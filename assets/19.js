

app_version1 = "427"
app_version2 = "Dev"
tcbx926n29 = app_version2 + " " + app_version1;

let modalIsAlreadyOpen = false;
let discordProfileEffectsCache = null;
let pplusProfileEffectsCache = null;
let communityThemesCache = null;
let atMeUsercache = null;
let claimablesShopcache = null;
let myXPBalancecache = null;
let myClaimablesClaimedCache = null;
let claimablesPromotionsCache = null;

defaultAvatar1 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAY1BMVEVYZfJib/OMlfahqPeWn/eBi/XLz/vq6/7////19f5tePTq7P22vPnV2Pyrsvirsvl3gvT09f7Axfp3gfRtePNsePPg4v22vPq2u/qCi/WhqPjf4/zf4v2Xn/essvjLzvuXnvdbidFTAAAETElEQVR4AezBgQAAAACAoP2pF6kCAAAAAAAAAAAAAAAAAAAAAIDZudMtV1UlDuCFRKlWIEJ6uOwbzXn/lzzzYc/GWiT6zya/79WrLeYSc5Vq9IFWa3Sr6JehWt0ZZn5RtFJvmHnodPsrPLx1/B9PKx1ziLOPnIRRO84EXaAP/CWnR3pArTWcybpA5G8NsX20pw+cSbpAngEeOQenY+Cf8KIZ4FuDfSV4Ko/7hS7wNjYH7W3MvNeHtn2jvxn+OXcgaP0x8KJo43vgnwqu85EXDfGVULWON9G1BOmDN/M/AnTgDSWC0xve0KAITeSsykFw4qzOQWB4YwNBOfLmPAHpeXsvr5XOgJkjGA3vIlU6A2bvOHvAnXwiCMrwTl5UpUtg5us7BAB2gcg78nXugaC6QORd+bo7AEAXiLwzX+8SANEFNHPdXcAwV90FDgxA037+zwAc7aZlCKnSNTDrADZBdU6DBwbha5wCAabBkWGkSqfAzFa6C8xeADYB9Y2ByEBsbSMAYAy0zHWPActQLPQuKBh3DiwiDRlwzwFOv9JfTpORh5x5rVfQc8CQiLLJiEMaA1oW6XgVq+grVh4yY56JA68x07fm8hCIhXCUPn823zgkG/HK4Rf6kYv8YBt5BQ03BQyv9CMq8M/JQ7IItw+e6cd8QQjKTqCX3OMTtOdCCNZOoCnqkrYgZEFD2/FF/08qDAE4Dji+TtHPKHknVmBboVB2i9HI9zIGahZUhaVqVxCyQEEVQ7rSBMj3QiPUUTCWJkC+8zrQVjzmELBYG2H5jDYUFqAiQDlMtAwKQgjr+nwoq9O2BSEQJQFVWKeNBSEQ6+BYeG3BFIUAHIfasmsLh7IQgLcjDZd0AWXEIZRDMDYCuuj73g95yJGxEuBLPmr6VBSyzMO9Fpzko3kqeA1r8W4GHOWNKQ/JIl4COL4SZf2lPAQhAY4lYrv860rlIVmHlYAsuBhjFwpCwO4LOkb0TMAzAc8EPBPwTMAGngl4JuCZgMig4jMB27AMykJUhCr4ekwzKI10T9hpwzcz6DNSUbRdORzThW/CJSKagd4LjKurof1suFCYVR54MDckpsBXDLk3pliQgxBTHneBrwiaNtOfeUUKCnMQYlKC32x2r7SlmSUpoOQdi5xtoqx1DNP8WW9kKSCVvAu8QnC2USR4/I2bP5vDmhS80pdOjXULw8dc7HSiL6ljYLTmz/ooKvJTdkqTt9G5s/mHczH6qXlV9I32Ehi0+QVfQbn7HryHhvY033V1Tuu3CRncOIj3rL3EV9pf7+53ced0bY+MIZm7ndEt9uNnkxN8OSWhAvjjZ8ktnIoKaMDHF0yH8S416C4Rpv7bU094pWJ9QFv4BJOBvnkFzjWKMvhu4G78IibMIz2EFM3KFUAwCEI+ID9MDia6kd/+enpFj+YE+af+aA8OZAAAAAAG+Vvf46sAAAAAAAAAAAAAAAAAAAAAAFYCeHSjWah9hFcAAAAASUVORK5CYII=`;
defaultAvatar2 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAhFBMVEV1fop9hpGgpq+ytr2prraXnqfT19vu7/H////29/iGjpju7/DCxszc3+K6vsS6v8WOlqD39/fLztPLz9OPlqDl5+nDx8ygpq6xtr6xtr3m5+iOlp/Dxsvc3+Hd3+GorraGjpnT19rT1tv29/eOlqHU19p+hpGprrWxt72or7bLz9Kfpq+ibmTzAAAEY0lEQVR4AezBAQEAAAQAIPB/swkMqAIAAAAAAAAAAAAAAAAAAAAAgBNZPfFWy86dLimOw3AAV5qYEXFicMKxHIFs03e///PtvaouagjRGMKfNr/vmhorsiMbpwcm+UZjN4PhD2YedR5TZpnZDgfmOww+L/h/jjoaS0iRG7pdk0HBQlECmeevisGEbpDJf7DQlUDJh2xlbm30noWmBGQFuOUcTMeej3CqFeCQzTOCl8i8bymBbPKQDlxeCecGqTH/Dc/ycUVK0LKx51ZVXs08H+WLoSu5la0yQmUK7sXQEKQ592ZOgFLukSE4meUe2YTQlCyinARTFnFOAss9swRlzL1zBCTj/o2ySFdAURCMBV+FiXQFFLP4esADvxGExPKVjJJIX4HCxbcJACyBkq/IxdkDQZVAyVfl4i4AgBIo+cpcvK8AiBJYMsddApY56hJIGcCSrmfFAAq6GsMQTKTvQDEEaILiXAZTBuEAlsAYl8E1wzCRLoEij7QLFKNYmwBhIp0BIo9tBgDMAcMc9xzYMJQcugvytl55VtCHWNx9wHaZ0d+mO6sP6Z7mBnQfYA2R2Fl1yMKCHov8zp3kycHKoQ9x3Mkj9Wv/i9s0FxCC9CJca8cv3JlDxBPecfgz/cwzt9j+etO5hFsCbEM/89I2e/QhoqI+2YBzGnfWEGHRuoBRQ6R9nu0hQJ3AIqgkNwEhLR6oPy7o/2MCQwC2AwWfltAxL/oifgFrhfZhtxitvpexAKug7nnU+gKqw2sO6DDk8bwJKKF6wZRPq8IToO28XqkvDnMK5FiNMB1n9SErqGZ4xeGvQV0IYV2f34ed05qgEIAjgZfAc9oyIATiPbgOvLZgA0IgtkMm7NpCGhCC8evIgkNKILHqEJIQjEZgGfR971wfMmasBLiQj5regkLaObifBd/p0Ls+xHBXOd7NgLH+YepDRIWXAK4yIpE9B4QAJaBgjcq0/3Wl8BDxiJUA4Yuqqob+YiGi7i0BiO4JuCfgnoB7Au4J6ME9AfcE3BNQMqjqnoAYrgkDnAc4BuWoH0sGtUS6J7xdWj4bu5wBHIqqL+yYZz6Lrek47wzOL0M7+kfjLAfyLpGJB3NDYrfnE2wq5VLagNF/GJl3nk/wS+pNM+PuKZAc6EefKP5m87ahPjnWpICMq1lllRsSpmCYxy8aq0sBJcbVnjvw23yR0OHwcR6/cPsuKcjoq+kir1d8lH3O0yl9lYw9oz1+0ZSqQ34SU5O6/KOuV/Zfdf3x4dJFltAB8+wZ9PErvoKqL7vxtp90TY5Pmlyy5ZI2QcDNg+qSZy9VQ9fX1Je7uDM91SNjMPZie/QN9vDFrtZ8OaXwsgcfvjB1y64owBJp+PrlsLrIGfSzIUzN4a7HNxSs2cO8+PSLwfLsJ3Dbh4QEfBlsz/xDjHcTQicHAPIGONck8LJBvpkc7OhMduxzk9CtmUL+U3+2BwcyAAAAAIP8re/xVQAAAAAAAAAAAAAAAAAAAAAAKwFiKavpSRGzHgAAAABJRU5ErkJggg==`;
defaultAvatar3 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAgVBMVEU7pVxIqmZ4wY+QzaOEx5lsu4TC48zm9Ov////z+fVHqmZUsHCp17jO6Nad0q2d0q5gtnry+vW13cK23cHa7uGp2Lep2Lh4wY6RzKOQzKPa7+Bsu4VgtXrz+vTa7uCExpnn9Orz+fTB48xTsHBHq2a23cKFx5mFxpmRzKR4wI9gtnsomQ4wAAAEZ0lEQVR4AezBgQAAAACAoP2pF6kCAAAAAAAAAAAAAAAAAAAAAIDZuc+1tXUYAMDKcKwMO6sDCCM0dN7//Z191B2iGmJR8/7+1KcWliM746ooTlJYLE5U9BuNXSWZRsS8gIVKjYg6S9TvMPjK4P8sLFRTiKkUPK4mMUgYU6Bs8UsmaeABqUoj4U2BDr+lO/Voo2+RcKYArQCPnIPGtvgTlrUCfEtXJYgXUd3PTIGyidPEVj2xNkmV+m94Gn/OpCBaaVuc1VX9i5k/aU1mO5yluxKkUgZXkSkQ6SWu5hUIlOKKFIhTalyRLkCaDkmQRdAgCbMINK5Mgyg1rs6CICWuLy8DXQGJATFeoxcq0BWQvJDVA3qwAREijZ7kRaCXQGKlbAKCngIdemTD7IFETYEOvbJhTwABU6BDz6z3S0DYU2CL3lnfu4Cgp0CKAmzAnx0KYMCbAUVQgV4DSea/CQp0GUxRCOt/CQxyGdyjGCrQJZBUgXaBJA+1CSAq7ArwUwMaBckDrwAfNfASRalEd0EHbY4HZOCHaLn7ALMt4W/NaeSHHHGpUug+YByAwGlkh8Sj0GORDBepCvjKK35ILXNPfP7FbVrtECLpQrjnjp/UDiGzGljTBhd4wy8e8+tN50bcEjBO8COXuerhh5Ae1qQdzmlqh5AZWloXkE8A3N+TEeK3E4jxuo7ZRfNDvhHDeqzT/2dwD/G9HTB4XQE/c2FWAIXMy2S1QTv+EpozQvyughfHo2rjEDKjEHUYkt02AW9F9YIpvy9xTUCG172DtViZJVCJaoT1TLzmh+xENcM7dLsM8kMAF9jJOgxQjDWUFeL/SODieE7buYX4vw7uHR9b0O4hfrdDg9tjC6ljiP+7IzG6TIFIs0OAQmQ0Ahun93tf8kNqlJUA6/II48Y1ZIYVd1vwPXzrPT9EibtB+PbXn9/auIfM6OUlALsSCJRv3EMkJMAgR6fmv67kHkIyWQkgren7PmvvFkKM3wT490zAMwHPBDwT8EzAMwHPBDwT4Gkv4F//TID/84AgHhi2KJT1eybo30bSc8JmO+LNjNuj/0NR/gM7Q4Y3YYaFJ8NKzp2hE/xjqkd0dKgLKjwxT0iczniFTmm6dKPD6PuB6q69+scfYDXTEZengHLAH33B+GazmWBNNXJSAIM1yHKsBiDKoJifn0wjLwVQDNYccIGDqeICZobv+ecn9XlJCkr4UhNXZqZ8dFalDXwpsi1K+/nJ1LEO+Qk0Q2qr3pij/pcxfW/TuCzgGyprUd7Pz30Lytx34z1+BJ9qvOqTe8s13yYQmXXQ3fPspZvAv8ngnAkcNNd6ZBmG8W579Feyh09OhvHmFMflLHz4ZDAzuyIHW4HDZyyH3V3OoLMBZJq+3fUcJnA2naVd+BiLwYebf7TRxAUQ8dPA3PhGzKH+BOLRAQD/CjBfBAfaID9MDk43q6u/R1/Ao2lE/lN/tgcHMgAAAACD/K3v8VUAAAAAAAAAAAAAAAAAAAAAACsBm86sivq4FSMAAAAASUVORK5CYII=`;
defaultAvatar4 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAjVBMVEX6phr6qyj7wWH8zX78x3D8wWH7vFP+47j+9OP/////+fH6sTf+9OL92Jv+6cb904z80o37t0X++vH93qn90436sTb7sTb7x3D80oz93an+7tT92Zv7wmH9zX/8zH7+79P7tkX92Jr82Jr/+vH+6Mb/9OP/9OL7qyj947j6rCj+79T8zX/95Lj7sTf915vvhd1yAAAEbklEQVR4AezBgQAAAACAoP2pF6kCAAAAAAAAAAAAAAAAAAAAAIDZuc/tRpUYAMAisAK54AAJnvFNZ5zYTnn/t7t9dXJc0Y4N8o6//0o8QlMpB0VXcQKt/Ygx+o3ajnGaEdGgdZuGGRGN0hh/h8aPc/ppAi1dc0g+RjhfRZwTE5TAsKTv8riAM4TjjJisBCpaN6rw3FpfEpOUAI8A55yD4qakHSayEWDNaHwL6kXc7/eUQF1cTWMztsyYeIpYw78y2i1PQLXhjovPqrGdlbRTmaemor1Gld4ywJw6kSKoNKbO/AEKJdQhVNj9M+rQKAJtKmJBdoKCWJidIKOOjUCVa+rcBBQZUvcGt4GOgCwHNe6oFxjoCMhmetaAPbkHFaKMejKIAp0C2UTLJiDoEqioRxMda6CgS6CiXk3CLgAFJVBRzyYKpoCQS+CBKOwSyIiCLoGEFIihP4+kQA69QVIBA50DWapzERTAMJiQEhONQ2AAw+ATqYGBDoHsOdBVIBuEughgqK4HBNAHMqKg+wAShd0HXkiVZ9WroCZzs4YE5CEjvfsAF9fwjyKZy0Nm1FatdB/wit+D5uKQu7nSY5G0Zdd8E48c6yFG5564+cVtmvEI0TQRPknbz8yRQ1gBXYqphQVss6A93K8vOmN1Q8BrDdssG9pNHsIsdCnzOKcxRw1hI22rgEENIL2egpB+VwJ3XiX54hGyxx10x3j9HvQIUbIdcHRYBLss5UW8VLYUauiglXwIHQhC+h0Fl55H1c4jZI9I1WFIetwEWFVrwSkdZv0TIF15TaErRmcXeFa1EB7JR7SR5wGUVXAcJpgGRSFALax0HQYg7IJeIQqOBJae57SVR4iKefDJ87GFzCNExXYI/R5bSDxCdNwduSOfEogycQhwiI6FQOz1fu9YHnJNuhJgfF5qevcK2c+ouy2YwLpEHoLqbhBaau1GfjHlIczqSwBVt8Bg+OERoigBjiQq3P91Jf8QlupKACtza21aniyE5T0kQI9LAi4JuCTgkoBLAjpwScAlAZcEWFLKXhIQwmPCCs4DDCllejgTVCVWdHOYXDyno3mNVwoORcUP7OCCjsJhy36HWu4M8dHmp5mTp8a8te54BXQkaeiAUcLlYj1y0Fjk/1nSAU0MnflcUfsUyHPArX8TfLPZ1dAlQ5IUABpHIrMvBIY5qbn87HMuSwG8oXENtdC4r7s3WG++nsvPTNMmBbfwXXH35Wa0U7b4mhbwXXRTkrbLzz6t6JCfQYFT82Wdm2X/cc5aM72r32ANLkrSd/mlb0Hlp914v/6APpmTzs7YfpnA1PUDe8qzF1tD/z7d6R7cKQ6tkXXA+cn26C+6m88SJ3lzSmDZKG8+Q7dnV+ThQVPz5cOhPckZdIqg0+f6rqepwdtnI5j4tA0G8dE/2uiu3oCpLwN35BsxjSlAPz4A4BngOJ2g4Q3y2eQggSNJ/mn9G5ybQuWf+qs9OJABAAAAGORvfY+vAgAAAAAAAAAAAAAAAAAAAABYCfy25L0QL4/pAAAAAElFTkSuQmCC`;
defaultAvatar5 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAh1BMVEXtQkXuTVDzfX/1lZf0iYvxcXP5xMT96Oj////+8/PuTlDvWVz95+j3rK360ND2oKL2oaLwZWf+8/T4uLnwZWj83Nz3ra73rK7yfX/1lZb1lJb829zxcXT70ND729z6z9D0lZbziYv95+f0lJb5xMXvWlzuTlHzfYD0iIvziYr73NzyfYD5w8SoNjStAAAEaklEQVR4AezBBwEAIAwAoN3+lY3gAgABAAAAAAAAAAAAAAAAAAAAAMAXWT1xVr352LnT/jZ5GADg6oKpDAanmPWEkLLQnd//6z33o90OmhOszPxfV/vN8iU7wG/UdrXJrxFRFzBTaRDR5Bv1OzS+qvF/FmbaUkhdXXISbjY1EsYQKBv8Ur25gQukqmskvCHg8FvGqUtrfYOEMwRoBbjkHLTbBn/C8laAb5iqBPGuaN57hkB58yrb2MoRazeZUv81z+DP1RmIVm4b9HKVe+35k6bOrUMv40qQStW4iFyBSLe4mDsQKMMFKRCnNLggU4A0DkmSk6BFkuYkMLgwA6JscXEWBClxebpMdAUkNYhxj1GoRFdA8lpWDRjBA4hwZTASXSS6BRKbwCFA/hBwGJFNoAaSPgQcRmUFDIC0h4DDyGz0LSDtIfCA0dnYp4Ckh0CGAjxCPE8oQA3RdCiCSnQPJHn8IijRZTBDIWz8JTDJZbBFMVSiSyCpEq0CiU61CCAq0RlAqkRnANGJz4AYc+AORalEV0Ha9DuNDPwQI/ccMOxL+Fv7PPJDdjhXKfQcMHYA5Hlkh9yPQq9FcpylKtgrx7chVuaZWP/iMc0GhEjaCFtu+4k9cQi5gSW9wRkO8CMH9Bh+veh8FLcEjBP8yItv9vBDiBNXB1v4MXvSEGKkVQF6AuD2JyMkbiXwNmhI3gWEeNzDcmzQ/6cLD4l9HOjxuAJ+5oU7AyjEK5dVBj15wq/5tcx15FWQ3x8DfwAN4WNO0GVIftoEOFG1YIbHufAEcCuvd7AUK3MKVKIKYcNf0UzgBZSLex3G3wYZIYAzPMm6DFCsNZQREv9K4CXwntaFhcTfB9vAxxZMeEjc41AX9thCFhbioeKcBZn9eWXYIUAhMgqBN0Hv997yQ7YoKwE25KWmfWiIhxX3s+B7+NZ7fogS9wOhw9m2/M7khxAnLwHoSiBQHsJDJCSgRw6n/F9XCg8huawEkKZ2zuXN2ULIED8BEa0JWBOwJmBNwJqABawJWBOwJsChUG5NQPz7gCQeGLYolI1/JxjXo6TnhIf9iCcz7j/EvxTlP7DTHfAkhm7mvFNSfhmiq83JjhhI24ImnpgnJJ41HmEyGi4uIAfadTTvGjxCP8Jipg84PwWUA37rC8Y3m4cJlmSRkwLobI8su6oDQs0X0P1kGnkpgKKzvcYZ9FB9LMDT/MjdT6yek4ISvtR+rPqd588PVdbCl662DUrrfjI51iU/gbbLbOX6fmf+1ffO2exjWcA31KFBod3PeAtqOO/Be7yHmCwe1Z6p5KIygcicB+6cdy9ugvimHn2m8xWdQwcydOPZzuh3sptPnnvOm1MML1p480nXe05FAfYCm89YDt1Z7qA/dSDT5MaZb44xTFraxsdYDB7Bjz8JhlcFEPHDYDjxDzHatiAeXQD4dwD+JNB0QL6YHLyHE3n/d+sLuDStyH/qz/bgQAYAAABgkL/1Pb4KAAAAAAAAAAAAAAAAAAAAAGAlB3yyZnlY4UQAAAAASUVORK5CYII=`;
defaultAvatar6 = `data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAZlBMVEXrRZ/sUKXxf73zl8nyi8Pwc7f5xOH96PP////+8/ntXKv86PP2rdX60Of1os/vZ7H+9Pn3udvuaLHzi8P73O32rtX0lsnzlsnwdLf95/P4xOH4xeH4udvsUaXxgL383O3yisPvaLFF0RjvAAAET0lEQVR4AezBgQAAAACAoP2pF6kCAAAAAAAAAAAAAAAAAAAAAIDZuc/FVnUYDuBiJbLBKs5ooLvv/5B3X3UTdJzAP4f8PldtLTxkM47K8qKk0fKiyn6jtlfFas3MbnSbfM3M9aqofofGN4H/JzSSaEhoLjkJN0VgZegCvuX3QnFDF6hq1qxsXSDyZ3WsLq31LStLF9AZ4JJzsJGWfyC2GeCTuvEEL9NxP9AF/E2+LaSJSqTYVpWnf9T8s1ASNC8tD4pN3A38SBtWEnlQHT2hqgJPYlURpD1PZk+ASp5QRXB8zROqM0ITWS1yEGxYLXMQ1DyxmqAIT04IiOfpOb/QGVAFgpHzLKqFzoBqh1MDzuSWIGQ1z8RlC10ClSxvEwDYBSLPSJZZA0F1gcizkmV3AIAuEHlmstwlAKILHHh2ssRdAEwXKBnALc1nxwACzaZjCNVC10C1WmYRBDANlgxCljgFAkyDG4ZRLXQKVM1Cq0DlllcEAIyByECahY4A5ZY2AgDGwJ6hNNBVkFuHnWMDe0iNuw8IB09/25S9PWR8mj3oPqDv3gf15pC8Bz0WueNRmuzTzGEPEcw9sfvFbZqkh0AshBtr+5WcOETd4B2H39N37u0b2wegScAwBfSevvPo+Gf2EBXh6mCh70lCCEol4C3P8Rmu50AIViXwlNQl9wkhA3KajiT9P11iCMB2IPBxGf3k0d6JH8FKIcdHPdPP1vZaZg01Cz4mHlWHhJABGdRhyOq0CYhQteCWj4upCbBXXiVNRTCHQANVCNdDM5o9ZAdVDO84fRm0hRCP8Ix1GFBZ5lBDCMCRwGPiOW1MCgFYBzeJjy3UCSEQ26Eu7bGFMi0E4O7IE6d0gaw2h5CGYBQCh6T3e/f2EGGsBEjKI4yH1JABAndb8IU+e7GHVHA3CCOPJvaLaQ9RES8BHD2R8vcJIUAJCGwRq+GvK6WHqBVWAlQbYoyr9mwhKsyQABzXBFwTcE3ANQHXBFwTcE3ANQETiAwqXhOwhMeEAc4DhEHJDGeCUG6Bbg5zOPR8Mv1hB3Moanhgp7vnkwjdyHFXodwZ0qNNLz0ncpLpwIN5QqJ0fEStvbGLCTlwsdO/2fIR7pYm43c8PgX2HGjrM8M3m4OnKQlbUkCdBDbZNR2pKjDM5Ve+t6WAsk6C4xFcaJ4yMjR/4suvxI1Jgaf3Nk9N2PGP1vfNdkPvZdIy2uVXPhoO+d/bdFtpYgi79b9CiFG2Tz6jT6r7lkEvv+EtqHDejXef05yEj3o9U8mlZYLCHAfxnGcv0dP8fDjfgzubYzUyhq4/2x59j918VQbDm1MWjw68+aoLA7uiBAfA5humw3iWM+hVR5h87E//BXjv0BY+w2Rwe/ITuJBnpOC7QTjxjRgnr4RPDwB0BTjNIHC6Qb6YHLzQibz83fqMLs0G8lf92R4cyAAAAAAM8re+x1cBAAAAAAAAAAAAAAAAAAAAAKwEXiSjy96AYeIAAAAASUVORK5CYII=`;

localStorage.experiment_2025_02_mobile_render = "Treatment 1: Use new mobile check";

if (!localStorage.ext_sty_category_tab) {
    localStorage.ext_sty_category_tab = "1";
}

if (!localStorage.reviews_filter_type) {
    localStorage.reviews_filter_type = "2";
}

if (!localStorage.reviews_privacy_type) {
    localStorage.reviews_privacy_type = "1";
}

if (!localStorage.reviews_time_type) {
    localStorage.reviews_time_type = "us";
}

if (localStorage.sa_theme) {
    document.body.classList.add('theme-' + localStorage.sa_theme);
} else if (!localStorage.sa_theme) {
    localStorage.sa_theme = "dark";
    document.body.classList.add('theme-dark');
}

let communityThemeImport = document.createElement("style");

communityThemeImport.id = 'community-theme-import';
if (localStorage.community_theme_raw) {
    communityThemeImport.innerHTML = `${localStorage.community_theme_raw}`;
}

document.body.appendChild(communityThemeImport);

if (localStorage.discord_banner) {
    
} else {
    localStorage.discord_banner = ``;
}

if (localStorage.discord_banner_color) {
    
} else {
    localStorage.discord_banner_color = `#829ff4`;
}

if (localStorage.discord_avatar && localStorage.discord_avatar != '') {

} else {
    setRandomDiscordAvatar()
}

function setRandomDiscordAvatar() {
    localStorage.discord_avatar = ``;
    const randomAvatar = Math.floor(Math.random() * (6 - 1 + 1)) + 1;

    if (randomAvatar === 1) {
        localStorage.discord_avatar = defaultAvatar1;
    } else if (randomAvatar === 2) {
        localStorage.discord_avatar = defaultAvatar2;
    } else if (randomAvatar === 3) {
        localStorage.discord_avatar = defaultAvatar3;
    } else if (randomAvatar === 4) {
        localStorage.discord_avatar = defaultAvatar4;
    } else if (randomAvatar === 5) {
        localStorage.discord_avatar = defaultAvatar5;
    } else if (randomAvatar === 6) {
        localStorage.discord_avatar = defaultAvatar6;
    }
}


if (localStorage.discord_username && localStorage.discord_username != '') {

} else {
    setRandomDiscordUsername()
}

function setRandomDiscordUsername() {
    localStorage.discord_username = `default_user`;
    // fetch('https://apis.kahoot.it/namerator')
    // .then(response => response.json())
    // .then((data) => {
    //     localStorage.discord_username = data.name.toLowerCase();
    //     localStorage.discord_displayname = data.name;
    // })

}


if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
    if (localStorage.experiment_2025_02_mobile_render === "Treatment 1: Use new mobile check") {
    




        document.getElementById("options-sidebar-container").remove();

        sessionStorage.setItem('api-token', 'token');

        const api_password = localStorage.getItem("api-password");
        const discord_token = localStorage.getItem("discord_token");
        const api_token = sessionStorage.getItem("api-token");
        api = 'https://api.yapper.shop/v2';
        discordsupport = 'https://support.discord.com/hc/en-us/articles/';
        discordblog = 'https://discord.com/blog/';
        yapperblog = 'https://yapper.shop/blog/';
        cdn = 'https://cdn.yapper.shop/';
        tmpapi = 'https://api.yapper.shop/tmp';


        endpoints = [
            COLLECTIBLES = "/collectibles-shop?tab=shop&has-leaks=true",
            COLLECTIBLES_IN_SHOP = "/collectibles-categories-published",
            CONSUMABLES = "/consumables",
            MISCELLANEOUS = "/collectibles-shop?tab=miscellaneous",
            PROFILES_PLUS = "/collectibles-shop?tab=pplus",
            HOME_PAGE_ALL = "/preview-1",
            HOME_PAGE_LEAKS = "/preview-2",
            HOME_PAGE_PPLUS = "/preview-3",
            PROFILE_EFFECTS = "/profile-effects?tab=discord",
            DOWNLOADABLE_DATA = "/downloads",
            PROFILES_PLUS_EFFECTS = "/profile-effects?tab=pplus",
            LEAKS = "/leaked-categories",
            COLLECTIBLES_MARKETING = "/collectibles-marketing",
            COLLECTIBLES_VARIANTS = "/collectibles-categories-variants",
            EXPERIMENT_ROLLOUTS = "/rollout-handler",
            COLLECTIBLES_SHOP_HOME = "/collectibles-shop-home",
            NEW_ITEMS = "/new-items",
            ORBS_SHOP = "/orbs-shop",
            ORBS_SHOP_DEFAULT = "/orbs-shop-default"
        ]

        yapper_categories = [
            WINDOWKILL = "profiles-plus-1",
            BOPL_BATTLE = "profiles-plus-2",
            PAPER_BEACH = "profiles-plus-3",
            WINDOWKILL_V2 = "profiles-plus-4",
            FIVE_NIGHTS_AT_FREDDYS = "profiles-plus-5",
            PLUS_SPECIAL_EVENT = "profiles-plus-6",
            GEOMETRY_DASH = "profiles-plus-7",
            PAPER_BEACH_V2 = "profiles-plus-8",
            RBXDOORS = "profiles-plus-9"
        ]
    
    
        discord_categories = [
            FANTASY = "1144003461608906824",
            ANIME = "1144302037593497701",
            BREAKFAST = "1144054000099012659",
            DISXCORE = "1144058340327047249",
            FALL = "1157406994873991284",
            HALLOWEEN = "1157410718711304313",
            WINTER = "1174459301239197856",
            MONSTERS = "1179493515038818325",
            CYBERPUNK = "1197342727608746044",
            LUNAR_NEW_YEAR = "1202069709281828935",
            ELEMENTS = "1207046915880124426",
            ANIME_V2 = "1212565175790473246",
            SPECIAL_EVENTS = "1217175518781243583",
            SPECIAL_EVENTS_2 = "1309309974266118144",
            SPRINGTOONS = "1217622942175727736",
            SHY = "1220513972189663413",
            LOFI_VIBES = "1228243842684162121",
            GALAXY = "1232029045928099922",
            FEELIN_RETRO = "1237649643073044491",
            PIRATES = "1237653589896200272",
            ARCADE = "1245086656973901894",
            TIDE = "1252404112650407998",
            DARK_FANTASY = "1256321669388308595",
            ROBERT = "1262491137386614805",
            STORM = "1265375293397270650",
            DOJO = "1266520267946201099",
            THE_VAULT = "1277733175191277721",
            AUTUMN_EQUINOX = "1282816432056569866",
            BAND = "1285465421339693076",
            SPOOKY_NIGHT = "1287835634089594972",
            CHANCE = "1293373563494993952",
            MYTHICAL_CREATURES = "1298033986811068497",
            WARRIOR = "1303490165284802580",
            KAWAII_MODE = "1306330663213072494",
            LOFI_GIRL = "1309668861943218229",
            WINTER_WONDERLAND = "1314020997204283476",
            FANTASY_V2 = "1324454241254903829",
            STEAMPUNK = "1326333074241486859",
            PROGRESS = "1333278032999485461",
            RADIATE = "1336483992429658112",
            VALENTINES = "1333866045521395723",
            ORB = "1332505418219655258",
            ANIME_V3 = "1341506445249609728",
            INSOMNIA = "1343751621364027462",
            NAMEPLATE_TEST = "1344802365307621427",
            AESPA = "1346499610977243196"
        ]
    
        category_types = [
            HERO = 0,
            FEATURED = 1,
            FEED = 2,
            WIDE_BANNER = 3
        ]
    
        item_types = [
            NONE = 100,
            AVATAR_DECORATION = 0,
            PROFILE_EFFECT = 1,
            NAMEPLATE = 2,
            BUNDLE = 1e3,
            VARIANTS_GROUP = 2e3,
            EXTERNAL_SKU = 3e3
        ]

        const nameplate_palettes = {
            crimson: {
                "darkBackground": "#900007",
                "lightBackground": "#E7040F"
            },
            berry: {
                "darkBackground": "#893A99",
                "lightBackground": "#B11FCF"
            },
            sky: {
                "darkBackground": "#0080B7",
                "lightBackground": "#56CCFF"
            },
            teal: {
                "darkBackground": "#086460",
                "lightBackground": "#7DEED7"
            },
            forest: {
                "darkBackground": "#2D5401",
                "lightBackground": "#6AA624"
            },
            bubble_gum: {
                "darkBackground": "#DC3E97",
                "lightBackground": "#F957B3"
            },
            violet: {
                "darkBackground": "#730BC8",
                "lightBackground": "#972FED"
            },
            cobalt: {
                "darkBackground": "#0131C2",
                "lightBackground": "#4278FF"
            },
            clover: {
                "darkBackground": "#047B20",
                "lightBackground": "#63CD5A"
            }
        }

        const params = new URLSearchParams(window.location.search);

        function setParams(params) {
            const url = new URL(window.location);
        
            // Clear all existing query parameters
            url.search = '';
        
            // Set the new query parameters from the provided object
            Object.entries(params).forEach(([key, value]) => {
                url.searchParams.set(key, value);
            });
        
            // Update the address bar without reloading the page
            history.replaceState(null, '', url);
        }

        function addParams(params) {
            const url = new URL(window.location);

            Object.entries(params).forEach(([key, value]) => {
                url.searchParams.set(key, value);
            });

            history.replaceState(null, '', url);
        }

        const clickable_side_tabs_container = document.getElementById('clickable-side-tabs-container');
        if (clickable_side_tabs_container) {  // Check if element exists
            document.getElementById('clickable-side-tabs-container').innerHTML = `
                <meta class="mobile-client" name="viewport" content= "width=device-width, user-scalable=no">
                <div class="dm-divider">Shop</div>
                <div id="collectibles-section">
                    <button class="dm-button" id="shop-tab" onclick="setParams({page: 'shop'}); location.reload();">
                        <p class="dm-button-text">Shop</p>
                    </button>
                    <button class="dm-button" id="miscellaneous-tab" onclick="setParams({page: 'miscellaneous'}); location.reload();">
                        <p class="dm-button-text">Misc</p>
                    </button>
                </div>
                <div id="new-profiles-plus-tab-container">
                </div>
            `;

            if (localStorage.experiment_2025_02_profiles_plus_home === "Treatment 2: Enabled") {
                document.getElementById('new-profiles-plus-tab-container').innerHTML = `
                    <div class="dm-divider">Profiles Plus</div>
                    <div id="collectibles-section">
                        <button class="dm-button" id="pplus-tab" onclick="setParams({page: 'pplus'}); location.reload();">
                            <p class="dm-button-text">Browse</p>
                        </button>
                    </div>
                `;
            }

            if (localStorage.experiment_2025_02_profiles_plus_home === "Treatment 3: Hide All Profiles Plus Tabs") {
                document.getElementById('new-profiles-plus-tab-container').innerHTML = ``;
            }
        }

        function pageCheck() {
            // if (params.get("page") === "home") {
            //     document.title = "Featured | Shop Archives";
            //     if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
            //         if (localStorage.unreleased_discord_collectibles == "true") {
            //             url = api + HOME_PAGE_ALL;
            //             apiUrl = new URL(url);
            //             apiUrl.searchParams.set("include-unpublished", "true");
            //         } else {
            //             apiUrl = api + HOME_PAGE_ALL;
            //         }
            //     } else {
            //         apiUrl = api + HOME_PAGE_ALL;
            //     }
            //     createHomePageElement()
            //     document.getElementById("home-tab").classList.add('dm-button-selected');
            //     document.getElementById("top-bar-container").innerHTML = `
            //         <h2 class="shop-tab-page-title">Featured</h2>
            //         <div id="open-help-modals-buttons-holder-new"></div>
            //     `;
            // } else if (params.get("page") === "year_recap") {
            //     document.title = "2025 Recap | Shop Archives";
            //     document.getElementById("recap-2024-tab").classList.add('dm-button-selected');
            //     localStorage.dismissible_recap_2024 = "Treatment 1: Seen";
            //     document.getElementById("top-bar-container").innerHTML = `
            //         <h2 class="shop-tab-page-title">2025 Recap</h2>
            //         <div id="open-help-modals-buttons-holder-new"></div>
            //     `;
            // } else 
            
            if (params.get("page") === "shop") {
                document.title = "Shop All | Shop Archives";
                if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                    if (localStorage.unreleased_discord_collectibles == "true") {
                        url = api + COLLECTIBLES;
                        apiUrl = new URL(url);
                        apiUrl.searchParams.set("include-unpublished", "true");
                    } else {
                        apiUrl = api + COLLECTIBLES;
                    }
                } else {
                    apiUrl = api + COLLECTIBLES;
                }
                createMainShopElement()
                document.getElementById("shop-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 style="margin-left: 10px; margin-top: 10px;">Shop > Shop All</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            }
            
            // else if (params.get("page") === "orbs") {
            //     document.title = "Orb Rewards | Shop Archives";
            //     if (localStorage.experiment_2025_02_orbs_shop === "Treatment 2: Orb Shop done like default") {
            //         apiUrl = api + ORBS_SHOP_DEFAULT;
            //     } else {
            //         apiUrl = api + ORBS_SHOP;
            //     }
            //     createMainPotionsElement()
            //     document.getElementById("top-bar-container").innerHTML = `
            //         <h2 class="shop-tab-page-title">Shop > Orb Rewards</h2>
            //         <div id="open-help-modals-buttons-holder-new"></div>
            //     `;
            // }
            // else if (params.get("page") === "leaks") {
            //     document.title = "Leaks | Shop Archives";
            //     if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
            //         if (localStorage.unreleased_discord_collectibles == "true") {
            //             url = api + LEAKS;
            //             apiUrl = new URL(url);
            //             apiUrl.searchParams.set("include-unpublished", "true");
            //         } else {
            //             apiUrl = api + LEAKS;
            //         }
            //     } else {
            //         apiUrl = api + LEAKS;
            //     }
            //     createMainShopElement()
            //     document.getElementById("top-bar-container").innerHTML = `
            //         <h2 class="shop-tab-page-title">Shop > Leaks</h2>
            //         <div id="open-help-modals-buttons-holder-new"></div>
            //     `;
            // } 
            else if (params.get("page") === "consumables") {
                document.title = "Potions | Shop Archives";
                if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                    if (localStorage.unreleased_discord_collectibles == "true") {
                        url = api + CONSUMABLES;
                        apiUrl = new URL(url);
                        apiUrl.searchParams.set("include-unpublished", "true");
                    } else {
                        apiUrl = api + CONSUMABLES;
                    }
                } else {
                    apiUrl = api + CONSUMABLES;
                }
                createMainPotionsElement()
                document.getElementById("potions-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 style="margin-left: 10px; margin-top: 10px;">Shop > Potions</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            } else if (params.get("page") === "miscellaneous") {
                document.title = "Miscellaneous | Shop Archives";
                if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                    if (localStorage.unreleased_discord_collectibles == "true") {
                        url = api + MISCELLANEOUS;
                        apiUrl = new URL(url);
                        apiUrl.searchParams.set("include-unpublished", "true");
                    } else {
                        apiUrl = api + MISCELLANEOUS;
                    }
                } else {
                    apiUrl = api + MISCELLANEOUS;
                }
                createMainShopElement()
                document.getElementById("miscellaneous-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 style="margin-left: 10px; margin-top: 10px;">Shop > Miscellaneous</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            }
            // else if (params.get("page") === "pplus-home") {
            //     document.title = "Featured | Shop Archives";
            //     if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
            //         if (localStorage.unreleased_profiles_plus == "true") {
            //             url = api + HOME_PAGE_PPLUS;
            //             apiUrl = new URL(url);
            //             apiUrl.searchParams.set("include-unpublished", "true");
            //         } else {
            //             apiUrl = api + HOME_PAGE_PPLUS;
            //         }
            //     } else {
            //         apiUrl = api + HOME_PAGE_PPLUS;
            //     }
            //     createHomePageElement()
            //     document.getElementById("pplus-home-tab").classList.add('dm-button-selected');
            //     document.getElementById("top-bar-container").innerHTML = `
            //         <h2 class="shop-tab-page-title">Profiles Plus > Featured</h2>
            //         <div id="open-help-modals-buttons-holder-new"></div>
            //     `;
            // }

            else if (params.get("page") === "pplus") {
                document.title = "Profiles Plus | Shop Archives";
                if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                    if (localStorage.unreleased_profiles_plus == "true") {
                        url = api + PROFILES_PLUS;
                        apiUrl = new URL(url);
                        apiUrl.searchParams.set("include-unpublished", "true");
                    } else {
                        apiUrl = api + PROFILES_PLUS;
                    }
                } else {
                    apiUrl = api + PROFILES_PLUS;
                }
                if (localStorage.experiment_2024_12_profiles_plus_marketing_variants == "Treatment 1: Paper Beach V2") {
                    localStorage.dismissible_paper_beach_v2_marketing = "Treatment 1: Seen";
                } else if (localStorage.experiment_2024_12_profiles_plus_marketing_variants == "Treatment 2: Roblox Doors") {
                    localStorage.dismissible_roblox_doors_marketing = "Treatment 1: Seen";
                }
                createMainShopElement()
                document.getElementById("pplus-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 style="margin-left: 10px; margin-top: 10px;">Profiles Plus > Browse All</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            } else if (params.get("page") === "published_listings") {
                document.title = "Published Listings | Shop Archives";
                createPublishedListingsPageElement()
                document.getElementById("published-listings-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 class="shop-tab-page-title">Published Listings</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            } else if (params.get("page") === "orb_converter") {
                document.title = "Orb Converter | Shop Archives";
                createOrbConverterPageElement()
                document.getElementById("orb-converter-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 class="shop-tab-page-title">Orb Converter</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            } else if (params.get("page") === "item_tool") {
                document.title = "Item Tool | Shop Archives";
                createItemToolPageElement()
                document.getElementById("avatar-decorations-debug-tab").classList.add('dm-button-selected');
                document.getElementById("top-bar-container").innerHTML = `
                    <h2 class="shop-tab-page-title">Item Tool | Staff Only</h2>
                    <div id="open-help-modals-buttons-holder-new"></div>
                `;
            } else {
                setParams({page: 'shop',err: '404'});
                document.title = "Shop All | Shop Archives";
                location.reload();
            }
        }
    
        pageCheck();

        function fetchData() {
            if (params.get("page") != "home" && params.get("page") != "pplus-home" && params.get("page") != "year-recap") {
    
    
                // Make the function async
                fetch(apiUrl, {
                    method: "GET",
                    headers: {
                        "Password": api_password,
                        "Authorization": discord_token,
                        "Token": api_token
                    }
                })
                    .then(response => response.json())
                    .then((data) => {
    
                        if (data.message === "Missing Access") {
                            document.getElementById("everything-housing-container").innerHTML = `
                                <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                                    <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                                    <h2>Well, this is awkward.</h2>
                                    <p>Hmmm, we weren&#8217;t able to load the shop. Check back later.</p>
                                    <p>Error: Missing Access</p>
                                    <button class="refresh-button" onclick="location.reload();">Reload</button>
                                </div>
                            `;
                        } else {
                            processCategories();
                        }
                        // Define async function inside the .then block
                        async function processCategories() {
                            const categoryTemplate = document.querySelector("[data-shop-category-template]");
                            const potionTemplate = document.querySelector("[data-potion-card-template]");
                            const categoryOutput = document.querySelector("[data-shop-output]");
                            const page = params.get("page");
                
                            for (const apiCategory of data) {
                                if (page === "pplus") {
                                    // Existing code for 'pplus' page
                                    const category = categoryTemplate.content.cloneNode(true).children[0];
                                    category.querySelector("[data-shop-category-banner]").id = apiCategory.sku_id;
                
                                    category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.mobile_banner}.png`;
                                    category.querySelector("[data-shop-category-banner-image]").alt = 'No Mobile Banner';
    
                                    if (apiCategory.category_bg != null) {
                                        category.querySelector("[data-shop-category-marketing-bg]").src = `https://cdn.yapper.shop/assets/${apiCategory.category_bg}.png`;
                                    }
    
    
                                    const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                    if (cardOutput) {
                                        for (const product of apiCategory.products) {
                                            const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                            const card = cardTemplate.content.cloneNode(true).children[0];
    
                                            if (product.type === NONE) {
                                                card.classList.add("type_100");
                                                card.classList.add('hidden')
                                            } else if (product.type === AVATAR_DECORATION) {
                                                product.items.forEach(item => {
                                                    card.classList.add("type_0");
                                                    // Set the innerHTML for the preview holder
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Set the initial image for the deco card
                                                    const imgElement = document.createElement("img");
                                                    imgElement.id = "shop-card-deco-image";
                                                    imgElement.src = `https://cdn.yapper.shop/custom-collectibles/${item.static}.png`;
                                                    
                                                    previewHolder.appendChild(imgElement);
    
                                                    const bgimg = document.createElement("div");
                                                    bgimg.id = "shop-card-deco-bg-image";
                                                    
                                                    previewHolder.appendChild(bgimg);
                                            
                                                    // Set the product details
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `Made By: ${product.credits}`;
                                                    card.querySelector("[data-product-card-name]").textContent = product.name;
                                                    card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                    // Hover effect: Change the image src on mouse enter and leave
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = `https://cdn.yapper.shop/custom-collectibles/${item.animated}.png`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            imgElement.src = `https://cdn.yapper.shop/custom-collectibles/${item.static}.png`;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                        });
                                                    }
                                                });
                                            } else if (product.type === PROFILE_EFFECT) {
                                                card.classList.add("type_1");
    
                                                card.querySelector("[data-product-card-sku-id]").textContent = `Made By: ${product.credits}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                                
                                                // Ensure the item ID is accessible here
                                                let itemId = undefined;
                                                if (Array.isArray(product.items)) {
                                                    // If items is an array, find the item with type 1 and get its id
                                                    const item = product.items.find(item => item.type === 1);
                                                    if (item) {
                                                        itemId = item.id;
                                                    }
                                                } else if (product.items && product.items.type === 1) {
                                                    // If items is an object and has type 1, get its id
                                                    itemId = product.items.id;
                                                }
                                            
                                            
                                                // Fetch profile effects API only if not already cached
                                                if (!discordProfileEffectsCache) {
                                                    const response = await fetch(api + PROFILES_PLUS_EFFECTS, {
                                                        method: "GET",
                                                        headers: {
                                                            "Password": api_password,
                                                            "Authorization": discord_token,
                                                            "Token": api_token
                                                        }
                                                    });
                                                    const effectsData = await response.json();
                                                    discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                }
                                            
                                                // Find matching profile effect
                                                const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                            
                                                if (matchingEffect) {
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('profile-effect-image');
                                            
                                                    previewHolder.innerHTML = `
                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                    `;
                                            
                                                    // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                    const imgElement = card.querySelector("img");
                                            
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                        });
                                                    } else {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = matchingEffect.reducedMotionSrc;
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                        });
                                                    }
                                                }
                                            } else if (product.type === NAMEPLATE) {
                                                card.classList.add("type_2");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
    
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
    
                                                if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                    previewName = localStorage.discord_displayname;
                                                } else {
                                                    previewName = 'Default User'
                                                }
    
                                                previewHolder.innerHTML = `
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _1"></div>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _2"></div>
                                                    </div>
                                                    <div class="nameplate-null-user" data-user-nameplate-preview>
                                                        <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                        <p class="nameplate-user-name">${previewName}</p>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _2"></div>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _1"></div>
                                                    </div>
                                                `;
    
                                                const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
    
                                                nameplatePreview.style.backgroundImage = `linear-gradient(10deg, #00000000 40%,rgb(144, 0, 7) 180%), linear-gradient(170deg, #00000000 40%,rgb(144, 0, 7) 180%)`;
                                                nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
    
                                                const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
    
                                                nullUserNameRandomWidth.forEach(UserName => {
                                                    const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                    UserName.style.width = randomWidth + `px`;
                                                });
    
                                                const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
    
                                                nullUserAvatar.forEach(UserAvatar => {
                                                    UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                });
                                                
                                            } else if (product.type === BUNDLE) {
                                                card.classList.add("type_1000");
                                                // Fetch the bundled products for the bundle summary
                                                const bundledProducts = product.bundled_products || [];
                                            
                                                // Generate the bundle summary from the names of the bundled products
                                                const type0Product = bundledProducts.find(item => item.type === 0);
                                                const type1Product = bundledProducts.find(item => item.type === 1);
                                            
                                                let bundleSummary = "Bundle Includes: ";
                                                if (type0Product) {
                                                    bundleSummary += `${type0Product.name} Decoration`;
                                                }
                                                if (type1Product) {
                                                    bundleSummary += ` & ${type1Product.name} Profile Effect`;
                                                }
                                            
                                                // Set the summary text
                                                card.querySelector("[data-product-card-summary]").textContent = bundleSummary;
                                            
                                                // Set the basic card details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `Made By: ${product.credits}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                            
                                                // Handle each item in the bundle
                                                product.items.forEach(item => {
                                                    if (item.type === 0) {
                                                        // Avatar decoration
                                                        const decoImage = document.createElement("img");
                                                        decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.static}.png`;
                                                        decoImage.alt = "Avatar Decoration";
                                                        decoImage.classList.add("avatar-decoration-image");
                                                        card.querySelector("[data-shop-card-preview-holder]").appendChild(decoImage);
    
                                                        const bgimg = document.createElement("div");
                                                        bgimg.classList.add("avatar-decoration-bg-image");
                                                        
                                                        card.querySelector("[data-shop-card-preview-holder]").appendChild(bgimg);
                                            
                                                        // Hover effect for decoration image
                                                        if (localStorage.reduced_motion != "true") {
                                                            card.addEventListener("mouseenter", () => {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.animated}.png`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            });
                                                            card.addEventListener("mouseleave", () => {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.static}.png`;
                                                                bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                            });
                                                        }
                                                    } else if (item.type === 1) {
                                                        // Profile effect
                                                        let discordProfileEffectsCache = null; // Cache profile effects to avoid multiple fetches
                                            
                                                        (async () => {
                                                            if (!discordProfileEffectsCache) {
                                                                const response = await fetch(api + PROFILES_PLUS_EFFECTS, {
                                                                    method: "GET",
                                                                    headers: {
                                                                        "Password": api_password,
                                                                        "Authorization": discord_token,
                                                                        "Token": api_token
                                                                    }
                                                                });
                                                                const effectsData = await response.json();
                                                                discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                            }
                                            
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                            
                                                            if (matchingEffect) {
                                                                const effectImage = document.createElement("img");
                                                                effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                effectImage.alt = "Profile Effect";
                                                                effectImage.classList.add("profile-effect-image");
                                                                card.querySelector("[data-shop-card-preview-holder]").appendChild(effectImage);
                                            
                                                                // Hover effect for profile effect
                                                                if (localStorage.reduced_motion != "true") {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects[0] && matchingEffect.effects[0].src) {
                                                                            effectImage.src = matchingEffect.effects[0].src;
                                                                        }
                                                                    });
                                                                    card.addEventListener("mouseleave", () => {
                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        effectImage.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                    card.addEventListener("mouseleave", () => {
                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        })();
                                                    }
                                                });
                                            } else if (product.type === VARIANTS_GROUP) {
                                                // Update SKU and summary
                                                card.querySelector("[data-product-card-sku-id]").textContent = `Made By: ${product.credits}`;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                // Always display the base variant name
                                                card.querySelector("[data-product-card-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                            
                                                // Render variant color blocks as interactive divs
                                                const variantContainer = card.querySelector("[data-shop-card-var-container]");
                                                variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                let currentSelectedVariant = null; // Track selected variant
                                            
                                                product.variants.forEach((variant, index) => {
                                                    // Create variant color block
                                                    const variantColorBlockTmp = document.querySelector("[data-shop-varcolorblock-template]");
                                                    const variantColorBlock = variantColorBlockTmp.content.cloneNode(true).children[0];
                                                    variantColorBlock.classList.add("shop-card-var");
                                                    variantColorBlock.id = "shop-card-var";
                                                    variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                            
                                                    // Add click event listener to switch variants
                                                    variantColorBlock.addEventListener("click", () => {
                                                        if (currentSelectedVariant) {
                                                            currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                        }
                                                        variantColorBlock.classList.add("shop-card-var-selected");
                                                        currentSelectedVariant = variantColorBlock;
                                                        applyVariant(variant);
                                                    });
                                            
                                                    // Append the color block to the container
                                                    variantContainer.appendChild(variantColorBlock);
                                            
                                                    // Set the first variant as the default selected
                                                    if (index === 0) {
                                                        currentSelectedVariant = variantColorBlock;
                                                        variantColorBlock.classList.add("shop-card-var-selected");
                                                    }
                                                });
    
                                                let isFirstTimeLoadingVariant = true;
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                            
                                                // Function to apply the selected variant
                                                function applyVariant(selectedVariant) {
                                                    card.querySelector("[data-shop-card-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                    if (selectedVariant.type === 0) {
                                                        card.classList.add("type_2000-0");
                                                        previewHolder.innerHTML = ""; // Clear previous decorations
                                                        previewHolder.classList.add('avatar-decoration-image');
                                                        
                                                        // Add the avatar decoration based on the selected variant
                                                        selectedVariant.items?.forEach(item => {
                                                            const decoImage = document.createElement("img");
                                                            const bgimg = document.createElement("div");
                                                            if (isFirstTimeLoadingVariant == true) {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.static}.png`;
                                                                isFirstTimeLoadingVariant = false;
                                                            } else {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.animated}.png`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            }
                                                            decoImage.alt = "Avatar Decoration";
                                                            decoImage.id = "shop-card-deco-image";
                                                            previewHolder.appendChild(decoImage);
    
                                                            bgimg.id = "shop-card-deco-bg-image";
    
                                                            previewHolder.appendChild(bgimg);
                                                        
                                                            // Hover effect for decoration image
                                                            if (localStorage.reduced_motion !== "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.animated}.png`;
                                                                    if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                        bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                    }
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    decoImage.src = `https://cdn.yapper.shop/custom-collectibles/${item.static}.png`;
                                                                    bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                                });
                                                            }
                                                        });
                                                    } else if (selectedVariant.type === 1) {
                                                        card.classList.add("type_2000-1");
                                                        (async () => {
                                                            // Ensure the item ID is accessible here
                                                            let itemId = undefined;
                                                            if (Array.isArray(selectedVariant.items)) {
                                                                // If items is an array, find the item with type 1 and get its id
                                                                const item = selectedVariant.items.find(item => item.type === 1);
                                                                if (item) {
                                                                    itemId = item.id;
                                                                }
                                                            } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                // If items is an object and has type 1, get its id
                                                                itemId = selectedVariant.items.id;
                                                            }
                                                        
                                                        
                                                            // Fetch profile effects API only if not already cached
                                                            if (!discordProfileEffectsCache) {
                                                                const response = await fetch(api + PROFILES_PLUS_EFFECTS, {
                                                                    method: "GET",
                                                                    headers: {
                                                                        "Password": api_password,
                                                                        "Authorization": discord_token,
                                                                        "Token": api_token
                                                                    }
                                                                });
                                                                const effectsData = await response.json();
                                                                discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                            }
                                                        
                                                            // Find matching profile effect
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                        
                                                            if (matchingEffect) {
                                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                                previewHolder.classList.add('profile-effect-image');
                                                            
                                                                if (isFirstTimeLoadingVariant == true) {
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                    `;
                                                                    isFirstTimeLoadingVariant = false;
                                                                } else {
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.effects[0]?.src}">
                                                                    `;
                                                                }
                                                            
                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                const imgElement = card.querySelector("img");
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    card.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    card.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        })();
                                                    }
                                                }
                                            
                                                // Apply the default variant (first one) initially
                                                if (product.variants.length > 0) {
                                                    applyVariant(product.variants[0]);
                                                }
                                            } else if (product.type === EXTERNAL_SKU) {
                                                card.classList.add("type_3000");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
    
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
    
                                                previewHolder.innerHTML = `
                                                    <p>item type 3000 (EXTERNAL_SKU) is not yet defined on the client, please remove it from the api</p>
                                                `;
                                                
                                            } else if (product.type === 'plus_more') {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                card.querySelector("[data-product-card-name]").textContent = `Plus More...`;
                                                card.querySelector("[data-product-card-summary]").textContent = `There are more items in this category that are coming soon.`;
    
                                                card.querySelector("[data-shop-price-container]").innerHTML = ``;
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                                card.querySelector("[data-share-product-card-button]").innerHTML = ``;
    
                                                const plusMoreQuestionMark = document.createElement("img");
                                                plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                                card.querySelector("[data-shop-card-preview-holder]").appendChild(plusMoreQuestionMark);
                                    
                                                // Hover effect for decoration image
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                    });
                                                    card.addEventListener("mouseleave", () => {
                                                        plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                    });
                                                }
                                            } else {
                                                card.classList.add('hidden')
                                            }
    
    
    
                                            if (product.emojiCopy === null) {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="location.href='https://discord.gg/SVKQEYeTsN';" title="Request item in our Discord server">Request to P+</button>
                                                `;
                                            } else {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="copyEmoji('${product.emojiCopy}');" title="Request item in our Discord server">Copy P+ Emoji</button>
                                                `;
                                            }
    
                                            if (product.premium_type === 2) {
                                                card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                `;
                                            }
    
    
                                            const unpublishedAt = new Date(product.unpublished_at);
                                
                                            if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = unpublishedAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">OFF SALE</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${days} DAYS LEFT TO REQUEST</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
    
                                            const ExpiredAt = new Date(product.expires_at);
                                
                                            if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = ExpiredAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">EXPIRED</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">EXPIRES IN ${days}D ${hours}H</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
                                            const ReleasesAt = new Date(product.releases_at);
                                
                                            if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = ReleasesAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">PUBLISHING...</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${days}D ${hours}H</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
                                            // Append card to output
                                            card.classList.add('shop-category-card-transparent')
                                            cardOutput.append(card);
                                        }
                                    }
                
                                    categoryOutput.append(category);
                                    
    
                                } else if (page === "consumables") {
                                    // Existing code for 'consumables' page
                                    const potionCard = potionTemplate.content.cloneNode(true).children[0];
                                    potionCard.querySelector("[data-potion-card-holder]").id = apiCategory.sku_id;
    
                                    potionCard.id = apiCategory.sku_id;
    
                                    potionCard.querySelector("[data-potion-card-holder]").classList.add('potion-card-gradient1');
                
                                    if (apiCategory.src === null) {
                                        potionCard.querySelector("[data-potion-card-preview-image]").src = `https://cdn.yapper.shop/assets/31.png`;
                                    } else {
                                        potionCard.querySelector("[data-potion-card-preview-image]").src = `https://cdn.yapper.shop/${apiCategory.endpoint}/${apiCategory.src}.${apiCategory.format}`;
                                    }
                                    potionCard.querySelector("[data-potion-card-preview-image]").alt = apiCategory.name;
    
                                    if (apiCategory.new_text != null) {
                                        potionCard.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                            <div class="unplublished-tag">
                                                <p class="unplublished-tag-text">${apiCategory.new_text}</p>
                                            </div>
                                        `;
                                    }
                
                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                        potionCard.querySelector("[data-product-card-sku-id]").textContent = ``;
                                    } else {
                                        potionCard.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${apiCategory.sku_id}`;
                                    }
                                    potionCard.querySelector("[data-product-card-name]").textContent = apiCategory.name;
                                    potionCard.querySelector("[data-product-card-summary]").textContent = apiCategory.summary;
    
                                    let priceStandard = "N/A";
                            
                                    if (apiCategory.price) {
                                        priceStandard = apiCategory.price.amount;
                                    }
    
    
                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                        potionCard.classList.add('clickable');
    
                                        potionCard.addEventListener("click", () => {
                                            openItemModal();
                                        });
    
                                        async function openItemModal() {
                                            let modal = document.createElement("div");
    
                                            modal.classList.add('modalv2');
    
                                            if (apiCategory.pdp_bg != null) {
                                                pdp = apiCategory.pdp_bg
                                            } else {
                                                pdp = apiCategory.banner
                                            }
    
                                            modal.innerHTML = `
                                                <div class="modalv2-inner">
                                                    <div class="modalv2-inner-left">
                                                        <p data-product-modal-sku-id></p>
                                                        <p style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                        <p style="color: var(--8)" data-product-modal-summary></p>
                                                        <div class="modal-shop-price-container" data-shop-price-container>
                                                            <div data-price-standard-container>
                                                                <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                                            </div>
                                                        </div>
                                                        <div class="modal-left-bottom">
                                                            <div class="modal-buttons" data-modal-buttons></div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div data-modal-top-product-buttons>
                                                        <div title="Close" data-close-product-card-button>
                                                            <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                        </div>
                                                        <div title="Download Data" data-download-product-card-button></div>
                                                    </div>
    
                                                    <div class="shop-modal-tag-container" data-shop-card-tag-container></div>
    
                                                    <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                        <img class="modalv2-inner-img" src="https://cdn.yapper.shop/assets/110.svg"></img>
                                                        <div data-modal-preview-holder></div>
                                                    </div>
                                                </div>
                                            `;
    
                                            document.body.appendChild(modal);
    
                                            setTimeout(() => {
                                                modal.classList.add('show');
                                            }, 1);
    
    
                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                            previewHolder.classList.add('modal-potion-img');
    
                                            const imgElement = document.createElement("img");
                                            imgElement.classList.add('potion-card-preview');
                                            imgElement.src = `https://cdn.yapper.shop/${apiCategory.endpoint}/${apiCategory.src}.${apiCategory.format}`;
    
                                            previewHolder.appendChild(imgElement);
                                            
                                            // Set the product details
                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${apiCategory.sku_id}`;
                                            modal.querySelector("[data-product-modal-name]").textContent = apiCategory.name;
                                            modal.querySelector("[data-product-modal-summary]").textContent = apiCategory.summary;
    
    
                                            const button_container = document.querySelector("[data-modal-buttons]");
                                            
                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads") {
                                                button_container.innerHTML = `
                                                    <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                                `;
                                                modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                    <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                `;
                                            } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+") {
                                                button_container.innerHTML = `
                                                    <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                                `;
                                                modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                    <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                `;
                                            } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                button_container.innerHTML = `
                                                    <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                                `;
                                                modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                    <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                `;
                                            } else {
                                                button_container.innerHTML = `
                                                    <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                                `;
                                            }
    
    
                                            let priceStandard = "N/A";
                            
                                            if (apiCategory.price) {
                                                priceStandard = apiCategory.price.amount;
                                            }
    
    
                                            const priceTextNitro = modal.querySelector("[data-price-nitro]");
                                            const priceTextStandard = modal.querySelector("[data-price-standard]");
    
                                            const priceContainerNitro = modal.querySelector("[data-price-nitro-container]");
                                            const priceContainerStandard = modal.querySelector("[data-price-standard-container]");
    
                                            const priceContainer = modal.querySelector("[data-shop-price-container]");
    
                                            if (localStorage.experiment_2025_01_orb_testing === "Treatment 1: Default Prices") {
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = priceStandard !== "N/A" ? `${priceStandard}` : "Price (USD): N/A";
                                                }
                                            
                                                let orb_icon = document.createElement("div");
                                            
                                                orb_icon.classList.add('orb-icon');
                                            
                                                priceContainerStandard.appendChild(orb_icon);
                                            
                                            } else if (localStorage.experiment_2025_01_orb_testing === "Treatment 2: 50 Orbs") {
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = `50`;
                                                }
                                            
                                                let orb_icon = document.createElement("div");
                                            
                                                orb_icon.classList.add('orb-icon');
                                            
                                                priceContainerStandard.appendChild(orb_icon);
                                            
                                            } else if (localStorage.experiment_2025_01_orb_testing === "Treatment 3: Dynamic") {
    
                                                if (apiCategory.price.currency === "discord_orb") {
                                                    if (priceTextStandard) {
                                                        priceTextStandard.textContent = priceStandard !== "N/A" ? `${priceStandard}` : "Price (USD): N/A";
                                                    }
                                                
                                                    let orb_icon = document.createElement("div");
                                                
                                                    orb_icon.classList.add('orb-icon');
                                                
                                                    priceContainerStandard.appendChild(orb_icon);
                                                
                                                } else {
                                                    if (priceTextStandard) {
                                                        priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "Price (USD): N/A";
                                                    }
                                                }
    
                                            } else {
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "Price (USD): N/A";
                                                }
                                            }
    
                                            if (apiCategory.new_text != null) {
                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="unplublished-tag">
                                                        <p class="unplublished-tag-text">${apiCategory.new_text}</p>
                                                    </div>
                                                `;
                                            }
    
    
                                            document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                modal.classList.add('potion-wobble')
                                            });
                                    
                                            document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                modal.classList.remove('potion-wobble')
                                            });
                                            
    
    
                                            let modal_back = document.createElement("div");
    
                                            modal_back.classList.add('modalv2-back');
                                            modal_back.id = 'modalv2-back';
    
                                            document.body.appendChild(modal_back);
    
                                            setTimeout(() => {
                                                modal_back.classList.add('show');
                                            }, 1);
    
    
                                            modal.addEventListener('click', (event) => {
                                                if (event.target === modal) {
                                                    modal.classList.remove('show');
                                                    modal_back.classList.remove('show');
                                                    setTimeout(() => {
                                                        modal.remove();
                                                        modal_back.remove();
                                                    }, 300);
                                                }
                                            });
    
                                            document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                modal.classList.remove('show');
                                                modal_back.classList.remove('show');
                                                setTimeout(() => {
                                                    modal.remove();
                                                    modal_back.remove();
                                                }, 300);
                                            });
                                        }
                                    }
                            
                                    
                                    const priceTextNitro = potionCard.querySelector("[data-price-nitro]");
                                    const priceTextStandard = potionCard.querySelector("[data-price-standard]");
    
                                    const priceContainerNitro = potionCard.querySelector("[data-price-nitro-container]");
                                    const priceContainerStandard = potionCard.querySelector("[data-price-standard-container]");
    
                                    const priceContainer = potionCard.querySelector("[data-shop-price-container]");
    
                                    if (localStorage.experiment_2025_01_orb_testing === "Treatment 1: Default Prices") {
                                        if (priceTextStandard) {
                                            priceTextStandard.textContent = priceStandard !== "N/A" ? `${priceStandard}` : "Price (USD): N/A";
                                        }
                                    
                                        let orb_icon = document.createElement("div");
                                    
                                        orb_icon.classList.add('orb-icon');
                                    
                                        priceContainerStandard.appendChild(orb_icon);
                                    
                                    } else if (localStorage.experiment_2025_01_orb_testing === "Treatment 2: 50 Orbs") {
                                        if (priceTextStandard) {
                                            priceTextStandard.textContent = `50`;
                                        }
                                    
                                        let orb_icon = document.createElement("div");
                                    
                                        orb_icon.classList.add('orb-icon');
                                    
                                        priceContainerStandard.appendChild(orb_icon);
                                    
                                    } else {
                                        if (priceTextStandard) {
                                            priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "Price (USD): N/A";
                                        }
                                    }
    
                                    potionCard.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                        <button class="card-button" onclick="location.href='${discordsupport}${apiCategory.support_id}';" title="Open this Potion's support article">Open Support Article</button>
                                    `;
    
                                    potionCard.addEventListener("mouseenter", () => {
                                        potionCard.classList.add('potion-wobble')
                                    });
                            
                                    potionCard.addEventListener("mouseleave", () => {
                                        potionCard.classList.remove('potion-wobble')
                                    });
                
                                    categoryOutput.append(potionCard);
                                } else {
                                    // Default page handling
                                    const category = categoryTemplate.content.cloneNode(true).children[0];
                                    category.querySelector("[data-shop-category-banner]").id = apiCategory.sku_id;
    
    
                                    // Banner Image/Video asset
                
                                    if (apiCategory.mobile_banner === null) {
                                        category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.banner}.png?size=4096`;
                                    } else {
                                        category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.mobile_banner}.png?size=4096`;
                                    }
                                    category.querySelector("[data-shop-category-banner-image]").alt = 'No Mobile Banner';

                                    if (apiCategory.mobile_bg != null) {
                                        category.querySelector("[data-shop-category-marketing-bg]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.mobile_bg}.png?size=4096`;
                                    }
                                    
    
                                    category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-banner-banner-container`;
    
    
                                    const unpublishedAt = new Date(apiCategory.unpublished_at);
                                
                                    if (apiCategory.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                        
                                        function updateTimer() {
                                            const now = new Date();
                                            const timeDiff = unpublishedAt - now;
                        
                                            if (timeDiff <= 0) {
                                                category.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="unplublished-tag">
                                                        <p class="unplublished-tag-text">NOT IN STORE</p>
                                                    </div>
                                                `;
                                                clearInterval(timerInterval);
                                            } else {
                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                        
                                                category.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="unplublished-tag">
                                                        <p class="unplublished-tag-text">${days} DAYS LEFT IS SHOP</p>
                                                    </div>
                                                `;
                                            }
                                        }
                        
                                        const timerInterval = setInterval(updateTimer, 1000);
                                        updateTimer();
                                    }
    
                
                                    const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                    if (cardOutput) {
                                        for (const product of apiCategory.products) {
                                            const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                            const card = cardTemplate.content.cloneNode(true).children[0];
    
                                            if (product.type === NONE) {
                                                card.classList.add("type_100");
                                                card.classList.add('hidden')
                                            } else if (product.type === AVATAR_DECORATION) {
                                                product.items.forEach(item => {
                                                    
                                                    card.classList.add("type_0");
                                                    // Set the innerHTML for the preview holder
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Set the initial image for the deco card
                                                    const imgElement = document.createElement("img");
                                                    imgElement.id = "shop-card-deco-image";
                                                    imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                    
                                                    previewHolder.appendChild(imgElement);
    
                                                    const bgimg = document.createElement("div");
                                                    bgimg.id = "shop-card-deco-bg-image";
                                                    
                                                    previewHolder.appendChild(bgimg);
                                            
                                                    // Set the product details
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                    } else {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                    }
                                                    card.querySelector("[data-product-card-name]").textContent = product.name;
                                                    card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                    // Hover effect: Change the image src on mouse enter and leave
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                        });
                                                    }
                                                    
                                                });
                                            } else if (product.type === PROFILE_EFFECT) {
                                                card.classList.add("type_1");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                                
                                                // Ensure the item ID is accessible here
                                                let itemId = undefined;
                                                if (Array.isArray(product.items)) {
                                                    // If items is an array, find the item with type 1 and get its id
                                                    const item = product.items.find(item => item.type === 1);
                                                    if (item) {
                                                        itemId = item.id;
                                                    }
                                                } else if (product.items && product.items.type === 1) {
                                                    // If items is an object and has type 1, get its id
                                                    itemId = product.items.id;
                                                }
                                            
                                            
                                                // Fetch profile effects API only if not already cached
                                                if (!discordProfileEffectsCache) {
                                                    const response = await fetch(api + PROFILE_EFFECTS, {
                                                        method: "GET",
                                                        headers: {
                                                            "Password": api_password,
                                                            "Authorization": discord_token,
                                                            "Token": api_token
                                                        }
                                                    });
                                                    const effectsData = await response.json();
                                                    discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                }
                                            
                                                // Find matching profile effect
                                                const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                            
                                                if (matchingEffect) {
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('profile-effect-image');
                                            
                                                    previewHolder.innerHTML = `
                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                    `;
                                            
                                                    // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                    const imgElement = card.querySelector("img");
                                            
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                        });
                                                    } else {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = matchingEffect.reducedMotionSrc;
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                        });
                                                    }
                                                }
                                            } else if (product.type === NAMEPLATE) {
                                                card.classList.add("type_2");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
    
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
    
                                                if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                    previewName = localStorage.discord_displayname;
                                                } else {
                                                    previewName = 'Default User'
                                                }
    
                                                previewHolder.innerHTML = `
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _1"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _2"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-null-user" data-user-nameplate-preview>
                                                        <video muted loop class="nameplate-null-user" style="position: absolute;" data-user-nameplate-preview-img></video>
                                                        <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                        <p class="nameplate-user-name">${previewName}</p>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _2"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _1"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-fade-top"></div>
                                                    <div class="nameplate-fade-bottom"></div>
                                                `;
    
                                                product.items.forEach(item => {
                                                    const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                    const paletteName = item.palette;
                                                    const asset = `https://cdn.discordapp.com/assets/collectibles/${item.asset}asset.webm`;
                                                    const bgcolor = nameplate_palettes[paletteName].darkBackground;
    
                                                    const videoElement = previewHolder.querySelector("[data-user-nameplate-preview-img]");
    
                                                    videoElement.src = asset;
    
                                                    nameplatePreview.style.backgroundImage = `linear-gradient(10deg, #00000000 40%, ${bgcolor} 180%), linear-gradient(170deg, #00000000 40%, ${bgcolor} 180%)`;
                                                    // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                    
                                                    const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                    
                                                    nullUserNameRandomWidth.forEach(UserName => {
                                                        const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                        UserName.style.width = randomWidth + `px`;
                                                    });
                                                
                                                    const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                                
                                                    nullUserAvatar.forEach(UserAvatar => {
                                                        UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                    });
    
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            videoElement.play();
                                                        });
                                                        card.addEventListener("mouseleave", () => {
                                                            videoElement.pause();
                                                        });
                                                    }
                                                });
                                                
                                            } else if (product.type === BUNDLE) {
                                                card.classList.add("type_1000");
                                                // Fetch the bundled products for the bundle summary
                                                const bundledProducts = product.bundled_products || [];
                                            
                                                // Generate the bundle summary from the names of the bundled products
                                                const type0Product = bundledProducts.find(item => item.type === 0);
                                                const type1Product = bundledProducts.find(item => item.type === 1);
                                            
                                                let bundleSummary = "Bundle Includes: ";
                                                if (type0Product) {
                                                    bundleSummary += `${type0Product.name} Decoration`;
                                                }
                                                if (type1Product) {
                                                    bundleSummary += ` & ${type1Product.name} Profile Effect`;
                                                }
                                            
                                                // Set the summary text
                                                card.querySelector("[data-product-card-summary]").textContent = bundleSummary;
                                            
                                                // Set the basic card details
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                            
                                                // Handle each item in the bundle
                                                product.items.forEach(item => {
                                                    if (item.type === 0) {
                                                        // Avatar decoration
                                                        const decoImage = document.createElement("img");
                                                        decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                        decoImage.alt = "Avatar Decoration";
                                                        decoImage.classList.add("avatar-decoration-image");
                                                        card.querySelector("[data-shop-card-preview-holder]").appendChild(decoImage);
    
                                                        const bgimg = document.createElement("div");
                                                        bgimg.classList.add("avatar-decoration-bg-image");
                                                        
                                                        card.querySelector("[data-shop-card-preview-holder]").appendChild(bgimg);
                                            
                                                        // Hover effect for decoration image
                                                        if (localStorage.reduced_motion != "true") {
                                                            card.addEventListener("mouseenter", () => {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            });
                                                            card.addEventListener("mouseleave", () => {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                            });
                                                        }
                                                    } else if (item.type === 1) {
                                                        // Profile effect
                                                        (async () => {
                                                            // Fetch profile effects if not cached
                                                            if (!discordProfileEffectsCache) {
                                                                const response = await fetch(api + PROFILE_EFFECTS, {
                                                                    method: "GET",
                                                                    headers: {
                                                                        "Password": api_password,
                                                                        "Authorization": discord_token,
                                                                        "Token": api_token
                                                                    }
                                                                });
                                                                const effectsData = await response.json();
                                                                discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                            }
                                            
                                                            // Find the matching effect
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                            
                                                            if (matchingEffect) {
                                                                const effectImage = document.createElement("img");
                                                                effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                effectImage.alt = "Profile Effect";
                                                                effectImage.classList.add("profile-effect-image");
                                                                card.querySelector("[data-shop-card-preview-holder]").appendChild(effectImage);
                                            
                                                                // Hover effect for profile effect
                                                                if (localStorage.reduced_motion != "true") {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects[0] && matchingEffect.effects[0].src) {
                                                                            effectImage.src = matchingEffect.effects[0].src;
                                                                        }
                                                                    });
                                                                    card.addEventListener("mouseleave", () => {
                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        effectImage.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                    card.addEventListener("mouseleave", () => {
                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        })();
                                                    }
                                                });
                                            } else if (product.type === VARIANTS_GROUP) {
                                                // Update SKU and summary
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                // Always display the base variant name
                                                card.querySelector("[data-product-card-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                            
                                                // Render variant color blocks as interactive divs
                                                const variantContainer = card.querySelector("[data-shop-card-var-container]");
                                                variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                let currentSelectedVariant = null; // Track selected variant
                                            
                                                product.variants.forEach((variant, index) => {
                                                    // Create variant color block
                                                    const variantColorBlockTmp = document.querySelector("[data-shop-varcolorblock-template]");
                                                    const variantColorBlock = variantColorBlockTmp.content.cloneNode(true).children[0];
                                                    variantColorBlock.classList.add("shop-card-var");
                                                    variantColorBlock.id = "shop-card-var";
                                                    variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                            
                                                    // Add click event listener to switch variants
                                                    variantColorBlock.addEventListener("click", () => {
                                                        if (currentSelectedVariant) {
                                                            currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                        }
                                                        variantColorBlock.classList.add("shop-card-var-selected");
                                                        currentSelectedVariant = variantColorBlock;
                                                        applyVariant(variant);
                                                    });
                                            
                                                    // Append the color block to the container
                                                    variantContainer.appendChild(variantColorBlock);
                                            
                                                    // Set the first variant as the default selected
                                                    if (index === 0) {
                                                        currentSelectedVariant = variantColorBlock;
                                                        variantColorBlock.classList.add("shop-card-var-selected");
                                                    }
                                                });
    
                                                let isFirstTimeLoadingVariant = true;
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                            
                                                // Function to apply the selected variant
                                                function applyVariant(selectedVariant) {
                                                    card.querySelector("[data-shop-card-var-title]").textContent = `(${selectedVariant.variant_label})`;
    
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                    } else {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                    }
    
                                                    if (localStorage.experiment_2025_02_shop_card_modals != "Treatment 1: Enable modals" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 2: Enable modals w/ data downloads" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 3: Enable modals w/ p+" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 4: Enable modals w/ p+ on p+ page" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 5: Enable modals w/ data downloads and p+" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        card.querySelector("[data-share-product-card-button]").innerHTML = `
                                                            <svg class="shareIcon_f4a996" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${selectedVariant.sku_id}');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                        `;
                                                    }
    
                                                    if (selectedVariant.type === 0) {
                                                        card.classList.add("type_2000-0");
                                                        previewHolder.innerHTML = ""; // Clear previous decorations
                                                        previewHolder.classList.add('avatar-decoration-image');
                                                        
                                                        // Add the avatar decoration based on the selected variant
                                                        selectedVariant.items?.forEach(item => {
                                                            const decoImage = document.createElement("img");
                                                            const bgimg = document.createElement("div");
                                                            if (isFirstTimeLoadingVariant == true) {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                isFirstTimeLoadingVariant = false;
                                                            } else {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            }
                                                            decoImage.alt = "Avatar Decoration";
                                                            decoImage.id = "shop-card-deco-image";
                                                            previewHolder.appendChild(decoImage);
    
                                                            bgimg.id = "shop-card-deco-bg-image";
    
                                                            previewHolder.appendChild(bgimg);
                                                        
                                                            // Hover effect for decoration image
                                                            if (localStorage.reduced_motion !== "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                    if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                        bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                    }
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                    bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                                });
                                                            }
                                                        });
                                                    } else if (selectedVariant.type === 1) {
                                                        card.classList.add("type_2000-1");
                                                        (async () => {
                                                            // Ensure the item ID is accessible here
                                                            let itemId = undefined;
                                                            if (Array.isArray(selectedVariant.items)) {
                                                                // If items is an array, find the item with type 1 and get its id
                                                                const item = selectedVariant.items.find(item => item.type === 1);
                                                                if (item) {
                                                                    itemId = item.id;
                                                                }
                                                            } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                // If items is an object and has type 1, get its id
                                                                itemId = selectedVariant.items.id;
                                                            }
                                                        
                                                        
                                                            // Fetch profile effects API only if not already cached
                                                            if (!discordProfileEffectsCache) {
                                                                const response = await fetch(api + PROFILE_EFFECTS, {
                                                                    method: "GET",
                                                                    headers: {
                                                                        "Password": api_password,
                                                                        "Authorization": discord_token,
                                                                        "Token": api_token
                                                                    }
                                                                });
                                                                const effectsData = await response.json();
                                                                discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                            }
                                                        
                                                            // Find matching profile effect
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                        
                                                            if (matchingEffect) {
                                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                                previewHolder.classList.add('profile-effect-image');
                                                            
                                                                if (isFirstTimeLoadingVariant == true) {
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                    `;
                                                                    isFirstTimeLoadingVariant = false;
                                                                } else {
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.effects[0]?.src}">
                                                                    `;
                                                                }
                                                            
                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                const imgElement = card.querySelector("img");
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    card.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    card.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        })();
                                                    }
                                                }
                                            
                                                // Apply the default variant (first one) initially
                                                if (product.variants.length > 0) {
                                                    applyVariant(product.variants[0]);
                                                }
                                            } else if (product.type === EXTERNAL_SKU) {
                                                card.classList.add("type_3000");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
    
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
    
                                                previewHolder.innerHTML = `
                                                    <p>item type 3000 (EXTERNAL_SKU) is not yet defined on the client, please remove it from the api</p>
                                                `;
                                                
                                            } else if (product.type === 'plus_more') {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                card.querySelector("[data-product-card-name]").textContent = `Plus More...`;
                                                card.querySelector("[data-product-card-summary]").textContent = `There are more items in this category that are coming soon.`;
    
                                                card.querySelector("[data-shop-price-container]").innerHTML = ``;
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                                card.querySelector("[data-share-product-card-button]").innerHTML = ``;
    
                                                const plusMoreQuestionMark = document.createElement("img");
                                                plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                                card.querySelector("[data-shop-card-preview-holder]").appendChild(plusMoreQuestionMark);
                                    
                                                // Hover effect for decoration image
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                    });
                                                    card.addEventListener("mouseleave", () => {
                                                        plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                    });
                                                }
                                            } else {
                                                card.classList.add('hidden')
                                            }
                                            
                                            
                                            const priceTextNitro = card.querySelector("[data-price-nitro]");
                                            const priceTextStandard = card.querySelector("[data-price-standard]");
    
                                            const priceContainerNitro = card.querySelector("[data-price-nitro-container]");
                                            const priceContainerStandard = card.querySelector("[data-price-standard-container]");
    
                                            const priceContainer = card.querySelector("[data-shop-price-container]");
    
                                            let priceStandard = "N/A";
                                            let priceNitro = "N/A";
                                            let priceOrb = "N/A";
    
                                            if (localStorage.experiment_2025_02_extra_options === "Treatment 4: Enabled") {
                                                if (localStorage.discord_premium_type === "2") {
                                                    if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                        product.prices["4"].country_prices.prices.forEach(price => {
                                                            if (price.currency === "discord_orb") {
                                                                priceOrb = price.amount;
                                                            }
                                                        });
                                                    }
                                            
                                                    if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                        product.prices["4"].country_prices.prices.forEach(price => {
                                                            if (price.currency === "usd") {
                                                                priceStandard = price.amount;
                                                            }
                                                        });
                                                    }
        
                                                    if (priceTextStandard) {
                                                        standardPriceOutput = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                                    }
    
                                                    priceContainerStandard.innerHTML = `
                                                        <a style="font-size: large; font-weight: 900; margin-left: 23px">${standardPriceOutput}</a>
                                                        <div class="nitro-icon" style="margin-left: -5px"></div>
                                                    `;
        
                                                    let orb_price = document.createElement("div");
                                                
                                                    orb_price.innerHTML = `
                                                        <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                        <div class="orb-icon" style="margin-left: -25px"></div>
                                                    `;
                                                    orb_price.style.position = `absolute`;
                                                    orb_price.style.right = `0px`;
        
                                                    if (priceOrb != 'N/A') {
                                                        priceContainer.appendChild(orb_price);
                                                    }
                                                } else {
                                                    if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                        product.prices["0"].country_prices.prices.forEach(price => {
                                                            if (price.currency === "discord_orb") {
                                                                priceOrb = price.amount;
                                                            }
                                                        });
                                                    }
                                            
                                                    if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                        product.prices["0"].country_prices.prices.forEach(price => {
                                                            if (price.currency === "usd") {
                                                                priceStandard = price.amount;
                                                            }
                                                        });
                                                    }
        
                                                    if (priceTextStandard) {
                                                        priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                                    }
        
                                                    let orb_price = document.createElement("div");
                                                
                                                    orb_price.innerHTML = `
                                                        <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                        <div class="orb-icon" style="margin-left: -25px"></div>
                                                    `;
                                                    orb_price.style.position = `absolute`;
                                                    orb_price.style.right = `0px`;
        
                                                    if (priceOrb != 'N/A') {
                                                        priceContainer.appendChild(orb_price);
                                                    }
                                                }
    
                                            } else {
                                                if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                    product.prices["0"].country_prices.prices.forEach(price => {
                                                        if (price.currency === "usd") {
                                                            priceStandard = price.amount;
                                                        }
                                                    });
                                                }
                                        
                                                if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                    product.prices["4"].country_prices.prices.forEach(price => {
                                                        if (price.currency === "usd") {
                                                            priceNitro = price.amount;
                                                        }
                                                    });
                                                }
    
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                                }
        
                                                if (priceTextNitro) {
                                                    priceTextNitro.textContent = priceNitro !== "N/A" ? `US$${(priceNitro / 100).toFixed(2)} with Nitro` : "null";
                                                }
                                            }
    
                                            if (priceTextStandard.textContent === "null" || priceTextNitro.textContent === "null") {
                                                let error_warning = document.createElement("div");
    
                                                error_warning.classList.add('card_error');
                                                error_warning.innerHTML = `
                                                    <p>ERROR</p>
                                                `;
                                                         
                                                card.appendChild(error_warning);
                                            }
    
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                <button class="card-button" onclick="location.href='https://discord.com/shop#itemSkuId=${product.sku_id}';" title="Open this item in the Discord Shop">Open In Shop</button>
                                            `;
    
                                            if (product.premium_type === 2) {
                                                card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                `;
                                            }
    
                                            card.querySelector("[data-share-product-card-button]").innerHTML = `
                                                <svg class="shareIcon_f4a996" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${product.sku_id}');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                            `;
    
    
                                            const unpublishedAt = new Date(product.unpublished_at);
                                
                                            if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = unpublishedAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">OFF SALE</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${days} DAYS LEFT IN SHOP</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
                                            const ExpiredAt = new Date(product.expires_at);
                                
                                            if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = ExpiredAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">EXPIRED</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">EXPIRES IN ${days}D ${hours}H</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
                                            // Append card to output
                                            cardOutput.append(card);
                                        }
                                    }
                
                                    categoryOutput.append(category);
                                }
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching the API:', error);
                        document.getElementById("everything-housing-container").innerHTML = `
                            <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                                <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                                <h2>Well, this is awkward.</h2>
                                <p>Hmmm, we weren&#8217;t able to load the shop. Check back later.</p>
                                <p>${error}</p>
                                <button class="refresh-button" onclick="location.reload();">Reload</button>
                            </div>
                        `;
                    });
    
            }
        }

        fetchData()


        function createMainShopElement() {
            document.getElementById("everything-housing-container").innerHTML = `
                <div class="shop-container" style="overflow-y: auto;">
                    <div class="shop-category" style="margin-top: 50px;">
                        <template data-shop-category-template>
                            <div class="thy-shop-category-idk">
                                <img class="shop-category-marketing-bg" src="https://cdn.yapper.shop/assets/31.png" data-shop-category-marketing-bg>
                                <div class="shop-category-banner" data-shop-category-banner>
                                    <div class="discordLogo_be5025" style="display: none;" data-shop-discord-watermark-container>
                                        <div><svg class="discordIcon_be5025" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M19.73 4.87a18.2 18.2 0 0 0-4.6-1.44c-.21.4-.4.8-.58 1.21-1.69-.25-3.4-.25-5.1 0-.18-.41-.37-.82-.59-1.2-1.6.27-3.14.75-4.6 1.43A19.04 19.04 0 0 0 .96 17.7a18.43 18.43 0 0 0 5.63 2.87c.46-.62.86-1.28 1.2-1.98-.65-.25-1.29-.55-1.9-.92.17-.12.32-.24.47-.37 3.58 1.7 7.7 1.7 11.28 0l.46.37c-.6.36-1.25.67-1.9.92.35.7.75 1.35 1.2 1.98 2.03-.63 3.94-1.6 5.64-2.87.47-4.87-.78-9.09-3.3-12.83ZM8.3 15.12c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.89 2.27-2 2.27Zm7.4 0c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.88 2.27-2 2.27Z" class=""></path></svg><svg class="discordWordmark_be5025" aria-hidden="true" role="img" width="55" height="16" viewBox="0 0 55 16"><g fill="currentColor"><path d="M3 4.78717H6.89554C7.83025 4.78717 8.62749 4.93379 9.27812 5.22703C9.92875 5.52027 10.4144 5.92348 10.7352 6.44582C11.0559 6.96815 11.2208 7.5638 11.2208 8.24192C11.2208 8.90171 11.0559 9.49736 10.7168 10.038C10.3778 10.5695 9.8646 11.0002 9.17732 11.3118C8.49003 11.6234 7.6378 11.7791 6.6197 11.7791H3V4.78717ZM6.57388 10.0014C7.2071 10.0014 7.69278 9.84559 8.03184 9.52485C8.3709 9.21328 8.54501 8.77343 8.54501 8.23276C8.54501 7.72875 8.38923 7.32555 8.08682 7.02314C7.78442 6.72073 7.32623 6.56495 6.71225 6.56495H5.49255V10.0014H6.57388Z"></path><path d="M17.2882 11.7709C16.7475 11.6335 16.2618 11.4319 15.8311 11.1569V9.4983C16.161 9.75489 16.5917 9.95649 17.1416 10.1214C17.6914 10.2864 18.2229 10.3689 18.7361 10.3689C18.9743 10.3689 19.1576 10.3414 19.2767 10.2772C19.3959 10.2131 19.46 10.1398 19.46 10.0481C19.46 9.94733 19.4233 9.86485 19.3592 9.80071C19.2951 9.73656 19.1668 9.68158 18.9743 9.62659L17.7739 9.36084C17.0866 9.20506 16.6009 8.97596 16.3077 8.70105C16.0144 8.42613 15.877 8.05042 15.877 7.59223C15.877 7.20735 16.0053 6.86829 16.2527 6.58421C16.5093 6.30013 16.8667 6.0802 17.334 5.92442C17.8014 5.76863 18.342 5.68616 18.9743 5.68616C19.5333 5.68616 20.0465 5.74114 20.5138 5.86944C20.9812 5.98857 21.3661 6.14435 21.6685 6.32763V7.89464C21.3569 7.71136 20.9904 7.56474 20.5871 7.45477C20.1748 7.34481 19.7533 7.28982 19.3226 7.28982C18.6994 7.28982 18.3878 7.39979 18.3878 7.61056C18.3878 7.71136 18.4337 7.78467 18.5345 7.83966C18.6353 7.89464 18.8094 7.94046 19.066 7.99544L20.0648 8.17871C20.7155 8.28868 21.2011 8.49028 21.5219 8.77436C21.8426 9.05844 21.9984 9.47081 21.9984 10.0298C21.9984 10.6346 21.7326 11.1203 21.2011 11.4685C20.6696 11.8259 19.9182 12 18.9468 12C18.3787 11.9817 17.8289 11.9084 17.2882 11.7709Z"></path><path d="M24.4735 11.5602C23.9054 11.2761 23.4655 10.9004 23.1814 10.4239C22.8882 9.94733 22.7507 9.40666 22.7507 8.80185C22.7507 8.20621 22.8974 7.66554 23.1998 7.19819C23.5022 6.72167 23.942 6.35512 24.5194 6.0802C25.0967 5.81445 25.7931 5.677 26.5995 5.677C27.5984 5.677 28.4231 5.88776 29.0829 6.3093V8.1329C28.8538 7.97712 28.5789 7.83965 28.2673 7.74802C27.9558 7.64721 27.6259 7.6014 27.2777 7.6014C26.6545 7.6014 26.178 7.71137 25.8206 7.94046C25.4724 8.16956 25.2983 8.46279 25.2983 8.82934C25.2983 9.18673 25.4632 9.47998 25.8115 9.70907C26.1505 9.93817 26.6453 10.0573 27.2868 10.0573C27.6167 10.0573 27.9466 10.0115 28.2673 9.91067C28.5881 9.80987 28.8722 9.69991 29.1013 9.55329V11.3219C28.3681 11.7618 27.5159 11.9817 26.5537 11.9817C25.7381 11.9817 25.0509 11.8351 24.4735 11.5602Z"></path><path d="M31.6955 11.5602C31.1182 11.2761 30.6783 10.9004 30.3759 10.4147C30.0735 9.929 29.9177 9.38834 29.9177 8.78353C29.9177 8.18788 30.0735 7.64722 30.3759 7.17986C30.6783 6.71251 31.1182 6.34595 31.6863 6.0802C32.2545 5.81445 32.9418 5.677 33.7299 5.677C34.518 5.677 35.2053 5.80529 35.7743 6.0802C36.3425 6.34595 36.7824 6.71251 37.0848 7.17986C37.3872 7.64722 37.5338 8.17872 37.5338 8.78353C37.5338 9.37918 37.3872 9.929 37.0848 10.4147C36.7824 10.9004 36.3517 11.2852 35.7743 11.5602C35.1961 11.8351 34.518 11.9817 33.7299 11.9817C32.951 11.9817 32.2728 11.8351 31.6955 11.5602ZM34.7287 9.79155C34.967 9.55329 35.0953 9.22339 35.0953 8.82934C35.0953 8.42614 34.9762 8.11457 34.7287 7.87632C34.4813 7.63806 34.1514 7.51892 33.7391 7.51892C33.3084 7.51892 32.9785 7.63806 32.731 7.87632C32.4928 8.11457 32.3645 8.42614 32.3645 8.82934C32.3645 9.23255 32.4836 9.55329 32.731 9.79155C32.9785 10.039 33.3084 10.1581 33.7391 10.1581C34.1514 10.1489 34.4905 10.0298 34.7287 9.79155Z"></path><path d="M43.6644 6.0435V8.19699C43.4078 8.03204 43.0779 7.94956 42.6747 7.94956C42.1432 7.94956 41.7308 8.11451 41.4467 8.43524C41.1626 8.75598 41.016 9.25999 41.016 9.93811V11.7709H38.5693V5.9427H40.9702V7.80295C41.0985 7.12482 41.3184 6.62082 41.6117 6.30008C41.9049 5.97935 42.2898 5.80524 42.7572 5.80524C43.1054 5.80524 43.4078 5.88771 43.6644 6.0435Z"></path><path d="M51.9136 4.58649V11.7801H49.4659V10.4696C49.2552 10.9645 48.9436 11.3402 48.5221 11.5968C48.1005 11.8534 47.5782 11.9817 46.9551 11.9817C46.4052 11.9817 45.9195 11.8442 45.5072 11.5785C45.0948 11.3127 44.7741 10.937 44.5542 10.4696C44.3342 9.99313 44.2242 9.46163 44.2242 8.87514C44.2151 8.26117 44.3342 7.71134 44.5816 7.22566C44.8199 6.73998 45.1681 6.36426 45.608 6.08935C46.0479 5.81444 46.5519 5.67698 47.12 5.67698C48.2838 5.67698 49.0627 6.18099 49.4659 7.19817V4.58649H51.9136ZM49.0994 9.7457C49.3468 9.50744 49.4751 9.18671 49.4751 8.80183C49.4751 8.42612 49.356 8.12371 49.1086 7.89462C48.8611 7.66552 48.5312 7.5464 48.1189 7.5464C47.7065 7.5464 47.3766 7.66553 47.1292 7.90378C46.8818 8.14204 46.7626 8.44444 46.7626 8.82932C46.7626 9.2142 46.8818 9.51661 47.1292 9.75487C47.3766 9.99313 47.6973 10.1123 48.1097 10.1123C48.5221 10.1123 48.852 9.99313 49.0994 9.7457Z"></path><path d="M13.4751 6.29095C14.1789 6.29095 14.7489 5.77778 14.7489 5.14547C14.7489 4.51317 14.1789 4 13.4751 4C12.7723 4 12.2014 4.51317 12.2014 5.14547C12.2014 5.77778 12.7723 6.29095 13.4751 6.29095Z"></path><path d="M14.7489 7.07812C13.97 7.41719 12.9986 7.42635 12.2014 7.07812V11.7792H14.7489V7.07812Z"></path></g></svg></div>
                                    </div>
                                    <div id="home-page-preview-banner-container" data-shop-banner-banner-container>
                                        <img class="shop-category-banner-img" src="" data-shop-category-banner-image>
                                    </div>
                                    <div class="shop-category-logo-holder" style="display: none;" data-shop-category-logo-holder>
                                        <img class="shop-category-banner-logo" src="" id="shop-banner-logo" data-shop-category-logo-image>
                                    </div>
                                    <div class="shop-category-text-holder">
                                        <p style="font-size: 18px;" data-shop-category-desc></p>
                                    </div>
                                    <!-- Timer Display -->
                                    <div class="shop-expiry-timer" style="display: none;">
                                        <p class="shop-expiry-timer-timer" id="shop-expiry-timer"></p>
                                    </div>
                                    <div class="shop-card-tag-container" data-shop-card-tag-container>
                                    </div>
                                </div>
                                <div class="shop-category-card-holder" id="shop-category-card-holder" data-shop-category-card-holder>
                                </div>
                            </div>
                        </template>
                        <template data-shop-item-card-template>
                            <div class="shop-category-card">
                                <div data-shop-card-preview-holder>
                                </div>
                                <div class="card-bottom">
                                    <div title="Copy Link" data-share-product-card-button></div>
                                    <a class="item-credits" data-product-card-sku-id>Failed To Load Item</a>
                                    <h3 data-product-card-name>Failed To Load Item</h3>
                                    <p class="shop-card-summary" data-product-card-summary>Failed To Load Item</p>
                                    <div class="shop-price-container" data-shop-price-container>
                                        <div data-price-standard-container>
                                            <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                        </div>
                                        <div data-price-nitro-container>
                                            <a data-price-nitro></a>
                                        </div>
                                    </div>
                                    <div class="shop-card-var-container" data-shop-card-var-container>
                                    </div>
                                    <a class="shop-card-var-title" data-shop-card-var-title></a>
                                </div>
                                <div class="card-button-container"data-product-card-open-in-shop>
                                    <button class="card-button" title="Open this item in the Discord Shop">Open In Shop</button>
                                </div>
                                <div class="shop-card-tag-container" data-shop-card-tag-container>
                                </div>
                            </div>
                        </template>
                        <template data-shop-varcolorblock-template>
                            <div data-shop-card-var></div>
                        </template>
                        <div data-shop-output>
                        </div>
                        <div id="shop-category-loading-container">
                        </div>
                    </div>
                </div>
            `;
        }



    }
} else if (localStorage.full_client_rework != "false") {

    experimentsList.forEach(({ name, rollout }) => {
        try {
            if (localStorage.experiment_force_rollout != "false") {
                localStorage.setItem(name, rollout);
            } else if (localStorage.getItem(name) == null) {
                localStorage.setItem(name, rollout);
            }
    
        } catch (error) {
            console.error(`Error setting up experiment: ${name}`, error);
        }
    });

    function clearSetExperiment(experimentName) {
        const experiment = experimentsList.find(exp => exp.name === experimentName);
        
        if (!experiment) {
            console.warn(`Experiment "${experimentName}" not found.`);
            return;
        }
    
        const { rollout } = experiment;
        const treatmentPicker = document.getElementById(`${experimentName}_treatment_container`);
    
        if (treatmentPicker) {
            treatmentPicker.value = rollout;
            localStorage.setItem(experimentName, rollout);
        }
    }

    sessionStorage.setItem('api-token', 'token');

    const api_password = localStorage.getItem("api-password");
    const discord_token = localStorage.getItem("discord_token");
    const shop_archives_token = localStorage.getItem("shop_archives_token");
    const api_token = sessionStorage.getItem("api-token");

    // api = 'https://raw.githubusercontent.com/Yappering/api/main/v2';
    api = 'https://api.yapper.shop/v2';
    prvapi = 'https://raw.githubusercontent.com/Yappering/private-api/refs/heads/main/v2';
    discordsupport = 'https://support.discord.com/hc/en-us/articles/';
    discordblog = 'https://discord.com/blog/';
    apidesignedurl = 'https://api.yapper.shop/v2';
    yapperblog = 'https://yapper.shop/blog/';
    yappersupport = 'https://support.yapper.shop/?page=';
    cdn = 'https://cdn.yapper.shop/';
    tmpapi = 'https://api.yapper.shop/tmp';

    function privateAPICheck() {
        // if (localStorage.force_all_api_to_fectch_private_api == "true") {
        //     api = prvapi;
        //     tmpapi = 'https://raw.githubusercontent.com/Yappering/api/main/tmp';
        // } else if (localStorage.api_designed_url != "false") {
        //     api = apidesignedurl;
        // } else {
        //     api = 'https://raw.githubusercontent.com/Yappering/api/main/v2';
        //     tmpapi = 'https://raw.githubusercontent.com/Yappering/api/main/tmp';
        // }
    }


    endpoints = [
        DOWNLOADABLE_DATA = "/downloads",
        COLLECTIBLES_SHOP = "/collectibles-shop",
        PROFILE_EFFECTS = "/profile-effects",
        COMMUNITY = "/community",
        APISTATUS = "/status",
        REVIEWSAPI = "/reviews",
        CLAIMABLES_SHOP = "/claimables-shop",
        XP_BALANCE = "/users/@me/xp-balance",
        CLAIMABLES_CLAIMED = "/users/@me/claimables-claimed",
        CLAIMABLES_PROMOTIONS = "/users/@me/claimables-promotions",
        REDEEM_GIFT_CODE = "/redeem-gift-code/"
    ]
    if (app_version2 === "Dev") {
        LOGIN_CALLBACK = "/dev/callback"
    } else {
        LOGIN_CALLBACK = "/callback"
    }

    const CUSTOM_EMOJIS = {
        ":thing:": "https://cdn.discordapp.com/emojis/1322807908471275561.webp?size=24",
        ":yapping_head:": "https://cdn.discordapp.com/emojis/1243471467392274544.webp?size=24",
        ":no_yapping:": "https://cdn.discordapp.com/emojis/1280620352338264207.webp?size=24"
    };
      

    yapper_categories = [
        WINDOWKILL = "1",
        BOPL_BATTLE = "7",
        PAPER_BEACH = "20",
        WINDOWKILL_V2 = "35",
        FIVE_NIGHTS_AT_FREDDYS = "54",
        PLUS_SPECIAL_EVENT = "55",
        GEOMETRY_DASH = "68",
        PAPER_BEACH_V2 = "77",
        RBXDOORS = "82",
        DATA_EXTRACTION_PROCESS = "85",
        HOAX = "86"
    ]

    claimable_types = {
        REWARD: 0,
        PURCHASE: 1
    };

    discord_categories = {
        FANTASY: "1144003461608906824",
        ANIME: "1144302037593497701",
        BREAKFAST: "1144054000099012659",
        DISXCORE: "1144058340327047249",
        FALL: "1157406994873991284",
        HALLOWEEN: "1157410718711304313",
        WINTER: "1174459301239197856",
        MONSTERS: "1179493515038818325",
        CYBERPUNK: "1197342727608746044",
        LUNAR_NEW_YEAR: "1202069709281828935",
        ELEMENTS: "1207046915880124426",
        ANIME_V2: "1212565175790473246",
        SPECIAL_EVENTS: "1217175518781243583",
        SPECIAL_EVENTS_2: "1309309974266118144",
        SPRINGTOONS: "1217622942175727736",
        SHY: "1220513972189663413",
        LOFI_VIBES: "1228243842684162121",
        GALAXY: "1232029045928099922",
        FEELIN_RETRO: "1237649643073044491",
        PIRATES: "1237653589896200272",
        ARCADE: "1245086656973901894",
        TIDE: "1252404112650407998",
        DARK_FANTASY: "1256321669388308595",
        ROBERT: "1262491137386614805",
        STORM: "1265375293397270650",
        DOJO: "1266520267946201099",
        THE_VAULT: "1277733175191277721",
        AUTUMN_EQUINOX: "1282816432056569866",
        BAND: "1285465421339693076",
        SPOOKY_NIGHT: "1287835634089594972",
        CHANCE: "1293373563494993952",
        MYTHICAL_CREATURES: "1298033986811068497",
        WARRIOR: "1303490165284802580",
        KAWAII_MODE: "1306330663213072494",
        LOFI_GIRL: "1309668861943218229",
        WINTER_WONDERLAND: "1314020997204283476",
        FANTASY_V2: "1324454241254903829",
        STEAMPUNK: "1326333074241486859",
        PROGRESS: "1333278032999485461",
        RADIATE: "1336483992429658112",
        VALENTINES: "1333866045521395723",
        ORB: "1332505418219655258",
        ANIME_V3: "1341506445249609728",
        INSOMNIA: "1343751621364027462",
        NAMEPLATE_TEST: "1344802365307621427",
        AESPA: "1346499610977243196",
        NAMEPLATE: "1349849614353829990",
        HOLIDAYS: "1349486948942745691",
        SHENANIGANS: "1352407446500675708",
        CHIBI_CAFE: "1354894010849820852",
        GGEZ: "1357589632723849316",
        HELLO: "1365410896222097539",
        COZY_VALLEY: "1369434230962262128",
        RC_TEST: "1370467303782617118",
        LEAF: "1373015260595884082"
    };

    discord_app_ids = {
        COLLECTIBLES_SHOP: "1096190356233670716",
        SHOP_ARCHIVES: "1342635740768501886"
    };

    external_skus = [
        NITRO_CREDITS_3_DAYS = "1333912750274904064",
        ORB_PROFILE_BADGE = "1342211853484429445"
    ]

    category_types = [
        HERO = 0,
        FEATURED = 1,
        FEED = 2,
        WIDE_BANNER = 3
    ]

    item_types = {
        NONE: 100,
        AVATAR_DECORATION: 0,
        PROFILE_EFFECT: 1,
        NAMEPLATE: 2,
        BUNDLE: 1e3,
        VARIANTS_GROUP: 2e3,
        EXTERNAL_SKU: 3e3
    }

    const nameplate_palettes = {
        crimson: {
            "darkBackground": "#900007",
            "lightBackground": "#E7040F"
        },
        berry: {
            "darkBackground": "#893A99",
            "lightBackground": "#B11FCF"
        },
        sky: {
            "darkBackground": "#0080B7",
            "lightBackground": "#56CCFF"
        },
        teal: {
            "darkBackground": "#086460",
            "lightBackground": "#7DEED7"
        },
        forest: {
            "darkBackground": "#2D5401",
            "lightBackground": "#6AA624"
        },
        bubble_gum: {
            "darkBackground": "#DC3E97",
            "lightBackground": "#F957B3"
        },
        violet: {
            "darkBackground": "#730BC8",
            "lightBackground": "#972FED"
        },
        cobalt: {
            "darkBackground": "#0131C2",
            "lightBackground": "#4278FF"
        },
        clover: {
            "darkBackground": "#047B20",
            "lightBackground": "#63CD5A"
        }
    }


    HELP_AVATAR_DECORATIONS = "13410113109911"
    HELP_SHOP = "17162747936663"
    HELP_PROFILE_EFFECTS = "17828465914263"
    HELP_HD_STREAMING_POTION = "27343254089623"
    HELP_CONFETTI_POTION = "29133681590679"


    BLOG_AVATAR_DECORATIONS_PROFILE_EFFECTS = "avatar-decorations-collect-and-keep-the-newest-styles"


    YAPPER_BLOG_2024_RECAP = "2024-recap"
    YAPPER_BLOG_2025_RECAP = "2025-recap"


    DISMISSIBLE_2024_RECAP = "assets/103.svg"
    DISMISSIBLE_2025_RECAP = "assets/160.png"


    m = ["1329609528441831537", "1329609528471195659", "1329609528492429332", "1329609528504746075", "1329609528525979658", "1329609528546693170", "1329609528571858975", "1329611507381829702", "1329611507402801312"];
    g = new Date('2025-01-31');
    newColorsSKUIDS = ["1144308439720394944", "1154896005045694555", "1144307257807491094", "1144305233707671573", "1144307629225672846", "1144308196723408958", "1144307957425778779", "1212569856189407352", "1212570343567261736", "1212570596970467378", "1212581390936178768", "1212569433839636530", "1212581147675205652", "1139323101881061466", "1139323093551165533", "1139323101008642101", "1212582298893946880", "1212582372877541427", "1212582452640350238", "1139323100568244355"];
    newColorsExpireDate = new Date('2025-03-08');
    N = new Date();
    I = ["1212569433839636530", "1144308439720394944", "1314020996201713685", "1212570343567261736", "1314020996776329279", "1271174640026255380", "1271175049168031815", "1232073608168472638", "1293373563407175680", "1314020996327542894", "1139323093991575696", "1232071157746765906", "1232071712695386162", "1144307957425778779", "1306330662990643252", "1280621222496964630", "1306330663015809024", "1306330663070334996", "1243617249974288404", "1309668861578186803", "1303490165213237338", "1306330662898372639", "1298033986508951685", "1282816432026943488", "1306330663137443991", "1197344764174008452", "1298033986727055370", "1298033986571866112", "1271175120437641261", "1314020996361093171", "1309668861645426729", "1256321669467865088", "1314020996864413717", "1306752744278982737", "1271174732577767626", "1144307257807491094", "1144308196723408958", "1287835633787732070", "1306330663162609685", "1306330662940311726", "1309668861901279422", "1282816431871754281", "1287835633485877369", "1228234634379132958", "1144305233707671573", "1298033986643169360", "1139323093551165533", "1212569856189407352", "1282816431850782730", "1144307629225672846", "1232070870093008937", "1207047014769234001", "1212582298893946880", "1232073286582538261", "1282816431985004594", "1293373563381878836", "1282816431964028958", "1306752744258011166", "1309668861846753372", "1271174324375519273", "1256321669426053198", "1287835633615765524", "1286504131325853739", "1306330663183581247", "1139323099687436419", "1287835633590734848", "1256321669493166214", "1286504131518791816", "1243620093431119922", "1262492035558932604", "1306330662927859723", "1197344326133502032", "1228251351415263242", "1232073448415821854", "1158572178179108968", "1298033986752221204", "1262491137394868311", "1309668861620260874", "1271174241860980907", "1220513989729976411", "1282820582408192061", "1154896005045694555", "1207047597294886923", "1306330663036780695", "1309668861674786877", "1197344693630009424", "1306330662965477478", "1174460780842856588", "1271174907081789524", "1282816431813169272", "1298033986622328842", "1139323101881061466", "1262491690900656267", "1303490165171294268", "1139323100568244355", "1243619479645065287", "1262491690971955284", "1316087100260483174", "1139323101008642101", "1228251144065777765", "1207048289610899526", "1287835633561239683", "1232072121950146560", "1303490165045727317", "1228246010116050965", "1309668861871919316", "1207049364464345158", "1243618816639107223", "1265421074514841751", "1316087100277395607", "1159280677246742548", "1262492035558932607", "1207047808838799410", "1306752744299954306", "1298033986668335135", "1266160780928352268", "1262491137386614812", "1139323092645183591", "1220513977683935373", "1256321669467865091", "1237654942202990602", "1287835633536209079", "1262491137394868305", "1256321669493166217", "1212582452640350238", "1158572275507937342", "1306752744228524052", "1174459546748600481", "1262491137394868308", "1309668861599285249", "1262492035558932610", "1144046002110738634", "1293373563184877618", "1298033986693500960", "1285465421260263464", "1306330663091306608", "1287835633645125653", "1303490165074825296", "1298033986538569781", "1303490165150322698", "1262491690900656261", "1256321669467865094", "1207048656289534022", "1285681070196396177", "1287835633674620949", "1237654224712765440", "1293373563121696891", "1303490165255180298", "1303490165120962651", "1212582372877541427", "1287835634005970994", "1303490165099991143", "1271564593746939904", "1314020996629532686", "1316087100260483176", "1228233390260486164", "1287835633867559022", "1158572263411556373", "1303490165192265799", "1237654783209508904", "1309668861704146984", "1212581147675205652", "1309668861548957738", "1245088205330710539", "1287835633896783952", "1316087100260483178", "1139323099251232828", "1262491690900656258", "1232072859485208687", "1197344396983664670", "1309668861788033074", "1314020996600172554", "1159280847262859364", "1314020996461760542", "1220514048068812901", "1293373563302318110", "1228251846032756796", "1197344636558114986", "1282820582223642624", "1287835634035331072", "1298033986777387059", "1243619781362450442", "1282816432001777794", "1212570596970467378", "1157409074422481023", "1256321669426053195", "1146328961417224193", "1293373563327483984", "1303490165234208810", "1266160780978556969", "1228237157554978817", "1287835633947115570", "1282820582345408595", "1271174810227179562", "1282816431830077542", "1287835633842258022", "1283211414323990538", "1282820582303334482", "1282820582429298748", "1306330663116472371", "1157407831348228141", "1293373563210043442", "1287835633515102228", "1309668861758672997", "1287835633703845888", "1287835633733341224", "1197344575832981605", "1316087100260483180", "1237653964582031400", "1287835633817227297", "1266493591207940133", "1309668861817393263", "1316087100260483182", "1298033986555351132", "1237650542772228096", "1207049498065375343", "1287835633980669972", "1314020996516286485", "1285465421193154560", "1268362891946627103", "1282820582244880496", "1293373563352649961", "1220432740638523543", "1243620329331626044", "1220432697718083614", "1267521289330102344", "1146328960951668776", "1293373563457507463", "1245088094437507163", "1262491690900656264", "1314020996432400404", "1220513984273186816", "1293373563159449653", "1314020996721803306", "1285681070196396179", "1285465421050548345", "1282820582366511229", "1256321669467865097", "1285465421285429258", "1293373563239272458", "1271174154514595891", "1217625794382401577", "1228252219502100530", "1285465421029576704", "1243618548673417298", "1220432647453409384", "1266493591275044903", "1217626024540508170", "1232072520249643028", "1245088254647205991", "1237654867330469949", "1314020996570812506", "1314020996227006484", "1245087968759382207", "1144006094134456352", "1314020997166403624", "1144048390594908212", "1287835633762701382", "1212581390936178768", "1285465420995756065", "1217626509737459852", "1314020996491116575", "1309668861729312898", "1237650411410685972", "1245087661316898877", "1217627230818009171", "1256321669388308601", "1314020996310896672", "1274105879238676561", "1293373563432341574", "1314020996273016863", "1282816431943057460", "1220513995308400680", "1293373563264569416", "1228252042791878707", "1314020997078323200", "1237654031732703272", "1267521289355268154", "1298033986592837754", "1285465421214126100", "1245087724265013299", "1314020996990242816", "1314020996663087154", "1282820582282629171", "1282816431922085888", "1314020997107683411", "1237654124443734026", "1314020997137043578", "1266161342801383434", "1285465421096685639", "1237654692985700352", "1174459480348565554", "1314020997019602984", "1314020996252176444", "1144003752978829455", "1282816431901118474", "1285465421306400858", "1285465421239291904", "1285465420979245087", "1314020996692447234", "1144048977138946230", "1217627051217911848", "1217626219651006495", "1217625572168044604", "1286504131392962641", "1237650618777075712", "1207048049571139584", "1314020996289921154", "1237654615474962472", "1314020996927328276", "1286504131439366184", "1285465421016862730", "1217625289681801316", "1243619153688920206", "1217624148080332820", "1144049316009353338", "1245481938202918912", "1245088023452975104", "1314020996960882789", "1285465421121851445", "1243617981435478102", "1144049603109470370", "1285465421071519825", "1256321669426053192", "1245087912350187520", "1207049115339591681", "1144049924397334651", "1237649939027333232", "1237650103980920872", "1237650023794081823", "1237650179721527347", "1245087850177888356", "1285465421167988758", "1277733174797008931"];

    async function setDiscordProfileEffectCache() {
        url = api + PROFILE_EFFECTS;
        pfxapiUrl = new URL(url);
        pfxapiUrl.searchParams.append("tab", "discord");
        const response = await fetch(pfxapiUrl, {
            method: "GET",
            headers: {
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            }
        });
        const effectsData = await response.json();
        discordProfileEffectsCache = effectsData.profile_effect_configs;
    }

    setDiscordProfileEffectCache()

    async function setPplusProfileEffectCache() {
        url = api + PROFILE_EFFECTS;
        pfxapiUrl = new URL(url);
        pfxapiUrl.searchParams.append("tab", "pplus");
        const response = await fetch(pfxapiUrl, {
            method: "GET",
            headers: {
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            }
        });
        const effectsData = await response.json();
        pplusProfileEffectsCache = effectsData.profile_effect_configs;
    }

    setPplusProfileEffectCache()

    async function setCommunityThemesCache() {
        url = api + COMMUNITY;
        communityapiUrl = new URL(url);
        communityapiUrl.searchParams.append("tab", "themes");
        if (localStorage.staff_unpublished_community_features == "true") {
            communityapiUrl.searchParams.append("include-unpublished", "true");
        }
        const response = await fetch(communityapiUrl, {
            method: "GET",
            headers: {
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            }
        });
        const themesData = await response.json();
        communityThemesCache = themesData;
    }

    setCommunityThemesCache()

    if (!atMeUsercache && shop_archives_token) {
        fetch(api + `/users/@me`, {
            method: "GET",
            headers: {
                "Authorization": shop_archives_token
            }
        })
        .then(response => response.json())
        .then((data) => {
            atMeUsercache = data;
            localStorage.admin_level = data.admin_level;

            if (Array.isArray(data.rollouts)) {
                data.rollouts.forEach(rollout => {

                    if (localStorage.experiment_force_rollout != "false") {
                        localStorage.setItem(rollout.name, rollout.rollout);
                    }
    
                });
            }

            if (localStorage.experiment_2025_05_xp_system === "Treatment 1: Enabled" && localStorage.dismissible_new100FreeXP != "Treatment 1: Seen" && data.claimed_100_free_xp === false) {
                let new100FreeXPDismissible = document.createElement("div");
                
                new100FreeXPDismissible.innerHTML = `
                    <div class="new100FreeXPDismissible-inner">
                        <hr style="opacity: 0;">
                        <svg class="closeIcon_modal_discord_login" onclick="closenew100FreeXPDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                        <hr style="opacity: 0;">
                        <p class="center-text options-medium-title" style="margin-top: 0px;">${getTextString("DISMISSIBLE_CONTENT_NEW_CLAIM_100_XP_MODAL_TITLE")}</p>
                        <hr style="opacity: 0;">
                        <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_CLAIM_100_XP_MODAL_SUMMARY_1")}</p>
                        <hr style="opacity: 0;">
                        <button class="card-button" onclick="setModalv3InnerContent('xp_events'); closenew100FreeXPDismissibleCoachtip();">${getTextString("DISMISSIBLE_CONTENT_NEW_CLAIM_100_XP_MODAL_TAKE_ME_THERE")}</button>
                        <button class="card-button" onclick="closenew100FreeXPDismissibleCoachtip()">${getTextString("DISMISSIBLE_CONTENT_NEW_CLAIM_100_XP_MODAL_LATER")}</button>
                    </div>
                    <div class="new100FreeXPDismissible-pointer"></div>
                `;
                
                new100FreeXPDismissible.classList.add('new100FreeXPDismissible');
                
                new100FreeXPDismissible.id = `new100FreeXPDismissible`;
                
                document.body.appendChild(new100FreeXPDismissible);
        
            }

        })
        .catch(error => {
            console.error(error);
        });
    }
    
    async function checkIfValidDiscordToken() {
        if (localStorage.discord_token && !localStorage.discord_profile || localStorage.discord_token && !localStorage.discord_user_id) {
            try {
                if (localStorage.discord_token && !localStorage.discord_profile || localStorage.discord_token && !localStorage.discord_user_id) {
                    const userInfo = await fetch('https://discord.com/api/users/@me', {
                        headers: { Authorization: `Bearer ${localStorage.discord_token}` }
                    });
          
                    if (!userInfo.ok) {
                        // If the response is not ok (e.g., 401 Unauthorized)
                        setParams({ page: 'home', login: 'false' });
                        actuallyLogOutOfDiscord();
                        return;
                    }
          
                    const user = await userInfo.json();
                    localStorage.discord_profile = JSON.stringify(user, undefined, 4);
                    localStorage.discord_avatar = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.webp?size=4096`;
                    localStorage.discord_username = user.username;
                    localStorage.discord_user_id = user.id;
                    if (user.global_name != null) {
                        localStorage.discord_displayname = user.global_name;
                    } else {
                        localStorage.discord_displayname = user.username;
                    }
                    localStorage.discord_banner_color = user.banner_color;
                    localStorage.discord_premium_type = user.premium_type;
          
                    if (user.banner != null) {
                        localStorage.discord_banner = `https://cdn.discordapp.com/banners/${user.id}/${user.banner}.png?size=4096`;
                    } else {
                        localStorage.removeItem('discord_banner');
                    }
          
                    console.log('success');
                    setParams({ page: 'home', login: 'true' });
                    location.reload();
                }
          
                // Optional: additional check (but `localStorage.discord_profile` is a string, so this check won't work unless parsed)
                const parsedProfile = JSON.parse(localStorage.discord_profile);
                if (parsedProfile.code === 0) {
                    setParams({ page: 'home', login: 'false' });
                    actuallyLogOutOfDiscord();
                }
          
            } catch (error) {
                setParams({ page: 'home', login: 'false' });
                actuallyLogOutOfDiscord();
            }
        }
    }

    const params = new URLSearchParams(window.location.search);

    function setParams(params) {
        const url = new URL(window.location);
    
        // Clear all existing query parameters
        url.search = '';
    
        // Set the new query parameters from the provided object
        Object.entries(params).forEach(([key, value]) => {
            url.searchParams.set(key, value);
        });
    
        // Update the address bar without reloading the page
        history.replaceState(null, '', url);
    }

    function addParams(params) {
        const url = new URL(window.location);

        Object.entries(params).forEach(([key, value]) => {
            url.searchParams.set(key, value);
        });

        history.replaceState(null, '', url);
    }

    function removeParams(params) {
        const url = new URL(window.location);
    
        // Convert params to an array if a single key is passed as a string
        if (!Array.isArray(params)) {
            params = [params];
        }
    
        // Remove each specified key from the URL parameters
        params.forEach(key => url.searchParams.delete(key));
    
        // Update the URL without reloading the page
        history.replaceState(null, '', url);
    }

    // Function to clear the shop data
    function clearShopData() {
        const output = document.querySelector("[data-shop-output]");
        output.innerHTML = ''; // Clears the content of the shop category
        if (params.get("page") === "consumables") {
            createPotionsCategoryLoadingElement()
        } else if (params.get("page") === "marketing") {
            createMarketingCategoryLoadingElement()
        } else {
            createShopCategoryLoadingElement()
        }
    }

    if (localStorage.experiment_2025_05_account_creator != "Treatment 1: Enabled") {
        checkIfValidDiscordToken();
    } else if (params.get("page") != "login" && localStorage.discord_token && !localStorage.discord_profile) {
        console.log("hoax????")
        actuallyLogOutOfDiscord();
    }
    
    // Function to fetch and display shop data
    function fetchData() {
        if (params.get("page") === "home" || params.get("page") === "orbs" && localStorage.experiment_2025_05_orbs_shop_home === "Treatment 1: Enabled") {

            fetchFirstHomeData();

            function fetchFirstHomeData() {
            
                fetch(apiUrl, {
                    method: "GET",
                    headers: {
                        "Password": api_password,
                        "Authorization": discord_token,
                        "Token": api_token
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === "Missing Access") {
                        document.getElementById("everything-housing-container").innerHTML = `
                            <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                                <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                                <h2>${getTextString("SHOP_NOT_LOAD_ERROR_1")}</h2>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR_2")}</p>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR")}${data.message}</p>
                                <button class="refresh-button" onclick="location.reload();">${getTextString("SHOP_NOT_LOAD_ERROR_RELOAD")}</button>
                            </div>
                        `;
                    } else {
                        data.forEach(apiCategory => {
                            async function processCategories() {
                                const output = document.querySelector("[data-shop-output]");
                                const output0 = document.querySelector("[data-shop-0-output]");
                                if (apiCategory.type === HERO) {
                                    const template = document.querySelector("[data-shop-category-template]");
                                
                                    const category = template.content.cloneNode(true).children[0];
                                
                                    if (apiCategory.hero_banner_asset) {
                                        if (apiCategory.hero_banner_asset.animated != null) {
                                            if (apiCategory.hero_banner_asset.static != null) {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <img class="home-page-preview-banner" style="opacity: 0;" src="${apiCategory.hero_banner_asset.static}">
                                                    <video disablepictureinpicture autoplay muted class="home-page-preview-banner-video" style="position: absolute; left: 0px; bottom: 0px; z-index: 1;" src="${apiCategory.hero_banner_asset.animated}" loop></video>
                                                `;
                                            } else {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <img class="home-page-preview-banner" style="opacity: 0;" src="">
                                                    <video disablepictureinpicture autoplay muted class="home-page-preview-banner-video" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.hero_banner_asset.animated}" loop></video>
                                                `;
                                            }
                                        } else if (apiCategory.hero_banner_asset.static != null) {
                                            category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.hero_banner_asset.static}`;
                                        }
                                    } else if (apiCategory.hero_banner != null) {
                                        category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.hero_banner}.png?size=4096`;
                                        category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                    } else {
                                        category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.banner}.png?size=4096`;
                                        category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                    }
                                
        
                                    if (apiCategory.hero_logo != null) {
                                        category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.hero_logo}.png?size=4096`;
                                    } else if (apiCategory.logo != null) {
                                        category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.logo}.png?size=4096`;
                                    } else {
                                        category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/31.png`;
                                    }
                                    category.querySelector("[data-shop-category-logo-image]").alt = apiCategory.name;

                                    if (apiCategory.sku_id === discord_categories.ORB) {
                                        category.querySelector("[data-shop-banner-banner-container]").style.backgroundImage = 'linear-gradient(to bottom,rgba(39, 30, 173, 0.3) 60%,rgba(0, 0, 0, 0)80%)';
                                    }
        
                                    category.querySelector("[data-shop-category-desc]").id = `${apiCategory.sku_id}-summary`;
                                    category.querySelector("[data-shop-category-desc]").textContent = apiCategory.summary;
        
                                    category.querySelector("[data-preview-banner-container]").id = apiCategory.sku_id;
                                    category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-preview-banner-container`;
                                
                                    if (apiCategory.leaks_type) {
                                        category.querySelector("[data-preview-new-categoey-button]").innerHTML = `
                                            <button class="home-page-preview-button" onclick="setParams({page: 'leaks'}); location.reload();">Check out New ${apiCategory.name} Leaks</button>
                                        `;
                                    } else {
                                        category.querySelector("[data-preview-new-categoey-button]").innerHTML = `
                                            <button class="home-page-preview-button" onclick="setParams({page: 'shop'}); addParams({scrollTo: '${apiCategory.sku_id}'}); location.reload();">${getTextString("SHOP_CATEGORY_SHOP_THE_COLLECTION_1")}${apiCategory.name}${getTextString("SHOP_CATEGORY_SHOP_THE_COLLECTION_2")}</button>
                                        `;
                                    }
                                
                                    const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                    if (cardOutput) {
                                        for (const product of apiCategory.products) {
                                            const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                            const card = cardTemplate.content.cloneNode(true).children[0];
    
                                            card.id = product.sku_id;
    
                                            if (product.type === item_types.NONE) {
                                                card.classList.add("type_100");
                                                card.classList.add('hidden')
                                            } else if (product.type === item_types.AVATAR_DECORATION) {
                                                product.items.forEach(item => {
                                                    
                                                    card.classList.add("type_0");
                                                    // Set the innerHTML for the preview holder
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Set the initial image for the deco card
                                                    const imgElement = document.createElement("img");
                                                    imgElement.id = "shop-card-deco-image";
                                                    imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                    
                                                    previewHolder.appendChild(imgElement);
    
                                                    const bgimg = document.createElement("div");
                                                    bgimg.id = "shop-card-deco-bg-image";
                                                    
                                                    previewHolder.appendChild(bgimg);
                                            
                                                    // Set the product details
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                    } else {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                    }
                                                    card.querySelector("[data-product-card-name]").textContent = product.name;
                                                    card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                    // Hover effect: Change the image src on mouse enter and leave
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                        });
                                                    }
                                                    
                                                });
                                            } else if (product.type === item_types.PROFILE_EFFECT) {
                                                card.classList.add("type_1");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                                
                                                // Ensure the item ID is accessible here
                                                let itemId = undefined;
                                                if (Array.isArray(product.items)) {
                                                    // If items is an array, find the item with type 1 and get its id
                                                    const item = product.items.find(item => item.type === 1);
                                                    if (item) {
                                                        itemId = item.id;
                                                    }
                                                } else if (product.items && product.items.type === 1) {
                                                    // If items is an object and has type 1, get its id
                                                    itemId = product.items.id;
                                                }
                                            
                                            
                                                if (!discordProfileEffectsCache) {
                                                    await setDiscordProfileEffectCache();
                                                }
                                            
                                                // Find matching profile effect
                                                const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                            
                                                if (matchingEffect) {
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('profile-effect-image');
                                            
                                                    previewHolder.innerHTML = `
                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                    `;
                                            
                                                    // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                    const imgElement = card.querySelector("img");
                                            
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                        });
                                                    } else {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = matchingEffect.reducedMotionSrc;
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                        });
                                                    }
                                                }
                                            } else if (product.type === item_types.NAMEPLATE) {
                                                card.classList.add("type_2");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
    
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
    
                                                if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                    previewName = localStorage.discord_displayname;
                                                } else {
                                                    previewName = 'Default User'
                                                }
    
                                                previewHolder.innerHTML = `
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _1"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _2"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-null-user" data-user-nameplate-preview>
                                                        <video disablepictureinpicture muted loop class="nameplate-null-user" style="position: absolute; height: 100%; width: auto; right: 0;" data-user-nameplate-preview-img></video>
                                                        <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                        <p class="nameplate-user-name">${previewName}</p>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _2"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-null-user">
                                                        <div class="nameplate-null-user-avatar"></div>
                                                        <div class="nameplate-null-user-name _1"></div>
                                                        <div class="nameplate-preview-status-bg"></div>
                                                        <div class="nameplate-preview-status-color"></div>
                                                    </div>
                                                    <div class="nameplate-fade-top"></div>
                                                    <div class="nameplate-fade-bottom"></div>
                                                `;
    
                                                product.items.forEach(item => {
                                                    const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                    const paletteName = item.palette;
                                                    const asset = `https://cdn.discordapp.com/assets/collectibles/${item.asset}asset.webm`;
                                                    const bgcolor = nameplate_palettes[paletteName].darkBackground;
    
                                                    const videoElement = previewHolder.querySelector("[data-user-nameplate-preview-img]");
    
                                                    videoElement.src = asset;
    
                                                    nameplatePreview.style.backgroundImage = `linear-gradient(90deg, #00000000 -30%, ${bgcolor} 200%)`;
                                                    // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                    
                                                    const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                    
                                                    nullUserNameRandomWidth.forEach(UserName => {
                                                        const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                        UserName.style.width = randomWidth + `px`;
                                                    });
                                                
                                                    const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                                
                                                    nullUserAvatar.forEach(UserAvatar => {
                                                        UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                    });
    
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            videoElement.play();
                                                        });
                                                        card.addEventListener("mouseleave", () => {
                                                            videoElement.pause();
                                                        });
                                                    }
                                                });
                                                
                                            } else if (product.type === item_types.BUNDLE) {
                                                card.classList.add("type_1000");
                                                // Fetch the bundled products for the bundle summary
                                                const bundledProducts = product.bundled_products || [];
                                            
                                                // Generate the bundle summary from the names of the bundled products
                                                const type0Product = bundledProducts.find(item => item.type === 0);
                                                const type1Product = bundledProducts.find(item => item.type === 1);
                                            
                                                let bundleSummary = `${getTextString("CARD_TYPE_BUNDLE_TITLE")}`;
                                                if (type0Product) {
                                                    bundleSummary += `${type0Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_DECO")}`;
                                                }
                                                if (type1Product) {
                                                    bundleSummary += `${type1Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_EFFECT")}`;
                                                }
                                            
                                                // Set the summary text
                                                card.querySelector("[data-product-card-summary]").textContent = bundleSummary;
                                            
                                                // Set the basic card details
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                            
                                                // Handle each item in the bundle
                                                product.items.forEach(item => {
                                                    if (item.type === 0) {
                                                        // Avatar decoration
                                                        const decoImage = document.createElement("img");
                                                        decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                        decoImage.alt = "Avatar Decoration";
                                                        decoImage.classList.add("avatar-decoration-image");
                                                        card.querySelector("[data-shop-card-preview-holder]").appendChild(decoImage);
    
                                                        const bgimg = document.createElement("div");
                                                        bgimg.classList.add("avatar-decoration-bg-image");
                                                        
                                                        card.querySelector("[data-shop-card-preview-holder]").appendChild(bgimg);
                                            
                                                        // Hover effect for decoration image
                                                        if (localStorage.reduced_motion != "true") {
                                                            card.addEventListener("mouseenter", () => {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            });
                                                            card.addEventListener("mouseleave", () => {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                            });
                                                        }
                                                    } else if (item.type === 1) {
                                                        // Profile effect
                                                        (async () => {
                                                            if (!discordProfileEffectsCache) {
                                                                await setDiscordProfileEffectCache();
                                                            }
                                            
                                                            // Find the matching effect
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                            
                                                            if (matchingEffect) {
                                                                const effectImage = document.createElement("img");
                                                                effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                effectImage.alt = "Profile Effect";
                                                                effectImage.classList.add("profile-effect-image");
                                                                card.querySelector("[data-shop-card-preview-holder]").appendChild(effectImage);
                                            
                                                                // Hover effect for profile effect
                                                                if (localStorage.reduced_motion != "true") {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects[0] && matchingEffect.effects[0].src) {
                                                                            effectImage.src = matchingEffect.effects[0].src;
                                                                        }
                                                                    });
                                                                    card.addEventListener("mouseleave", () => {
                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        effectImage.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                    card.addEventListener("mouseleave", () => {
                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        })();
                                                    }
                                                });
                                            } else if (product.type === item_types.VARIANTS_GROUP) {
                                                // Update SKU and summary
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                // Always display the base variant name
                                                card.querySelector("[data-product-card-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                            
                                                // Render variant color blocks as interactive divs
                                                const variantContainer = card.querySelector("[data-shop-card-var-container]");
                                                variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                let currentSelectedVariant = null; // Track selected variant
                                            
                                                product.variants.forEach((variant, index) => {
                                                    // Create variant color block
                                                    const variantColorBlockTmp = document.querySelector("[data-shop-varcolorblock-template]");
                                                    const variantColorBlock = variantColorBlockTmp.content.cloneNode(true).children[0];
                                                    variantColorBlock.classList.add("shop-card-var");
                                                    variantColorBlock.id = "shop-card-var";
                                                    variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                            
                                                    // Add click event listener to switch variants
                                                    variantColorBlock.addEventListener("click", () => {
                                                        if (currentSelectedVariant) {
                                                            currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                        }
                                                        variantColorBlock.classList.add("shop-card-var-selected");
                                                        currentSelectedVariant = variantColorBlock;
                                                        applyVariant(variant);
                                                    });
                                            
                                                    // Append the color block to the container
                                                    variantContainer.appendChild(variantColorBlock);
                                            
                                                    // Set the first variant as the default selected
                                                    if (index === 0) {
                                                        currentSelectedVariant = variantColorBlock;
                                                        variantColorBlock.classList.add("shop-card-var-selected");
                                                    }
                                                });
    
                                                let isFirstTimeLoadingVariant = true;
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                            
                                                // Function to apply the selected variant
                                                function applyVariant(selectedVariant) {
                                                    card.querySelector("[data-shop-card-var-title]").textContent = `(${selectedVariant.variant_label})`;
    
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                    } else {
                                                        card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                    }
    
                                                    if (localStorage.experiment_2025_02_shop_card_modals != "Treatment 1: Enable modals" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 2: Enable modals w/ data downloads" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 3: Enable modals w/ p+" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 4: Enable modals w/ p+ on p+ page" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 5: Enable modals w/ data downloads and p+" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        card.querySelector("[data-share-product-card-button]").innerHTML = `
                                                            <svg class="shareIcon_f4a996" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${selectedVariant.sku_id}');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                        `;
                                                    }
    
                                                    if (selectedVariant.type === 0) {
                                                        card.classList.add("type_2000-0");
                                                        previewHolder.innerHTML = ""; // Clear previous decorations
                                                        previewHolder.classList.add('avatar-decoration-image');
                                                        
                                                        // Add the avatar decoration based on the selected variant
                                                        selectedVariant.items?.forEach(item => {
                                                            const decoImage = document.createElement("img");
                                                            const bgimg = document.createElement("div");
                                                            if (isFirstTimeLoadingVariant == true) {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                isFirstTimeLoadingVariant = false;
                                                            } else {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            }
                                                            decoImage.alt = "Avatar Decoration";
                                                            decoImage.id = "shop-card-deco-image";
                                                            previewHolder.appendChild(decoImage);
    
                                                            bgimg.id = "shop-card-deco-bg-image";
    
                                                            previewHolder.appendChild(bgimg);
                                                        
                                                            // Hover effect for decoration image
                                                            if (localStorage.reduced_motion !== "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                    if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                        bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                    }
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                    bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                                });
                                                            }
                                                        });
                                                    } else if (selectedVariant.type === 1) {
                                                        card.classList.add("type_2000-1");
                                                        (async () => {
                                                            // Ensure the item ID is accessible here
                                                            let itemId = undefined;
                                                            if (Array.isArray(selectedVariant.items)) {
                                                                // If items is an array, find the item with type 1 and get its id
                                                                const item = selectedVariant.items.find(item => item.type === 1);
                                                                if (item) {
                                                                    itemId = item.id;
                                                                }
                                                            } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                // If items is an object and has type 1, get its id
                                                                itemId = selectedVariant.items.id;
                                                            }
                                                        
                                                        
                                                            if (!discordProfileEffectsCache) {
                                                                await setDiscordProfileEffectCache();
                                                            }
                                                        
                                                            // Find matching profile effect
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                        
                                                            if (matchingEffect) {
                                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                                previewHolder.classList.add('profile-effect-image');
                                                            
                                                                if (isFirstTimeLoadingVariant == true) {
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                    `;
                                                                    isFirstTimeLoadingVariant = false;
                                                                } else {
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.effects[0]?.src}">
                                                                    `;
                                                                }
                                                            
                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                const imgElement = card.querySelector("img");
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    card.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    card.addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    card.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        })();
                                                    }
                                                }
                                            
                                                // Apply the default variant (first one) initially
                                                if (product.variants.length > 0) {
                                                    applyVariant(product.variants[0]);
                                                }
                                            } else if (product.type === item_types.EXTERNAL_SKU) {
                                                card.classList.add("type_3000");
    
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
    
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
    
                                                if (product.sku_id === ORB_PROFILE_BADGE) {
                                                    previewHolder.classList.add('potion-card-preview-holder');
                                                        
                                                    previewHolder.innerHTML = `
                                                        <video loop disablepictureinpicture class="potion-card-preview profile-badge-orb-preview" id="orb-profile-badge-card-video" src="https://cdn.discordapp.com/assets/content/ccaa60fae2114887bfa2e413be11d62c6d194139ee0f33671825ff06a1050692.webm"></video>
                                                    `;
    
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            card.querySelector("#orb-profile-badge-card-video").play();
                                                        });
                                                        card.addEventListener("mouseleave", () => {
                                                            card.querySelector("#orb-profile-badge-card-video").pause();
                                                            card.querySelector("#orb-profile-badge-card-video").currentTime = 0;
                                                        });
                                                    }
                                                } else if (product.sku_id === NITRO_CREDITS_3_DAYS) {
                                                    previewHolder.classList.add('potion-card-preview-holder');
                                                        
                                                    previewHolder.innerHTML = `
                                                        <svg class="potion-card-preview nitro-3-days-orb-preview" width="187" height="187" viewBox="0 0 187 187" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path d="M161.164 3.17212H30.5663C16.8601 3.17212 5.74902 14.3031 5.74902 28.0339V158.866C5.74902 172.597 16.8601 183.728 30.5663 183.728H161.164C174.87 183.728 185.982 172.597 185.982 158.866V28.0339C185.982 14.3031 174.87 3.17212 161.164 3.17212Z" fill="url(#paint0_linear_170_2)"/>
                                                        <g filter="url(#filter0_d_170_2)">
                                                        <path d="M100.125 107.318C106.339 107.318 111.376 102.266 111.376 96.0332C111.376 89.8007 106.339 84.7483 100.125 84.7483C93.9113 84.7483 88.874 89.8007 88.874 96.0332C88.874 102.266 93.9113 107.318 100.125 107.318Z" fill="white"/>
                                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M55.1214 50.8938C52.0146 50.8938 49.496 53.42 49.496 56.5362C49.496 59.6525 52.0146 62.1787 55.1214 62.1787H71.9979C75.1048 62.1787 77.6235 64.7049 77.6235 67.8211C77.6235 70.9373 75.1048 73.4635 71.9979 73.4635H46.6832C43.5763 73.4635 41.0576 75.9897 41.0576 79.106C41.0576 82.2222 43.5763 84.7484 46.6832 84.7484H60.7469C63.8539 84.7484 66.3724 87.2746 66.3724 90.3908C66.3724 93.5071 63.8539 96.0333 60.7469 96.0333H49.496C46.389 96.0333 43.8704 98.5595 43.8704 101.676C43.8704 104.792 46.389 107.318 49.496 107.318H56.5393C61.5352 126.787 79.1553 141.173 100.125 141.173C124.981 141.173 145.13 120.963 145.13 96.0333C145.13 71.1035 124.981 50.8938 100.125 50.8938H55.1214ZM100.125 118.603C112.553 118.603 122.627 108.498 122.627 96.0333C122.627 83.5683 112.553 73.4635 100.125 73.4635C87.6979 73.4635 77.6235 83.5683 77.6235 96.0333C77.6235 108.498 87.6979 118.603 100.125 118.603Z" fill="white"/>
                                                        <path d="M29.8064 84.7485C32.9133 84.7485 35.4319 82.2223 35.4319 79.1061C35.4319 75.9898 32.9133 73.4636 29.8064 73.4636H26.9936C23.8868 73.4636 21.3682 75.9898 21.3682 79.1061C21.3682 82.2223 23.8868 84.7485 26.9936 84.7485H29.8064Z" fill="white"/>
                                                        </g>
                                                        <defs>
                                                        <filter id="filter0_d_170_2" x="7.48094" y="42.5615" width="151.536" height="118.053" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                                                        <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                                                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                                                        <feOffset dy="5.55489"/>
                                                        <feGaussianBlur stdDeviation="6.94361"/>
                                                        <feComposite in2="hardAlpha" operator="out"/>
                                                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
                                                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_170_2"/>
                                                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_170_2" result="shape"/>
                                                        </filter>
                                                        <linearGradient id="paint0_linear_170_2" x1="160.748" y1="183.303" x2="46.3474" y2="36.4729" gradientUnits="userSpaceOnUse">
                                                        <stop stop-color="#E978E6"/>
                                                        <stop offset="1" stop-color="#2F3EBB"/>
                                                        </linearGradient>
                                                        </defs>
                                                        </svg>
                                                    `;
                                                } else {
                                                    previewHolder.innerHTML = `
                                                        <p>${getTextString("CARD_TYPE_EXTERNAL_SKU_ERROR")}</p>
                                                    `;
                                                }
                                                
                                            } else if (product.type === 'plus_more') {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                card.querySelector("[data-product-card-name]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_TITLE")}`;
                                                card.querySelector("[data-product-card-summary]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_DESC")}`;
    
                                                card.querySelector("[data-shop-price-container]").innerHTML = ``;
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                                card.querySelector("[data-share-product-card-button]").innerHTML = ``;
    
                                                const plusMoreQuestionMark = document.createElement("img");
                                                plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                                card.querySelector("[data-shop-card-preview-holder]").appendChild(plusMoreQuestionMark);
                                    
                                                // Hover effect for decoration image
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                    });
                                                    card.addEventListener("mouseleave", () => {
                                                        plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                    });
                                                }
                                            } else if (product.items[0].item_type === 'deco') {
                                                product.items.forEach(item => {
                                                    
                                                    card.classList.add("type_0");
                                                    // Set the innerHTML for the preview holder
                                                    const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Set the initial image for the deco card
                                                    const imgElement = document.createElement("img");
                                                    imgElement.id = "shop-card-deco-image";
                                                    imgElement.src = imgElement.src = item.static;
                                                    
                                                    previewHolder.appendChild(imgElement);
    
                                                    const bgimg = document.createElement("div");
                                                    bgimg.id = "shop-card-deco-bg-image";
                                                    
                                                    previewHolder.appendChild(bgimg);
                                            
                                                    // Set the product details
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                    card.querySelector("[data-product-card-name]").textContent = product.name;
                                                    card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                                    // Hover effect: Change the image src on mouse enter and leave
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            imgElement.src = item.animated;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                
                                                        card.addEventListener("mouseleave", () => {
                                                            imgElement.src = item.static;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                        });
                                                    }
                                                    
                                                });
                                            } else if (product.items[0].item_type === 'effect') {
                                                card.classList.add("type_1");
    
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                                
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('profile-effect-image');
                                            
                                                previewHolder.innerHTML = `
                                                    <img class="thumbnail-preview" src="${product.items[0].static}">
                                                `;
                                            
                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                const imgElement = card.querySelector("img");
                                            
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = product.items[0].animated;
                                                    });
                                                
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = product.items[0].static;
                                                    });
                                                }
                                            } else {
                                                card.classList.add('hidden')
                                            }
                                            
                                            
                                            const priceTextNitro = card.querySelector("[data-price-nitro]");
                                            const priceTextStandard = card.querySelector("[data-price-standard]");
    
                                            const priceContainerNitro = card.querySelector("[data-price-nitro-container]");
                                            const priceContainerStandard = card.querySelector("[data-price-standard-container]");
    
                                            const priceContainer = card.querySelector("[data-shop-price-container]");
    
                                            let priceStandard = "N/A";
                                            let priceNitro = "N/A";
                                            let priceOrb = "N/A";
    
                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                if (localStorage.discord_premium_type === "2") {
                                                    if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                        product.prices["4"].country_prices.prices.forEach(price => {
                                                            if (price.currency === "usd") {
                                                                priceStandard = price.amount;
                                                            }
                                                            if (price.currency === "discord_orb") {
                                                                priceOrb = price.amount;
                                                            }
                                                        });
        
                                                        if (priceStandard != "N/A" && priceOrb != "N/A") {
                                                            let orb_price = document.createElement("div");
                                                    
                                                            orb_price.innerHTML = `
                                                                <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                <div class="orb-icon" style="margin-left: -25px"></div>
                                                            `;
                                                            orb_price.style.position = `absolute`;
                                                            orb_price.style.right = `0px`;
                                                            
                                                            priceContainer.appendChild(orb_price);
        
                                                            standardPriceOutput = `US$${(priceStandard / 100).toFixed(2)}`;
    
                                                            priceContainerStandard.innerHTML = `
                                                                <a style="font-size: large; font-weight: 900; margin-left: 23px">${standardPriceOutput}</a>
                                                                <div class="nitro-icon" style="margin-left: -5px"></div>
                                                            `;
        
                                                        } else if (priceStandard != "N/A") {
        
                                                            standardPriceOutput = `US$${(priceStandard / 100).toFixed(2)}`;
    
                                                            priceContainerStandard.innerHTML = `
                                                                <a style="font-size: large; font-weight: 900; margin-left: 23px">${standardPriceOutput}</a>
                                                                <div class="nitro-icon" style="margin-left: -5px"></div>
                                                            `;
        
                                                        } else if (priceOrb != "N/A") {
        
                                                            let orb_price = document.createElement("div");
                                                    
                                                            orb_price.innerHTML = `
                                                                <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                <div class="orb-icon" style="margin-left: -25px"></div>
                                                            `;
                                                            orb_price.style.position = `absolute`;
                                                            orb_price.style.left = `23px`;
                                                            orb_price.style.bottom = `0px`;
                                                            
                                                            priceContainer.appendChild(orb_price);
        
                                                            card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                <div class="unplublished-tag">
                                                                    <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                </div>
                                                            `;
                                                            
                                                        }
                                                    }
                                                } else {
                                                    if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                        product.prices["0"].country_prices.prices.forEach(price => {
                                                            if (price.currency === "usd") {
                                                                priceStandard = price.amount;
                                                            }
                                                            if (price.currency === "discord_orb") {
                                                                priceOrb = price.amount;
                                                            }
                                                        });
        
                                                        if (priceStandard != "N/A" && priceOrb != "N/A") {
                                                            let orb_price = document.createElement("div");
                                                    
                                                            orb_price.innerHTML = `
                                                                <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                <div class="orb-icon" style="margin-left: -25px"></div>
                                                            `;
                                                            orb_price.style.position = `absolute`;
                                                            orb_price.style.right = `0px`;
                                                            
                                                            priceContainer.appendChild(orb_price);
        
                                                            priceTextStandard.textContent = `US$${(priceStandard / 100).toFixed(2)}`;
        
                                                        } else if (priceStandard != "N/A") {
        
                                                            priceTextStandard.textContent = `US$${(priceStandard / 100).toFixed(2)}`;
        
                                                        } else if (priceOrb != "N/A") {
        
                                                            let orb_price = document.createElement("div");
                                                    
                                                            orb_price.innerHTML = `
                                                                <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                <div class="orb-icon" style="margin-left: -25px"></div>
                                                            `;
                                                            orb_price.style.position = `absolute`;
                                                            orb_price.style.left = `23px`;
                                                            orb_price.style.bottom = `0px`;
                                                            
                                                            priceContainer.appendChild(orb_price);
        
                                                            card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                <div class="unplublished-tag">
                                                                    <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                </div>
                                                            `;
                                                            
                                                        }
                                                    }
                                                }
    
                                            } else {
                                                if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                    product.prices["0"].country_prices.prices.forEach(price => {
                                                        if (price.currency === "usd") {
                                                            priceStandard = price.amount;
                                                        }
                                                    });
                                                }
                                        
                                                if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                    product.prices["4"].country_prices.prices.forEach(price => {
                                                        if (price.currency === "usd") {
                                                            priceNitro = price.amount;
                                                        }
                                                    });
                                                }
    
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                                }
        
                                                if (priceTextNitro) {
                                                    priceTextNitro.textContent = priceNitro !== "N/A" ? `US$${(priceNitro / 100).toFixed(2)} with Nitro` : "null";
                                                }
                                            }
    
                                            if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 1: Enabled" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button") {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="location.href='https://discord.com/shop#itemSkuId=${product.sku_id}';" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP_V2")}</button>
                                                        <button class="card-button" onclick="copyEmoji('${product.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                                    </div>
                                                `;
                                            } else {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="location.href='https://discord.com/shop#itemSkuId=${product.sku_id}';" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP")}</button>
                                                `;
                                            }
    
                                            if (product.items[0] && product.items[0].item_type && product.items[0].item_type === 'deco' || product.items[0] && product.items[0].item_type && product.items[0].item_type === 'effect' || product.sku_id === "0") {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                            }
    
                                            if (product.premium_type === 2) {
                                                card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                `;
                                            }
    
                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                if (product.type === item_types.AVATAR_DECORATION || product.type === item_types.PROFILE_EFFECT || product.type === item_types.NAMEPLATE || product.type === item_types.BUNDLE || product.type === item_types.VARIANTS_GROUP || product.type === item_types.EXTERNAL_SKU) {
                                                    card.classList.add('clickable');
    
                                                    card.addEventListener("click", (event) => {
                                                        if (event.target.matches("[data-shop-card-var]") || event.target.matches(".card-button") || event.target.matches(".shareIcon_f4a996")) {
                                                        } else {
                                                            openItemModal();
                                                            addParams({itemSkuId: product.sku_id})
                                                        }
                                                    });
    
                                                    const itemSKUForScroll = params.get("itemSkuId");
    
                                                    if (itemSKUForScroll === product.sku_id && modalIsAlreadyOpen != true) {
                                                        modalIsAlreadyOpen = true;
                                                        setTimeout(() => {
                                                            openItemModal();
                                                        }, 1000);
                                                    }
                                                    
    
                                                    async function openItemModal() {
                                                        let modal = document.createElement("div");
    
                                                        modal.classList.add('modalv2');
    
                                                        if (apiCategory.pdp_bg != null) {
                                                            pdp = apiCategory.pdp_bg
                                                        } else {
                                                            pdp = apiCategory.banner
                                                        }
    
                                                        modal.innerHTML = `
                                                            <div class="modalv2-inner">
                                                                <div class="modalv2-inner-left">
                                                                    <div data-modal-left-preview-holder></div>
                                                                    <p class="shop-modal-product-sku-id" data-product-modal-sku-id></p>
                                                                    <p class="shop-modal-product-name" style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                                    <p class="shop-modal-product-summary" style="color: var(--8)" data-product-modal-summary></p>
                                                                    <div class="shop-modal-var-container-container" data-shop-modal-var-container-container>
                                                                        <div class="shop-modal-var-container" data-shop-modal-var-container></div>
                                                                        <a class="shop-modal-var-title" data-shop-modal-var-title></a>
                                                                    </div>
                                                                    <div class="modal-shop-price-container" data-shop-price-container></div>
                                                                    <div class="modal-left-bottom">
                                                                        <div class="modal-buttons" data-modal-buttons></div>
                                                                    </div>
                                                                </div>
                                                                <img class="modalv2-inner-logo" src="https://cdn.yapper.shop/assets/31.png" data-modalv2-inner-logo></img>
                                                                <div class="shop-modal-tag-container" data-shop-card-tag-container></div>
    
                                                                <div data-modal-top-product-buttons>
                                                                    <div title="Close" data-close-product-card-button>
                                                                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                    </div>
                                                                </div>
    
                                                                <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                                    <img class="modalv2-inner-img" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${pdp}.png?size=4096"></img>
                                                                    <div data-modal-preview-holder></div>
                                                                </div>
                                                            </div>
                                                        `;
    
                                                        document.body.appendChild(modal);
    
                                                        setTimeout(() => {
                                                            modal.classList.add('show');
                                                        }, 1);
    
                                                        if (apiCategory.logo != null) {
                                                            modal.querySelector("[data-modalv2-inner-logo]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.logo}.png?size=4096`;
                                                        }
    
                                                        const button_container = document.querySelector("[data-modal-buttons]");
                                                        const top_button_container = document.querySelector("[data-modal-top-product-buttons]");
                                                        
    
                                                        let copyDiscordLink = document.createElement("div");
    
                                                        copyDiscordLink.title = getTextString("SHOP_SHARE_DISCORD_LINK");
                                                        copyDiscordLink.innerHTML = `
                                                            <svg data-share-product-card-button class="shareIcon_modal" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${product.sku_id}'); copyNotice('copylink');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                        `;
                                                        
                                                        top_button_container.appendChild(copyDiscordLink);
                                                        
                                                        if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                            let downloadItemData = document.createElement("div");
    
                                                            downloadItemData.title = getTextString("SHOP_DOWNLOAD_DATA");
                                                            downloadItemData.innerHTML = `
                                                                <svg data-download-product-card-button class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                            `;
    
                                                            top_button_container.appendChild(downloadItemData);
                                                        }
    
                                                        if (localStorage.experiment_2025_03_view_raw_modal === "Treatment 1: Enabled") {
                                                            let rawItemData = document.createElement("div");
    
                                                            rawItemData.title = getTextString("SHOP_VIEW_RAW_DATA");
                                                            rawItemData.innerHTML = `
                                                                <svg data-view-raw-product-card-button class="shareIcon_modal" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.7376 3.18925C15.4883 2.93731 15.0814 2.93686 14.8316 3.18824L14.0087 4.01625C13.7618 4.26471 13.7614 4.66581 14.0078 4.91476L20.3804 11.3527C20.6265 11.6013 20.6265 12.0017 20.3804 12.2503L14.0078 18.6882C13.7614 18.9373 13.7618 19.3383 14.0087 19.5867L14.8316 20.4148C15.0814 20.6662 15.4883 20.6658 15.7376 20.4138L23.815 12.2503C24.061 12.0016 24.061 11.6014 23.815 11.3528L15.7376 3.18925Z" fill="currentColor"/><path d="M9.99171 4.91476C10.2381 4.66581 10.2377 4.26471 9.99081 4.01625L9.16787 3.18824C8.91804 2.93686 8.51118 2.93731 8.2619 3.18925L0.184466 11.3528C-0.0614893 11.6014 -0.061488 12.0016 0.184466 12.2503L8.2619 20.4138C8.51118 20.6658 8.91803 20.6662 9.16787 20.4148L9.99081 19.5867C10.2377 19.3383 10.2381 18.9373 9.99171 18.6882L3.61906 12.2503C3.37298 12.0017 3.37298 11.6013 3.61906 11.3527L9.99171 4.91476Z" fill="currentColor"/></svg>
                                                            `;
    
                                                            top_button_container.appendChild(rawItemData);
    
                                                            modal.querySelector("[data-view-raw-product-card-button]").onclick = function(){
                                                                openRawModal();
                                                            };
    
                                                            async function openRawModal() {
                                                                let modal = document.createElement("div");
                        
                                                                modal.classList.add('modalv2');
                        
                                                                modal.innerHTML = `
                                                                    <div class="view-raw-modalv2-inner">
                                                                        <textarea class="view-raw-modal-textbox" readonly>${JSON.stringify(product, undefined, 4)}</textarea>
                                                                    </div>
                                                                `;
                        
                                                                document.body.appendChild(modal);
                        
                                                                setTimeout(() => {
                                                                    modal.classList.add('show');
                                                                }, 1);
                                                                
                        
                                                                let modal_back = document.createElement("div");
                        
                                                                modal_back.classList.add('modalv2-back');
                                                                modal_back.id = 'modalv2-back';
                        
                                                                document.body.appendChild(modal_back);
                        
                                                                setTimeout(() => {
                                                                    modal_back.classList.add('show');
                                                                }, 1);
                        
                        
                                                                modal.addEventListener('click', (event) => {
                                                                    if (event.target === modal) {
                                                                        modal.classList.remove('show');
                                                                        modal_back.classList.remove('show');
                                                                        setTimeout(() => {
                                                                            modal.remove();
                                                                            modal_back.remove();
                                                                        }, 300);
                                                                    }
                                                                });
                        
                                                                document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                                    modal.classList.remove('show');
                                                                    modal_back.classList.remove('show');
                                                                    setTimeout(() => {
                                                                        modal.remove();
                                                                        modal_back.remove();
                                                                    }, 300);
                                                                });
                                                            }
                                                        }
    
                                                        button_container.innerHTML = `
                                                            <button class="card-button" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}" onclick="location.href='https://discord.com/shop#itemSkuId=${product.sku_id}';">${getTextString("CARD_OPEN_IN_SHOP")}</button>
                                                        `;
    
                                                        if (product.type === item_types.AVATAR_DECORATION) {
    
                                                            modal.classList.add('modal-0');
    
                                                            product.items.forEach(item => {
    
                                                                const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
    
                                                                modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                                modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                                modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
    
                                                                if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
    
                                                                    previewHolder.classList.add('modal-preview-profile-container');
                                                                    previewHolder.innerHTML = `
                                                                        <div class="modal-preview-profile1">
                                                                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                            <div class="profile-avatar-preview-bg"></div>
                                                                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                            <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                            <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true">
                                                                            <div class="options-preview-profile-status-bg"></div>
                                                                            <div class="options-preview-profile-status-color"></div>
                                                                        </div>
                                                                    `;
    
                                                                    document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
    
                                                                    previewHolderLeft.classList.add('modal-left-avatar-decoration-img');
    
                                                                    const imgElement = document.createElement("img");
                                                                    imgElement.id = "shop-card-deco-image";
                                                                    imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
    
                                                                    previewHolderLeft.appendChild(imgElement);
    
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        imgElement.addEventListener("mouseenter", () => {
                                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                        });
                                                                    
                                                                        imgElement.addEventListener("mouseleave", () => {
                                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        });
                                                                    }
    
                                                                } else {
                                                                    
                                                                    previewHolder.classList.add('modal-avatar-decoration-img');
    
                                                                    const imgElement = document.createElement("img");
                                                                    imgElement.id = "shop-card-deco-image";
                                                                    imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
    
                                                                    previewHolder.appendChild(imgElement);
    
                                                                    // Hover effect: Change the image src on mouse enter and leave
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                        });
                                                                    
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                            imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        });
                                                                    }
                                                                }
    
                                                            });
                                                        } else if (product.type === item_types.PROFILE_EFFECT) {
                                                            modal.classList.add('modal-1');
            
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
    
                                                            // Ensure the item ID is accessible here
                                                            let itemId = undefined;
                                                            if (Array.isArray(product.items)) {
                                                                // If items is an array, find the item with type 1 and get its id
                                                                const item = product.items.find(item => item.type === 1);
                                                                if (item) {
                                                                    itemId = item.id;
                                                                }
                                                            } else if (product.items && product.items.type === 1) {
                                                                // If items is an object and has type 1, get its id
                                                                itemId = product.items.id;
                                                            }
                                                        
                                                        
                                                            if (!discordProfileEffectsCache) {
                                                                await setDiscordProfileEffectCache();
                                                            }
                                                        
                                                            // Find matching profile effect
                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
    
                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                            const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                        
                                                            if (matchingEffect) {
                                                                if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                    previewHolder.classList.add('modal-preview-profile-container');
                                                                    previewHolder.innerHTML = `
                                                                        <div class="modal-preview-profile2">
                                                                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                            <div class="profile-avatar-preview-bg"></div>
                                                                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                            <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                            <div class="options-preview-profile-status-bg"></div>
                                                                            <div class="options-preview-profile-status-color"></div>
                                                                            <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${matchingEffect.effects[0]?.src}">
                                                                        </div>
                                                                    `;
    
                                                                    document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
    
                                                                    previewHolderLeft.classList.add('modal-left-profile-effect-img');
                                                                
                                                                    const imgElement = document.createElement("img");
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
    
                                                                    previewHolderLeft.appendChild(imgElement);
                                                                
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        imgElement.addEventListener("mouseenter", () => {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                            }
                                                                        });
                                                                    
                                                                        imgElement.addEventListener("mouseleave", () => {
                                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                        });
                                                                    } else {
                                                                        imgElement.addEventListener("mouseenter", () => {
                                                                            imgElement.src = matchingEffect.reducedMotionSrc;
                                                                        });
                                                                    
                                                                        imgElement.addEventListener("mouseleave", () => {
                                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                        });
                                                                    }
                                                                } else {
                                                                    const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                    previewHolder.classList.add('modal-profile-effect-img');
                                                                
                                                                    previewHolder.innerHTML = `
                                                                        <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                    `;
                                                                
                                                                    // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                    const imgElement = previewHolder.querySelector("img");
                                                                
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                            }
                                                                        });
                                                                    
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                        });
                                                                    } else {
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                            imgElement.src = matchingEffect.reducedMotionSrc;
                                                                        });
                                                                    
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                            // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                            imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                        });
                                                                    }
                                                                }
                                                            }
                                                        } else if (product.type === item_types.NAMEPLATE) {
                                                            card.classList.add("modal-2");
                
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
                
                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                            previewHolder.classList.add('nameplate-modal-preview');
    
                                                            const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                
                                                            if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                                previewName = localStorage.discord_displayname;
                                                            } else {
                                                                previewName = 'Default User'
                                                            }
    
                                                            if (localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 2: Nameplate & Nameplate Test Warning" && product.category_sku_id === discord_categories.NAMEPLATE) {
                                                                let nameplateWarning = document.createElement("div");
    
                                                                nameplateWarning.classList.add('nameplate-modal-early-warning-container');
                                                                nameplateWarning.innerHTML = `
                                                                    <p>${getTextString("SHOP_NAMEPLATE_WARNING_NOTICE_1")}</p>
                                                                `;
    
                                                                modal.querySelector(".modalv2-inner-left").appendChild(nameplateWarning);
                                                            } else if (localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 1: Nameplate Test Warning" || localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 2: Nameplate & Nameplate Test Warning") {
                                                                if (product.category_sku_id === discord_categories.NAMEPLATE_TEST) {
                                                                    let nameplateWarning = document.createElement("div");
    
                                                                    nameplateWarning.classList.add('nameplate-modal-early-warning-container');
                                                                    nameplateWarning.innerHTML = `
                                                                        <p>${getTextString("SHOP_NAMEPLATE_WARNING_NOTICE_2")}</p>
                                                                    `;
    
                                                                    modal.querySelector(".modalv2-inner-left").appendChild(nameplateWarning);
                                                                }
                                                            }
                
                                                            previewHolder.innerHTML = `
                                                                <div class="nameplate-null-user">
                                                                    <div class="nameplate-null-user-avatar"></div>
                                                                    <div class="nameplate-null-user-name _1"></div>
                                                                    <div class="nameplate-preview-status-bg"></div>
                                                                    <div class="nameplate-preview-status-color"></div>
                                                                </div>
                                                                <div class="nameplate-null-user">
                                                                    <div class="nameplate-null-user-avatar"></div>
                                                                    <div class="nameplate-null-user-name _2"></div>
                                                                    <div class="nameplate-preview-status-bg"></div>
                                                                    <div class="nameplate-preview-status-color"></div>
                                                                </div>
                                                                <div class="nameplate-null-user" data-user-nameplate-preview>
                                                                    <video disablepictureinpicture muted loop class="nameplate-null-user" style="position: absolute; height: 100%; width: auto; right: 0;" data-user-nameplate-preview-img></video>
                                                                    <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                                    <p class="nameplate-user-name">${previewName}</p>
                                                                </div>
                                                                <div class="nameplate-null-user">
                                                                    <div class="nameplate-null-user-avatar"></div>
                                                                    <div class="nameplate-null-user-name _2"></div>
                                                                    <div class="nameplate-preview-status-bg"></div>
                                                                    <div class="nameplate-preview-status-color"></div>
                                                                </div>
                                                                <div class="nameplate-null-user">
                                                                    <div class="nameplate-null-user-avatar"></div>
                                                                    <div class="nameplate-null-user-name _1"></div>
                                                                    <div class="nameplate-preview-status-bg"></div>
                                                                    <div class="nameplate-preview-status-color"></div>
                                                                </div>
                                                            `;
    
                                                            previewHolderLeft.innerHTML = `
                                                                <div class="nameplate-null-user" data-user-nameplate-preview-left>
                                                                    <video disablepictureinpicture muted loop class="nameplate-null-user" style="position: absolute; height: 100%; width: auto; right: 0;" data-user-nameplate-preview-img-left></video>
                                                                    <div class="nameplate-user-avatar" data-nameplate-user-random-avatar-left></div>
                                                                    <p class="nameplate-user-name">${previewName}</p>
                                                                </div>
                                                            `;
                
                                                            product.items.forEach(item => {
                                                                const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                                const paletteName = item.palette;
                                                                const asset = `https://cdn.discordapp.com/assets/collectibles/${item.asset}asset.webm`;
                                                                const bgcolor = nameplate_palettes[paletteName].darkBackground;
                
                                                                const videoElement = previewHolder.querySelector("[data-user-nameplate-preview-img]");
    
                                                                videoElement.src = asset;
                
                                                                nameplatePreview.style.backgroundImage = `linear-gradient(90deg, #00000000 -30%, ${bgcolor} 200%)`;
                                                                // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                                
                                                                const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                                
                                                                nullUserNameRandomWidth.forEach(UserName => {
                                                                    const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                                    UserName.style.width = randomWidth + `px`;
                                                                });
                                                            
                                                                const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                                            
                                                                nullUserAvatar.forEach(UserAvatar => {
                                                                    UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                                });
    
                                                                if (localStorage.reduced_motion != "true") {
                                                                    videoElement.play();
                                                                }
    
    
    
                                                                const videoElementLeft = previewHolderLeft.querySelector("[data-user-nameplate-preview-img-left]");
                                                                const nameplatePreviewLeft = previewHolderLeft.querySelector("[data-user-nameplate-preview-left]");
                                                                previewHolderLeft.classList.add("modal-left-nameplate-preview");
    
                                                                videoElementLeft.src = asset;
    
                                                                nameplatePreviewLeft.style.backgroundImage = `linear-gradient(90deg, #00000000 -30%, ${bgcolor} 200%)`;
    
                                                                const nullUserAvatarLeft = previewHolderLeft.querySelectorAll("[data-nameplate-user-random-avatar-left]");
                                                            
                                                                nullUserAvatarLeft.forEach(UserAvatar => {
                                                                    UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                                });
    
                                                                if (localStorage.reduced_motion != "true") {
                                                                    videoElementLeft.addEventListener("mouseenter", () => {
                                                                        videoElementLeft.play();
                                                                    });
                                                                
                                                                    videoElementLeft.addEventListener("mouseleave", () => {
                                                                        videoElementLeft.pause();
                                                                    });
                                                                }
                                                            });
                                                            
                                                        } else if (product.type === item_types.BUNDLE) {
                                                            modal.classList.add('modal-1000');
    
                                                            const bundledProducts = product.bundled_products || [];
    
                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        
                                                            // Generate the bundle summary from the names of the bundled products
                                                            const type0Product = bundledProducts.find(item => item.type === 0);
                                                            const type1Product = bundledProducts.find(item => item.type === 1);
                                                        
                                                            let bundleSummary = `${getTextString("CARD_TYPE_BUNDLE_TITLE")}`;
                                                            if (type0Product) {
                                                                bundleSummary += `${type0Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_DECO")}`;
                                                            }
                                                            if (type1Product) {
                                                                bundleSummary += `${type1Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_EFFECT")}`;
                                                            }
                                                        
                                                            // Set the summary text
                                                            modal.querySelector("[data-product-modal-summary]").textContent = bundleSummary;
                                                        
                                                            // Set the basic card details
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        
                                                            // Handle each item in the bundle
                                                            product.items.forEach(item => {
                                                                if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                    
                                                                    if (item.type === 0) {
                                                                        decosrc = item.asset
                                                                    } else if (item.type === 1) {
                                                                        // Profile effect
                                                                        (async () => {
                                                                            if (!discordProfileEffectsCache) {
                                                                                await setDiscordProfileEffectCache();
                                                                            }
                                                                            
                                                        
                                                                            // Find the matching effect
                                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                                        
                                                                            if (matchingEffect) {
                                                                                if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                    const effectUrl = matchingEffect.effects[0]?.src;
                                                                                    renderProfile(effectUrl)
                                                                                }
                                                                            }
                                                                        })();
                                                                    }
    
                                                                    function renderProfile(effectUrl) {
                                                                        previewHolder.classList.add('modal-preview-profile-container');
                                                                        previewHolder.innerHTML = `
                                                                            <div class="modal-preview-profile2">
                                                                                <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                <div class="profile-avatar-preview-bg"></div>
                                                                                <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.discordapp.com/avatar-decoration-presets/${decosrc}.png?size=4096&passthrough=true">
                                                                                <div class="options-preview-profile-status-bg"></div>
                                                                                <div class="options-preview-profile-status-color"></div>
                                                                                <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                            </div>
                                                                        `;
                                                                        document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                    }
    
                                                                    
                                                                } else {
                                                                    if (item.type === 0) {
                                                                        const decoImage = document.createElement("img");
                                                                        decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        decoImage.alt = "Avatar Decoration";
                                                                        decoImage.classList.add("modal-avatar-decoration-img");
                                                                        modal.querySelector("[data-modal-preview-holder]").appendChild(decoImage);
                                                        
                                                                        // Hover effect for decoration image
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                            });
    
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                            });
                                                                        }
                                                                    } else if (item.type === 1) {
                                                                        // Profile effect
                                                                        (async () => {
                                                                            // Fetch profile effects if not cached
                                                                            if (!discordProfileEffectsCache) {
                                                                                const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                    method: "GET",
                                                                                    headers: {
                                                                                        "Password": api_password,
                                                                                        "Authorization": discord_token,
                                                                                        "Token": api_token
                                                                                    }
                                                                                });
                                                                                const effectsData = await response.json();
                                                                                discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                            }
                                                        
                                                                            // Find the matching effect
                                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                                        
                                                                            if (matchingEffect) {
                                                                                const effectImage = document.createElement("img");
                                                                                effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                effectImage.alt = "Profile Effect";
                                                                                effectImage.classList.add("modal-profile-effect-img");
                                                                                modal.querySelector("[data-modal-preview-holder]").appendChild(effectImage);
                                                        
                                                                                // Hover effect for profile effect
                                                                                if (localStorage.reduced_motion != "true") {
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                                            effectImage.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                        }
                                                                                    });
                                                                                
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                    });
                                                                                } else {
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                        effectImage.src = matchingEffect.reducedMotionSrc;
                                                                                    });
                                                                                
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                        effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                    });
                                                                                }
                                                                            }
                                                                        })();
                                                                    }
                                                                }
                                                            });
                                                        } else if (product.type === item_types.VARIANTS_GROUP) {
                                                            modal.querySelector("[data-shop-modal-var-container-container]").classList.add('show');
                                                            // Update SKU and summary
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
                                                        
                                                            // Always display the base variant name
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                                        
                                                            // Render variant color blocks as interactive divs
                                                            const variantContainer = modal.querySelector("[data-shop-modal-var-container]");
                                                            variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                            let currentSelectedVariant = null; // Track selected variant
                                                        
                                                            product.variants.forEach((variant, index) => {
                                                                // Create variant color block
                                                                const variantColorBlock = document.createElement("div");
                                                                variantColorBlock.classList.add("shop-card-var");
                                                                variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                                        
                                                                // Add click event listener to switch variants
                                                                variantColorBlock.addEventListener("click", () => {
                                                                    if (currentSelectedVariant) {
                                                                        currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                                    }
                                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                                    currentSelectedVariant = variantColorBlock;
                                                                    applyVariant(variant);
                                                                });
                                                        
                                                                // Append the color block to the container
                                                                variantContainer.appendChild(variantColorBlock);
                                                        
                                                                // Set the first variant as the default selected
                                                                if (index === 0) {
                                                                    currentSelectedVariant = variantColorBlock;
                                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                                }
                                                            });
                
                                                            let isFirstTimeLoadingVariant = true;
                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                            const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                        
                                                            // Function to apply the selected variant
                                                            function applyVariant(selectedVariant) {
                                                                modal.querySelector("[data-shop-modal-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                                modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                                modal.querySelector("[data-share-product-card-button]").onclick = function(){
                                                                    copyEmoji(`https://canary.discord.com/shop#itemSkuId=${selectedVariant.sku_id}`);
                                                                };
                                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                                    modal.querySelector("[data-download-product-card-button]").onclick = function(){
                                                                        window.open(`https://item.yapper.shop/sku/${selectedVariant.sku_id}/data.zip`);
                                                                    };
                                                                }
                                                                if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                    
                                                                    if (selectedVariant.type === 0) {
                                                                        selectedVariant.items?.forEach(item => {
                                                                            previewHolder.classList.add('modal-preview-profile-container');
                                                                            previewHolder.innerHTML = `
                                                                                <div class="modal-preview-profile1">
                                                                                    <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                    <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                    <div class="profile-avatar-preview-bg"></div>
                                                                                    <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                    <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                    <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                    <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true">
                                                                                    <div class="options-preview-profile-status-bg"></div>
                                                                                    <div class="options-preview-profile-status-color"></div>
                                                                                </div>
                                                                            `;
                                                                            document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
    
                                                                            previewHolderLeft.classList.add('modal-left-avatar-decoration-img');
    
                                                                            previewHolderLeft.innerHTML = `
                                                                                <img id="shop-card-deco-image" src="https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&amp;passthrough=false" data-left-preview-deco-var>
                                                                            `;
    
                                                                            const imgElement = previewHolderLeft.querySelector("[data-left-preview-deco-var]");
                                                                            
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                imgElement.addEventListener("mouseenter", () => {
                                                                                    imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                                });
                                                                            
                                                                                imgElement.addEventListener("mouseleave", () => {
                                                                                    imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                                });
                                                                            }
                                                                        });
                                                                    } else if (selectedVariant.type === 1) {
    
                                                                        modal.classList.add("modal-2000-1");
                                                                        (async () => {
                                                                            // Ensure the item ID is accessible here
                                                                            let itemId = undefined;
                                                                            if (Array.isArray(selectedVariant.items)) {
                                                                                // If items is an array, find the item with type 1 and get its id
                                                                                const item = selectedVariant.items.find(item => item.type === 1);
                                                                                if (item) {
                                                                                    itemId = item.id;
                                                                                }
                                                                            } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                                // If items is an object and has type 1, get its id
                                                                                itemId = selectedVariant.items.id;
                                                                            }
                                                                        
                                                                        
                                                                            if (!discordProfileEffectsCache) {
                                                                                await setDiscordProfileEffectCache();
                                                                            }
                                                                        
                                                                            // Find matching profile effect
                                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                                        
                                                                            if (matchingEffect) {
                                                                                if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                    const effectUrl = matchingEffect.effects[0]?.src;
                                                                                    previewHolder.classList.add('modal-preview-profile-container');
                                                                                    previewHolder.innerHTML = `
                                                                                        <div class="modal-preview-profile2">
                                                                                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                            <div class="profile-avatar-preview-bg"></div>
                                                                                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                            <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                            <div class="options-preview-profile-status-bg"></div>
                                                                                            <div class="options-preview-profile-status-color"></div>
                                                                                            <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                                        </div>
                                                                                    `;
                                                                                    document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                                }
                                                                            }
    
                                                                            previewHolderLeft.classList.add('modal-left-profile-effect-img');
    
                                                                            previewHolderLeft.innerHTML = `
                                                                                <img src="${matchingEffect.thumbnailPreviewSrc}" data-left-preview-effect-var>
                                                                            `;
    
                                                                            const imgElement = previewHolderLeft.querySelector("[data-left-preview-effect-var]");
                                                                            
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                imgElement.addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                imgElement.addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                imgElement.addEventListener("mouseenter", () => {
                                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                imgElement.addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        })();
                                                                    }
    
                                                                    
                                                                } else {
                                                                    if (selectedVariant.type === 0) {
                                                                        modal.classList.add("modal-2000-0");
                                                                        previewHolder.innerHTML = ""; // Clear previous decorations
                                                                        previewHolder.classList.add('modal-avatar-decoration-img');
                                                                        
                                                                        // Add the avatar decoration based on the selected variant
                                                                        selectedVariant.items?.forEach(item => {
                                                                            const decoImage = document.createElement("img");
                                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                            decoImage.alt = "Avatar Decoration";
                                                                            decoImage.id = "shop-card-deco-image";
                                                                            previewHolder.appendChild(decoImage);
                                                                        
                                                                            // Hover effect for decoration image
                                                                            if (localStorage.reduced_motion !== "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                                });
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                                });
                                                                            }
                                                                        });
                                                                    } else if (selectedVariant.type === 1) {
                                                                        modal.classList.add("modal-2000-1");
                                                                        (async () => {
                                                                            // Ensure the item ID is accessible here
                                                                            let itemId = undefined;
                                                                            if (Array.isArray(selectedVariant.items)) {
                                                                                // If items is an array, find the item with type 1 and get its id
                                                                                const item = selectedVariant.items.find(item => item.type === 1);
                                                                                if (item) {
                                                                                    itemId = item.id;
                                                                                }
                                                                            } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                                // If items is an object and has type 1, get its id
                                                                                itemId = selectedVariant.items.id;
                                                                            }
                                                                        
                                                                        
                                                                            // Fetch profile effects API only if not already cached
                                                                            if (!discordProfileEffectsCache) {
                                                                                const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                    method: "GET",
                                                                                    headers: {
                                                                                        "Password": api_password,
                                                                                        "Authorization": discord_token,
                                                                                        "Token": api_token
                                                                                    }
                                                                                });
                                                                                const effectsData = await response.json();
                                                                                discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                            }
                                                                        
                                                                            // Find matching profile effect
                                                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                                        
                                                                            if (matchingEffect) {
                                                                                const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                                previewHolder.classList.add('modal-profile-effect-img');
                                                                            
                                                                                previewHolder.innerHTML = `
                                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                                `;
                                                                            
                                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                                const imgElement = previewHolder.querySelector("img");
                                                                            
                                                                                if (localStorage.reduced_motion != "true") {
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                        }
                                                                                    });
                                                                                
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                    });
                                                                                } else {
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                                    });
                                                                                
                                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                    });
                                                                                }
                                                                            }
                                                                        })();
                                                                    }
                                                                }
                                                            }
                                                        
                                                            // Apply the default variant (first one) initially
                                                            if (product.variants.length > 0) {
                                                                applyVariant(product.variants[0]);
                                                            }
                                                        } else if (product.type === item_types.EXTERNAL_SKU) {
                                                            modal.classList.add('modal-3000');
                
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
                
                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                
                                                            if (product.sku_id === ORB_PROFILE_BADGE) {
                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile3">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                        <div class="options-preview-profile-badge-container">
                                                                            <img class="options-preview-profile-badge" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTg3IiBoZWlnaHQ9IjE4NyIgdmlld0JveD0iMCAwIDE4NyAxODciIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF8xNDBfMikiPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDFfMTQwXzIpIj4KPHBhdGggZD0iTTg5Ljg1MzUgMC43MTg3ODFDOTIuMTYxOCAtMC4yMzk1OTQgOTQuNzU2NCAtMC4yMzk1OTQgOTcuMDY0NyAwLjcxODc4MUwxNTYuNDg0IDI1LjMzMjdDMTU4Ljc5MiAyNi4yOTEgMTYwLjYyNyAyOC4xMjYgMTYxLjU4NiAzMC40MzQzTDE4Ni4xOTkgODkuODUzNUMxODcuMTU4IDkyLjE2MTggMTg3LjE1OCA5NC43NTY0IDE4Ni4xOTkgOTcuMDY0N0wxNjEuNTg2IDE1Ni40ODRDMTYwLjYyNyAxNTguNzkyIDE1OC43OTIgMTYwLjYyNyAxNTYuNDg0IDE2MS41ODZMOTcuMDY0NyAxODYuMTk5Qzk0Ljc1NjQgMTg3LjE1OCA5Mi4xNjE4IDE4Ny4xNTggODkuODUzNSAxODYuMTk5TDMwLjQzNDMgMTYxLjU4NkMyOC4xMjYgMTYwLjYyNyAyNi4yOTEgMTU4Ljc5MiAyNS4zMzI3IDE1Ni40ODRMMC43MTg3ODEgOTcuMDY0N0MtMC4yMzk1OTQgOTQuNzU2NCAtMC4yMzk1OTQgOTIuMTYxOCAwLjcxODc4MSA4OS44NTM1TDI1LjMzMjcgMzAuNDM0M0MyNi4yOTEgMjguMTI2IDI4LjEyNiAyNi4yOTEgMzAuNDM0MyAyNS4zMzI3TDg5Ljg1MzUgMC43MTg3ODFaIiBmaWxsPSJ3aGl0ZSIvPgo8bWFzayBpZD0ibWFzazBfMTQwXzIiIHN0eWxlPSJtYXNrLXR5cGU6bHVtaW5hbmNlIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSIwIiB5PSIwIiB3aWR0aD0iMTg3IiBoZWlnaHQ9IjE4NyI+CjxwYXRoIGQ9Ik04OS44NTM1IDAuNzE4NzgxQzkyLjE2MTggLTAuMjM5NTk0IDk0Ljc1NjQgLTAuMjM5NTk0IDk3LjA2NDcgMC43MTg3ODFMMTU2LjQ4NCAyNS4zMzI3QzE1OC43OTIgMjYuMjkxIDE2MC42MjcgMjguMTI2IDE2MS41ODYgMzAuNDM0M0wxODYuMTk5IDg5Ljg1MzVDMTg3LjE1OCA5Mi4xNjE4IDE4Ny4xNTggOTQuNzU2NCAxODYuMTk5IDk3LjA2NDdMMTYxLjU4NiAxNTYuNDg0QzE2MC42MjcgMTU4Ljc5MiAxNTguNzkyIDE2MC42MjcgMTU2LjQ4NCAxNjEuNTg2TDk3LjA2NDcgMTg2LjE5OUM5NC43NTY0IDE4Ny4xNTggOTIuMTYxOCAxODcuMTU4IDg5Ljg1MzUgMTg2LjE5OUwzMC40MzQzIDE2MS41ODZDMjguMTI2IDE2MC42MjcgMjYuMjkxIDE1OC43OTIgMjUuMzMyNyAxNTYuNDg0TDAuNzE4NzgxIDk3LjA2NDdDLTAuMjM5NTk0IDk0Ljc1NjQgLTAuMjM5NTk0IDkyLjE2MTggMC43MTg3ODEgODkuODUzNUwyNS4zMzI3IDMwLjQzNDNDMjYuMjkxIDI4LjEyNiAyOC4xMjYgMjYuMjkxIDMwLjQzNDMgMjUuMzMyN0w4OS44NTM1IDAuNzE4NzgxWiIgZmlsbD0id2hpdGUiLz4KPC9tYXNrPgo8ZyBtYXNrPSJ1cmwoI21hc2swXzE0MF8yKSI+CjxwYXRoIGQ9Ik05My40NTkzIC0yNS45NDZILTI2LjU2NTRWMjEzLjI1Nkg5My40NTkzVi0yNS45NDZaIiBmaWxsPSIjRUY1MUU4Ii8+CjxwYXRoIGQ9Ik0yNC42NjcgMTYyLjI1MkwxNjIuMjUyIDI0LjY2NjVMMTk1Ljc1NCAzOC45ODM3TDIxMC44MiAxNTguNDUzTDEyMy41NTUgMjE2LjExNEwyNy4xOTczIDIwNS43MjNMMjQuNjY3IDE2Mi4yNTJaIiBmaWxsPSIjM0M0MEYzIi8+CjxwYXRoIGQ9Ik0yNC42NjcgMjQuNjY2NUwxNjIuMjUyIDE2Mi4yNTJMMjAzLjU1IDYyLjYxNTlMMTM5LjEzNCAtMjMuNjA4N0wzNi44MDQ1IC0zMS42NjE0TDI0LjY2NyAyNC42NjY1WiIgZmlsbD0iI0NGOTJGRiIvPgo8cGF0aCBkPSJNMjEzLjQ4NCAtMjUuOTQ2SDkzLjQ1OVYyMTMuMjU2SDIxMy40ODRWLTI1Ljk0NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNjIuMjUyIDI0LjY2NjZMOTUuMzc2IDkxLjU0MjZMOTYuMDM2MyAxNzAuNDMzTDE3NS41OTMgMTc5LjU1NUwyMDYuNzY0IDExMC43MzNMMTc3LjE1MyAyMi42ODU1TDE2Mi4yNTIgMjQuNjY2NloiIGZpbGw9IiM3QUU5RDYiLz4KPHBhdGggZD0iTTkzLjQ1OSAxOTUuMDc2VjEyOS4yMjlMMTI1LjYyOSAxMjMuNjU0TDE2Mi4yNTIgMTYxLjU3NEwxNjQuNTg5IDE3My41MTlMOTMuNDU5IDE5NS4wNzZaIiBmaWxsPSIjN0I0OUZGIi8+CjwvZz4KPHBhdGggZD0iTTk2LjU3MzggMjUuOTU4Qzk0Ljg0OTkgMjQuMjM0MSA5Mi4wNTY2IDI0LjIzNDEgOTAuMzMyNyAyNS45NThMMjUuOTU4IDkwLjMzODZDMjQuMjM0MSA5Mi4wNjI1IDI0LjIzNDEgOTQuODU1OCAyNS45NTggOTYuNTc5N0w5MC4zMzI3IDE2MC45NkM5Mi4wNTY2IDE2Mi42ODQgOTQuODQ5OSAxNjIuNjg0IDk2LjU3MzggMTYwLjk2TDE2MC45NTQgOTYuNTc5N0MxNjIuNjc4IDk0Ljg1NTggMTYyLjY3OCA5Mi4wNjI1IDE2MC45NTQgOTAuMzM4Nkw5Ni41NzM4IDI1Ljk1OFoiIGZpbGw9IiMxNDE0MTQiLz4KPHBhdGggZD0iTTk2LjU3MzggMjUuOTU4Qzk0Ljg0OTkgMjQuMjM0MSA5Mi4wNTY2IDI0LjIzNDEgOTAuMzMyNyAyNS45NThMMjUuOTU4IDkwLjMzODZDMjQuMjM0MSA5Mi4wNjI1IDI0LjIzNDEgOTQuODU1OCAyNS45NTggOTYuNTc5N0w5MC4zMzI3IDE2MC45NkM5Mi4wNTY2IDE2Mi42ODQgOTQuODQ5OSAxNjIuNjg0IDk2LjU3MzggMTYwLjk2TDE2MC45NTQgOTYuNTc5N0MxNjIuNjc4IDk0Ljg1NTggMTYyLjY3OCA5Mi4wNjI1IDE2MC45NTQgOTAuMzM4Nkw5Ni41NzM4IDI1Ljk1OFoiIGZpbGw9IiMwMDA3NzciLz4KPG1hc2sgaWQ9Im1hc2sxXzE0MF8yIiBzdHlsZT0ibWFzay10eXBlOmx1bWluYW5jZSIgbWFza1VuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMjQiIHk9IjI0IiB3aWR0aD0iMTM5IiBoZWlnaHQ9IjEzOSI+CjxwYXRoIGQ9Ik05Ni41NzM4IDI1Ljk1OEM5NC44NDk5IDI0LjIzNDEgOTIuMDU2NiAyNC4yMzQxIDkwLjMzMjcgMjUuOTU4TDI1Ljk1OCA5MC4zMzg2QzI0LjIzNDEgOTIuMDYyNSAyNC4yMzQxIDk0Ljg1NTggMjUuOTU4IDk2LjU3OTdMOTAuMzMyNyAxNjAuOTZDOTIuMDU2NiAxNjIuNjg0IDk0Ljg0OTkgMTYyLjY4NCA5Ni41NzM4IDE2MC45NkwxNjAuOTU0IDk2LjU3OTdDMTYyLjY3OCA5NC44NTU4IDE2Mi42NzggOTIuMDYyNSAxNjAuOTU0IDkwLjMzODZMOTYuNTczOCAyNS45NThaIiBmaWxsPSJ3aGl0ZSIvPgo8L21hc2s+CjxnIG1hc2s9InVybCgjbWFzazFfMTQwXzIpIj4KPHBhdGggZD0iTTkzLjQ1OTEgOTMuNDU5SDE5LjQwMTRWMTg1Ljk4M0g5My40NTkxVjkzLjQ1OVoiIGZpbGw9IiMwMDA0M0IiLz4KPHBhdGggZD0iTTE2Ni45NjIgMC45MzUwNTlIOTIuOTA0M1Y5My40NTkxSDE2Ni45NjJWMC45MzUwNTlaIiBmaWxsPSIjMkYzNzlFIi8+CjwvZz4KPHBhdGggZD0iTTk2Ljc0MzQgNTkuNTAxQzk4LjQyMDYgNjYuOTk4NSAxMDIuMTg0IDczLjg3MDggMTA3LjYwMSA3OS4zMTcxQzExMy4wMTggODQuNzYzNSAxMTkuODY3IDg4LjU2NzggMTI3LjM1OSA5MC4yODU4QzEyOC4wODkgOTAuNDU1MyAxMjguNzQ0IDkwLjg3MDIgMTI5LjIxMSA5MS40NTQ2QzEyOS42NzkgOTIuMDQ0OCAxMjkuOTM2IDkyLjc3NTMgMTI5LjkzNiA5My41MjMzQzEyOS45MzYgOTQuMjcxMyAxMjkuNjc5IDk1LjAwNzYgMTI5LjIxMSA5NS41OTJDMTI4Ljc0NCA5Ni4xODIyIDEyOC4wODkgOTYuNTkxMyAxMjcuMzU5IDk2Ljc2MDdDMTE5Ljg3OSA5OC40Mzc5IDExMy4wMyAxMDIuMjAxIDEwNy42MDcgMTA3LjYyNEMxMDIuMTg0IDExMy4wNDcgOTguNDIwNiAxMTkuODk2IDk2Ljc0MzQgMTI3LjM3NkM5Ni41NzQgMTI4LjEwNyA5Ni4xNTkxIDEyOC43NjEgOTUuNTc0NyAxMjkuMjI5Qzk0Ljk4NDUgMTI5LjY5NiA5NC4yNTQgMTI5Ljk1MyA5My41MDYgMTI5Ljk1M0M5Mi43NTggMTI5Ljk1MyA5Mi4wMjE3IDEyOS42OTYgOTEuNDM3MyAxMjkuMjI5QzkwLjg0NzEgMTI4Ljc2MSA5MC40MzggMTI4LjEwNyA5MC4yNjg2IDEyNy4zNzZDODguNTU2NCAxMTkuODk2IDg0Ljc2OTYgMTEzLjA1MyA3OS4zNDA4IDEwNy42NDJDNzMuOTExOSAxMDIuMjI1IDY3LjA1NzIgOTguNDU1NCA1OS41NzE0IDk2Ljc2NjZDNTguODQwOSA5Ni41OTcxIDU4LjE4NjMgOTYuMTgyMiA1Ny43MTg4IDk1LjU5NzhDNTcuMjUxMyA5NS4wMDc2IDU2Ljk5NDEgOTQuMjc3MSA1Ni45OTQxIDkzLjUyOTFDNTYuOTk0MSA5Mi43ODExIDU3LjI1MTMgOTIuMDQ0OCA1Ny43MTg4IDkxLjQ2MDRDNTguMTg2MyA5MC44NzAyIDU4Ljg0MDkgOTAuNDYxMiA1OS41NzE0IDkwLjI5MTdDNjcuMDU3MiA4OC41Nzk1IDczLjkwNjEgODQuNzg2OSA3OS4zMzQ5IDc5LjM1OEM4NC43NjM4IDczLjkyOTIgODguNTU2NCA2Ny4wODAzIDkwLjI2ODYgNTkuNTk0NUM5MC40MjY0IDU4Ljg1ODIgOTAuODI5NiA1OC4xOTc4IDkxLjQxMzkgNTcuNzI0NEM5MS45OTgzIDU3LjI1MTEgOTIuNzIzIDU2Ljk4MjMgOTMuNDc2OCA1Ni45NzY1Qzk0LjIzMDYgNTYuOTY0OCA5NC45NjExIDU3LjIxMDIgOTUuNTU3MiA1Ny42NzE4Qzk2LjE1MzIgNTguMTMzNSA5Ni41NzQgNTguNzgyMiA5Ni43NDkzIDU5LjUxMjdMOTYuNzQzNCA1OS41MDFaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTQwXzIiPgo8cmVjdCB3aWR0aD0iMTg3IiBoZWlnaHQ9IjE4NyIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPGNsaXBQYXRoIGlkPSJjbGlwMV8xNDBfMiI+CjxyZWN0IHdpZHRoPSIxODciIGhlaWdodD0iMTg3IiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo="></img>
                                                                        </div>
                                                                    </div>
                                                                `;
        
                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                            } else if (product.sku_id === NITRO_CREDITS_3_DAYS) {
                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                    
                                                                previewHolder.innerHTML = `
                                                                    <div class="nitro-3-days-modal-orb-preview">
                                                                        <img class="hero-img" src="https://cdn.discordapp.com/assets/content/81644099db353c3ea7cefa334f8d298d06b768a68a349de663d2151fd01eddc7.png"></img>
                                                                        <svg class="nitro-title" aria-hidden="true" role="img" width="106" height="26" viewBox="0 0 106 26"><title>Nitro</title><g fill="none" fill-rule="evenodd"><path fill="white" d="M98.8266537 8.64800265L97.5788372 17.0822416C97.2940433 19.0754982 95.0485266 20.0010292 92.981582 20.0010292 91.0571496 20.0010292 89.1680861 19.0754982 89.4175111 17.2605602L90.6652125 8.64800265C90.9501215 6.76162212 93.1956383 5.80077257 95.2624676 5.80077257 97.3294121 5.80077257 99.1115628 6.76162212 98.8266537 8.64800265M96.2496839.0038079646L96.2503751.0000115044248 82.8208233.0000115044248C82.4777342.0000115044248 82.1864887.251383186 82.1368341.59030354L81.4839511 5.04596726C81.4228909 5.46254248 81.7462794 5.83609115 82.167825 5.83609115L84.6202551 5.83609115C84.8670304 5.83609115 85.0355795 6.08734779 84.9386897 6.31398496 84.6326976 7.03036549 84.4097703 7.8080646 84.2859219 8.64800265L83.0381053 17.2605602C82.2182861 23.0258876 87.0301735 25.9085513 92.2687909 25.9085513 97.7574094 25.9085513 103.139115 23.0258876 103.958934 17.2605602L105.206059 8.64800265C106.009634 2.99656903 101.367679.115400885 96.2496839.0038079646M15.5778562 11.7941867L15.6467505 15.9747796C15.648133 16.0607177 15.5902986 16.1363018 15.5068881 16.1574699L15.5067729 16.1574699 14.0843013 11.1148504C14.0822275 11.1071425 14.0795777 11.0996646 14.0763519 11.0923018L9.66308376.775018584C9.55432753.520885841 9.30421123.355912389 9.0273667.355912389L4.02607753.355912389C3.68126035.355912389 3.38920838.6097 3.34151232.950576106L.00682030635 24.7668062C-.0513596718 25.1820009.271568009 25.5526735.691385514 25.5526735L5.67355018 25.5526735C6.01882818 25.5526735 6.31122578 25.2981956 6.3583458 24.9566292L7.6643423 15.4949301C7.66560958 15.4857265 7.66618562 15.4762929 7.66607042 15.4669743L7.59475674 10.6052044 7.73715368 10.5697708 9.23116943 15.6125053C9.23335838 15.6196381 9.23589295 15.6267708 9.23888836 15.6336735L13.3663258 25.1370186C13.4758885 25.3893106 13.7250831 25.5526735 14.0004299 25.5526735L19.39573 25.5526735C19.7405472 25.5526735 20.0325992 25.2988858 20.0802953 24.9580097L23.4156785 1.14177965C23.4738585.726584956 23.1509308.355912389 22.7311133.355912389L17.782935.355912389C17.438233.355912389 17.146181.609469912 17.0983698.950346018L15.5795843 11.7654257C15.578317 11.7749743 15.577741 11.784523 15.5778562 11.7941867M25.2200758 25.5526274L30.2035078 25.5526274C30.5483249 25.5526274 30.8403769 25.2989549 30.888073 24.9579637L34.222765 1.14184867C34.280945.726653982 33.9580173.355981416 33.5381998.355981416L28.5547678.355981416C28.2100659.355981416 27.9180139.609653982 27.8702026.950645133L24.5355106 24.7667602C24.4773306 25.1819549 24.8002583 25.5526274 25.2200758 25.5526274M37.588782.910862832L36.9357838 5.3664115C36.8748388 5.78298673 37.1982273 6.15665044 37.6197729 6.15665044L42.8344271 6.15665044C43.2536686 6.15665044 43.5763658 6.52628761 43.5192227 6.94102212L41.0626451 24.7682788C41.005502 25.1830133 41.3281993 25.5526504 41.7474408 25.5526504L46.8027624 25.5526504C47.1481556 25.5526504 47.4405532 25.2980575 47.4875581 24.9564912L49.9960944 6.75280973C50.0430992 6.41112832 50.3354968 6.15665044 50.68089 6.15665044L56.2874814 6.15665044C56.6305704 6.15665044 56.9217007 5.90539381 56.9714705 5.56635841L57.6249296 1.11080973C57.6859898.694234513 57.3626013.320570796 56.9409404.320570796L38.2727712.320570796C37.9296821.320570796 37.6384366.571827434 37.588782.910862832M72.9157339 9.14614425C72.7371616 10.6051354 71.5970645 12.0642416 69.6364568 12.0642416L66.6908218 12.0642416C66.2704283 12.0642416 65.9472702 11.6925336 66.0063718 11.2768788L66.6298768 6.8920823C66.6782642 6.55178142 66.9700857 6.29891416 67.3143268 6.29891416L70.4562761 6.29891416C72.3453396 6.29891416 73.0936148 7.61571062 72.9157339 9.14614425M71.1691824.355958407L61.6845787.355958407C61.3397615.355958407 61.0477096.609630973 60.9998983.950622124L57.6652063 24.7667372C57.6070263 25.1819319 57.929954 25.5526044 58.3497715 25.5526044L63.4034802 25.5526044C63.7487582 25.5526044 64.0411558 25.2981265 64.0882759 24.9565602L65.0696166 17.8430292C65.0932342 17.6723035 65.2393178 17.5450646 65.4120144 17.5450646L66.0616716 17.5450646C66.1795293 17.5450646 66.2893224 17.6050027 66.3528019 17.7041708L71.1792055 25.2345071C71.3062798 25.4327283 71.5256356 25.5526044 71.7613509 25.5526044L78.0034289 25.5526044C78.5625328 25.5526044 78.8902992 24.9242327 78.5697909 24.4667018L73.5050221 17.2370912C73.383593 17.0637195 73.4460357 16.8224717 73.6364743 16.729631 76.8698986 15.1516841 78.7475566 13.5351973 79.3665685 9.03926814 80.0787836 3.13174602 76.3728918.355958407 71.1691824.355958407"></path></g></svg>
                                                                        <div class="preview-perks">
                                                                            <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                            <p>Custom emojis anywhere</p>
                                                                        </div>
                                                                        <div class="preview-perks">
                                                                            <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                            <p>Custom profile</p>
                                                                        </div>
                                                                        <div class="preview-perks">
                                                                            <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                            <p>500 MB Uploads</p>
                                                                        </div>
                                                                        <div class="preview-perks">
                                                                            <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                            <p>HD video streaming</p>
                                                                        </div>
                                                                        <div class="preview-perks">
                                                                            <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                            <p>Colour app themes and more!</p>
                                                                        </div>
                                                                    </div>
                                                                `;
                                                            } else {
                                                                previewHolder.innerHTML = `
                                                                    <p>${getTextString("CARD_TYPE_EXTERNAL_SKU_ERROR")}</p>
                                                                `;
                                                            }
                                                            
                                                        }
    
    
                                                        const priceTextNitro = modal.querySelector("[data-price-nitro]");
                                                        const priceTextStandard = modal.querySelector("[data-price-standard]");
    
                                                        const priceContainerNitro = modal.querySelector("[data-price-nitro-container]");
                                                        const priceContainerStandard = modal.querySelector("[data-price-standard-container]");
    
                                                        const priceContainer = modal.querySelector("[data-shop-price-container]");
    
                                                        let priceStandard = "N/A";
                                                        let priceNitro = "N/A";
                                                        let priceOrb = "N/A";
    
                                                        if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                            if (localStorage.discord_premium_type === "2") {
                                                                if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                                    product.prices["4"].country_prices.prices.forEach(price => {
                                                                        if (price.currency === "usd") {
                                                                            priceStandard = price.amount;
                                                                        }
                                                                        if (price.currency === "discord_orb") {
                                                                            priceOrb = price.amount;
                                                                        }
                                                                    });
                    
                                                                    if (priceStandard != "N/A" && priceOrb != "N/A") {
    
                                                                        let nitro_price = document.createElement("div");
                                                                
                                                                        nitro_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900; margin-left: 23px">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                            <div class="nitro-icon" style="margin-left: -5px"></div>
                                                                        `;
                                                                        nitro_price.style.position = `absolute`;
                                                                        nitro_price.style.left = `0px`;
                                                                        
                                                                        priceContainer.appendChild(nitro_price);
    
                                                                        let orb_price = document.createElement("div");
                                                                
                                                                        orb_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                                        `;
                                                                        orb_price.style.position = `absolute`;
                                                                        orb_price.style.right = `20px`;
                                                                        
                                                                        priceContainer.appendChild(orb_price);
                    
                                                                    } else if (priceStandard != "N/A") {
                    
                                                                        let nitro_price = document.createElement("div");
                                                                
                                                                        nitro_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900; margin-left: 23px">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                            <div class="nitro-icon" style="margin-left: -5px"></div>
                                                                        `;
                                                                        nitro_price.style.position = `absolute`;
                                                                        nitro_price.style.left = `0px`;
                                                                        
                                                                        priceContainer.appendChild(nitro_price);
                    
                                                                    } else if (priceOrb != "N/A") {
                    
                                                                        let orb_price = document.createElement("div");
                                                                
                                                                        orb_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                                        `;
                                                                        orb_price.style.position = `absolute`;
                                                                        orb_price.style.left = `23px`;
                                                                        
                                                                        priceContainer.appendChild(orb_price);
                    
                                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                            <div class="unplublished-tag">
                                                                                <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                            </div>
                                                                        `;
                                                                        
                                                                    }
                                                                }
                                                                if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                                    product.prices["0"].country_prices.prices.forEach(price => {
                                                                        if (price.currency === "usd") {
                                                                            priceStandard = price.amount;
                                                                        }
                                                                        if (price.currency === "discord_orb") {
                                                                            priceOrb = price.amount;
                                                                        }
                                                                    });
                    
                                                                    if (priceStandard != "N/A" && priceOrb != "N/A") {
    
                                                                        let standard_price = document.createElement("div");
                                                                
                                                                        standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        `;
                                                                        standard_price.style.position = `absolute`;
                                                                        standard_price.style.left = `0px`;
                                                                        standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(standard_price);
    
                                                                        let orb_standard_price = document.createElement("div");
                                                                
                                                                        orb_standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                            <div class="orb-icon-crossed" style="margin-left: -23px"></div>
                                                                        `;
                                                                        orb_standard_price.style.position = `absolute`;
                                                                        orb_standard_price.style.right = `20px`;
                                                                        orb_standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(orb_standard_price);
                    
                                                                    } else if (priceStandard != "N/A") {
                    
                                                                        let standard_price = document.createElement("div");
                                                                
                                                                        standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        `;
                                                                        standard_price.style.position = `absolute`;
                                                                        standard_price.style.left = `0px`;
                                                                        standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(standard_price);
                    
                                                                    } else if (priceOrb != "N/A") {
                    
                                                                        let orb_standard_price = document.createElement("div");
                                                                
                                                                        orb_standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                            <div class="orb-icon-crossed" style="margin-left: -24px"></div>
                                                                        `;
                                                                        orb_standard_price.style.position = `absolute`;
                                                                        orb_standard_price.style.left = `23px`;
                                                                        orb_standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(orb_standard_price);
                    
                                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                            <div class="unplublished-tag">
                                                                                <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                            </div>
                                                                        `;
                                                                        
                                                                    }
                                                                }
                                                            } else {
                                                                if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                                    product.prices["0"].country_prices.prices.forEach(price => {
                                                                        if (price.currency === "usd") {
                                                                            priceStandard = price.amount;
                                                                        }
                                                                        if (price.currency === "discord_orb") {
                                                                            priceOrb = price.amount;
                                                                        }
                                                                    });
                    
                                                                    if (priceStandard != "N/A" && priceOrb != "N/A") {
    
                                                                        let standard_price = document.createElement("div");
                                                                
                                                                        standard_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        `;
                                                                        standard_price.style.position = `absolute`;
                                                                        standard_price.style.left = `0px`;
                                                                        
                                                                        priceContainer.appendChild(standard_price);
    
                                                                        let orb_price = document.createElement("div");
                                                                
                                                                        orb_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                                        `;
                                                                        orb_price.style.position = `absolute`;
                                                                        orb_price.style.right = `20px`;
                                                                        
                                                                        priceContainer.appendChild(orb_price);
                    
                                                                    } else if (priceStandard != "N/A") {
                    
                                                                        let nitro_price = document.createElement("div");
                                                                
                                                                        nitro_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        `;
                                                                        nitro_price.style.position = `absolute`;
                                                                        nitro_price.style.left = `0px`;
                                                                        
                                                                        priceContainer.appendChild(nitro_price);
                    
                                                                    } else if (priceOrb != "N/A") {
                    
                                                                        let orb_price = document.createElement("div");
                                                                
                                                                        orb_price.innerHTML = `
                                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                                        `;
                                                                        orb_price.style.position = `absolute`;
                                                                        orb_price.style.left = `23px`;
                                                                        
                                                                        priceContainer.appendChild(orb_price);
                    
                                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                            <div class="unplublished-tag">
                                                                                <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                            </div>
                                                                        `;
                                                                        
                                                                    }
                                                                }
                                                                if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                                    product.prices["4"].country_prices.prices.forEach(price => {
                                                                        if (price.currency === "usd") {
                                                                            priceStandard = price.amount;
                                                                        }
                                                                        if (price.currency === "discord_orb") {
                                                                            priceOrb = price.amount;
                                                                        }
                                                                    });
                    
                                                                    if (priceStandard != "N/A" && priceOrb != "N/A") {
    
                                                                        let standard_price = document.createElement("div");
                                                                
                                                                        standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed" style="margin-left: 21px;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                            <div class="nitro-icon-crossed" style="margin-left: -3px"></div>
                                                                        `;
                                                                        standard_price.style.position = `absolute`;
                                                                        standard_price.style.left = `0px`;
                                                                        standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(standard_price);
    
                                                                        let orb_standard_price = document.createElement("div");
                                                                
                                                                        orb_standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                            <div class="orb-icon-crossed" style="margin-left: -23px"></div>
                                                                        `;
                                                                        orb_standard_price.style.position = `absolute`;
                                                                        orb_standard_price.style.right = `20px`;
                                                                        orb_standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(orb_standard_price);
                    
                                                                    } else if (priceStandard != "N/A") {
                    
                                                                        let standard_price = document.createElement("div");
                                                                
                                                                        standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed" style="margin-left: 21px;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                            <div class="nitro-icon-crossed" style="margin-left: -3px"></div>
                                                                        `;
                                                                        standard_price.style.position = `absolute`;
                                                                        standard_price.style.left = `0px`;
                                                                        standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(standard_price);
                    
                                                                    } else if (priceOrb != "N/A") {
                    
                                                                        let orb_standard_price = document.createElement("div");
                                                                
                                                                        orb_standard_price.innerHTML = `
                                                                            <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                            <div class="orb-icon-crossed" style="margin-left: -24px"></div>
                                                                        `;
                                                                        orb_standard_price.style.position = `absolute`;
                                                                        orb_standard_price.style.left = `23px`;
                                                                        orb_standard_price.style.marginTop = `30px`;
                                                                        
                                                                        priceContainer.appendChild(orb_standard_price);
                    
                                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                            <div class="unplublished-tag">
                                                                                <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                            </div>
                                                                        `;
                                                                        
                                                                    }
                                                                }
                                                            }
                
                                                        } else {
                                                            if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                                product.prices["0"].country_prices.prices.forEach(price => {
                                                                    if (price.currency === "usd") {
                                                                        priceStandard = price.amount;
                                                                    }
                                                                });
                                                            }
                                                    
                                                            if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                                product.prices["4"].country_prices.prices.forEach(price => {
                                                                    if (price.currency === "usd") {
                                                                        priceNitro = price.amount;
                                                                    }
                                                                });
                                                            }
                
                                                            if (priceTextStandard) {
                                                                priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                                            }
                    
                                                            if (priceTextNitro) {
                                                                priceTextNitro.textContent = priceNitro !== "N/A" ? `US$${(priceNitro / 100).toFixed(2)} with Nitro` : "null";
                                                            }
                                                        }
    
    
                                                        const unpublishedAt = new Date(product.unpublished_at);
                                
                                                        if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                                
                                                            function updateTimer() {
                                                                const now = new Date();
                                                                const timeDiff = unpublishedAt - now;
                                
                                                                if (timeDiff <= 0) {
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                    clearInterval(timerInterval);
                                                                } else {
                                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${days}${getTextString("CARD_UNPUBLISHED_COUNTDOWN_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                }
                                                            }
                                
                                                            const timerInterval = setInterval(updateTimer, 1000);
                                                            updateTimer();
                                                        }
    
                                                        const ExpiredAt = new Date(product.expires_at);
                                
                                                        if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                                
                                                            function updateTimer() {
                                                                const now = new Date();
                                                                const timeDiff = ExpiredAt - now;
                                
                                                                if (timeDiff <= 0) {
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                    clearInterval(timerInterval);
                                                                } else {
                                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                                        </div>
                                                                    `;
                                                                }
                                                            }
                                
                                                            const timerInterval = setInterval(updateTimer, 1000);
                                                            updateTimer();
                                                        }
    
                                                        if (product.premium_type === 2) {
                                                            modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                            `;
                                                        }

                                                        if (localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1" && product.type != 3000) {

                                                            if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen") {
                                                                let newLogInWithDiscordDismissible = document.createElement("div");
                                                    
                                                                newLogInWithDiscordDismissible.innerHTML = `
                                                                    <div class="newLogInWithDiscordDismissible-inner">
                                                                        <svg class="closeIcon_modal_discord_login" onclick="closeLoginDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                        <hr style="opacity: 0;">
                                                                        <p class="center-text options-medium-title" style="margin-top: 0px;">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_TITLE")}</p>
                                                                        <hr style="opacity: 0;">
                                                                        <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_1")}</p>
                                                                        <hr style="opacity: 0;">
                                                                        <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_2")}</p>
                                                                        <hr style="opacity: 0;">
                                                                        <img src="https://cdn.yapper.shop/assets/178.png">
                                                                        <hr style="opacity: 0;">
                                                                        <button class="card-button" onclick="loginToDiscord()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_LOG_IN")}</button>
                                                                        <button class="card-button" onclick="closeLoginDismissibleCoachtip()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_NO_THANKS")}</button>
                                                                    </div>
                                                                    <div class="newLogInWithDiscordDismissible-pointer"></div>
                                                                `;
                                                    
                                                                newLogInWithDiscordDismissible.classList.add('newLogInWithDiscordDismissible');
                                                    
                                                                newLogInWithDiscordDismissible.id = `newLogInWithDiscordDismissible`;
                                                    
                                                                modal.appendChild(newLogInWithDiscordDismissible);
                                                            }
                                                        }
                                                        
    
    
                                                        let modal_back = document.createElement("div");
    
                                                        modal_back.classList.add('modalv2-back');
                                                        modal_back.id = 'modalv2-back';
    
                                                        document.body.appendChild(modal_back);
    
                                                        setTimeout(() => {
                                                            modal_back.classList.add('show');
                                                        }, 1);
    
    
                                                        modal.addEventListener('click', (event) => {
                                                            if (event.target === modal) {
                                                                modal.classList.remove('show');
                                                                modal_back.classList.remove('show');
                                                                setTimeout(() => {
                                                                    modal.remove();
                                                                    modal_back.remove();
                                                                }, 300);
                                                                removeParams('itemSkuId');
                                                                modalIsAlreadyOpen = false;
                                                            }
                                                        });
    
                                                        document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                            modal.classList.remove('show');
                                                            modal_back.classList.remove('show');
                                                            setTimeout(() => {
                                                                modal.remove();
                                                                modal_back.remove();
                                                            }, 300);
                                                        });
                                                    }
                                                }
                                            }
    
                                            if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 3: only share button") {
                                                card.querySelector("[data-share-product-card-button]").innerHTML = `
                                                    <svg class="shareIcon_f4a996" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${product.sku_id}'); copyNotice('copylink');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                `;
                                            }
    
    
                                            function newItemCheck() {
    
                                                if (N > g) {
                                                } else {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_NEW_TAG")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                                                                                
                                            if (m.includes(product.sku_id)) {
                                                newItemCheck();
                                            }
    
                                            function newColorItemCheck() {
    
                                                if (N > newColorsExpireDate) {
                                                } else {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_NEW_COLORS_TAG")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                                                                                
                                            if (newColorsSKUIDS.includes(product.sku_id) && discord_categories.ANIME_V3 === apiCategory.sku_id) {
                                                newColorItemCheck();
                                            }
    
                                            function popularItemCheck() {
                                                card.classList.add('popular-item');
                                            }
                                                                                
                                            if (I.includes(product.sku_id)) {
                                                popularItemCheck();
                                            }
    
    
                                            const unpublishedAt = new Date(product.unpublished_at);
                                
                                            if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = unpublishedAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${days}${getTextString("CARD_UNPUBLISHED_COUNTDOWN_TAG")}</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
                                            const ExpiredAt = new Date(product.expires_at);
                                
                                            if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                                
                                                function updateTimer() {
                                                    const now = new Date();
                                                    const timeDiff = ExpiredAt - now;
                                
                                                    if (timeDiff <= 0) {
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                            </div>
                                                        `;
                                                        clearInterval(timerInterval);
                                                    } else {
                                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                                
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                            </div>
                                                        `;
                                                    }
                                                }
                                
                                                const timerInterval = setInterval(updateTimer, 1000);
                                                updateTimer();
                                            }
    
                                            // Append card to output
                                            cardOutput.append(card);
    
                                            scrollToSKU(product.sku_id, 'true');
                                        }
                                    }
                                    output0.append(category);
        
                                    document.getElementById("shop-category-loading-container").innerHTML = ``;
                                    document.getElementById("shop-category-loading-container").style.display = 'none';
    
        
                                    const lofi_girl_banner = document.getElementById(discord_categories.LOFI_GIRL);
                                    const kawaii_mode_banner = document.getElementById(discord_categories.KAWAII_MODE);
        
                                    if (localStorage.reduced_motion != "true") {
        
                                        if (lofi_girl_banner) {  // Check if element exists
                                            document.getElementById(`${discord_categories.LOFI_GIRL}-preview-banner-container`).innerHTML = `
                                                <video autoplay muted class="home-page-preview-banner" src="https://cdn.discordapp.com/assets/collectibles/drops/lofi_girl/hero_banner.webm" loop></video>
                                            `;
                                        }
        
                                        if (kawaii_mode_banner) {  // Check if element exists
                                            document.getElementById('1306330663213072494-preview-banner-container').innerHTML = `
                                                <video autoplay muted class="home-page-preview-banner" src="https://cdn.discordapp.com/assets/collectibles/drops/kawaii_mode/hero_banner.webm" loop></video>
                                            `;
                                        }
                                    }
                                    if (kawaii_mode_banner) {  // Check if element exists
                                        document.getElementById('1306330663213072494-summary').style.color = 'black';
                                    }
                                } else if (apiCategory.type === FEATURED) {
    
                                    const featureContainerTemplate = document.querySelector("[data-shop-subblock-container-template]");
                
                                    const featureBlockContainer = featureContainerTemplate.content.cloneNode(true).children[0];
    
                                    apiCategory.subblocks.forEach(subblock => {
    
                                        const template = document.querySelector("[data-shop-category-template-sub]");
                
                                        const featureblock = template.content.cloneNode(true).children[0];
                
                                        const oneImage = featureblock.querySelector("[data-shop-preview-image-sub]");
                                        oneImage.src = subblock.banner_url;
                                        oneImage.alt = subblock.name;
    
                                        featureblock.setAttribute("onclick",`setParams({page: '${subblock.page}'}); addParams({scrollTo: '${subblock.sku_id}'}); location.reload();`);
    
                                        featureBlockContainer.append(featureblock);
    
                                    });
    
                                output.append(featureBlockContainer);
                                
                                } else if (apiCategory.type === WIDE_BANNER) {
    
                                    const template = document.querySelector("[data-shop-category-template-wide]");
                
                                    const category = template.content.cloneNode(true).children[0];
                
                                    const oneImage = category.querySelector("[data-shop-preview-image-wide]");
                                    oneImage.src = apiCategory.banner_url;
                                    oneImage.alt = apiCategory.name;
    
                                    const title = category.querySelector("[data-shop-output-wide-title]");
                                    title.textContent = apiCategory.title;
                                    title.style.color = apiCategory.banner_text_color;
    
                                    const desc = category.querySelector("[data-shop-output-wide-desc]");
                                    desc.textContent = apiCategory.body;
                                    desc.style.color = apiCategory.banner_text_color;
    
                                    if (apiCategory.disable_cta != true) {
                                        category.classList.add('clickable');
                                    }
    
                                    category.setAttribute("onclick",`setParams({page: '${apiCategory.page}'}); location.reload();`);
    
                                    output.append(category);
                                }
                            }
    
                            processCategories()
                        });
                    }
                })
                .catch(error => {
                    console.error('Error fetching the API:', error);
                });
            }
        } else if (params.get("page") === "pplus-home") {

            fetchFirstHomeData();

            function fetchFirstHomeData() {
                let discordProfileEffectsCache = null;
            
                fetch(apiUrl, {
                    method: "GET",
                    headers: {
                        "Password": api_password,
                        "Authorization": discord_token,
                        "Token": api_token
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === "Missing Access") {
                        document.getElementById("everything-housing-container").innerHTML = `
                            <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                                <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                                <h2>${getTextString("SHOP_NOT_LOAD_ERROR_1")}</h2>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR_2")}</p>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR")}${data.message}</p>
                                <button class="refresh-button" onclick="location.reload();">${getTextString("SHOP_NOT_LOAD_ERROR_RELOAD")}</button>
                            </div>
                        `;
                    } else {
                        data.forEach(apiCategory => {
                        async function processCategories() {
                            const output = document.querySelector("[data-shop-output]");
                            const output0 = document.querySelector("[data-shop-0-output]");
                            if (apiCategory.type === HERO) {
                                const template = document.querySelector("[data-shop-category-template]");
                            
                                const category = template.content.cloneNode(true).children[0];
                            
                                if (apiCategory.hero_banner_asset) {
                                    if (apiCategory.hero_banner_asset.animated != null) {
                                        if (apiCategory.hero_banner_asset.static != null) {
                                            category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                <img class="home-page-preview-banner" src="${apiCategory.hero_banner_asset.static}">
                                                <video autoplay muted class="home-page-preview-banner-video" style="position: absolute; left: 0px; bottom: 0px; z-index: 1;" src="${apiCategory.hero_banner_asset.animated}" loop></video>
                                            `;
                                        } else {
                                            category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                <video autoplay muted class="home-page-preview-banner-video" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.hero_banner_asset.animated}" loop></video>
                                            `;
                                        }
                                    } else if (apiCategory.hero_banner_asset.static != null) {
                                        category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.hero_banner_asset.static}`;
                                    }
                                } else if (apiCategory.hero_banner != null) {
                                    category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.hero_banner}.png`;
                                    category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                } else {
                                    category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.banner}.png`;
                                    category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                }
                            
    
                                if (apiCategory.hero_logo != null) {
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.hero_logo}.png`;
                                } else if (apiCategory.logo != null) {
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.logo}.png`;
                                } else {
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/31.png`;
                                }
                                category.querySelector("[data-shop-category-logo-image]").alt = apiCategory.name;
    
                                category.querySelector("[data-shop-category-desc]").id = `${apiCategory.sku_id}-summary`;
                                category.querySelector("[data-shop-category-desc]").textContent = apiCategory.summary;
    
                                category.querySelector("[data-preview-banner-container]").id = apiCategory.sku_id;
                                category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-preview-banner-container`;
                            
                                if (apiCategory.leaks_type) {
                                    category.querySelector("[data-preview-new-categoey-button]").innerHTML = `
                                        <button class="home-page-preview-button" onclick="setParams({page: 'leaks'}); location.reload();">Check out New ${apiCategory.name} Leaks</button>
                                    `;
                                } else {
                                    category.querySelector("[data-preview-new-categoey-button]").innerHTML = `
                                        <button class="home-page-preview-button" onclick="setParams({page: 'pplus'}); addParams({itemSkuId: '${apiCategory.sku_id}'}); location.reload();">${getTextString("SHOP_CATEGORY_BROWSE_THE_COLLECTION_1")}${apiCategory.name}${getTextString("SHOP_CATEGORY_BROWSE_THE_COLLECTION_2")}</button>
                                    `;
                                }
                            
                                const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                if (cardOutput) {
                                    for (const product of apiCategory.products) {
                                        const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                        const card = cardTemplate.content.cloneNode(true).children[0];

                                        card.id = product.sku_id;

                                        if (product.type === item_types.NONE) {
                                            card.classList.add("type_100");
                                            card.classList.add('hidden')
                                        } else if (product.type === item_types.AVATAR_DECORATION) {
                                            product.items.forEach(item => {
                                                card.classList.add("type_0");
                                                // Set the innerHTML for the preview holder
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('avatar-decoration-image');
                                                
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                
                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                
                                                previewHolder.appendChild(bgimg);
                                        
                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                        if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                            bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                        bgimg.style.backgroundImage = `url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAYAAABRRIOnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAy4SURBVHgB7Z3bbxTJFYePCZfYAgMh4m7CJVwSELeIyy5ICFagICHgkQeeeeMf4oUHeAEJCRASQShcHqIlXA0RCgYcBN5wyeIAZmUDhmXn65nytsczPd3V1VXdM/VJzYzxeKan69enTp06p6pNmpuO0tFZeWyvPE6oPFe/r8Vg5XGodAxXfh4KPb6TJqVNmgcad3bpmFo6plQeswRRDJSO/spjU4ikyILgTkcAvy8dsyo/uwTrgTBeSlkkg1JAiiYIGr1LykKYIfkGUfRJwcRRFEFgBZZJ/kVQD6xGX+Ux1+RZEFiDxaVjkbjvDkyBpXgoObYaeRREMwqhGkYuWAvEkSth5EkQrSCEWtCV5EYYeRHEcmk9IYRBDD+Ujh5xjGtB4CyukfoBolZD+Rh94ghXgsASrJXy8NEzFmfdiAtBIALE0KrdQ1ycWIvfiD0QwJ9Lx0rLn1tUVCSWxzel42exgC0LgY/wjXhfQResxfdioQuxcacSat5QOn4rHl1UyP6jlOdLMiNrQRBuXiW+izAB15AuBKveLxmRZUPhOC4Wj2mYz8Fi/CgZkIUgONnN4oeUWTJdyvke/xPDzqZpQSAGnMfp4smayaVjZun4rxgUhUlBKDFknank+RUcdaOiMCUILwZ3GBWFKUH8RcrzEh43IIrfiYGopglBMKzsEo9rOipHqqystIIgzvBH8eQFuuxUcYo0gsAqrBJP3iBOQe2IVkRznOiBaVopnrxC22jNG+lYCEYUW8XPTeQZFebGyUw08tARBFPYM8WTd7hxad9EIe6kgsBv+JN4igIRY3yJn+L+QRIfgj5pmXiKBpOM4+O+OIkgEINPcCkedB3r4r44riC6xAefiowqim5IXEH4rqL4rInzojhOJWKYI56iQ9fRMIrZyELgM/iuonmgOi7SwWxkIYh4FW4Wc/r06TJnzhx5+/atZMGiRYukra1NPnz4IAWD9v4qEVYiSi2FsQ400KxZs2TBggXB80mTJgX/f+zYMXny5ImYZP369bJnz57g+cePH4P3f/bsmbx69cr4Z2UEVqK3dHyu9csoQeTWkaTBV65cGQhg+fLlIwKoZuvWrcYbacuWLaPOY8WKFcEBSiAPHjyQnp6e4Occgi+xROoUFtcThFrAKzdw8bn7N2/eHFiDeiIIw+s5TIkC60B3FHWOYYEgDI579+5JzqhrJepVbtFVrJUcMHfuXFm1apWsW7culgiqQQznzp0LRNTR0SFTpkwJ3ofnEydODB7DDA4OyqdPn4JH7vD379/Lmzdvgue7du0KrFJS+Pu+vj65evVq8DwnUDc6xkrUE8R34jgqiRB0GyDP4G+cOXMmD8JgFZu/Vf9nrVEGXcVCcQhm+cCBAzJ7dvOVdkydOlXWrl0rN2/elC9fvohDaPv/S1W9aK04hPORxbZt2yL76qJDl7Vv3z7JAWMGDtWCcO5M4ritXr1amh0cTxxex5BuN2pgMa7GC5wSHtY1O8QzdBxlw4xy0qoF4bS7aPauohq+K8Nox4zqEcKCoLtwZiG4OK3QVVSDIBxbiVHdxriqXzij1ayDAjHs2LFDHDMymx0WhDNnslWtg2LDhg2ub4aRCcywIDrFEViHVsfxNZilnihBUALmJDLZ6tZBwTVwaCWY8AraXwnCW4cc4PjGCFwGJQgnDiV3BNPXnjKORxzB2h7hLsM64WQWT3nE4TAuwT5lbruMVopKxsVhtzFiIZxZh1aMOzSCa+JwjqMDQbSLA9asiVUm0JIsXbpUHNGJIJwMN70zWR/d7DADdDgRBFO/3pmsD9eGjDEHtDvpMlQSqqc+jrrUwEJY38jEdxeNcXSNJjDtadVCZBF7IGH1xo0bQS2ESl7F5G7cuNHoMI7M62vXrgWJsiq1n88h95MhtMlRkyo7sFz8006iJSvWW7MSmMKFCxeKKah5OHHihDx9+nRUaR3p86omYtmyZdLenk73CO3o0aPBe4ZLBPmcFy9eyN27d2X8+PEyf/58MQWfw/eyyDCCsLq04Pbt24PMYxPQ2KdPn47MXkYkjx49SiUKxHD8+PHI1HnOobe3N7izTYni69evtot8JuguS6iNqToLGofCl7ivpVhHl4sXL8auozBZjONipGFVECYjcEkvPH2xTn+Mv0A3ERf8DPwZE7gYfloVBOV0pqA0Lin379+XpNy+fVuScufOHTGF7co1q4Lo7DQzh0bpvY5Z1rEQr1+/lqRgJUx1G6auWVysCsKU+dMts6eANynPnz8XHRh9mMCkVY0DgrC2nbDtL1eNjpBch9inTZsmFhm0ZiG4sKYuLiX9OugIkiUDdDD1XQl22RQlghgSC5hUuu5FmjdvniSFlWqSwvmZtIa6otRgCEEMiwWqF+ZIi06qmU4YWyc3wXSCi46QNRm2ZiFMZ0clTUhlhlVnCKeWJYoL52Q6NdCihRi05lSa/lJc+J07d8Z6LWKM+9paUKUdV9BZlCSatq4RDFkTRBaOEWtJ7N69O/K9aZyDBw+maqQ478E5sARSFlnTFp3KQSa32HEl8z26meE0OcupoH/F8WMSi8XC1IwnZp6ZVVZqmTx5sqSFibFNmzYFohgYGBiJM/AzSwTt3bs3s1xIZjwtzXr2kg9hxUJkmWHNe+/fv19sgGNqO1XeYnb6OxWH0NrBzdNUvOOfceEfPC1NYBS8hfAoggXRlSBSbQ8cB52JJU8ZS9dulIXgEzONWOZ0IfBCYOHa0f6jfAjI3Ep4csuIyxAWhPYG4nEwlR8Aebc2ps/PwrrYI8ZgfK3/zDNcnFOnTsnQ0FAQfDJdD5EGVbfBQbg5bYRUQcAtY0aMQVgQw5VfZLKaDPmMRBRNzAQiBoTBQc6jikpGbaaSFYiAAiHqMsIpemSHmWhItVtPhtDmI15r9fYIhLCTJwAkgMkfE+tKUa9QK/NaiYN8hKwytPhMREC9Byl24S6Cz+f7pU2O5T35flibjOmW8qbxAdWCoILrr5IxJiacFKTIk/ZeK4FWJapwcMeSsJpUJDQ+ibb9/f3BI59Tq083JQSwvKfG3yXCQsC3YmkRMmYrTfkANBSbrsWBz2OySnUv6vPVLjocqluKw+HDh418B4tWQYHfOKqIpJYgEMO3YgkuJHdW2gkjLmTcSi7TmOgGEQHnb3kEhRhGDSZq7ahDBtViibfrb2qYrlZFudy1Ov0+d/LJkyfFFS9fvgwcZp3aUbqHs2fPyq1bt2zvsEM38a/q/6zX6MQnrG7gqoTBBcJqJCkIvnDhQtaeeCQ05OfPn4OC4rgoIVy5ciWzDWcbQBnbmDmseoLghX8QS1YiDBenu7s7tsVQow3XsCQADmUjXwLRnz9/3qUQgBDDA6kxXdEW8UfI3flSL2qZvlrOJ/3tkSNHcrP1Ied36NChMbGQcMAqJ1FWhpndtX4RZQGcWYkwdCXcfdevXw/MLHtuk7CL9bh06ZI8fvxY8gLnSvexZMmSoOHZee/y5cvBUgSkwDnehS/MTakzmdnW4A9zYSVqQVxBt+4ya/J8bhJhHaCRIAhUfScOFibzZAIji+8lIo+2UW0nZuU/4mkWfpAGSdVxin0fiohPdyo+tGFPoxfFrf7uFk/ReRjnRXEFwRSpz6gqLn0SmtGMIsn6EFgJK5XiHqPQVcSyDpBEEIjBdx3FI5EPmDTo9JOUh6B+55NiwAgxUeROZ0khP+ooBom6CoVOWJpqcaYWu8RxWNtTF7r3f5SOxBMnug06XPkwZ9tDeyIhz0GrrCLNHa7m0q3mTXgaQjehHV1Oa/JRIevdONnZzzMGhPBvSYEJH4CAFVbCyWZunhFoh9RhAVNOISczs3T4ndXcQKEuOQ4/S0pMCYITIQHAi8I+iIEpbSNRZJPDRi8K+xgVA5iOIyhRTK4cnuzAof+nGJ5fyiKwpEThQ9zZwcwlRTapfYZqsow0/lh59HEKsxBnSL41UEyyDj1j1qgEmyE+zJ0WugYikJmmNDZKsjUFMYpvxMcqdGmYHGsKW3ct6ibBk9lV71ckA4vATnBWKnxsmnEcIPwKuhB2FvOp/dFwEyEEFr4w7jzWw0W/zqQY0+cIws+B1IbIL12E9QVlbfkQ9SCnguow71uUwUdgPiLTFQGjcC0IBaJAHK0qDFUQlTjDyTR5EQQgBiWMVkEJ4YnkJKM9T4JQKGGQjdWsjmfuhKDIoyAUCIOAVjP5GLkVgiLPggiDteiS4uZw4iT2iENnMS5FEYRCWY0usbR0YgpU+SMTUYWpeCuaIMIocWA1OsV9t0KjE195LWUhFLLssciCqIYgF8KYEXqeJQOVgyQVBNAUxUvNJIhaIAwWj+wIPU6oPBepb1VU4xJmH678PFR5HJAmrlz7BccI+z+sD4lzAAAAAElFTkSuQmCC)`;
                                                    });
                                                }
                                            });
                                        } else if (product.type === item_types.PROFILE_EFFECT) {
                                            card.classList.add("type_1");

                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                            // Ensure the item ID is accessible here
                                            let itemId = undefined;
                                            if (Array.isArray(product.items)) {
                                                // If items is an array, find the item with type 1 and get its id
                                                const item = product.items.find(item => item.type === 1);
                                                if (item) {
                                                    itemId = item.id;
                                                }
                                            } else if (product.items && product.items.type === 1) {
                                                // If items is an object and has type 1, get its id
                                                itemId = product.items.id;
                                            }

                                            if (!pplusProfileEffectsCache) {
                                                await setPplusProfileEffectCache();
                                            }
                                        
                                            // Find matching profile effect
                                            const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);
                                        
                                            if (matchingEffect) {
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('profile-effect-image');
                                        
                                                previewHolder.innerHTML = `
                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                `;
                                        
                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                const imgElement = card.querySelector("img");
                                        
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                    });
                                                } else {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                    });
                                                }
                                            }
                                        } else if (product.type === item_types.NAMEPLATE) {
                                            card.classList.add("type_2");

                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                previewName = localStorage.discord_displayname;
                                            } else {
                                                previewName = 'Default User'
                                            }

                                            previewHolder.innerHTML = `
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _1"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _2"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-null-user" data-user-nameplate-preview>
                                                    <video muted loop class="nameplate-null-user" style="position: absolute;" data-user-nameplate-preview-img></video>
                                                    <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                    <p class="nameplate-user-name">${previewName}</p>
                                                </div>
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _2"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _1"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-fade-top"></div>
                                                <div class="nameplate-fade-bottom"></div>
                                            `;

                                            product.items.forEach(item => {
                                                const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                const paletteName = item.palette;
                                                const asset = `https://cdn.yapper.shop/custom-collectibles/${item.asset}.png`;
                                                const bgcolor = nameplate_palettes[paletteName].darkBackground;

                                                previewHolder.querySelector("[data-user-nameplate-preview-img]").src = asset;

                                                nameplatePreview.style.backgroundImage = `linear-gradient(10deg, #00000000 40%, ${bgcolor} 180%), linear-gradient(170deg, #00000000 40%, ${bgcolor} 180%)`;
                                                // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                
                                                const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                
                                                nullUserNameRandomWidth.forEach(UserName => {
                                                    const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                    UserName.style.width = randomWidth + `px`;
                                                });
                                            
                                                const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                            
                                                nullUserAvatar.forEach(UserAvatar => {
                                                    UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                });
                                            });
                                            
                                        } else if (product.type === item_types.BUNDLE) {
                                            card.classList.add("type_1000");
                                            // Fetch the bundled products for the bundle summary
                                            const bundledProducts = product.bundled_products || [];
                                        
                                            // Generate the bundle summary from the names of the bundled products
                                            const type0Product = bundledProducts.find(item => item.type === 0);
                                            const type1Product = bundledProducts.find(item => item.type === 1);
                                        
                                            let bundleSummary = `${getTextString("CARD_TYPE_BUNDLE_TITLE")}`;
                                            if (type0Product) {
                                                bundleSummary += `${type0Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_DECO")}`;
                                            }
                                            if (type1Product) {
                                                bundleSummary += `${type1Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_EFFECT")}`;
                                            }
                                        
                                            // Set the summary text
                                            card.querySelector("[data-product-card-summary]").textContent = bundleSummary;
                                        
                                            // Set the basic card details
                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                        
                                            // Handle each item in the bundle
                                            product.items.forEach(item => {
                                                if (item.type === 0) {
                                                    // Avatar decoration
                                                    const decoImage = document.createElement("img");
                                                    decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                    decoImage.alt = "Avatar Decoration";
                                                    decoImage.classList.add("avatar-decoration-image");
                                                    card.querySelector("[data-shop-card-preview-holder]").appendChild(decoImage);

                                                    const bgimg = document.createElement("div");
                                                    bgimg.classList.add("avatar-decoration-bg-image");
                                                    
                                                    card.querySelector("[data-shop-card-preview-holder]").appendChild(bgimg);
                                        
                                                    // Hover effect for decoration image
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                        card.addEventListener("mouseleave", () => {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQgAAAEJCAYAAABoqrlaAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAABjZSURBVHgB7Z07kBxVloaPNNA8JAESEnqBhEItgiAUISKIwAFrHHAWBxzWAYdxsDQOa+yuMxbOysIaR1jjMNY64Ow44CwQgSIkIZCEhJ7der9fIxHTX3bfJrtUj8yqzJv38X8RSVW3CqmyKu+f/zn33HOXmUiZDaXHDT2/WzF3rLRqzJaez8wdN0qH+1kkyDITMcMAZ8BPLzyuX3jufu+TGftdLI6Wfj5iEpBokUDEQVkIti88OiGIAQTiyMIxu/D4g4ngkUCECWLwqs2LAY/TliaIBGKxb+FxxkRQSCDCACfw5tyxy+YFwXd4EAoIBKKxb+FRgtExEojuQAjesHlhyFUQRuFCkW9MIUknSCD8UXYJb1o8+YNQII/xtf0uFkp8ekAC0S6IAPmDDyyupGIMOLH40kRrSCDawYUPb5tEoW2cs/jKFIY0jgSiORCCd21eFJRT6AaSmp+bEpyNIYGYHNzCBwuPIhwIPeQqJkQCMR4u4fiWSRhCx7kK5SrGQAJRDxdGvGfKLcSGwo8xkEBUQ8KQDoiDCz8kFCOQQAxHwpAuEooKSCD6I2HIBycUfzcVXz2EBOJhEIYPTcKQG0pm9kEC8TvMRnxiqmHIHQlFCQnEvCAgDJquFGUQCIQi6/xEzgLh8gwfmhCD2WvzQpEluQqEwglRh2zDjtwEAtfwsc2vlxCiLtmFHX+wfKA0es/c8YoJMR4s2ec6umnzzWySJweBwDXsnjv+NHdMmRCT4dbhEJ7SvTvp2onUBYJcw6emGQrRPM5NuBb/SZKyQJBr+LOp4Em0B9eWy2ftswRJMUmpugbRBbiI3ZaYm0jNQSAKJCK3mBB+cbkJNgY6YYmQkkDQ1ek/TIlI0R2IxB8XnicRcqQgEHwpJCJV2yBCwe2G9u3ccc8iJvYcBPmGPaaKSBEm0eclYnYQLt+wxoQIE5eXINy4ZBESq0CwyOq/TfkGET6IxDs2X3150CIjRoEgGfknEyIuXl94jCp5GZtAUPz07yZEnLjanGhEIiaBoPjpHRMibhAJkurfWATEMItBDPcXU2WkSAtWgzLDEfRir9AdBOKgJdoiRZh9Iy/xDwu4ViJkgXDiMG1CpEnwIhGqQEgcRC4ELRIhCoTEQeRGsCIRmkBIHESuBCkSoQkEWd3XTYg8WbNwBDMFGpJAUASlOgeRO7jnYOokQhEIyqdVISnEPC7E7rziMgSBQBw+NCFEGQoDO1/g1bVAsBT2zyaE6Af5OLpmd9bCrstSa+Ksv5q6TgsxDEqxP7KOms505SBcJyg1exFiOPQ8wWmTtPS+bqMrgVDnaSGqg8smcfmVeaYLgSAp+UcTQtQB141QfGse8S0QtIpTNyghxoNVzV5nNpabP1DAD00IMQk4cG9d3H3NYmCNmLFQe3ohJocZDWY2Wk9a+goxOBmtsRCiGbjhMrvRej7Ch0Cw45XyDkI0C/kI9gE9Yi3Sdg6CkOIDE0K0AQscWw3b2xYIOlEr7yBEOxBqfGIt0maIwZSmlm8L0S7cgFub+mxrFoM3/TcTQvigtfUabYUYrdoeIcQSWgs12ggxmLV4z4QQPmkl1GjaQWjWQojuYOw12j6haYHwWgYqhFhC46FGkwLBmvW3TQjRJYzDxvaxbXIWg1kLuQchuofZjPetAZpKUlLzoB4PQoQBoUYjCcsmQgxcg2YthAiLRhKWTTgI6sEbi3mEEI3Aas9/zh0/2ARM6iBwD0pMChEmE88qTioQqnkQImwmGqOTCITcQwesWLHCnn32WYuNp59+unjvwjuM0bFTAI/Y+Mg9tAwDauXKlbZq1arisTzAvv/+e7tz547FwOOPP247d+5c/Pnq1at28+ZNu3Xrlt24caN4LlqFsTpWLmLcOgit1mwB7rIIwerVq4vHP/xhcA6ZQbZ//36LgR07dthzzz038M8fPHhQCMXly5eLR85NNM5uG0MkxnUQcg8N8Nhjj9natWsrCUIviAlH6IOJ9zhMHIDzducDCMaVK1cKweD8YnFKgTOWixhHIJR7mAAGwZo1a4o8AgIxCS+88ELwAsF7rAuCwefjci2EIJznpUuX5C7G59WFo5ZIjCMQcg81caKwfv36Wi6hyt8bsosg9+BcwSSQe+HYtGmT3b17tzjfc+fOSSzq85bVFIi6OQjlHirCwHjqqads8+bNjYpCLyHnIkblHiYFsbh48aKdPXtWYUh1/s1q7KdR10HIPQzhkUceKVwCOYUm7pxV4N/hTj3OAOH9jhIvBuE48J7aFAcgRMNVcCCU58+fLwTj/v37JgbCsoi9VV9cx0HgHvaYVmw+RFshRFXOnDljx44dK54zaEh4MvinpqaKn3nOwaB1rxkHxILB5w7387179wqB4rmbsmzbPQyCBCcicfLkSbmK/uAe3reKLqKOQJCYVK/JEggDSThfbmEQDEwGxqRJz6ZAJEIoinKuYnZ21sQSPreKLqKOQKjfwwKIQtu5BdEcOB0chYRiEXbj+qjKC6te4UyPaEm3zYvDli1bbPlynxuji0kgvCIExGlRiCVszdyxzyq0ya96lb9loojhEQcRJ3x3Lg8jqk04VBEIFUYtUF5PIOIDJzE9PW2igKhgZEOZKgKhZjBzbNy4MZgkoBgfEsp8l6JgZNqgikBkX/uALd26dauJNFCosciuUS8YJRD4sexnLkhMasYiHQg1XnzxRROL6zMGMkog3rXMofipi4If0S4sBOu6fiUQJhKI7PMP46xGFHFAtSduInOGmoBhAoE4ZB1eIA5KTKYL360SlsVMxkAjMEwgsq59IIlFtaRIGxZ6yUUU2/X1ZZSDyBYlJvMAcdi2bZtlzkAzMEggsp698LFUWYQD33XmCcuBYcYggRhoOXJAicn80HdeTyBGFlCkSpUmqyI9yk1zM6XvmO8nEIQW2eYfmPoSeZK5i+i7NmP5gBdmCUVRmtbMF7mIh1ML/QQi2/BCcaiQi1iKHMQCcg8CMncRD5mDXoHYYJlOb8o9CEfG18JD479XILJ0D9wx5B6EI3MXsUQDegUiy/yD3IPoJeNrYqhAZNePiz0ktOxX9JKxi1hiEsoCwRxodgKh1XxiEJm6CHIQi/UQZYHIThy05kIMAweR6UrPRS3IWiCUexCjyNRh9hWI7BKUyj2IUWTaL6KvQGRV/6DCKFEFxGHdunWWGYtmwQlEdgnKDL90MSY0uM2MxUSlE4isxIHkpMILUZVMpzyLiKLsILJByUlRFzb/zYzCNGTpIOQeRF2YDs8sWblEILZbJhBPKjkp6oI4rFixwjJiSQ4imxmMDK2iaIjMQtPCNGQlENwFVDkpxgUHkVGYsZikXGmZJCkznK4SDYI4ZHQNFbqAQCi8EKIimdXPrHQOInlQfwmEmJTMwozpbByEpjZFE+QWZmQjEHIPoilWrVplmbAhmxBDDkI0RU4OgmAqeYGIrSntgwcP7MaNG3b58mW7f/9+cQBrSJ588skom+zevXvXrly5Yrdv3y7O586dO8X5TE1NFXH9M888E81u6oQZfAdXr161xCkEYr0lzlNPPWUxwCA6e/aszc7OLorCINweoqHXdTCITp482Xcw9f6OJfgUI8UgflxTOQgEkv22JZ6H2LJlS3G3CpkTJ07YoUOH7Pr16/bbb7+NfD1icunSJTt//nxheUPLrPP+OB/EgedVuHnzpp05c6Z4HkNIeO7cOUucSwjEe3NHshk8Bs727eEuNWHwHDhwwC5cuGDjgNPgQn3iiSeK8CMEEK6DBw8W4cQ4XLt2LVjhc3DDwe1VEfOYST5JGfICG8Rh//79Rb5hEhAJ7tYh3NF4Dz/++OPIEGkU5Cj4bKq6jy7IYfHWckuckKc3GdQMhKY4fPhwp3ExIQLvoSmcSEwqNm2Rw9R58nUQoao8OYdJnUM/EJ0uBpTLOTQNInHq1CkLkQwcxMrkHUSIyS4GE8m7NkAcjh8/br45ffp0o26o9+8OccYgg7LrtAUi1Ex4kza8H0yT+hxQbnq2TdoS1EnIoYlM0gIRSla/DHG6j8F78eJF84WPwctnFqKLCPEaa5KkBYLqvNBo+07rYJrQVy7C18DlnEJDDiJiQqzI8zWYEAfqCdqG82kr99CLT1dUlRBvQk2SrECEGB8SXvgaTMDah7bxafsRPT7DkOAmlHKiMlmBCNH6+RQHuHfvnrWND5dSJjSBgJS7pCMQzU/GB0CIqu774vbx7/muufAtslVYuTLZYuQbyQpELCs4YyfUKkefJDyTcUMhhhATohAjQjLbJk10SMIhxkyyAhGig/AtWj7ubL7PKUThl4OIjFCbw/i+kHwMJt93z1BDx0RF4iYCEd680YSE+mX5XhviI1HrO0EXqkAkGtIWScoZS4xQvyzX7NQXPv4tn+eDWwn1u000D5FmDiLkaSdf06+EWT7utvwbvkRi48aNFirLlyc5IZhmHUTIdm/Tpk1e3p/Prep9dVYKuZFt6E2Rx2QmyRAj5C8LcWj7Tsj5+xxMtN5vW/RoiR9yIjCWPT1qkmYOIvQvq20X4XtvCc5l27Zt1hYInk9HNA6JOgglKbuA9zc9PW1t4DbU8Q3/Zltb0sWwmU6iAnHEZVaSEokYppwYTE3fFblId+zYYV2B6DU9UPiMQt89LFEKTXACkVSiMpaiFXb8akokGJg7d+7s9NwRZt5DUyKxbt264jOKgQRzEEsE4qiJTmhCJAgruhYHB++B9zJpkpTP5KWXXrJYSLBQapb/ONljb4zXLQH4op5//nmLCQYTWXq2rKuzfJpz3bp1a7G1YEgXKO+FsAAncevWrVrnxGdBmMTnERuJbcX3zdzxg7uqkslBxKrk3Hlfe+21ou8izVmH9V9kEFFwtXnz5qCtLSLBe6UtHZvyDmpg49oD4hpi2LR3EHwXCfXHOMJ/Hin/ILqH5KWbDWBgccG5i46BRJPUmOJdhA+h4Hjw4EGxm1i5KxQlyjiNROsIYqYwDWUHQaIy6Y18YyPmu2k/EAHOKbXzSpTCNJQLyJMIM9QoRoiJ+cE9KQtEEjMZsqqiKxIqlpp1T8oCoTyEEAIWtaAsED+YEEIMEAh+GX1FJZlyIcRE9M1BQPRhhvZpEF0R4qY+Y7AkkugVCJVcC5E3SzSgVyCUhxAib4Y6CAmEEHkzVCBuWOQikUgcKCLk7t27FjkPTVT0a8WrPIQQebKv9xf9BOJrixzNZAjfJHLNPTT2+wlE9PUQqoUQvkngmuubXlg+4IVR10PIQQjfJJD72tfvl4OWPtJN5lWLFJJFoe3hyB3m8OHDRdMUNWKtz7lz54rDtdhPeUftjuibWhgkEF/OHR9bpITmIBCs/fv3L95lEIqTJ08WTVlD3xCmSxDV06dPF63cyt8pIhtKD05HAg6i7+zloLXR92zeQWywCPG5X+QouJh/+uknu3379pLfc8Ffu3ataMVG38Zly5YFvaeoT+ikdeTIETt69GjxGfX2eeSzo38nnbdC6f/B++G9Rgri8Pd+fzCsecIqi7SRrfuiQhCJqakpW716dXE3HNSTEfG4cOFC0YsSsaCnRaIbsQwEUSCEOHTokM3MzAytKWDrwpdfftkeffRRC4FffvmlcDoR87kNyDsuG/I/0X7ufy1iQtgrogwXPaHF7OzsyNe6/TUJQ1Jt0YYoOGGoUmTE5xBSY1veM4JGn83Ied8GdJRbNuJ/3GMRJysdJLXYDzMUcBLHjh0rBkcVnFjQyZrHWHMWuKgrV67Y9evXC5GsmisKTRiA0BCxT2DGjPBi96A/HCUQ71nEycoybr+FkAZXHUdRhhwL3aAJXRCP0GZsHGVB4C5bVRAdIQoD3xlJ5rrnEjCf2vykRF9GCUT0YUYZElpccCG5CXBCwUU3Tjbc7SuBaKxataoQDd+t5DkHRAB3RB6F5+OsTeBcmNkhzxCaU0rINZQZGF7AKIGAJMKMMqHlJhzccdkwZ9gmM3Xg/JxYkCxl8PE7Ht3hXteP8gBHuNweHfz+3r17xfNxhaAXXMKaNWsKcQit8XCCrsFBvdN/DntBFYFAHPZYguAmQtwclgvyu+++s1xAqNhVLLQtC1wdBq4hUYaGF1BFqrEf5CKmLDGYDmVq0Vn0UDh+/HgjDiIWXJ0Du4aFAm7h4MGDRX1DojCuPx31oqpeDg+aVJjhcEU3xM3E713fxZydzQ0SmYQXXX/+CPPPP/+cYq6hF8KLkSu3qwqEcxHJQrESsT+xNW6iqws1N/dQBnFcu3atdQHhBJ89FZwJNH6pwn9ZhVXbVQWCvyja0us6MDgRCiC551MosLXUR+QKIk2y0mcVKcJw6tSpwjVEXCpdl4Gl1b3USRczWf+2ZQIXC6EHNtPXPPyBAweyX6rO3dvHSteyMFCr0bveI3E+mztOVHlhHYEgzEAgstkB3C2oconM8tRg0+BaWI+ROwgEnzH5oDbIXBiAcVx5VrLuhDPTolEu4JoEl8h0jqLp0INBwYIfNbqZh9qKDRs22PLly60pJAyL4B4qN4SqKxDYkncswSnPKpSXaDeZzCQ5lmARztg0Oe3pckrMDGUuDFBparNMXYGgT0SyU551cBcegkHl37i9HFjJeOJEpXAwK5j2nCRh6XpK/Prrr8XflbkwOEhM1trWokolZS/kIP5mGeUiqsCFXLdDVG+nKbEUPtNdu3ZVdmmDOlCJAtzDbhuy7qIf4xS9y0X0oRx+uOmyUdWZCi2G4wb5sFADUbh8+XKRwxnUgUoU4B5qb2kxjoMAuYgKcOejLVq/pi+EFjlWTI4DC+t6Pz+EFWGo01ciY8ZyDzDusjm5iApwJyNXgRiU28nRf5L4WBd2NZg9ovcFhVS0o6PHJ4/KLVRmLPcA4zoIkIsQInzGdg8wyUQz5deVyjWFEJ3xlY0pDjBpJcoXFvk2fUIkDMKw1yZgUoFAHD4zIUSIfG4T0kQtKx1pahVfCCFaB/fwpU1IU8XuEyuVEKJRapVUD6IpgcBBjDWNIoRoHBKTjbj65pbLzecilLAUolsYg3utIZrsL84b+6dluBxciICgNqkxN9+kgwCmPSuvNRdCNMrE05q9tLFDCZsIZNOaToiA+MgaDvPbEAhUjH5hr5gQwhfMJDY+UdB0iOHYaxOUdwohatF4aOFoaxNEVnseNYUaQvig8dDC0eYuqQo1hGifVkILxyTLvavy17lj2oQQTcNN+H1rkbZyEGUqbfElhKgFY2q3tUybIYZDBVRCNA/O/P+tZXwIBBw05SOEaAoaNe01D/gIMRx7TVOfQkxKa1Oa/fCRpCzD7uBYI/WxFKI+hOtMaXq70foKMRyc4OW5400TQtSFTXe9NmfyLRDAYi6ci1rmC1Ed6h2+MM90IRCAChJuqD5CiNF8M3f8j3VAVwIB+2x+6nONCSEGQb7hE5tfvuCdLgWCE/7W5vMRSloK8TBu05tL1hG+ZzH6oZkNIR7G+4xFP7p0EA4+iB9NKz+FKPPx3HHCOiYEgQBUctY0/SkE0LK+9TLqKoQiEKDpTyE6ms4cREgCAUx/SiREriAOey0gQhMIkEiIHAlOHCBEgQCJhMiJIMUBQhUIkEiIHAhWHCBkgQCJhEiZoMUBQhcIkEiIFAleHCAGgQBE4qapbZ1IA+ocgpnKHEYsAgG0rWOvDURiyoSID6qG/zJ3/J9FQkwCAZSessALkdDaDRETblWm14YvkxKbQAAr21gfr1WgIhbcqszO11bUJUaBAKwaIkHDmQ0mRLjgGDpdsj0JsQoEIBJfmWY4RLjQnp6cQyfNXpogZoFwaIZDhAY3L3qc7LXICaFhTFMQauwxhRyiW8g3sN3kEUuAFByEw+UlEIgtJoR/XL4hmQ2iUhIIQCT+YcpLCP98ZvMONtp8Qz9SCjF6UcghfIBboDIyqvqGqqTmIMq4WY5nTftviHZwsxTR1TdUJWWBAOze1zbf7xKRUGGVaAJXMs16iqRCil5SFwgHGWUSmKtMbkJMBtcRicgkZilGkXIOYhC01//AlJsQ9Ug61zCIXBxEGecmEMdXTIjRJJ9rGESODqKMZjrEMHALn1tmrqFM7gLhUNghypCEDGp/iq6QQPwO4uCEQuQJwkA48cXC8+yRQDwMQvHh3PGWiZygZmavJVQm3QQSiMFIKPIg+zzDMCQQo5FQpImEoQISiOpIKNJAwlADCUR9JBTx4dblkHxUjqEGEojxQShonPuuaXo0VDQrMSESiGZgehRHoR4UYaAwoiEkEM3iwo9dJlfhG+cWvjSFEY0hgWgP3ATO4g3TMvO2QBRYzk9+QW6hBSQQ7YM4kKt4Y+FRTAaiwII7ROFrU26hVSQQfkEscBYIhcKQ6pSdwhGTKHhDAtEtry4cu0wJzl4IGfYtPCp86AgJRDg4d8Gx3fITDJxBWRDkEgJAAhEuCMb0wuHCkVTa5THLgAgctXlhUNgQKBKIuCiLBoKx3cJuxjuzcBxdeJQYRIYEIg0QiA09x/qF37s/a1pEZkqPHDdLz90hIYgcCURerOw5yvTOqNywpQN8ZsDvRcL8C4aF6dA8K7JrAAAADmVYSWZNTQAqAAAACAAAAAAAAADSU5MAAAAASUVORK5CYII=)`;
                                                        });
                                                    }
                                                } else if (item.type === 1) {
                                                    // Profile effect
                                        
                                                    (async () => {

                                                        if (!pplusProfileEffectsCache) {
                                                            await setPplusProfileEffectCache();
                                                        }
                                        
                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === item.id);
                                        
                                                        if (matchingEffect) {
                                                            const effectImage = document.createElement("img");
                                                            effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                            effectImage.alt = "Profile Effect";
                                                            effectImage.classList.add("profile-effect-image");
                                                            card.querySelector("[data-shop-card-preview-holder]").appendChild(effectImage);
                                        
                                                            // Hover effect for profile effect
                                                            if (localStorage.reduced_motion != "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    if (matchingEffect.effects && matchingEffect.effects[0] && matchingEffect.effects[0].src) {
                                                                        effectImage.src = matchingEffect.effects[0].src;
                                                                    }
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            } else {
                                                                card.addEventListener("mouseenter", () => {
                                                                    effectImage.src = matchingEffect.reducedMotionSrc;
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            }
                                                        }
                                                    })();
                                                }
                                            });
                                        } else if (product.type === item_types.VARIANTS_GROUP) {
                                            // Update SKU and summary
                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                            // Always display the base variant name
                                            card.querySelector("[data-product-card-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                        
                                            // Render variant color blocks as interactive divs
                                            const variantContainer = card.querySelector("[data-shop-card-var-container]");
                                            variantContainer.innerHTML = ""; // Clear existing variant blocks
                                            let currentSelectedVariant = null; // Track selected variant
                                        
                                            product.variants.forEach((variant, index) => {
                                                // Create variant color block
                                                const variantColorBlockTmp = document.querySelector("[data-shop-varcolorblock-template]");
                                                const variantColorBlock = variantColorBlockTmp.content.cloneNode(true).children[0];
                                                variantColorBlock.classList.add("shop-card-var");
                                                variantColorBlock.id = "shop-card-var";
                                                variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                        
                                                // Add click event listener to switch variants
                                                variantColorBlock.addEventListener("click", () => {
                                                    if (currentSelectedVariant) {
                                                        currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                    }
                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                    currentSelectedVariant = variantColorBlock;
                                                    applyVariant(variant);
                                                });
                                        
                                                // Append the color block to the container
                                                variantContainer.appendChild(variantColorBlock);
                                        
                                                // Set the first variant as the default selected
                                                if (index === 0) {
                                                    currentSelectedVariant = variantColorBlock;
                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                }
                                            });

                                            let isFirstTimeLoadingVariant = true;
                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                        
                                            // Function to apply the selected variant
                                            function applyVariant(selectedVariant) {
                                                card.querySelector("[data-shop-card-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                if (selectedVariant.type === 0) {
                                                    card.classList.add("type_2000-0");
                                                    previewHolder.innerHTML = ""; // Clear previous decorations
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Add the avatar decoration based on the selected variant
                                                    selectedVariant.items?.forEach(item => {
                                                        const decoImage = document.createElement("img");
                                                        const bgimg = document.createElement("div");
                                                        if (isFirstTimeLoadingVariant == true) {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                            isFirstTimeLoadingVariant = false;
                                                        } else {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        }
                                                        decoImage.alt = "Avatar Decoration";
                                                        decoImage.id = "shop-card-deco-image";
                                                        previewHolder.appendChild(decoImage);

                                                        bgimg.id = "shop-card-deco-bg-image";

                                                        previewHolder.appendChild(bgimg);
                                                    
                                                        // Hover effect for decoration image
                                                        if (localStorage.reduced_motion !== "true") {
                                                            card.addEventListener("mouseenter", () => {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            });
                                                            card.addEventListener("mouseleave", () => {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                            });
                                                        }
                                                    });
                                                } else if (selectedVariant.type === 1) {
                                                    card.classList.add("type_2000-1");
                                                    (async () => {
                                                        // Ensure the item ID is accessible here
                                                        let itemId = undefined;
                                                        if (Array.isArray(selectedVariant.items)) {
                                                            // If items is an array, find the item with type 1 and get its id
                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                            if (item) {
                                                                itemId = item.id;
                                                            }
                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                            // If items is an object and has type 1, get its id
                                                            itemId = selectedVariant.items.id;
                                                        }

                                                        if (!pplusProfileEffectsCache) {
                                                            await setPplusProfileEffectCache();
                                                        }
                                                    
                                                        // Find matching profile effect
                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);
                                                    
                                                        if (matchingEffect) {
                                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                            previewHolder.classList.add('profile-effect-image');
                                                        
                                                            if (isFirstTimeLoadingVariant == true) {
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                `;
                                                                isFirstTimeLoadingVariant = false;
                                                            } else {
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.effects[0]?.src}">
                                                                `;
                                                            }
                                                        
                                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                            const imgElement = card.querySelector("img");
                                                        
                                                            if (localStorage.reduced_motion != "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                    }
                                                                });
                                                            
                                                                card.addEventListener("mouseleave", () => {
                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            } else {
                                                                card.addEventListener("mouseenter", () => {
                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                });
                                                            
                                                                card.addEventListener("mouseleave", () => {
                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            }
                                                        }
                                                    })();
                                                }
                                            }
                                        
                                            // Apply the default variant (first one) initially
                                            if (product.variants.length > 0) {
                                                applyVariant(product.variants[0]);
                                            }
                                        } else if (product.type === item_types.EXTERNAL_SKU) {
                                            card.classList.add("type_3000");

                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            previewHolder.innerHTML = `
                                                <p>${getTextString("CARD_TYPE_EXTERNAL_SKU_ERROR")}</p>
                                            `;
                                            
                                        } else if (product.type === 'plus_more') {
                                            card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            card.querySelector("[data-product-card-name]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_TITLE")}`;
                                            card.querySelector("[data-product-card-summary]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_DESC")}`;

                                            card.querySelector("[data-shop-price-container]").innerHTML = ``;
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                            card.querySelector("[data-share-product-card-button]").innerHTML = ``;

                                            const plusMoreQuestionMark = document.createElement("img");
                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                            plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                            card.querySelector("[data-shop-card-preview-holder]").appendChild(plusMoreQuestionMark);
                                
                                            // Hover effect for decoration image
                                            if (localStorage.reduced_motion != "true") {
                                                card.addEventListener("mouseenter", () => {
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                });
                                                card.addEventListener("mouseleave", () => {
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                });
                                            }
                                        } else {
                                            card.classList.add('hidden')
                                        }



                                        if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 1: Enabled" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button") {
                                            if (product.emojiCopy === null && product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="location.href='https://discord.gg/SVKQEYeTsN';" title="${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_REQUEST_PPLUS_EMOJI_v2")}</button>
                                                        <button class="card-button" onclick="copyEmoji('${product.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                                    </div>
                                                `;
                                            } else if (product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="copyEmoji('${product.emojiCopy}'); copyNotice('copyemoji');" title="${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_COPY_PPLUS_EMOJI_V2")}</button>
                                                        <button class="card-button" onclick="copyEmoji('${product.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                                    </div>
                                                `;
                                            }
                                        } else {
                                            if (product.emojiCopy === null && product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="location.href='https://discord.gg/SVKQEYeTsN';" title="${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_REQUEST_PPLUS_EMOJI")}</button>
                                                `;
                                            } else if (product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="copyEmoji('${product.emojiCopy}');" title="${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_COPY_PPLUS_EMOJI")}</button>
                                                `;
                                            }
                                        }

                                        if (product.premium_type === 2) {
                                            card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                            `;
                                        }


                                        if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                            if (product.type === item_types.AVATAR_DECORATION || product.type === item_types.PROFILE_EFFECT || product.type === item_types.NAMEPLATE || product.type === item_types.BUNDLE || product.type === item_types.VARIANTS_GROUP) {
                                                card.classList.add('clickable');

                                                card.addEventListener("click", (event) => {
                                                    if (event.target.matches("[data-shop-card-var]") || event.target.matches(".card-button") || event.target.matches(".shareIcon_f4a996")) {
                                                    } else {
                                                        openItemModal();
                                                        addParams({itemSkuId: product.sku_id})
                                                    }
                                                });

                                                const itemSKUForScroll = params.get("itemSkuId");

                                                if (itemSKUForScroll === product.sku_id && modalIsAlreadyOpen != true) {
                                                    modalIsAlreadyOpen = true;
                                                    setTimeout(() => {
                                                        openItemModal();
                                                    }, 1000);
                                                }

                                                async function openItemModal() {
                                                    let modal = document.createElement("div");

                                                    modal.classList.add('modalv2');

                                                    if (apiCategory.pdp_bg != null) {
                                                        pdp = apiCategory.pdp_bg
                                                    } else {
                                                        pdp = apiCategory.banner
                                                    }

                                                    modal.innerHTML = `
                                                        <div class="modalv2-inner">
                                                            <div class="modalv2-inner-left">
                                                                <div data-modal-left-preview-holder></div>
                                                                <p data-product-modal-sku-id></p>
                                                                <p data-product-modal-credits></p>
                                                                <p style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                                <p style="color: var(--8)" data-product-modal-summary></p>
                                                                <div class="shop-modal-var-container-container" data-shop-modal-var-container-container>
                                                                    <div class="shop-modal-var-container" data-shop-modal-var-container></div>
                                                                    <a class="shop-modal-var-title" data-shop-modal-var-title></a>
                                                                </div>
                                                                <div class="modal-shop-price-container" data-shop-price-container>
                                                                    <div data-price-standard-container>
                                                                        <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                                                    </div>
                                                                    <div data-price-nitro-container>
                                                                        <a data-price-nitro></a>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-left-bottom">
                                                                    <div class="modal-buttons" data-modal-buttons></div>
                                                                </div>
                                                            </div>
                                                            <img class="modalv2-inner-logo" src="https://cdn.yapper.shop/assets/${apiCategory.logo}.png"></img>
                                                            <div class="shop-modal-tag-container" data-shop-card-tag-container></div>

                                                            <div data-modal-top-product-buttons>
                                                                <div title="Close" data-close-product-card-button>
                                                                    <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                </div>
                                                                <div title="Download Data" data-download-product-card-button></div>
                                                            </div>

                                                            <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                                <img class="modalv2-inner-img" src="https://cdn.yapper.shop/assets/${pdp}.png"></img>
                                                                <div data-modal-preview-holder></div>
                                                            </div>
                                                        </div>
                                                    `;

                                                    document.body.appendChild(modal);

                                                    setTimeout(() => {
                                                        modal.classList.add('show');
                                                    }, 1);

                                                    if (product.type === item_types.AVATAR_DECORATION) {

                                                        modal.classList.add('modal-0');

                                                        product.items.forEach(item => {

                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                            const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");

                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;

                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {

                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile1">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png">
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                    </div>
                                                                `;

                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                previewHolderLeft.classList.add('modal-left-avatar-decoration-img');

                                                                const imgElement = document.createElement("img");
                                                                imgElement.id = "shop-card-deco-image";
                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;

                                                                previewHolderLeft.appendChild(imgElement);

                                                                if (localStorage.reduced_motion != "true") {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                    });
                                                                }

                                                            } else {
                                                                
                                                                previewHolder.classList.add('modal-avatar-decoration-img');

                                                                const imgElement = document.createElement("img");
                                                                imgElement.id = "shop-card-deco-image";
                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;

                                                                previewHolder.appendChild(imgElement);

                                                                // Hover effect: Change the image src on mouse enter and leave
                                                                if (localStorage.reduced_motion != "true") {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                    });
                                                                }
                                                            }

                                                        });
                                                    } else if (product.type === item_types.PROFILE_EFFECT) {
                                                        modal.classList.add('modal-1');
        
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;

                                                        // Ensure the item ID is accessible here
                                                        let itemId = undefined;
                                                        if (Array.isArray(product.items)) {
                                                            // If items is an array, find the item with type 1 and get its id
                                                            const item = product.items.find(item => item.type === 1);
                                                            if (item) {
                                                                itemId = item.id;
                                                            }
                                                        } else if (product.items && product.items.type === 1) {
                                                            // If items is an object and has type 1, get its id
                                                            itemId = product.items.id;
                                                        }
                                                    
                                                        // Find matching profile effect
                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);

                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                    
                                                        if (matchingEffect) {
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile2">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                        <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${matchingEffect.effects[0]?.src}">
                                                                    </div>
                                                                `;

                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                previewHolderLeft.classList.add('modal-left-profile-effect-img');
                                                            
                                                                const imgElement = document.createElement("img");
                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;

                                                                previewHolderLeft.appendChild(imgElement);
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            } else {
                                                                const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                previewHolder.classList.add('modal-profile-effect-img');
                                                            
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                `;
                                                            
                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                const imgElement = previewHolder.querySelector("img");
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        }
                                                    } else if (product.type === item_types.NAMEPLATE) {
                                                        card.classList.add("modal-2");
            
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
            
                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        previewHolder.classList.add('nameplate-modal-preview');
            
                                                        if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                            previewName = localStorage.discord_displayname;
                                                        } else {
                                                            previewName = 'Default User'
                                                        }

                                                        if (localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 2: Nameplate & Nameplate Test Warning" && product.category_sku_id === discord_categories.NAMEPLATE) {
                                                            let nameplateWarning = document.createElement("div");

                                                            nameplateWarning.classList.add('nameplate-modal-early-warning-container');
                                                            nameplateWarning.innerHTML = `
                                                                <p>${getTextString("SHOP_NAMEPLATE_WARNING_NOTICE_1")}</p>
                                                            `;

                                                            modal.querySelector(".modalv2-inner-left").appendChild(nameplateWarning);
                                                        } else if (localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 1: Nameplate Test Warning" || localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 2: Nameplate & Nameplate Test Warning") {
                                                            if (product.category_sku_id === discord_categories.NAMEPLATE_TEST) {
                                                                let nameplateWarning = document.createElement("div");

                                                                nameplateWarning.classList.add('nameplate-modal-early-warning-container');
                                                                nameplateWarning.innerHTML = `
                                                                    <p>${getTextString("SHOP_NAMEPLATE_WARNING_NOTICE_2")}</p>
                                                                `;

                                                                modal.querySelector(".modalv2-inner-left").appendChild(nameplateWarning);
                                                            }
                                                        }
            
                                                        previewHolder.innerHTML = `
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _1"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _2"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                            <div class="nameplate-null-user" data-user-nameplate-preview>
                                                                <video muted loop class="nameplate-null-user" style="position: absolute;" data-user-nameplate-preview-img></video>
                                                                <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                                <p class="nameplate-user-name">${previewName}</p>
                                                            </div>
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _2"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _1"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                        `;
            
                                                        product.items.forEach(item => {
                                                            const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                            const paletteName = item.palette;
                                                            const asset = `https://cdn.discordapp.com/assets/collectibles/${item.asset}img.png`;
                                                            const bgcolor = nameplate_palettes[paletteName].darkBackground;
            
                                                            previewHolder.querySelector("[data-user-nameplate-preview-img]").src = asset;
            
                                                            nameplatePreview.style.backgroundImage = `linear-gradient(10deg, #00000000 40%, ${bgcolor} 180%), linear-gradient(170deg, #00000000 40%, ${bgcolor} 180%)`;
                                                            // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                            
                                                            const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                            
                                                            nullUserNameRandomWidth.forEach(UserName => {
                                                                const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                                UserName.style.width = randomWidth + `px`;
                                                            });
                                                        
                                                            const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                                        
                                                            nullUserAvatar.forEach(UserAvatar => {
                                                                UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                            });
                                                        });
                                                        
                                                    } else if (product.type === item_types.BUNDLE) {
                                                        modal.classList.add('modal-1000');

                                                        const bundledProducts = product.bundled_products || [];

                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                    
                                                        // Generate the bundle summary from the names of the bundled products
                                                        const type0Product = bundledProducts.find(item => item.type === 0);
                                                        const type1Product = bundledProducts.find(item => item.type === 1);
                                                    
                                                        let bundleSummary = "Bundle Includes: ";
                                                        if (type0Product) {
                                                            bundleSummary += `${type0Product.name} Decoration`;
                                                        }
                                                        if (type1Product) {
                                                            bundleSummary += ` & ${type1Product.name} Profile Effect`;
                                                        }
                                                    
                                                        // Set the summary text
                                                        modal.querySelector("[data-product-modal-summary]").textContent = bundleSummary;
                                                    
                                                        // Set the basic card details
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                    
                                                        // Handle each item in the bundle
                                                        product.items.forEach(item => {
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                
                                                                if (item.type === 0) {
                                                                    decosrc = item.asset
                                                                } else if (item.type === 1) {
                                                                    // Profile effect
                                                                    (async () => {
                                                    
                                                                        // Find the matching effect
                                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === item.id);
                                                    
                                                                        if (matchingEffect) {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                renderProfile(effectUrl)
                                                                            }
                                                                        }
                                                                    })();
                                                                }

                                                                function renderProfile(effectUrl) {
                                                                    previewHolder.classList.add('modal-preview-profile-container');
                                                                    previewHolder.innerHTML = `
                                                                        <div class="modal-preview-profile2">
                                                                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                            <div class="profile-avatar-preview-bg"></div>
                                                                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                            <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                            <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${decosrc}.png">
                                                                            <div class="options-preview-profile-status-bg"></div>
                                                                            <div class="options-preview-profile-status-color"></div>
                                                                            <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                        </div>
                                                                    `;
                                                                    document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                }

                                                                
                                                            } else {
                                                                if (item.type === 0) {
                                                                    const decoImage = document.createElement("img");
                                                                    decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                    decoImage.alt = "Avatar Decoration";
                                                                    decoImage.classList.add("modal-avatar-decoration-img");
                                                                    modal.querySelector("[data-modal-preview-holder]").appendChild(decoImage);
                                                    
                                                                    // Hover effect for decoration image
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                        });

                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                        });
                                                                    }
                                                                } else if (item.type === 1) {
                                                                    // Profile effect
                                                                    (async () => {
                                                                        // Fetch profile effects if not cached
                                                                        if (!discordProfileEffectsCache) {
                                                                            const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                method: "GET",
                                                                                headers: {
                                                                                    "Password": api_password,
                                                                                    "Authorization": discord_token,
                                                                                    "Token": api_token
                                                                                }
                                                                            });
                                                                            const effectsData = await response.json();
                                                                            discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                        }
                                                    
                                                                        // Find the matching effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                                    
                                                                        if (matchingEffect) {
                                                                            const effectImage = document.createElement("img");
                                                                            effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                            effectImage.alt = "Profile Effect";
                                                                            effectImage.classList.add("modal-profile-effect-img");
                                                                            modal.querySelector("[data-modal-preview-holder]").appendChild(effectImage);
                                                    
                                                                            // Hover effect for profile effect
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        effectImage.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    effectImage.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        }
                                                                    })();
                                                                }
                                                            }
                                                        });
                                                    } else if (product.type === item_types.VARIANTS_GROUP) {
                                                        modal.querySelector("[data-shop-modal-var-container-container]").classList.add('show');
                                                        // Update SKU and summary
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
                                                    
                                                        // Always display the base variant name
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                                    
                                                        // Render variant color blocks as interactive divs
                                                        const variantContainer = modal.querySelector("[data-shop-modal-var-container]");
                                                        variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                        let currentSelectedVariant = null; // Track selected variant
                                                    
                                                        product.variants.forEach((variant, index) => {
                                                            // Create variant color block
                                                            const variantColorBlock = document.createElement("div");
                                                            variantColorBlock.classList.add("shop-card-var");
                                                            variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                                    
                                                            // Add click event listener to switch variants
                                                            variantColorBlock.addEventListener("click", () => {
                                                                if (currentSelectedVariant) {
                                                                    currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                                }
                                                                variantColorBlock.classList.add("shop-card-var-selected");
                                                                currentSelectedVariant = variantColorBlock;
                                                                applyVariant(variant);
                                                            });
                                                    
                                                            // Append the color block to the container
                                                            variantContainer.appendChild(variantColorBlock);
                                                    
                                                            // Set the first variant as the default selected
                                                            if (index === 0) {
                                                                currentSelectedVariant = variantColorBlock;
                                                                variantColorBlock.classList.add("shop-card-var-selected");
                                                            }
                                                        });
            
                                                        let isFirstTimeLoadingVariant = true;
                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                    
                                                        // Function to apply the selected variant
                                                        function applyVariant(selectedVariant) {
                                                            modal.querySelector("[data-shop-modal-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                            modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${selectedVariant.credits}`;
                                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                                modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                                    <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${selectedVariant.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                                `;
                                                            }
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                
                                                                if (selectedVariant.type === 0) {
                                                                    selectedVariant.items?.forEach(item => {
                                                                        previewHolder.classList.add('modal-preview-profile-container');
                                                                        previewHolder.innerHTML = `
                                                                            <div class="modal-preview-profile1">
                                                                                <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                <div class="profile-avatar-preview-bg"></div>
                                                                                <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png">
                                                                                <div class="options-preview-profile-status-bg"></div>
                                                                                <div class="options-preview-profile-status-color"></div>
                                                                            </div>
                                                                        `;
                                                                        document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                        previewHolderLeft.classList.add('modal-left-avatar-decoration-img');

                                                                        previewHolderLeft.innerHTML = `
                                                                            <img id="shop-card-deco-image" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png" data-left-preview-deco-var>
                                                                        `;

                                                                        const imgElement = previewHolderLeft.querySelector("[data-left-preview-deco-var]");
                                                                        
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                            });
                                                                        }
                                                                    });
                                                                } else if (selectedVariant.type === 1) {

                                                                    modal.classList.add("modal-2000-1");
                                                                    (async () => {
                                                                        // Ensure the item ID is accessible here
                                                                        let itemId = undefined;
                                                                        if (Array.isArray(selectedVariant.items)) {
                                                                            // If items is an array, find the item with type 1 and get its id
                                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                                            if (item) {
                                                                                itemId = item.id;
                                                                            }
                                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                            // If items is an object and has type 1, get its id
                                                                            itemId = selectedVariant.items.id;
                                                                        }
                                                                    
                                                                        // Find matching profile effect
                                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);
                                                                    
                                                                        if (matchingEffect) {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                                previewHolder.innerHTML = `
                                                                                    <div class="modal-preview-profile2">
                                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                                        <div class="options-preview-profile-status-color"></div>
                                                                                        <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                                    </div>
                                                                                `;
                                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                            }
                                                                        }

                                                                        previewHolderLeft.classList.add('modal-left-profile-effect-img');

                                                                        previewHolderLeft.innerHTML = `
                                                                            <img src="${matchingEffect.thumbnailPreviewSrc}" data-left-preview-effect-var>
                                                                        `;

                                                                        const imgElement = previewHolderLeft.querySelector("[data-left-preview-effect-var]");
                                                                        
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                    const effectUrl = matchingEffect.effects[0]?.src;
                                                                                    imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                }
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                            });
                                                                        } else {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                imgElement.src = matchingEffect.reducedMotionSrc;
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                            });
                                                                        }
                                                                    })();
                                                                }

                                                                
                                                            } else {
                                                                if (selectedVariant.type === 0) {
                                                                    modal.classList.add("modal-2000-0");
                                                                    previewHolder.innerHTML = ""; // Clear previous decorations
                                                                    previewHolder.classList.add('modal-avatar-decoration-img');
                                                                    
                                                                    // Add the avatar decoration based on the selected variant
                                                                    selectedVariant.items?.forEach(item => {
                                                                        const decoImage = document.createElement("img");
                                                                        decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        decoImage.alt = "Avatar Decoration";
                                                                        decoImage.id = "shop-card-deco-image";
                                                                        previewHolder.appendChild(decoImage);
                                                                    
                                                                        // Hover effect for decoration image
                                                                        if (localStorage.reduced_motion !== "true") {
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                            });
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                            });
                                                                        }
                                                                    });
                                                                } else if (selectedVariant.type === 1) {
                                                                    modal.classList.add("modal-2000-1");
                                                                    (async () => {
                                                                        // Ensure the item ID is accessible here
                                                                        let itemId = undefined;
                                                                        if (Array.isArray(selectedVariant.items)) {
                                                                            // If items is an array, find the item with type 1 and get its id
                                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                                            if (item) {
                                                                                itemId = item.id;
                                                                            }
                                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                            // If items is an object and has type 1, get its id
                                                                            itemId = selectedVariant.items.id;
                                                                        }
                                                                    
                                                                    
                                                                        // Fetch profile effects API only if not already cached
                                                                        if (!discordProfileEffectsCache) {
                                                                            const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                method: "GET",
                                                                                headers: {
                                                                                    "Password": api_password,
                                                                                    "Authorization": discord_token,
                                                                                    "Token": api_token
                                                                                }
                                                                            });
                                                                            const effectsData = await response.json();
                                                                            discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                        }
                                                                    
                                                                        // Find matching profile effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                                    
                                                                        if (matchingEffect) {
                                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                            previewHolder.classList.add('modal-profile-effect-img');
                                                                        
                                                                            previewHolder.innerHTML = `
                                                                                <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                            `;
                                                                        
                                                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                            const imgElement = previewHolder.querySelector("img");
                                                                        
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        }
                                                                    })();
                                                                }
                                                            }
                                                        }
                                                    
                                                        // Apply the default variant (first one) initially
                                                        if (product.variants.length > 0) {
                                                            applyVariant(product.variants[0]);
                                                        }
                                                    }


                                                    const button_container = document.querySelector("[data-modal-buttons]");
                                                    
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads") {
                                                        modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                            <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                        `;
                                                    } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page") {
                                                        if (typeof product.emojiCopy != 'undefined') {
                                                            button_container.innerHTML = `
                                                                <button class="card-button ${product.emojiCopy ? '' : 'card-button-no-emoji'}" onclick="${product.emojiCopy ? `copyEmoji('${product.emojiCopy}'); copyNotice('copyemoji');` : `redirectToLink('https://discord.gg/SVKQEYeTsN')`}" title="${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}`}">${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI")}`}</button>
                                                            `;
                                                        } else {
                                                            button_container.innerHTML = `
                                                                <button class="card-button card-button-no-emoji" title="${getTextString("CARD_PPLUS_ERROR_TITLE")}">${getTextString("CARD_PPLUS_ERROR")}</button>
                                                            `;
                                                        }
                                                    } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        if (typeof product.emojiCopy != 'undefined') {
                                                            button_container.innerHTML = `
                                                                <button class="card-button ${product.emojiCopy ? '' : 'card-button-no-emoji'}" onclick="${product.emojiCopy ? `copyEmoji('${product.emojiCopy}'); copyNotice('copyemoji');` : `redirectToLink('https://discord.gg/SVKQEYeTsN')`}" title="${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}`}">${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI")}`}</button>
                                                            `;
                                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                            `;
                                                        } else {
                                                            button_container.innerHTML = `
                                                                <button class="card-button card-button-no-emoji" title="${getTextString("CARD_PPLUS_ERROR_TITLE")}">${getTextString("CARD_PPLUS_ERROR")}</button>
                                                            `;
                                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                            `;
                                                        }
                                                    } else {
                                                        button_container.innerHTML = ``;
                                                    }


                                                    const unpublishedAt = new Date(product.unpublished_at);
                            
                                                    if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = unpublishedAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_LEFT_TO_REQUEST_COUNTDOWN_TAG")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }


                                                    const expiresAt = new Date(product.expires_at);

                                                    if (product.expires_at && !isNaN(expiresAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = expiresAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    const ReleasesAt = new Date(product.releases_at);
                            
                                                    if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = ReleasesAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_PUBLISHING_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    if (product.premium_type === 2) {
                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                        `;
                                                    }

                                                    if (localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1" && product.type != 3000) {

                                                        if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen") {
                                                            let newLogInWithDiscordDismissible = document.createElement("div");
                                                
                                                            newLogInWithDiscordDismissible.innerHTML = `
                                                                <div class="newLogInWithDiscordDismissible-inner">
                                                                    <svg class="closeIcon_modal_discord_login" onclick="closeLoginDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-medium-title" style="margin-top: 0px;">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_TITLE")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_1")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_2")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <img src="https://cdn.yapper.shop/assets/178.png">
                                                                    <hr style="opacity: 0;">
                                                                    <button class="card-button" onclick="loginToDiscord()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_LOG_IN")}</button>
                                                                    <button class="card-button" onclick="closeLoginDismissibleCoachtip()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_NO_THANKS")}</button>
                                                                </div>
                                                                <div class="newLogInWithDiscordDismissible-pointer"></div>
                                                            `;
                                                
                                                            newLogInWithDiscordDismissible.classList.add('newLogInWithDiscordDismissible');
                                                
                                                            newLogInWithDiscordDismissible.id = `newLogInWithDiscordDismissible`;
                                                
                                                            modal.appendChild(newLogInWithDiscordDismissible);
                                                        }
                                                    }
                                                    


                                                    let modal_back = document.createElement("div");

                                                    modal_back.classList.add('modalv2-back');
                                                    modal_back.id = 'modalv2-back';

                                                    document.body.appendChild(modal_back);

                                                    setTimeout(() => {
                                                        modal_back.classList.add('show');
                                                    }, 1);


                                                    modal.addEventListener('click', (event) => {
                                                        if (event.target === modal) {
                                                            modal.classList.remove('show');
                                                            modal_back.classList.remove('show');
                                                            setTimeout(() => {
                                                                modal.remove();
                                                                modal_back.remove();
                                                            }, 300);
                                                            removeParams('itemSkuId');
                                                            modalIsAlreadyOpen = false;
                                                        }
                                                    });

                                                    document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    });
                                                }
                                            } else if (product.type === "plus_more") {
                                                card.classList.add('clickable');

                                                card.addEventListener("click", (event) => {
                                                    if (event.target.matches("[data-shop-card-var]")) {
                                                    } else {
                                                        openItemModal();
                                                    }
                                                });

                                                async function openItemModal() {
                                                    let modal = document.createElement("div");

                                                    modal.classList.add('modalv2');

                                                    if (apiCategory.pdp_bg != null) {
                                                        pdp = apiCategory.pdp_bg
                                                    } else {
                                                        pdp = apiCategory.banner
                                                    }

                                                    modal.innerHTML = `
                                                        <div class="modalv2-inner">
                                                            <div class="modalv2-inner-left">
                                                                <div data-modal-left-preview-holder></div>
                                                                <p data-product-modal-sku-id></p>
                                                                <p data-product-modal-credits></p>
                                                                <p style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                                <p style="color: var(--8)" data-product-modal-summary></p>
                                                                <div class="shop-modal-var-container-container" data-shop-modal-var-container-container>
                                                                    <div class="shop-modal-var-container" data-shop-modal-var-container></div>
                                                                    <a class="shop-modal-var-title" data-shop-modal-var-title></a>
                                                                </div>
                                                                <div class="modal-shop-price-container" data-shop-price-container>
                                                                    <div data-price-standard-container>
                                                                        <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                                                    </div>
                                                                    <div data-price-nitro-container>
                                                                        <a data-price-nitro></a>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-left-bottom">
                                                                    <div class="modal-buttons" data-modal-buttons></div>
                                                                </div>
                                                            </div>
                                                            <img class="modalv2-inner-logo" src="https://cdn.yapper.shop/assets/${apiCategory.logo}.png"></img>
                                                            <div class="shop-modal-tag-container" data-shop-card-tag-container></div>

                                                            <div data-modal-top-product-buttons>
                                                                <div title="Close" data-close-product-card-button>
                                                                    <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                </div>
                                                                <div title="Download Data" data-download-product-card-button></div>
                                                            </div>

                                                            <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                                <img class="modalv2-inner-img" src="https://cdn.yapper.shop/assets/${pdp}.png"></img>
                                                                <div data-modal-preview-holder></div>
                                                            </div>
                                                        </div>
                                                    `;

                                                    document.body.appendChild(modal);

                                                    setTimeout(() => {
                                                        modal.classList.add('show');
                                                    }, 1);

                                                    modal.querySelector("[data-product-modal-name]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_TITLE")}`;
                                                    modal.querySelector("[data-product-modal-summary]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_DESC")}`;

                                                    const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                    previewHolder.classList.add('modal-plus-more-question-mark-img');

                                                    const plusMoreQuestionMark = document.createElement("img");
                                                    plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;

                                                    previewHolder.appendChild(plusMoreQuestionMark);

                                                    if (localStorage.reduced_motion != "true") {
                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                        });
                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                        });
                                                    }


                                                    const button_container = document.querySelector("[data-modal-buttons]");

                                                    button_container.innerHTML = ``;


                                                    const unpublishedAt = new Date(product.unpublished_at);
                            
                                                    if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = unpublishedAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_LEFT_TO_REQUEST_COUNTDOWN_TAG")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }


                                                    const expiresAt = new Date(product.expires_at);

                                                    if (product.expires_at && !isNaN(expiresAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = expiresAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    const ReleasesAt = new Date(product.releases_at);
                            
                                                    if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = ReleasesAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_PUBLISHING_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    if (product.premium_type === 2) {
                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                        `;
                                                    }
                                                    


                                                    let modal_back = document.createElement("div");

                                                    modal_back.classList.add('modalv2-back');
                                                    modal_back.id = 'modalv2-back';

                                                    document.body.appendChild(modal_back);

                                                    setTimeout(() => {
                                                        modal_back.classList.add('show');
                                                    }, 1);


                                                    modal.addEventListener('click', (event) => {
                                                        if (event.target === modal) {
                                                            modal.classList.remove('show');
                                                            modal_back.classList.remove('show');
                                                            setTimeout(() => {
                                                                modal.remove();
                                                                modal_back.remove();
                                                            }, 300);
                                                            removeParams('itemSkuId');
                                                            modalIsAlreadyOpen = false;
                                                        }
                                                    });

                                                    document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    });
                                                }
                                            }
                                        }


                                        const unpublishedAt = new Date(product.unpublished_at);
                            
                                        if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = unpublishedAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("CARD_LEFT_TO_REQUEST_COUNTDOWN_TAG")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }


                                        const ExpiredAt = new Date(product.expires_at);
                            
                                        if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = ExpiredAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }

                                        const ReleasesAt = new Date(product.releases_at);
                            
                                        if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = ReleasesAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_PUBLISHING_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_HOURS")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }

                                        // Append card to output
                                        card.classList.add('shop-category-card-transparent')
                                        cardOutput.append(card);
                                    }
                                }
                                
                                output0.append(category);
    
                                document.getElementById("shop-category-loading-container").innerHTML = ``;
                                document.getElementById("shop-category-loading-container").style.display = 'none';
                            } else if (apiCategory.type === FEATURED) {

                                const featureContainerTemplate = document.querySelector("[data-shop-subblock-container-template]");
            
                                const featureBlockContainer = featureContainerTemplate.content.cloneNode(true).children[0];

                                apiCategory.subblocks.forEach(subblock => {

                                    const template = document.querySelector("[data-shop-category-template-sub]");
            
                                    const featureblock = template.content.cloneNode(true).children[0];
            
                                    const oneImage = featureblock.querySelector("[data-shop-preview-image-sub]");
                                    oneImage.src = subblock.banner_url;
                                    oneImage.alt = subblock.name;

                                    featureblock.setAttribute("onclick",`setParams({page: '${subblock.page}'}); location.reload();`);

                                    featureBlockContainer.append(featureblock);

                                });

                                output.append(featureBlockContainer);
                            
                            } else if (apiCategory.type === WIDE_BANNER) {

                                const template = document.querySelector("[data-shop-category-template-wide]");
            
                                const wide_banner = template.content.cloneNode(true).children[0];
            
                                const oneImage = wide_banner.querySelector("[data-shop-preview-image-wide]");
                                oneImage.src = apiCategory.banner_url;
                                oneImage.alt = apiCategory.name;

                                const title = wide_banner.querySelector("[data-shop-output-wide-title]");
                                title.textContent = apiCategory.title;
                                title.style.color = apiCategory.banner_text_color;

                                const desc = wide_banner.querySelector("[data-shop-output-wide-desc]");
                                desc.textContent = apiCategory.body;
                                desc.style.color = apiCategory.banner_text_color;

                                if (apiCategory.disable_cta != true) {
                                    wide_banner.classList.add('clickable');
                                }

                                wide_banner.setAttribute("onclick",`setParams({page: '${apiCategory.page}'}); location.reload();`);

                                output.append(wide_banner);
                            }
                        }

                        processCategories()
                    });
                    }
                })
                .catch(error => {
                    console.error('Error fetching the API:', error);
                });
            }
        } else {

            if (params.get("page") === "consumables") {
                createMainPotionsElement()
                createPotionsCategoryLoadingElement()
            } else {
                createMainShopElement()
                createShopCategoryLoadingElement()
            }


            // Clear the previous data
            clearShopData();
        
            // Fetch new data

            // Make the function async
            fetch(apiUrl, {
                method: "GET",
                headers: {
                    "Password": api_password,
                    "Authorization": discord_token,
                    "Token": api_token
                }
            })
                .then(response => response.json())
                .then((data) => {

                    if (data.message === "Missing Access") {
                        document.getElementById("everything-housing-container").innerHTML = `
                            <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                                <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                                <h2>${getTextString("SHOP_NOT_LOAD_ERROR_1")}</h2>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR_2")}</p>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR")}${data.message}</p>
                                <button class="refresh-button" onclick="location.reload();">${getTextString("SHOP_NOT_LOAD_ERROR_RELOAD")}</button>
                            </div>
                        `;
                    } else if (data.message === "No Leaks") {
                        document.getElementById("everything-housing-container").innerHTML = `
                            <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                                <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                                <h2>${getTextString("SHOP_NO_LEAKS_ERROR_1")}</h2>
                                <p>${getTextString("SHOP_NO_LEAKS_ERROR_2")}</p>
                                <p>${getTextString("SHOP_NOT_LOAD_ERROR")}${data.message}</p>
                                <button class="refresh-button" onclick="location.reload();">${getTextString("SHOP_NOT_LOAD_ERROR_RELOAD")}</button>
                            </div>
                        `;
                    } else {
                        processCategories();

                        if (document.getElementById("top-bar-other-things-container") && localStorage.experiment_2025_04_item_search === "Treatment 1: Enabled") {
                            document.getElementById("open-help-modals-buttons-holder-new").classList.add("with-search");
                            document.getElementById("top-bar-other-things-container").innerHTML = `
                                <input autocomplete="off" placeholder="${getTextString("ITEM_SEARCH_INPUT_PLACEHOLDER")}">
                            `;
                        }
                    }
                    // Define async function inside the .then block
                    async function processCategories() {
                        const categoryTemplate = document.querySelector("[data-shop-category-template]");
                        const potionTemplate = document.querySelector("[data-potion-card-template]");
                        const categoryOutput = document.querySelector("[data-shop-output]");
                        const page = params.get("page"); 
            
                        for (const apiCategory of data) {
                            if (page === "pplus" || page === "leaks_") {
                                // Existing code for 'pplus' page
                                const category = categoryTemplate.content.cloneNode(true).children[0];
                                category.querySelector("[data-shop-category-banner]").id = apiCategory.sku_id;

                                if (localStorage.experiment_2025_02_shop_category_modals === "Treatment 1: Enable category modals" || localStorage.experiment_2025_02_shop_category_modals === "Treatment 2: Enable category modals w/ data downloads") {
                                    category.querySelector("[data-shop-category-banner]").classList.add('clickable')
                                }
            
                                if (apiCategory.banner_asset) {
                                    if (apiCategory.banner_asset.animated != null) {
                                        if (apiCategory.banner_asset.static != null) {
                                            category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="${apiCategory.banner_asset.static}">
                                                <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                            `;
                                        } else {
                                            category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                            `;
                                        }
                                    } else if (apiCategory.banner_asset.static != null) {
                                        category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.banner_asset.static}`;
                                    }
                                } else {
                                    category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.banner}.png`;
                                    category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                }
            
                                category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.logo}.png`;
                                category.querySelector("[data-shop-category-logo-image]").alt = apiCategory.name;
            
                                category.querySelector("[data-shop-category-desc]").id = `${apiCategory.sku_id}-summary`;
                                category.querySelector("[data-shop-category-desc]").textContent = apiCategory.summary;
                                if (apiCategory.banner_text_color && apiCategory.banner_text_color != null) {
                                    category.querySelector("[data-shop-category-desc]").style.color = apiCategory.banner_text_color;
                                }

                                category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-banner-banner-container`;
                                category.querySelector("[data-shop-category-logo-holder]").id = `${apiCategory.sku_id}-logo-container`;
                                category.querySelector("[data-shop-discord-watermark-container]").id = `${apiCategory.sku_id}-discord-watermark-container`;

                                if (apiCategory.category_bg != null) {
                                    category.querySelector("[data-shop-category-marketing-bg]").src = `https://cdn.yapper.shop/assets/${apiCategory.category_bg}.png`;
                                }

                                
                                if (apiCategory.sku_id === PAPER_BEACH) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === WINDOWKILL_V2) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === FIVE_NIGHTS_AT_FREDDYS) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === PLUS_SPECIAL_EVENT) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === GEOMETRY_DASH) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === PAPER_BEACH_V2) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === HOAX) {
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-category-desc]").style.color = 'black';
                                }

                                if (localStorage.experiment_2025_02_shop_category_modals === "Treatment 1: Enable category modals" || localStorage.experiment_2025_02_shop_category_modals === "Treatment 2: Enable category modals w/ data downloads") {
                                    category.querySelector("[data-shop-category-banner]").classList.add('clickable');

                                    category.querySelector("[data-shop-category-banner]").addEventListener("click", () => {
                                        openCategoryModal();
                                        addParams({itemSkuId: apiCategory.sku_id})
                                    });

                                    const itemSKUForScroll = params.get("itemSkuId");

                                    if (itemSKUForScroll === apiCategory.sku_id && modalIsAlreadyOpen != true) {
                                        modalIsAlreadyOpen = true;
                                        setTimeout(() => {
                                            openCategoryModal();
                                        }, 1000);
                                    }
                                    

                                    async function openCategoryModal() {
                                        let modal = document.createElement("div");

                                        modal.classList.add('modalv2');

                                        modal.innerHTML = `
                                            <div class="category-modalv2-inner">
                                                <div class="category-modalv2-inner-left">
                                                    <p class="category-modal-text-sku-id" data-product-modal-sku-id></p>
                                                    <p class="category-modal-text-name" data-product-modal-name></p>
                                                    <p class="category-modal-text-summary" data-product-modal-summary></p>
                                                    <p class="category-modal-text-item-count">${getTextString("SHOP_CATEGORY_MODAL_ITEM_COUNT")}${apiCategory.products.length}</p>
                                                    <div class="category-modal-content-container" data-category-modal-content-container>
                                                        <div class="change-category-modal-content-button selected" data-shop-category-modal-tabs-tab-button-1>
                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_ASSETS_TAB")}</p>
                                                        </div>
                                                        <div class="change-category-modal-content-button" style="display: none;" data-shop-category-modal-tabs-tab-button-2>
                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_TAB")}</p>
                                                        </div>
                                                        <div class="category-modal-inner-content-container" data-category-modal-inner-content-container>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="shop-modal-tag-container" data-shop-card-tag-container></div>
                                                <div data-modal-top-product-buttons>
                                                    <div title="Close" data-close-product-card-button>
                                                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                    </div>
                                                </div>
                                            </div>
                                        `;

                                        if (localStorage.experiment_2025_04_reviews_v2 === "Treatment 1: Enabled") {
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]").style.display = 'flex';
                                        }

                                        fillCategoryModalContentContainer('assets');

                                        const tab_button_1 = modal.querySelector("[data-shop-category-modal-tabs-tab-button-1]");
                                        const tab_button_2 = modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]");

                                        tab_button_1.addEventListener('click', () => {
                                            if (tab_button_2.classList.contains("selected")) {
                                                tab_button_2.classList.remove("selected");
                                            }
                                            tab_button_1.classList.add("selected");
                                            fillCategoryModalContentContainer('assets');
                                        });

                                        tab_button_2.addEventListener('click', () => {
                                            if (tab_button_1.classList.contains("selected")) {
                                                tab_button_1.classList.remove("selected");
                                            }
                                            tab_button_2.classList.add("selected");
                                            fillCategoryModalContentContainer('reviews');
                                        });

                                        function fillCategoryModalContentContainer(tab) {
                                            if (document.getElementById("shop-category-modal-write-review-container")) {
                                                document.getElementById("shop-category-modal-write-review-container").remove();
                                            }
                                            if (tab === "assets") {

                                                modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                const asset_container = modal.querySelector("[data-category-modal-inner-content-container]");

                                                if (apiCategory.banner != null) {
                                                    let banner_asset = document.createElement("div");

                                                    banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.banner}</p>
                                                        <img class="category-modalv2-inner-img-banner" src="https://cdn.yapper.shop/assets/${apiCategory.banner}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(banner_asset);
                                                }

                                                if (apiCategory.banner_asset && apiCategory.banner_asset.static != null) {
                                                    let banner_asset = document.createElement("div");

                                                    banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_BANNER_ASSET_1")}</p>
                                                        <img class="category-modalv2-inner-img-banner" src="${apiCategory.banner_asset.static}"></img> 
                                                    `;

                                                    asset_container.appendChild(banner_asset);
                                                }

                                                if (apiCategory.banner_asset && apiCategory.banner_asset.animated != null) {
                                                    let banner_asset = document.createElement("div");

                                                    banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_BANNER_ASSET_2")}</p>
                                                        <video disablepictureinpicture autoplay muted class="category-modalv2-inner-img-banner" src="${apiCategory.banner_asset.animated}" loop></video> 
                                                    `;

                                                    asset_container.appendChild(banner_asset);
                                                }

                                                if (apiCategory.logo != null) {
                                                    let logo_asset = document.createElement("div");

                                                    logo_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_LOGO")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.logo}</p>
                                                        <img class="category-modalv2-inner-img-logo" src="https://cdn.yapper.shop/assets/${apiCategory.logo}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(logo_asset);
                                                }

                                                if (apiCategory.mobile_bg != null) {
                                                    let mobile_bg_asset = document.createElement("div");

                                                    mobile_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_MOBILE_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.mobile_bg}</p>
                                                        <img class="category-modalv2-inner-img-mobile_bg" src="https://cdn.yapper.shop/assets/${apiCategory.mobile_bg}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(mobile_bg_asset);
                                                }

                                                if (apiCategory.pdp_bg != null) {
                                                    let pdp_bg_asset = document.createElement("div");

                                                    pdp_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_PDP_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.pdp_bg}</p>
                                                        <img class="category-modalv2-inner-img-pdp_bg" src="https://cdn.yapper.shop/assets/${apiCategory.pdp_bg}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(pdp_bg_asset);
                                                }

                                                if (apiCategory.success_modal_bg != null) {
                                                    let success_modal_bg_asset = document.createElement("div");

                                                    success_modal_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_SUCCESS_MODAL_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.success_modal_bg}</p>
                                                        <img class="category-modalv2-inner-img-success_modal_bg" src="https://cdn.yapper.shop/assets/${apiCategory.success_modal_bg}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(success_modal_bg_asset);
                                                }

                                                if (apiCategory.mobile_banner != null) {
                                                    let mobile_banner_asset = document.createElement("div");

                                                    mobile_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_MOBILE_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.mobile_banner}</p>
                                                        <img class="category-modalv2-inner-img-mobile_banner" src="https://cdn.yapper.shop/assets/${apiCategory.mobile_banner}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(mobile_banner_asset);
                                                }

                                                if (apiCategory.featured_block != null) {
                                                    let featured_block_asset = document.createElement("div");

                                                    featured_block_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_FEATURED_BLOCK")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.featured_block}</p>
                                                        <img class="category-modalv2-inner-img-featured_block" src="https://cdn.yapper.shop/assets/${apiCategory.featured_block}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(featured_block_asset);
                                                }

                                                if (apiCategory.hero_banner != null) {
                                                    let hero_banner_asset = document.createElement("div");

                                                    hero_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.hero_banner}</p>
                                                        <img class="category-modalv2-inner-img-hero_banner" src="https://cdn.yapper.shop/assets/${apiCategory.hero_banner}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(hero_banner_asset);
                                                }

                                                if (apiCategory.hero_banner_asset && apiCategory.hero_banner_asset.static != null) {
                                                    let hero_banner_asset = document.createElement("div");

                                                    hero_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_BANNER_ASSET_1")}</p>
                                                        <img class="category-modalv2-inner-img-banner" src="${apiCategory.hero_banner_asset.static}"></img> 
                                                    `;

                                                    asset_container.appendChild(hero_banner_asset);
                                                }

                                                if (apiCategory.hero_banner_asset && apiCategory.hero_banner_asset.animated != null) {
                                                    let hero_banner_asset = document.createElement("div");

                                                    hero_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_BANNER_ASSET_2")}</p>
                                                        <video disablepictureinpicture autoplay muted class="category-modalv2-inner-img-banner" src="${apiCategory.hero_banner_asset.animated}" loop></video> 
                                                    `;

                                                    asset_container.appendChild(hero_banner_asset);
                                                }

                                                if (apiCategory.wide_banner != null) {
                                                    let wide_banner_asset = document.createElement("div");

                                                    wide_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_WIDE_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.wide_banner}</p>
                                                        <img class="category-modalv2-inner-img-wide_banner" src="https://cdn.yapper.shop/assets/${apiCategory.wide_banner}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(wide_banner_asset);
                                                }

                                                if (apiCategory.hero_logo != null) {
                                                    let hero_logo_asset = document.createElement("div");

                                                    hero_logo_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_LOGO")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.hero_logo}</p>
                                                        <img class="category-modalv2-inner-img-hero_logo" src="https://cdn.yapper.shop/assets/${apiCategory.hero_logo}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(hero_logo_asset);
                                                }

                                                if (apiCategory.category_bg != null) {
                                                    let category_bg_asset = document.createElement("div");

                                                    category_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_CATEGORY_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.category_bg}</p>
                                                        <img class="category-modalv2-inner-img-category_bg" src="https://cdn.yapper.shop/assets/${apiCategory.category_bg}.png"></img> 
                                                    `;

                                                    asset_container.appendChild(category_bg_asset);
                                                }
                                            } else if (tab === "reviews") {

                                                modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = `
                                                    <div class="review-element-warning" id="loading-category-reviews">
                                                        <p class="review-warning-notice-text">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_PPLUS_WARNING")}</p>
                                                    </div>
                                                `;
                                            }
                                        }

                                        window.fillCategoryModalContentContainer = fillCategoryModalContentContainer;


                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `${getTextString("SHOP_CATEGORY_MODAL_SKU_ID")}${apiCategory.sku_id}`;
                                        modal.querySelector("[data-product-modal-name]").textContent = apiCategory.name;
                                        modal.querySelector("[data-product-modal-summary]").textContent = apiCategory.summary;

                                        document.body.appendChild(modal);

                                        setTimeout(() => {
                                            modal.classList.add('show');
                                        }, 1);

                                        
                                        const top_button_container = document.querySelector("[data-modal-top-product-buttons]");

                                        
                                        if (localStorage.experiment_2025_02_shop_category_modals === "Treatment 2: Enable category modals w/ data downloads") {
                                            let downloadItemData = document.createElement("div");

                                            downloadItemData.title = getTextString("SHOP_DOWNLOAD_DATA");
                                            downloadItemData.innerHTML = `
                                                <svg data-download-product-card-button class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                            `;

                                            top_button_container.appendChild(downloadItemData);
                                        }

                                        if (localStorage.experiment_2025_03_view_raw_modal === "Treatment 1: Enabled") {
                                            let rawItemData = document.createElement("div");

                                            rawItemData.title = getTextString("SHOP_VIEW_RAW_DATA");
                                            rawItemData.innerHTML = `
                                                <svg data-view-raw-product-card-button class="shareIcon_modal" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.7376 3.18925C15.4883 2.93731 15.0814 2.93686 14.8316 3.18824L14.0087 4.01625C13.7618 4.26471 13.7614 4.66581 14.0078 4.91476L20.3804 11.3527C20.6265 11.6013 20.6265 12.0017 20.3804 12.2503L14.0078 18.6882C13.7614 18.9373 13.7618 19.3383 14.0087 19.5867L14.8316 20.4148C15.0814 20.6662 15.4883 20.6658 15.7376 20.4138L23.815 12.2503C24.061 12.0016 24.061 11.6014 23.815 11.3528L15.7376 3.18925Z" fill="currentColor"/><path d="M9.99171 4.91476C10.2381 4.66581 10.2377 4.26471 9.99081 4.01625L9.16787 3.18824C8.91804 2.93686 8.51118 2.93731 8.2619 3.18925L0.184466 11.3528C-0.0614893 11.6014 -0.061488 12.0016 0.184466 12.2503L8.2619 20.4138C8.51118 20.6658 8.91803 20.6662 9.16787 20.4148L9.99081 19.5867C10.2377 19.3383 10.2381 18.9373 9.99171 18.6882L3.61906 12.2503C3.37298 12.0017 3.37298 11.6013 3.61906 11.3527L9.99171 4.91476Z" fill="currentColor"/></svg>
                                            `;

                                            top_button_container.appendChild(rawItemData);

                                            modal.querySelector("[data-view-raw-product-card-button]").onclick = function(){
                                                openRawModal();
                                            };

                                            async function openRawModal() {
                                                let modal = document.createElement("div");
                    
                                                modal.classList.add('modalv2');
                    
                                                modal.innerHTML = `
                                                    <div class="view-raw-modalv2-inner">
                                                        <textarea class="view-raw-modal-textbox" readonly>${JSON.stringify(apiCategory, undefined, 4)}</textarea>
                                                    </div>
                                                `;
                    
                                                document.body.appendChild(modal);
                    
                                                setTimeout(() => {
                                                    modal.classList.add('show');
                                                }, 1);
                                                
                    
                                                let modal_back = document.createElement("div");
                    
                                                modal_back.classList.add('modalv2-back');
                                                modal_back.id = 'modalv2-back';
                    
                                                document.body.appendChild(modal_back);
                    
                                                setTimeout(() => {
                                                    modal_back.classList.add('show');
                                                }, 1);
                    
                    
                                                modal.addEventListener('click', (event) => {
                                                    if (event.target === modal) {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    }
                                                });
                    
                                                document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                    modal.classList.remove('show');
                                                    modal_back.classList.remove('show');
                                                    setTimeout(() => {
                                                        modal.remove();
                                                        modal_back.remove();
                                                    }, 300);
                                                });
                                            }
                                        }


                                        const unpublishedAt = new Date(apiCategory.unpublished_at);
                    
                                        if (apiCategory.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                    
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = unpublishedAt - now;
                    
                                                if (timeDiff <= 0) {
                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("SHOP_CATEGORY_NOT_IN_STORE")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                    
                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("SHOP_CATEGORY_DAYS_LEFT_IN_STORE")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                    
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }
                                        


                                        let modal_back = document.createElement("div");

                                        modal_back.classList.add('modalv2-back');
                                        modal_back.id = 'modalv2-back';

                                        document.body.appendChild(modal_back);

                                        setTimeout(() => {
                                            modal_back.classList.add('show');
                                        }, 1);


                                        modal.addEventListener('click', (event) => {
                                            if (event.target === modal) {
                                                modal.classList.remove('show');
                                                modal_back.classList.remove('show');
                                                setTimeout(() => {
                                                    modal.remove();
                                                    modal_back.remove();
                                                }, 300);
                                                removeParams('itemSkuId');
                                                modalIsAlreadyOpen = false;
                                            }
                                        });

                                        document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                            modal.classList.remove('show');
                                            modal_back.classList.remove('show');
                                            setTimeout(() => {
                                                modal.remove();
                                                modal_back.remove();
                                            }, 300);
                                        });
                                    }
                                }


                                const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                if (cardOutput) {
                                    for (const product of apiCategory.products) {
                                        const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                        const card = cardTemplate.content.cloneNode(true).children[0];

                                        card.id = product.sku_id;

                                        if (product.type === item_types.NONE) {
                                            card.classList.add("type_100");
                                            card.classList.add('hidden')
                                        } else if (product.type === item_types.AVATAR_DECORATION) {
                                            product.items.forEach(item => {
                                                card.classList.add("type_0");
                                                // Set the innerHTML for the preview holder
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('avatar-decoration-image');
                                                
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                
                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                
                                                previewHolder.appendChild(bgimg);
                                        
                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                        if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                            bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                        bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                    });
                                                }
                                            });
                                        } else if (product.type === item_types.PROFILE_EFFECT) {
                                            card.classList.add("type_1");

                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                            // Ensure the item ID is accessible here
                                            let itemId = undefined;
                                            if (Array.isArray(product.items)) {
                                                // If items is an array, find the item with type 1 and get its id
                                                const item = product.items.find(item => item.type === 1);
                                                if (item) {
                                                    itemId = item.id;
                                                }
                                            } else if (product.items && product.items.type === 1) {
                                                // If items is an object and has type 1, get its id
                                                itemId = product.items.id;
                                            }

                                            if (!pplusProfileEffectsCache) {
                                                await setPplusProfileEffectCache();
                                            }
                                        
                                            // Find matching profile effect
                                            const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);
                                        
                                            if (matchingEffect) {
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('profile-effect-image');
                                        
                                                previewHolder.innerHTML = `
                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                `;
                                        
                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                const imgElement = card.querySelector("img");
                                        
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                    });
                                                } else {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                    });
                                                }
                                            }
                                        } else if (product.type === item_types.NAMEPLATE) {
                                            card.classList.add("type_2");

                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            previewHolder.innerHTML = `
                                                <p>${getTextString("CARD_TYPE_NAMEPLATE_PPLUS_ERROR")}</p>
                                            `;
                                            
                                        } else if (product.type === item_types.BUNDLE) {
                                            card.classList.add("type_1000");
                                            // Fetch the bundled products for the bundle summary
                                            const bundledProducts = product.bundled_products || [];
                                        
                                            // Generate the bundle summary from the names of the bundled products
                                            const type0Product = bundledProducts.find(item => item.type === 0);
                                            const type1Product = bundledProducts.find(item => item.type === 1);
                                        
                                            let bundleSummary = `${getTextString("CARD_TYPE_BUNDLE_TITLE")}`;
                                            if (type0Product) {
                                                bundleSummary += `${type0Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_DECO")}`;
                                            }
                                            if (type1Product) {
                                                bundleSummary += `${type1Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_EFFECT")}`;
                                            }
                                        
                                            // Set the summary text
                                            card.querySelector("[data-product-card-summary]").textContent = bundleSummary;
                                        
                                            // Set the basic card details
                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                        
                                            // Handle each item in the bundle
                                            product.items.forEach(item => {
                                                if (item.type === 0) {
                                                    // Avatar decoration
                                                    const decoImage = document.createElement("img");
                                                    decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                    decoImage.alt = "Avatar Decoration";
                                                    decoImage.classList.add("avatar-decoration-image");
                                                    card.querySelector("[data-shop-card-preview-holder]").appendChild(decoImage);

                                                    const bgimg = document.createElement("div");
                                                    bgimg.classList.add("avatar-decoration-bg-image");
                                                    
                                                    card.querySelector("[data-shop-card-preview-holder]").appendChild(bgimg);
                                        
                                                    // Hover effect for decoration image
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                        card.addEventListener("mouseleave", () => {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                        });
                                                    }
                                                } else if (item.type === 1) {
                                                    // Profile effect
                                        
                                                    (async () => {

                                                        if (!pplusProfileEffectsCache) {
                                                            await setPplusProfileEffectCache();
                                                        }
                                        
                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === item.id);
                                        
                                                        if (matchingEffect) {
                                                            const effectImage = document.createElement("img");
                                                            effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                            effectImage.alt = "Profile Effect";
                                                            effectImage.classList.add("profile-effect-image");
                                                            card.querySelector("[data-shop-card-preview-holder]").appendChild(effectImage);
                                        
                                                            // Hover effect for profile effect
                                                            if (localStorage.reduced_motion != "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    if (matchingEffect.effects && matchingEffect.effects[0] && matchingEffect.effects[0].src) {
                                                                        effectImage.src = matchingEffect.effects[0].src;
                                                                    }
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            } else {
                                                                card.addEventListener("mouseenter", () => {
                                                                    effectImage.src = matchingEffect.reducedMotionSrc;
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            }
                                                        }
                                                    })();
                                                }
                                            });
                                        } else if (product.type === item_types.VARIANTS_GROUP) {
                                            // Update SKU and summary
                                            card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_PPLUS_MADE_BY")}${product.credits}`;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                            // Always display the base variant name
                                            card.querySelector("[data-product-card-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                        
                                            // Render variant color blocks as interactive divs
                                            const variantContainer = card.querySelector("[data-shop-card-var-container]");
                                            variantContainer.innerHTML = ""; // Clear existing variant blocks
                                            let currentSelectedVariant = null; // Track selected variant
                                        
                                            product.variants.forEach((variant, index) => {
                                                // Create variant color block
                                                const variantColorBlockTmp = document.querySelector("[data-shop-varcolorblock-template]");
                                                const variantColorBlock = variantColorBlockTmp.content.cloneNode(true).children[0];
                                                variantColorBlock.classList.add("shop-card-var");
                                                variantColorBlock.id = "shop-card-var";
                                                variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                        
                                                // Add click event listener to switch variants
                                                variantColorBlock.addEventListener("click", () => {
                                                    if (currentSelectedVariant) {
                                                        currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                    }
                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                    currentSelectedVariant = variantColorBlock;
                                                    applyVariant(variant);
                                                });
                                        
                                                // Append the color block to the container
                                                variantContainer.appendChild(variantColorBlock);
                                        
                                                // Set the first variant as the default selected
                                                if (index === 0) {
                                                    currentSelectedVariant = variantColorBlock;
                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                }
                                            });

                                            let isFirstTimeLoadingVariant = true;
                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                        
                                            // Function to apply the selected variant
                                            function applyVariant(selectedVariant) {
                                                card.querySelector("[data-shop-card-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                if (selectedVariant.type === 0) {
                                                    card.classList.add("type_2000-0");
                                                    previewHolder.innerHTML = ""; // Clear previous decorations
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Add the avatar decoration based on the selected variant
                                                    selectedVariant.items?.forEach(item => {
                                                        const decoImage = document.createElement("img");
                                                        const bgimg = document.createElement("div");
                                                        if (isFirstTimeLoadingVariant == true) {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                            isFirstTimeLoadingVariant = false;
                                                        } else {
                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        }
                                                        decoImage.alt = "Avatar Decoration";
                                                        decoImage.id = "shop-card-deco-image";
                                                        previewHolder.appendChild(decoImage);

                                                        bgimg.id = "shop-card-deco-bg-image";

                                                        previewHolder.appendChild(bgimg);
                                                    
                                                        // Hover effect for decoration image
                                                        if (localStorage.reduced_motion !== "true") {
                                                            card.addEventListener("mouseenter", () => {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            });
                                                            card.addEventListener("mouseleave", () => {
                                                                decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                            });
                                                        }
                                                    });
                                                } else if (selectedVariant.type === 1) {
                                                    card.classList.add("type_2000-1");
                                                    (async () => {
                                                        // Ensure the item ID is accessible here
                                                        let itemId = undefined;
                                                        if (Array.isArray(selectedVariant.items)) {
                                                            // If items is an array, find the item with type 1 and get its id
                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                            if (item) {
                                                                itemId = item.id;
                                                            }
                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                            // If items is an object and has type 1, get its id
                                                            itemId = selectedVariant.items.id;
                                                        }

                                                        if (!pplusProfileEffectsCache) {
                                                            await setPplusProfileEffectCache();
                                                        }
                                                    
                                                        // Find matching profile effect
                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);
                                                    
                                                        if (matchingEffect) {
                                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                            previewHolder.classList.add('profile-effect-image');
                                                        
                                                            if (isFirstTimeLoadingVariant == true) {
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                `;
                                                                isFirstTimeLoadingVariant = false;
                                                            } else {
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.effects[0]?.src}">
                                                                `;
                                                            }
                                                        
                                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                            const imgElement = card.querySelector("img");
                                                        
                                                            if (localStorage.reduced_motion != "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                    }
                                                                });
                                                            
                                                                card.addEventListener("mouseleave", () => {
                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            } else {
                                                                card.addEventListener("mouseenter", () => {
                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                });
                                                            
                                                                card.addEventListener("mouseleave", () => {
                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            }
                                                        }
                                                    })();
                                                }
                                            }
                                        
                                            // Apply the default variant (first one) initially
                                            if (product.variants.length > 0) {
                                                applyVariant(product.variants[0]);
                                            }
                                        } else if (product.type === item_types.EXTERNAL_SKU) {
                                            card.classList.add("type_3000");

                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            previewHolder.innerHTML = `
                                                <p>${getTextString("CARD_TYPE_EXTERNAL_SKU_ERROR")}</p>
                                            `;
                                            
                                        } else if (product.type === 'plus_more') {
                                            card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            card.querySelector("[data-product-card-name]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_TITLE")}`;
                                            card.querySelector("[data-product-card-summary]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_DESC")}`;

                                            card.querySelector("[data-shop-price-container]").innerHTML = ``;
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                            card.querySelector("[data-share-product-card-button]").innerHTML = ``;

                                            const plusMoreQuestionMark = document.createElement("img");
                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                            plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                            card.querySelector("[data-shop-card-preview-holder]").appendChild(plusMoreQuestionMark);
                                
                                            // Hover effect for decoration image
                                            if (localStorage.reduced_motion != "true") {
                                                card.addEventListener("mouseenter", () => {
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                });
                                                card.addEventListener("mouseleave", () => {
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                });
                                            }
                                        } else if (product.items[0] && product.items[0].item_type === 'deco') {
                                            card.querySelector("[data-product-card-open-in-shop]").style.display = 'none';

                                            product.items.forEach(item => {
                                                
                                                card.classList.add("type_0");
                                                // Set the innerHTML for the preview holder
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('avatar-decoration-image');
                                                
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = imgElement.src = item.static;
                                                
                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                
                                                previewHolder.appendChild(bgimg);
                                        
                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = item.animated;
                                                        if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                            bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = item.static;
                                                        bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                    });
                                                }
                                                
                                            });
                                        } else if (product.items[0] && product.items[0].item_type === 'effect') {
                                            card.querySelector("[data-product-card-open-in-shop]").style.display = 'none';
                                            
                                            card.classList.add("type_1");

                                            card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                            previewHolder.classList.add('profile-effect-image');
                                        
                                            previewHolder.innerHTML = `
                                                <img class="thumbnail-preview" src="${product.items[0].static}">
                                            `;
                                        
                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                            const imgElement = card.querySelector("img");
                                        
                                            if (localStorage.reduced_motion != "true") {
                                                card.addEventListener("mouseenter", () => {
                                                    imgElement.src = product.items[0].animated;
                                                });
                                            
                                                card.addEventListener("mouseleave", () => {
                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                    imgElement.src = product.items[0].static;
                                                });
                                            }
                                        } else {
                                            card.classList.add('hidden')
                                        }



                                        if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 1: Enabled" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button") {
                                            if (product.emojiCopy === null && product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="location.href='https://discord.gg/SVKQEYeTsN';" title="${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_REQUEST_PPLUS_EMOJI_v2")}</button>
                                                        <button class="card-button" onclick="copyEmoji('${product.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                                    </div>
                                                `;
                                            } else if (product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="copyEmoji('${product.emojiCopy}'); copyNotice('copyemoji');" title="${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_COPY_PPLUS_EMOJI_V2")}</button>
                                                        <button class="card-button" onclick="copyEmoji('${product.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                                    </div>
                                                `;
                                            }
                                        } else {
                                            if (product.emojiCopy === null && product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="location.href='https://discord.gg/SVKQEYeTsN';" title="${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_REQUEST_PPLUS_EMOJI")}</button>
                                                `;
                                            } else if (product.type != 'plus_more') {
                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="copyEmoji('${product.emojiCopy}');" title="${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}">${getTextString("CARD_COPY_PPLUS_EMOJI")}</button>
                                                `;
                                            }
                                        }

                                        if (product.premium_type === 2) {
                                            card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                            `;
                                        }


                                        if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                            if (product.type === item_types.AVATAR_DECORATION || product.type === item_types.PROFILE_EFFECT || product.type === item_types.BUNDLE || product.type === item_types.VARIANTS_GROUP) {
                                                card.classList.add('clickable');

                                                card.addEventListener("click", (event) => {
                                                    if (event.target.matches("[data-shop-card-var]") || event.target.matches(".card-button") || event.target.matches(".shareIcon_f4a996")) {
                                                    } else {
                                                        openItemModal();
                                                        addParams({itemSkuId: product.sku_id})
                                                    }
                                                });

                                                const itemSKUForScroll = params.get("itemSkuId");

                                                if (itemSKUForScroll === product.sku_id && modalIsAlreadyOpen != true) {
                                                    modalIsAlreadyOpen = true;
                                                    setTimeout(() => {
                                                        openItemModal();
                                                    }, 1000);
                                                }

                                                async function openItemModal() {
                                                    let modal = document.createElement("div");

                                                    modal.classList.add('modalv2');

                                                    if (apiCategory.pdp_bg != null) {
                                                        pdp = apiCategory.pdp_bg
                                                    } else {
                                                        pdp = apiCategory.banner
                                                    }

                                                    modal.innerHTML = `
                                                        <div class="modalv2-inner">
                                                            <div class="modalv2-inner-left">
                                                                <div data-modal-left-preview-holder></div>
                                                                <p class="shop-modal-product-sku-id" data-product-modal-sku-id></p>
                                                                <p class="shop-modal-product-credits" data-product-modal-credits></p>
                                                                <p class="shop-modal-product-name" style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                                <p class="shop-modal-product-summary" style="color: var(--8)" data-product-modal-summary></p>
                                                                <div class="shop-modal-var-container-container" data-shop-modal-var-container-container>
                                                                    <div class="shop-modal-var-container" data-shop-modal-var-container></div>
                                                                    <a class="shop-modal-var-title" data-shop-modal-var-title></a>
                                                                </div>
                                                                <div class="modal-shop-price-container" data-shop-price-container></div>
                                                                <div class="modal-left-bottom">
                                                                    <div class="modal-buttons" data-modal-buttons></div>
                                                                </div>
                                                            </div>
                                                            <img class="modalv2-inner-logo" src="https://cdn.yapper.shop/assets/${apiCategory.logo}.png" data-modalv2-inner-logo></img>
                                                            <div class="shop-modal-tag-container" data-shop-card-tag-container></div>
    
                                                            <div data-modal-top-product-buttons>
                                                                <div title="Close" data-close-product-card-button>
                                                                    <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                </div>
                                                            </div>
    
                                                            <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                                <img class="modalv2-inner-img" src="https://cdn.yapper.shop/assets/${pdp}.png"></img>
                                                                <div data-modal-preview-holder></div>
                                                            </div>
                                                        </div>
                                                    `;

                                                    document.body.appendChild(modal);

                                                    setTimeout(() => {
                                                        modal.classList.add('show');
                                                    }, 1);

                                                    if (product.type === item_types.AVATAR_DECORATION) {

                                                        modal.classList.add('modal-0');

                                                        product.items.forEach(item => {

                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                            const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");

                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;

                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {

                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile1">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png">
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                    </div>
                                                                `;

                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                previewHolderLeft.classList.add('modal-left-avatar-decoration-img');

                                                                const imgElement = document.createElement("img");
                                                                imgElement.id = "shop-card-deco-image";
                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;

                                                                previewHolderLeft.appendChild(imgElement);

                                                                if (localStorage.reduced_motion != "true") {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                    });
                                                                }

                                                            } else {
                                                                
                                                                previewHolder.classList.add('modal-avatar-decoration-img');

                                                                const imgElement = document.createElement("img");
                                                                imgElement.id = "shop-card-deco-image";
                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;

                                                                previewHolder.appendChild(imgElement);

                                                                // Hover effect: Change the image src on mouse enter and leave
                                                                if (localStorage.reduced_motion != "true") {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                    });
                                                                }
                                                            }

                                                        });
                                                    } else if (product.type === item_types.PROFILE_EFFECT) {
                                                        modal.classList.add('modal-1');
        
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;

                                                        // Ensure the item ID is accessible here
                                                        let itemId = undefined;
                                                        if (Array.isArray(product.items)) {
                                                            // If items is an array, find the item with type 1 and get its id
                                                            const item = product.items.find(item => item.type === 1);
                                                            if (item) {
                                                                itemId = item.id;
                                                            }
                                                        } else if (product.items && product.items.type === 1) {
                                                            // If items is an object and has type 1, get its id
                                                            itemId = product.items.id;
                                                        }
                                                    
                                                        // Find matching profile effect
                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);

                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                    
                                                        if (matchingEffect) {
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile2">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                        <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${matchingEffect.effects[0]?.src}">
                                                                    </div>
                                                                `;

                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                previewHolderLeft.classList.add('modal-left-profile-effect-img');
                                                            
                                                                const imgElement = document.createElement("img");
                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;

                                                                previewHolderLeft.appendChild(imgElement);
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            } else {
                                                                const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                previewHolder.classList.add('modal-profile-effect-img');
                                                            
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                `;
                                                            
                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                const imgElement = previewHolder.querySelector("img");
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        }
                                                    } else if (product.type === item_types.BUNDLE) {
                                                        modal.classList.add('modal-1000');

                                                        const bundledProducts = product.bundled_products || [];

                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                    
                                                        // Generate the bundle summary from the names of the bundled products
                                                        const type0Product = bundledProducts.find(item => item.type === 0);
                                                        const type1Product = bundledProducts.find(item => item.type === 1);
                                                    
                                                        let bundleSummary = "Bundle Includes: ";
                                                        if (type0Product) {
                                                            bundleSummary += `${type0Product.name} Decoration`;
                                                        }
                                                        if (type1Product) {
                                                            bundleSummary += ` & ${type1Product.name} Profile Effect`;
                                                        }
                                                    
                                                        // Set the summary text
                                                        modal.querySelector("[data-product-modal-summary]").textContent = bundleSummary;
                                                    
                                                        // Set the basic card details
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                    
                                                        // Handle each item in the bundle
                                                        product.items.forEach(item => {
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                
                                                                if (item.type === 0) {
                                                                    decosrc = item.asset
                                                                } else if (item.type === 1) {
                                                                    // Profile effect
                                                                    (async () => {
                                                    
                                                                        // Find the matching effect
                                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === item.id);
                                                    
                                                                        if (matchingEffect) {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                renderProfile(effectUrl)
                                                                            }
                                                                        }
                                                                    })();
                                                                }

                                                                function renderProfile(effectUrl) {
                                                                    previewHolder.classList.add('modal-preview-profile-container');
                                                                    previewHolder.innerHTML = `
                                                                        <div class="modal-preview-profile2">
                                                                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                            <div class="profile-avatar-preview-bg"></div>
                                                                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                            <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                            <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${decosrc}.png">
                                                                            <div class="options-preview-profile-status-bg"></div>
                                                                            <div class="options-preview-profile-status-color"></div>
                                                                            <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                        </div>
                                                                    `;
                                                                    document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                }

                                                                
                                                            } else {
                                                                if (item.type === 0) {
                                                                    const decoImage = document.createElement("img");
                                                                    decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                    decoImage.alt = "Avatar Decoration";
                                                                    decoImage.classList.add("modal-avatar-decoration-img");
                                                                    modal.querySelector("[data-modal-preview-holder]").appendChild(decoImage);
                                                    
                                                                    // Hover effect for decoration image
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                        });

                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                            decoImage.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                        });
                                                                    }
                                                                } else if (item.type === 1) {
                                                                    // Profile effect
                                                                    (async () => {
                                                                        // Fetch profile effects if not cached
                                                                        if (!discordProfileEffectsCache) {
                                                                            const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                method: "GET",
                                                                                headers: {
                                                                                    "Password": api_password,
                                                                                    "Authorization": discord_token,
                                                                                    "Token": api_token
                                                                                }
                                                                            });
                                                                            const effectsData = await response.json();
                                                                            discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                        }
                                                    
                                                                        // Find the matching effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                                    
                                                                        if (matchingEffect) {
                                                                            const effectImage = document.createElement("img");
                                                                            effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                            effectImage.alt = "Profile Effect";
                                                                            effectImage.classList.add("modal-profile-effect-img");
                                                                            modal.querySelector("[data-modal-preview-holder]").appendChild(effectImage);
                                                    
                                                                            // Hover effect for profile effect
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        effectImage.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    effectImage.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        }
                                                                    })();
                                                                }
                                                            }
                                                        });
                                                    } else if (product.type === item_types.VARIANTS_GROUP) {
                                                        modal.querySelector("[data-shop-modal-var-container-container]").classList.add('show');
                                                        // Update SKU and summary
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${product.credits}`;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
                                                    
                                                        // Always display the base variant name
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                                    
                                                        // Render variant color blocks as interactive divs
                                                        const variantContainer = modal.querySelector("[data-shop-modal-var-container]");
                                                        variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                        let currentSelectedVariant = null; // Track selected variant
                                                    
                                                        product.variants.forEach((variant, index) => {
                                                            // Create variant color block
                                                            const variantColorBlock = document.createElement("div");
                                                            variantColorBlock.classList.add("shop-card-var");
                                                            variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                                    
                                                            // Add click event listener to switch variants
                                                            variantColorBlock.addEventListener("click", () => {
                                                                if (currentSelectedVariant) {
                                                                    currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                                }
                                                                variantColorBlock.classList.add("shop-card-var-selected");
                                                                currentSelectedVariant = variantColorBlock;
                                                                applyVariant(variant);
                                                            });
                                                    
                                                            // Append the color block to the container
                                                            variantContainer.appendChild(variantColorBlock);
                                                    
                                                            // Set the first variant as the default selected
                                                            if (index === 0) {
                                                                currentSelectedVariant = variantColorBlock;
                                                                variantColorBlock.classList.add("shop-card-var-selected");
                                                            }
                                                        });
            
                                                        let isFirstTimeLoadingVariant = true;
                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                    
                                                        // Function to apply the selected variant
                                                        function applyVariant(selectedVariant) {
                                                            modal.querySelector("[data-shop-modal-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                            modal.querySelector("[data-product-modal-credits]").textContent = `Made By: ${selectedVariant.credits}`;
                                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                                modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                                    <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${selectedVariant.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                                `;
                                                            }
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                
                                                                if (selectedVariant.type === 0) {
                                                                    selectedVariant.items?.forEach(item => {
                                                                        previewHolder.classList.add('modal-preview-profile-container');
                                                                        previewHolder.innerHTML = `
                                                                            <div class="modal-preview-profile1">
                                                                                <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                <div class="profile-avatar-preview-bg"></div>
                                                                                <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png">
                                                                                <div class="options-preview-profile-status-bg"></div>
                                                                                <div class="options-preview-profile-status-color"></div>
                                                                            </div>
                                                                        `;
                                                                        document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                        previewHolderLeft.classList.add('modal-left-avatar-decoration-img');

                                                                        previewHolderLeft.innerHTML = `
                                                                            <img id="shop-card-deco-image" src="https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png" data-left-preview-deco-var>
                                                                        `;

                                                                        const imgElement = previewHolderLeft.querySelector("[data-left-preview-deco-var]");
                                                                        
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${item.asset}.png`;
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${item.asset}.png`;
                                                                            });
                                                                        }
                                                                    });
                                                                } else if (selectedVariant.type === 1) {

                                                                    modal.classList.add("modal-2000-1");
                                                                    (async () => {
                                                                        // Ensure the item ID is accessible here
                                                                        let itemId = undefined;
                                                                        if (Array.isArray(selectedVariant.items)) {
                                                                            // If items is an array, find the item with type 1 and get its id
                                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                                            if (item) {
                                                                                itemId = item.id;
                                                                            }
                                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                            // If items is an object and has type 1, get its id
                                                                            itemId = selectedVariant.items.id;
                                                                        }
                                                                    
                                                                        // Find matching profile effect
                                                                        const matchingEffect = pplusProfileEffectsCache.find(effect => effect.id === itemId);
                                                                    
                                                                        if (matchingEffect) {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                                previewHolder.innerHTML = `
                                                                                    <div class="modal-preview-profile2">
                                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                                        <div class="options-preview-profile-status-color"></div>
                                                                                        <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                                    </div>
                                                                                `;
                                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                            }
                                                                        }

                                                                        previewHolderLeft.classList.add('modal-left-profile-effect-img');

                                                                        previewHolderLeft.innerHTML = `
                                                                            <img src="${matchingEffect.thumbnailPreviewSrc}" data-left-preview-effect-var>
                                                                        `;

                                                                        const imgElement = previewHolderLeft.querySelector("[data-left-preview-effect-var]");
                                                                        
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                    const effectUrl = matchingEffect.effects[0]?.src;
                                                                                    imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                }
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                            });
                                                                        } else {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                imgElement.src = matchingEffect.reducedMotionSrc;
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                            });
                                                                        }
                                                                    })();
                                                                }

                                                                
                                                            } else {
                                                                if (selectedVariant.type === 0) {
                                                                    modal.classList.add("modal-2000-0");
                                                                    previewHolder.innerHTML = ""; // Clear previous decorations
                                                                    previewHolder.classList.add('modal-avatar-decoration-img');
                                                                    
                                                                    // Add the avatar decoration based on the selected variant
                                                                    selectedVariant.items?.forEach(item => {
                                                                        const decoImage = document.createElement("img");
                                                                        decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        decoImage.alt = "Avatar Decoration";
                                                                        decoImage.id = "shop-card-deco-image";
                                                                        previewHolder.appendChild(decoImage);
                                                                    
                                                                        // Hover effect for decoration image
                                                                        if (localStorage.reduced_motion !== "true") {
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                            });
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                            });
                                                                        }
                                                                    });
                                                                } else if (selectedVariant.type === 1) {
                                                                    modal.classList.add("modal-2000-1");
                                                                    (async () => {
                                                                        // Ensure the item ID is accessible here
                                                                        let itemId = undefined;
                                                                        if (Array.isArray(selectedVariant.items)) {
                                                                            // If items is an array, find the item with type 1 and get its id
                                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                                            if (item) {
                                                                                itemId = item.id;
                                                                            }
                                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                            // If items is an object and has type 1, get its id
                                                                            itemId = selectedVariant.items.id;
                                                                        }
                                                                    
                                                                    
                                                                        // Fetch profile effects API only if not already cached
                                                                        if (!discordProfileEffectsCache) {
                                                                            const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                method: "GET",
                                                                                headers: {
                                                                                    "Password": api_password,
                                                                                    "Authorization": discord_token,
                                                                                    "Token": api_token
                                                                                }
                                                                            });
                                                                            const effectsData = await response.json();
                                                                            discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                        }
                                                                    
                                                                        // Find matching profile effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                                    
                                                                        if (matchingEffect) {
                                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                            previewHolder.classList.add('modal-profile-effect-img');
                                                                        
                                                                            previewHolder.innerHTML = `
                                                                                <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                            `;
                                                                        
                                                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                            const imgElement = previewHolder.querySelector("img");
                                                                        
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        }
                                                                    })();
                                                                }
                                                            }
                                                        }
                                                    
                                                        // Apply the default variant (first one) initially
                                                        if (product.variants.length > 0) {
                                                            applyVariant(product.variants[0]);
                                                        }
                                                    }


                                                    const button_container = document.querySelector("[data-modal-buttons]");
                                                    
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads") {
                                                        modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                            <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                        `;
                                                    } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page") {
                                                        if (typeof product.emojiCopy != 'undefined') {
                                                            button_container.innerHTML = `
                                                                <button class="card-button ${product.emojiCopy ? '' : 'card-button-no-emoji'}" onclick="${product.emojiCopy ? `copyEmoji('${product.emojiCopy}'); copyNotice('copyemoji');` : `redirectToLink('https://discord.gg/SVKQEYeTsN')`}" title="${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}`}">${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI")}`}</button>
                                                            `;
                                                        } else {
                                                            button_container.innerHTML = `
                                                                <button class="card-button card-button-no-emoji" title="${getTextString("CARD_PPLUS_ERROR_TITLE")}">${getTextString("CARD_PPLUS_ERROR")}</button>
                                                            `;
                                                        }
                                                    } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        if (typeof product.emojiCopy != 'undefined') {
                                                            button_container.innerHTML = `
                                                                <button class="card-button ${product.emojiCopy ? '' : 'card-button-no-emoji'}" onclick="${product.emojiCopy ? `copyEmoji('${product.emojiCopy}'); copyNotice('copyemoji');` : `redirectToLink('https://discord.gg/SVKQEYeTsN')`}" title="${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI_TITLE")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI_TITLE")}`}">${product.emojiCopy ? `${getTextString("CARD_COPY_PPLUS_EMOJI")}` : `${getTextString("CARD_REQUEST_PPLUS_EMOJI")}`}</button>
                                                            `;
                                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                            `;
                                                        } else {
                                                            button_container.innerHTML = `
                                                                <button class="card-button card-button-no-emoji" title="${getTextString("CARD_PPLUS_ERROR_TITLE")}">${getTextString("CARD_PPLUS_ERROR")}</button>
                                                            `;
                                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                            `;
                                                        }
                                                    } else {
                                                        button_container.innerHTML = ``;
                                                    }


                                                    const unpublishedAt = new Date(product.unpublished_at);
                            
                                                    if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = unpublishedAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_LEFT_TO_REQUEST_COUNTDOWN_TAG")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }


                                                    const expiresAt = new Date(product.expires_at);

                                                    if (product.expires_at && !isNaN(expiresAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = expiresAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    const ReleasesAt = new Date(product.releases_at);
                            
                                                    if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = ReleasesAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_PUBLISHING_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    if (product.premium_type === 2) {
                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                        `;
                                                    }
                                                    
                                                    if (localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1" && product.type != 3000) {

                                                        if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen") {
                                                            let newLogInWithDiscordDismissible = document.createElement("div");
                                                
                                                            newLogInWithDiscordDismissible.innerHTML = `
                                                                <div class="newLogInWithDiscordDismissible-inner">
                                                                    <svg class="closeIcon_modal_discord_login" onclick="closeLoginDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-medium-title" style="margin-top: 0px;">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_TITLE")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_1")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_2")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <img src="https://cdn.yapper.shop/assets/178.png">
                                                                    <hr style="opacity: 0;">
                                                                    <button class="card-button" onclick="loginToDiscord()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_LOG_IN")}</button>
                                                                    <button class="card-button" onclick="closeLoginDismissibleCoachtip()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_NO_THANKS")}</button>
                                                                </div>
                                                                <div class="newLogInWithDiscordDismissible-pointer"></div>
                                                            `;
                                                
                                                            newLogInWithDiscordDismissible.classList.add('newLogInWithDiscordDismissible');
                                                
                                                            newLogInWithDiscordDismissible.id = `newLogInWithDiscordDismissible`;
                                                
                                                            modal.appendChild(newLogInWithDiscordDismissible);
                                                        }
                                                    }


                                                    let modal_back = document.createElement("div");

                                                    modal_back.classList.add('modalv2-back');
                                                    modal_back.id = 'modalv2-back';

                                                    document.body.appendChild(modal_back);

                                                    setTimeout(() => {
                                                        modal_back.classList.add('show');
                                                    }, 1);


                                                    modal.addEventListener('click', (event) => {
                                                        if (event.target === modal) {
                                                            modal.classList.remove('show');
                                                            modal_back.classList.remove('show');
                                                            setTimeout(() => {
                                                                modal.remove();
                                                                modal_back.remove();
                                                            }, 300);
                                                            removeParams('itemSkuId');
                                                            modalIsAlreadyOpen = false;
                                                        }
                                                    });

                                                    document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    });
                                                }
                                            } else if (product.type === "plus_more") {
                                                card.classList.add('clickable');

                                                card.addEventListener("click", (event) => {
                                                    if (event.target.matches("[data-shop-card-var]")) {
                                                    } else {
                                                        openItemModal();
                                                    }
                                                });

                                                async function openItemModal() {
                                                    let modal = document.createElement("div");

                                                    modal.classList.add('modalv2');

                                                    if (apiCategory.pdp_bg != null) {
                                                        pdp = apiCategory.pdp_bg
                                                    } else {
                                                        pdp = apiCategory.banner
                                                    }

                                                    modal.innerHTML = `
                                                        <div class="modalv2-inner">
                                                            <div class="modalv2-inner-left">
                                                                <div data-modal-left-preview-holder></div>
                                                                <p class="shop-modal-product-sku-id" data-product-modal-sku-id></p>
                                                                <p class="shop-modal-product-credits" data-product-modal-credits></p>
                                                                <p class="shop-modal-product-name" style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                                <p class="shop-modal-product-summary" style="color: var(--8)" data-product-modal-summary></p>
                                                                <div class="shop-modal-var-container-container" data-shop-modal-var-container-container>
                                                                    <div class="shop-modal-var-container" data-shop-modal-var-container></div>
                                                                    <a class="shop-modal-var-title" data-shop-modal-var-title></a>
                                                                </div>
                                                                <div class="modal-shop-price-container" data-shop-price-container>
                                                                    <div data-price-standard-container>
                                                                        <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                                                    </div>
                                                                    <div data-price-nitro-container>
                                                                        <a data-price-nitro></a>
                                                                    </div>
                                                                </div>
                                                                <div class="modal-left-bottom">
                                                                    <div class="modal-buttons" data-modal-buttons></div>
                                                                </div>
                                                            </div>
                                                            <img class="modalv2-inner-logo" src="https://cdn.yapper.shop/assets/${apiCategory.logo}.png"></img>
                                                            <div class="shop-modal-tag-container" data-shop-card-tag-container></div>

                                                            <div data-modal-top-product-buttons>
                                                                <div title="Close" data-close-product-card-button>
                                                                    <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                </div>
                                                                <div title="Download Data" data-download-product-card-button></div>
                                                            </div>

                                                            <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                                <img class="modalv2-inner-img" src="https://cdn.yapper.shop/assets/${pdp}.png"></img>
                                                                <div data-modal-preview-holder></div>
                                                            </div>
                                                        </div>
                                                    `;

                                                    document.body.appendChild(modal);

                                                    setTimeout(() => {
                                                        modal.classList.add('show');
                                                    }, 1);

                                                    modal.querySelector("[data-product-modal-name]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_TITLE")}`;
                                                    modal.querySelector("[data-product-modal-summary]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_DESC")}`;

                                                    const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                    previewHolder.classList.add('modal-plus-more-question-mark-img');

                                                    const plusMoreQuestionMark = document.createElement("img");
                                                    plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;

                                                    previewHolder.appendChild(plusMoreQuestionMark);

                                                    if (localStorage.reduced_motion != "true") {
                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                        });
                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                        });
                                                    }


                                                    const button_container = document.querySelector("[data-modal-buttons]");

                                                    button_container.innerHTML = ``;


                                                    const unpublishedAt = new Date(product.unpublished_at);
                            
                                                    if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = unpublishedAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_LEFT_TO_REQUEST_COUNTDOWN_TAG")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }


                                                    const expiresAt = new Date(product.expires_at);

                                                    if (product.expires_at && !isNaN(expiresAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = expiresAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    const ReleasesAt = new Date(product.releases_at);
                            
                                                    if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = ReleasesAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_PUBLISHING_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    if (product.premium_type === 2) {
                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                        `;
                                                    }
                                                    


                                                    let modal_back = document.createElement("div");

                                                    modal_back.classList.add('modalv2-back');
                                                    modal_back.id = 'modalv2-back';

                                                    document.body.appendChild(modal_back);

                                                    setTimeout(() => {
                                                        modal_back.classList.add('show');
                                                    }, 1);


                                                    modal.addEventListener('click', (event) => {
                                                        if (event.target === modal) {
                                                            modal.classList.remove('show');
                                                            modal_back.classList.remove('show');
                                                            setTimeout(() => {
                                                                modal.remove();
                                                                modal_back.remove();
                                                            }, 300);
                                                            removeParams('itemSkuId');
                                                            modalIsAlreadyOpen = false;
                                                        }
                                                    });

                                                    document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    });
                                                }
                                            }
                                        }


                                        const unpublishedAt = new Date(product.unpublished_at);
                            
                                        if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = unpublishedAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("CARD_LEFT_TO_REQUEST_COUNTDOWN_TAG")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }


                                        const ExpiredAt = new Date(product.expires_at);
                            
                                        if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = ExpiredAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }

                                        const ReleasesAt = new Date(product.releases_at);
                            
                                        if (product.releases_at && !isNaN(ReleasesAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = ReleasesAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_PUBLISHING_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_PUBLISHING_COUNTDOWN_TAG_HOURS")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }

                                        // Append card to output
                                        card.classList.add('shop-category-card-transparent')
                                        cardOutput.append(card);

                                        scrollToSKU(product.sku_id);
                                    }
                                }
            
                                categoryOutput.append(category);

                                scrollToSKU(apiCategory.sku_id);


                                const paper_beach2_banner = document.getElementById(PAPER_BEACH_V2);
                                const geometry_dash_banner = document.getElementById(GEOMETRY_DASH);
                                const special_event_plus_banner = document.getElementById(PLUS_SPECIAL_EVENT);
                                const fnaf_banner = document.getElementById(FIVE_NIGHTS_AT_FREDDYS);
                                const windowkill2_banner = document.getElementById(WINDOWKILL_V2);
                                const paper_beach_banner = document.getElementById(PAPER_BEACH);
                                const bopl_battle_banner = document.getElementById(BOPL_BATTLE);
                                const windowkill_banner = document.getElementById(WINDOWKILL);

                                if (localStorage.disable_client_banner_overrides != "true") {
                                    
                                    if (paper_beach2_banner) {
                                        document.getElementById(`${PAPER_BEACH_V2}-banner-banner-container`).innerHTML = `
                                            <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/assets/112.png">
                                            <img class="paper-beach-sun-banner-decoration" src="https://cdn.yapper.shop/assets/116.png">
                                        `;
                                        document.getElementById(`${PAPER_BEACH_V2}-logo-container`).innerHTML = `
                                            <img class="shop-category-banner-logo-1 shop-logo-sway" src="https://cdn.yapper.shop/assets/115.png" id="shop-banner-logo">
                                        `;
                                    }
                                    
                                    if (windowkill2_banner) {
                                        document.getElementById(WINDOWKILL_V2).innerHTML = `
                                            <img class="shop-category-condensed-banner-img" src="https://cdn.yapper.shop/assets/86.png">
                                            <div class="shop-category-condensed-logo-holder" style="left: 23%;">
                                                <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/assets/53.png" id="shop-banner-logo">
                                            </div>
                                        `;
                                    }
                                    
                                    if (paper_beach_banner) {
                                        document.getElementById(PAPER_BEACH).innerHTML = `
                                            <img class="shop-category-condensed-banner-img" src="https://cdn.yapper.shop/assets/3.png">
                                            <div class="shop-category-condensed-logo-holder" style="right: -6%;">
                                                <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/assets/1.png" id="shop-banner-logo">
                                            </div>
                                        `;
                                    }
                                    
                                    if (bopl_battle_banner) {
                                        document.getElementById(BOPL_BATTLE).innerHTML = `
                                            <img class="shop-category-condensed-banner-img" src="https://cdn.yapper.shop/assets/92.png">
                                            <div class="shop-category-condensed-logo-holder" style="left: 15%;">
                                                <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/assets/60.png" id="shop-banner-logo">
                                            </div>
                                        `;
                                    }
                                }


                                

                            } else if (page === "consumables") {
                                // Existing code for 'consumables' page
                                const potionCard = potionTemplate.content.cloneNode(true).children[0];
                                potionCard.querySelector("[data-potion-card-holder]").id = apiCategory.sku_id;

                                potionCard.id = apiCategory.sku_id;

                                potionCard.querySelector("[data-potion-card-holder]").classList.add('potion-card-gradient1');
            
                                if (apiCategory.src === null) {
                                    potionCard.querySelector("[data-potion-card-preview-image]").src = `https://cdn.yapper.shop/assets/31.png`;
                                } else {
                                    potionCard.querySelector("[data-potion-card-preview-image]").src = `https://cdn.yapper.shop/${apiCategory.endpoint}/${apiCategory.src}.${apiCategory.format}`;
                                }
                                potionCard.querySelector("[data-potion-card-preview-image]").alt = apiCategory.name;

                                if (apiCategory.new_text != null) {
                                    potionCard.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                        <div class="unplublished-tag">
                                            <p class="unplublished-tag-text">${apiCategory.new_text}</p>
                                        </div>
                                    `;
                                }
            
                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                    potionCard.querySelector("[data-product-card-sku-id]").textContent = ``;
                                } else {
                                    potionCard.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${apiCategory.sku_id}`;
                                }
                                potionCard.querySelector("[data-product-card-name]").textContent = apiCategory.name;
                                potionCard.querySelector("[data-product-card-summary]").textContent = apiCategory.summary;

                                let priceStandard = "N/A";
                        
                                if (apiCategory.price) {
                                    priceStandard = apiCategory.price.amount;
                                }


                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                    potionCard.classList.add('clickable');

                                    potionCard.addEventListener("click", (event) => {
                                        if (event.target.matches(".card-button")) {
                                        } else {
                                            openItemModal();
                                        }
                                    });

                                    async function openItemModal() {
                                        let modal = document.createElement("div");

                                        modal.classList.add('modalv2');

                                        if (apiCategory.pdp_bg != null) {
                                            pdp = apiCategory.pdp_bg
                                        } else {
                                            pdp = apiCategory.banner
                                        }

                                        modal.innerHTML = `
                                            <div class="modalv2-inner">
                                                <div class="modalv2-inner-left">
                                                    <p class="shop-modal-product-sku-id" data-product-modal-sku-id></p>
                                                    <p class="shop-modal-product-name" style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                    <p class="shop-modal-product-summary" style="color: var(--8)" data-product-modal-summary></p>
                                                    <div class="modal-shop-price-container" data-shop-price-container>
                                                        <div data-price-standard-container>
                                                            <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                                        </div>
                                                    </div>
                                                    <div class="modal-left-bottom">
                                                        <div class="modal-buttons" data-modal-buttons></div>
                                                    </div>
                                                </div>
                                                
                                                <div data-modal-top-product-buttons>
                                                    <div title="Close" data-close-product-card-button>
                                                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                    </div>
                                                    <div title="Download Data" data-download-product-card-button></div>
                                                </div>

                                                <div class="shop-modal-tag-container" data-shop-card-tag-container></div>

                                                <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                    <img class="modalv2-inner-img" src="https://cdn.yapper.shop/assets/110.svg"></img>
                                                    <div data-modal-preview-holder></div>
                                                </div>
                                            </div>
                                        `;

                                        document.body.appendChild(modal);

                                        setTimeout(() => {
                                            modal.classList.add('show');
                                        }, 1);


                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                        previewHolder.classList.add('modal-potion-img');

                                        const imgElement = document.createElement("img");
                                        imgElement.classList.add('potion-card-preview');
                                        imgElement.src = `https://cdn.yapper.shop/${apiCategory.endpoint}/${apiCategory.src}.${apiCategory.format}`;

                                        previewHolder.appendChild(imgElement);
                                        
                                        // Set the product details
                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${apiCategory.sku_id}`;
                                        modal.querySelector("[data-product-modal-name]").textContent = apiCategory.name;
                                        modal.querySelector("[data-product-modal-summary]").textContent = apiCategory.summary;


                                        const button_container = document.querySelector("[data-modal-buttons]");
                                        
                                        if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads") {
                                            button_container.innerHTML = `
                                                <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                            `;
                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                            `;
                                        } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+") {
                                            button_container.innerHTML = `
                                                <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                            `;
                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                            `;
                                        } else if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                            button_container.innerHTML = `
                                                <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                            `;
                                            modal.querySelector("[data-download-product-card-button]").innerHTML = `
                                                <svg class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                            `;
                                        } else {
                                            button_container.innerHTML = `
                                                <button class="card-button" title="Open this Potion's support article" onclick="location.href='${discordsupport}${apiCategory.support_id}';">Open Support Article</button>
                                            `;
                                        }


                                        let priceStandard = "N/A";
                        
                                        if (apiCategory.price) {
                                            priceStandard = apiCategory.price.amount;
                                        }


                                        const priceTextNitro = modal.querySelector("[data-price-nitro]");
                                        const priceTextStandard = modal.querySelector("[data-price-standard]");

                                        const priceContainerNitro = modal.querySelector("[data-price-nitro-container]");
                                        const priceContainerStandard = modal.querySelector("[data-price-standard-container]");

                                        const priceContainer = modal.querySelector("[data-shop-price-container]");

                                        if (localStorage.experiment_2025_01_orb_testing === "Treatment 1: Default Prices") {
                                            if (priceTextStandard) {
                                                priceTextStandard.textContent = priceStandard !== "N/A" ? `${priceStandard}` : "Price (USD): N/A";
                                            }
                                        
                                            let orb_icon = document.createElement("div");
                                        
                                            orb_icon.classList.add('orb-icon');
                                        
                                            priceContainerStandard.appendChild(orb_icon);
                                        
                                        } else if (localStorage.experiment_2025_01_orb_testing === "Treatment 2: 50 Orbs") {
                                            if (priceTextStandard) {
                                                priceTextStandard.textContent = `50`;
                                            }
                                        
                                            let orb_icon = document.createElement("div");
                                        
                                            orb_icon.classList.add('orb-icon');
                                        
                                            priceContainerStandard.appendChild(orb_icon);
                                        
                                        } else if (localStorage.experiment_2025_01_orb_testing === "Treatment 3: Dynamic") {

                                            if (apiCategory.price.currency === "discord_orb") {
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = priceStandard !== "N/A" ? `${priceStandard}` : "Price (USD): N/A";
                                                }
                                            
                                                let orb_icon = document.createElement("div");
                                            
                                                orb_icon.classList.add('orb-icon');
                                            
                                                priceContainerStandard.appendChild(orb_icon);
                                            
                                            } else {
                                                if (priceTextStandard) {
                                                    priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "Price (USD): N/A";
                                                }
                                            }

                                        } else {
                                            if (priceTextStandard) {
                                                priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "Price (USD): N/A";
                                            }
                                        }

                                        if (apiCategory.new_text != null) {
                                            modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="unplublished-tag">
                                                    <p class="unplublished-tag-text">${apiCategory.new_text}</p>
                                                </div>
                                            `;
                                        }


                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                            modal.classList.add('potion-wobble')
                                        });
                                
                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                            modal.classList.remove('potion-wobble')
                                        });
                                        


                                        let modal_back = document.createElement("div");

                                        modal_back.classList.add('modalv2-back');
                                        modal_back.id = 'modalv2-back';

                                        document.body.appendChild(modal_back);

                                        setTimeout(() => {
                                            modal_back.classList.add('show');
                                        }, 1);


                                        modal.addEventListener('click', (event) => {
                                            if (event.target === modal) {
                                                modal.classList.remove('show');
                                                modal_back.classList.remove('show');
                                                setTimeout(() => {
                                                    modal.remove();
                                                    modal_back.remove();
                                                }, 300);
                                            }
                                        });

                                        document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                            modal.classList.remove('show');
                                            modal_back.classList.remove('show');
                                            setTimeout(() => {
                                                modal.remove();
                                                modal_back.remove();
                                            }, 300);
                                        });
                                    }
                                }
                        
                                
                                const priceTextNitro = potionCard.querySelector("[data-price-nitro]");
                                const priceTextStandard = potionCard.querySelector("[data-price-standard]");

                                const priceContainerNitro = potionCard.querySelector("[data-price-nitro-container]");
                                const priceContainerStandard = potionCard.querySelector("[data-price-standard-container]");

                                const priceContainer = potionCard.querySelector("[data-shop-price-container]");

                                if (localStorage.experiment_2025_01_orb_testing === "Treatment 1: Default Prices") {
                                    if (priceTextStandard) {
                                        priceTextStandard.textContent = priceStandard !== "N/A" ? `${priceStandard}` : "Price (USD): N/A";
                                    }
                                
                                    let orb_icon = document.createElement("div");
                                
                                    orb_icon.classList.add('orb-icon');
                                
                                    priceContainerStandard.appendChild(orb_icon);
                                
                                } else if (localStorage.experiment_2025_01_orb_testing === "Treatment 2: 50 Orbs") {
                                    if (priceTextStandard) {
                                        priceTextStandard.textContent = `50`;
                                    }
                                
                                    let orb_icon = document.createElement("div");
                                
                                    orb_icon.classList.add('orb-icon');
                                
                                    priceContainerStandard.appendChild(orb_icon);
                                
                                } else {
                                    if (priceTextStandard) {
                                        priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "Price (USD): N/A";
                                    }
                                }

                                if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 1: Enabled" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button") {
                                    potionCard.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                        <div class="card-multi-button-container" card-multi-button-container>
                                            <button class="card-button" onclick="location.href='${discordsupport}${apiCategory.support_id}';" title="${getTextString("CARD_OPEN_SUPPORT_ARTICLE_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP_V2")}</button>
                                            <button class="card-button" onclick="copyEmoji('${apiCategory.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                        </div>
                                    `;
                                } else {
                                    potionCard.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                        <button class="card-button" onclick="location.href='${discordsupport}${apiCategory.support_id}';" title="${getTextString("CARD_OPEN_SUPPORT_ARTICLE_TITLE")}">${getTextString("CARD_OPEN_SUPPORT_ARTICLE")}</button>
                                    `;
                                }

                                potionCard.addEventListener("mouseenter", () => {
                                    potionCard.classList.add('potion-wobble')
                                });
                        
                                potionCard.addEventListener("mouseleave", () => {
                                    potionCard.classList.remove('potion-wobble')
                                });
            
                                categoryOutput.append(potionCard);
                            } else if (page === "marketing") {
                                if (localStorage.experiment_2025_04_collectibles_marketing_page === "Treatment 1: Enabled") {
                                    const category = categoryTemplate.content.cloneNode(true).children[0];
                                    category.querySelector("[data-shop-category-banner]").id = apiCategory.sku_id;
            
                                    if (apiCategory.banner_asset) {
                                        if (apiCategory.banner_asset.animated != null) {
                                            if (apiCategory.banner_asset.static != null) {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="${apiCategory.banner_asset.static}">
                                                    <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                                `;
                                            } else {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                                `;
                                            }
                                        } else if (apiCategory.banner_asset.static != null) {
                                            category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.banner_asset.static}`;
                                        }
                                    } else {
                                        category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.banner}.png`;
                                        category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                    }
            
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.logo}.png`;
                                    category.querySelector("[data-shop-category-logo-image]").alt = apiCategory.name;
                                    category.querySelector("[data-shop-category-logo-image]").classList.add("shop-category-condensed-banner-img");
            
                                    category.querySelector("[data-shop-category-desc]").id = `${apiCategory.sku_id}-summary`;
                                    category.querySelector("[data-shop-category-desc]").textContent = apiCategory.summary;
                                    if (apiCategory.banner_text_color && apiCategory.banner_text_color != null) {
                                        category.querySelector("[data-shop-category-desc]").style.color = apiCategory.banner_text_color;
                                    }

                                    category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-banner-banner-container`;
                                    category.querySelector("[data-shop-category-logo-holder]").id = `${apiCategory.sku_id}-logo-container`;
                                    category.querySelector("[data-shop-discord-watermark-container]").id = `${apiCategory.sku_id}-discord-watermark-container`;


                                    const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                    if (cardOutput) {
                                        for (const product of apiCategory.products) {
                                            const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                            const card = cardTemplate.content.cloneNode(true).children[0];

                                            card.id = product.sku_id;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                            previewHolder.classList.add('avatar-decoration-image');

                                            
                                            if (apiCategory.type === 0) {
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${product.asset}.png?size=4096&passthrough=false`;

                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                bgimg.style.backgroundImage = `url('${product.src}')`;

                                                previewHolder.appendChild(bgimg);

                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_SHOP_MARKETING_ID")}${product.id}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${product.asset}.png?size=4096&passthrough=true`;
                                                    });

                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${product.asset}.png?size=4096&passthrough=false`;
                                                    });
                                                }

                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="location.href='https://item.yapper.shop/marketing/${product.id}/data.zip';">${getTextString("CARD_DOWNLOAD_MARKETING_DATA")}</button>
                                                `;
                                            } else if (apiCategory.type === 1) {
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${product.asset}.png`;

                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                bgimg.style.backgroundImage = `url('${product.src}')`;

                                                previewHolder.appendChild(bgimg);

                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_SHOP_MARKETING_ID")}${product.id}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${product.asset}.png`;
                                                    });

                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${product.asset}.png`;
                                                    });
                                                }

                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <button class="card-button" onclick="location.href='https://item.yapper.shop/profiles-plus-marketing/${product.id}/data.zip';">${getTextString("CARD_DOWNLOAD_MARKETING_DATA")}</button>
                                                `;
                                            } else {
                                                card.classList.add("hidden");
                                            }

                                            cardOutput.append(card);
                                        }
                                    }
            
                                    categoryOutput.append(category);
                                } else if (localStorage.experiment_2025_04_collectibles_marketing_page === "Treatment 2: Enable v2") {
                                    const category = categoryTemplate.content.cloneNode(true).children[0];
                                    category.querySelector("[data-shop-category-banner]").id = apiCategory.sku_id;
            
                                    if (apiCategory.banner_asset) {
                                        if (apiCategory.banner_asset.animated != null) {
                                            if (apiCategory.banner_asset.static != null) {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="${apiCategory.banner_asset.static}">
                                                    <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                                `;
                                            } else {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                                `;
                                            }
                                        } else if (apiCategory.banner_asset.static != null) {
                                            category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.banner_asset.static}`;
                                        }
                                    } else {
                                        category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.banner}.png`;
                                        category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                    }
            
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/${apiCategory.logo}.png`;
                                    category.querySelector("[data-shop-category-logo-image]").alt = apiCategory.name;
                                    category.querySelector("[data-shop-category-logo-image]").classList.add("shop-category-condensed-banner-img");
            
                                    category.querySelector("[data-shop-category-desc]").id = `${apiCategory.sku_id}-summary`;
                                    category.querySelector("[data-shop-category-desc]").textContent = apiCategory.summary;
                                    if (apiCategory.banner_text_color && apiCategory.banner_text_color != null) {
                                        category.querySelector("[data-shop-category-desc]").style.color = apiCategory.banner_text_color;
                                    }

                                    category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-banner-banner-container`;
                                    category.querySelector("[data-shop-category-logo-holder]").id = `${apiCategory.sku_id}-logo-container`;
                                    category.querySelector("[data-shop-discord-watermark-container]").id = `${apiCategory.sku_id}-discord-watermark-container`;

                                    category.querySelector("[data-shop-category-banner]").innerHTML = `
                                        <img class="shop-category-condensed-banner-img" src="https://cdn.yapper.shop/assets/180.png">
                                        <div class="shop-category-condensed-logo-holder" style="left: 23%;">
                                            <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/assets/181.png" id="shop-banner-logo">
                                        </div>
                                    `;


                                    const cardOutput = category.querySelector("[data-shop-category-card-holder]");
                                    if (cardOutput) {
                                        const sortedData = apiCategory.products.sort((b, a) => a.id - b.id);
                                        for (const product of sortedData) {
                                            const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                            const card = cardTemplate.content.cloneNode(true).children[0];

                                            card.classList.add("shop-marketing-card");
                                            card.innerHTML = `
                                                <div data-shop-card-preview-holder  style="position: absolute; z-index: 1; left: 10px; margin-top: 0px; height: 150px; width: 150px; scale: 0.9;" class="avatar-decoration-image"></div>
                                                <img class="shop-category-banner-img" style="position: absolute; right: 0px; top: 0px; filter: blur(5px); width: 1200px;" src="https://cdn.yapper.shop/assets/31.png" data-marketing-shop-card-bg>
                                                <div class="card-bottom" style="background-color: unset; backdrop-filter: unset;">
                                                    <div class="shop-marketing-silly-crap-container" data-modal-top-product-buttons>
                                                        <div title="Copy Download Link">
                                                            <svg class="shareIcon_modal" onclick="copyEmoji('https://item.yapper.shop/marketing/${product.id}'); copyNotice('copylink');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                        </div>
                                                        <div title="View Raw">
                                                            <svg data-view-raw-product-card-button class="shareIcon_modal" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.7376 3.18925C15.4883 2.93731 15.0814 2.93686 14.8316 3.18824L14.0087 4.01625C13.7618 4.26471 13.7614 4.66581 14.0078 4.91476L20.3804 11.3527C20.6265 11.6013 20.6265 12.0017 20.3804 12.2503L14.0078 18.6882C13.7614 18.9373 13.7618 19.3383 14.0087 19.5867L14.8316 20.4148C15.0814 20.6662 15.4883 20.6658 15.7376 20.4138L23.815 12.2503C24.061 12.0016 24.061 11.6014 23.815 11.3528L15.7376 3.18925Z" fill="currentColor"></path><path d="M9.99171 4.91476C10.2381 4.66581 10.2377 4.26471 9.99081 4.01625L9.16787 3.18824C8.91804 2.93686 8.51118 2.93731 8.2619 3.18925L0.184466 11.3528C-0.0614893 11.6014 -0.061488 12.0016 0.184466 12.2503L8.2619 20.4138C8.51118 20.6658 8.91803 20.6662 9.16787 20.4148L9.99081 19.5867C10.2377 19.3383 10.2381 18.9373 9.99171 18.6882L3.61906 12.2503C3.37298 12.0017 3.37298 11.6013 3.61906 11.3527L9.99171 4.91476Z" fill="currentColor"></path></svg>
                                                        </div>
                                                    </div>
                                                    <a class="item-credits" style="margin-left: 186px; z-index: 2;" data-product-card-sku-id>Failed to load ID</a>
                                                    <h3 style="margin-left: 186px; z-index: 2;" data-product-card-name>Failed to load name</h3>
                                                    <p class="shop-card-summary" style="margin-left: 186px; z-index: 2;" data-product-card-summary>Failed to load summary</p>
                                                </div>
                                                <p style="display: none; z-index: 1; position: absolute; top: 10px; right: 305px;" data-shop-tab-preview-text>${getTextString("CARD_MARKETING_SHOP_TAB_PREVIEW_TEXT")}</p>
                                                <div class="dm-button" style="display: none; position: absolute; top: 45px; right: 200px; overflow: hidden;" title="${getTextString("CARD_MARKETING_SHOP_TAB_PREVIEW_TITLE")}" data-shop-tab-preview>
                                                    <img style="position: absolute; bottom: 0px; right: 0px; width: 270px;" src="https://cdn.yapper.shop/assets/31.png" data-shop-tab-preview-img>
                                                    <svg style="margin-left: 10px; margin-top: 14px; z-index: 1;" class="linkButtonIcon__972a0" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M2.63 4.19A3 3 0 0 1 5.53 2H7a1 1 0 0 1 1 1v3.98a3.07 3.07 0 0 1-.3 1.35A2.97 2.97 0 0 1 4.98 10c-2 0-3.44-1.9-2.9-3.83l.55-1.98ZM10 2a1 1 0 0 0-1 1v4a3 3 0 0 0 3 3 3 3 0 0 0 3-2.97V3a1 1 0 0 0-1-1h-4ZM17 2a1 1 0 0 0-1 1v3.98a2.43 2.43 0 0 0 0 .05A2.95 2.95 0 0 0 19.02 10c2 0 3.44-1.9 2.9-3.83l-.55-1.98A3 3 0 0 0 18.47 2H17Z" class=""></path><path fill="currentColor" d="M21 11.42V19a3 3 0 0 1-3 3h-2.75a.25.25 0 0 1-.25-.25V16a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v5.75c0 .14-.11.25-.25.25H6a3 3 0 0 1-3-3v-7.58c0-.18.2-.3.37-.24a4.46 4.46 0 0 0 4.94-1.1c.1-.12.3-.12.4 0a4.49 4.49 0 0 0 6.58 0c.1-.12.3-.12.4 0a4.45 4.45 0 0 0 4.94 1.1c.17-.07.37.06.37.24Z" class=""></path></svg>
                                                    <p style="z-index: 1;" class="dm-button-text">${getTextString("CARD_MARKETING_SHOP_TAB_PREVIEW")}</p>
                                                </div>
                                                <div class="card-button-container" style="position: absolute; width: 550px; left: 475px;" data-product-card-open-in-shop></div>
                                            `;

                                            if (product.raw != null && product.raw.marketings["2"] && product.raw.marketings["2"].asset != null) {
                                                card.querySelector("[data-marketing-shop-card-bg]").src = product.raw.marketings["2"].asset;
                                            }

                                            if (product.raw != null && product.raw.marketings["0"] && product.raw.marketings["0"].ref_target_background != null) {
                                                card.querySelector("[data-shop-tab-preview]").style.display = 'flex';
                                                card.querySelector("[data-shop-tab-preview-text]").style.display = 'flex';
                                                if (product.raw != null && product.raw.marketings["0"] && product.raw.marketings["0"].ref_target_background != null && product.raw.marketings["0"].ref_target_background.asset.resting.dark && product.raw.marketings["0"].ref_target_background.asset.resting.dark != null) {
                                                    card.querySelector("[data-shop-tab-preview-img]").src = product.raw.marketings["0"].ref_target_background.asset.resting.dark;
                                                }
                                                card.addEventListener("mouseenter", () => {
                                                    if (product.raw.marketings["0"].ref_target_background.asset.hovered.dark != null) {
                                                        card.querySelector("[data-shop-tab-preview-img]").src = product.raw.marketings["0"].ref_target_background.asset.hovered.dark;
                                                    }
                                                });
    
                                                card.addEventListener("mouseleave", () => {
                                                    if (product.raw.marketings["0"].ref_target_background.asset.resting.dark != null) {
                                                        card.querySelector("[data-shop-tab-preview-img]").src = product.raw.marketings["0"].ref_target_background.asset.resting.dark;
                                                    } else {
                                                        card.querySelector("[data-shop-tab-preview-img]").src = 'https://cdn.yapper.shop/assets/31.png';
                                                    }
                                                });
    
                                                if (product.raw != null && product.raw.marketings["0"] && product.raw.marketings["0"].ref_target_background != null && product.raw.marketings["0"].ref_target_background.style.resting.dark && product.raw.marketings["0"].ref_target_background.style.resting.dark != null) {
                                                    card.querySelector("[data-shop-tab-preview]").style.backgroundImage = product.raw.marketings["0"].ref_target_background.style.resting.dark;
                                                }
                                                card.addEventListener("mouseenter", () => {
                                                    if (product.raw.marketings["0"].ref_target_background.style.hovered.dark != null) {
                                                        card.querySelector("[data-shop-tab-preview]").style.backgroundImage = product.raw.marketings["0"].ref_target_background.style.hovered.dark;
                                                    }
                                                });
    
                                                card.addEventListener("mouseleave", () => {
                                                    if (product.raw.marketings["0"].ref_target_background.style.resting.dark != null) {
                                                        card.querySelector("[data-shop-tab-preview]").style.backgroundImage = product.raw.marketings["0"].ref_target_background.style.resting.dark;
                                                    }
                                                });
                                            }

                                            card.querySelector("[data-view-raw-product-card-button]").onclick = function(){
                                                openRawModal();
                                            };

                                            async function openRawModal() {
                                                let modal = document.createElement("div");
        
                                                modal.classList.add('modalv2');
        
                                                modal.innerHTML = `
                                                    <div class="view-raw-modalv2-inner">
                                                        <textarea class="view-raw-modal-textbox" readonly>${JSON.stringify(product.raw, undefined, 4)}</textarea>
                                                    </div>
                                                `;
        
                                                document.body.appendChild(modal);
        
                                                setTimeout(() => {
                                                    modal.classList.add('show');
                                                }, 1);
                                                
        
                                                let modal_back = document.createElement("div");
        
                                                modal_back.classList.add('modalv2-back');
                                                modal_back.id = 'modalv2-back';
        
                                                document.body.appendChild(modal_back);
        
                                                setTimeout(() => {
                                                    modal_back.classList.add('show');
                                                }, 1);
        
        
                                                modal.addEventListener('click', (event) => {
                                                    if (event.target === modal) {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    }
                                                });
                                            }

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            
                                            if (apiCategory.type === 0) {
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${product.asset}.png?size=4096&passthrough=false`;
                                                imgElement.style.height = `150px`;
                                                imgElement.style.width = `150px`;

                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                bgimg.style.backgroundImage = `url('${product.src}')`;
                                                bgimg.style.height = `150px`;
                                                bgimg.style.width = `150px`;

                                                previewHolder.appendChild(bgimg);

                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_SHOP_MARKETING_ID")}${product.id}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                                if (product.raw != null && product.raw.marketings["2"] && product.raw.marketings["2"].revert_text_color === true) {
                                                    card.querySelector("[data-product-card-sku-id]").style.color = `black`;
                                                    card.querySelector("[data-product-card-name]").style.color = `black`;
                                                    card.querySelector("[data-product-card-summary]").style.color = `black`;
                                                } 

                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${product.asset}.png?size=4096&passthrough=true`;
                                                    });

                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${product.asset}.png?size=4096&passthrough=false`;
                                                    });
                                                }

                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="location.href='https://item.yapper.shop/marketing/${product.id}/data.zip';">${getTextString("CARD_DOWNLOAD_MARKETING_DATA")}</button>
                                                        <button class="card-button" onclick="setParams({page: 'shop'}); addParams({scrollTo: '${product.category_sku_id}'}); location.reload();">${getTextString("CARD_MARKETING_GO_TO_CATEGORY")}</button>
                                                    </div>
                                                `;
                                            } else if (apiCategory.type === 1) {
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${product.asset}.png`;
                                                imgElement.style.height = `150px`;
                                                imgElement.style.width = `150px`;

                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                bgimg.style.backgroundImage = `url('${product.src}')`;
                                                bgimg.style.height = `150px`;
                                                bgimg.style.width = `150px`;

                                                previewHolder.appendChild(bgimg);

                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = `${getTextString("CARD_SHOP_MARKETING_ID")}${product.id}`;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                                if (product.raw != null && product.raw.marketings["2"] && product.raw.marketings["2"].revert_text_color === true) {
                                                    card.querySelector("[data-product-card-sku-id]").style.color = `black`;
                                                    card.querySelector("[data-product-card-name]").style.color = `black`;
                                                    card.querySelector("[data-product-card-summary]").style.color = `black`;
                                                } 

                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/a_${product.asset}.png`;
                                                    });

                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.yapper.shop/custom-collectibles/avatar-decorations/${product.asset}.png`;
                                                    });
                                                }

                                                card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                    <div class="card-multi-button-container" card-multi-button-container>
                                                        <button class="card-button" onclick="location.href='https://item.yapper.shop/profiles-plus-marketing/${product.id}/data.zip';">${getTextString("CARD_DOWNLOAD_MARKETING_DATA")}</button>
                                                        <button class="card-button" onclick="setParams({page: 'pplus'}); addParams({scrollTo: '${product.category_sku_id}'}); location.reload();">${getTextString("CARD_MARKETING_GO_TO_CATEGORY")}</button>
                                                    </div>
                                                `;
                                            } else {
                                                card.classList.add("hidden");
                                            }

                                            cardOutput.append(card);
                                        }
                                    }
            
                                    categoryOutput.append(category);
                                }

                            } else {
                                // Default page handling
                                const category = categoryTemplate.content.cloneNode(true).children[0];
                                category.querySelector("[data-shop-category-banner]").id = apiCategory.sku_id;


                                // Category info modals

                                if (localStorage.experiment_2025_02_shop_category_modals === "Treatment 1: Enable category modals" || localStorage.experiment_2025_02_shop_category_modals === "Treatment 2: Enable category modals w/ data downloads") {
                                    category.querySelector("[data-shop-category-banner]").classList.add('clickable')
                                }


                                // Banner Image/Video asset
            
                                if (apiCategory.banner_asset) {
                                    if (apiCategory.banner_asset.animated != null) {
                                        if (localStorage.reduced_motion != "true") {
                                            if (apiCategory.banner_asset.static != null) {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="${apiCategory.banner_asset.static}">
                                                    <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                                `;
                                            } else {
                                                category.querySelector("[data-shop-banner-banner-container]").innerHTML = `
                                                    <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="${apiCategory.banner_asset.animated}" loop></video>
                                                `;
                                            }
                                        } else if (apiCategory.banner_asset.static != null) {
                                            category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.banner_asset.static}`;
                                        } else {
                                            category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.banner}.png?size=4096`;
                                            category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                        }
                                    } else if (apiCategory.banner_asset.static != null) {
                                        category.querySelector("[data-shop-category-banner-image]").src = `${apiCategory.banner_asset.static}`;
                                    }
                                } else {
                                    category.querySelector("[data-shop-category-banner-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.banner}.png?size=4096`;
                                    category.querySelector("[data-shop-category-banner-image]").alt = apiCategory.name;
                                }
                                

                                category.querySelector("[data-shop-banner-banner-container]").id = `${apiCategory.sku_id}-banner-banner-container`;

                                category.querySelector("[data-shop-category-marketing-bg]").remove();


                                // Logo Image/Video asset
            
                                if (apiCategory.logo != null) {
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.logo}.png?size=4096`;
                                } else {
                                    category.querySelector("[data-shop-category-logo-image]").src = `https://cdn.yapper.shop/assets/31.png`;
                                }
                                category.querySelector("[data-shop-category-logo-image]").alt = apiCategory.name;

                                category.querySelector("[data-shop-category-logo-holder]").id = `${apiCategory.sku_id}-logo-container`;


            
                                category.querySelector("[data-shop-category-desc]").id = `${apiCategory.sku_id}-summary`;
                                category.querySelector("[data-shop-category-desc]").textContent = apiCategory.summary;
                                if (apiCategory.banner_text_color && apiCategory.banner_text_color != null) {
                                    category.querySelector("[data-shop-category-desc]").style.color = apiCategory.banner_text_color;
                                }


                                category.querySelector("[data-shop-discord-watermark-container]").id = `${apiCategory.sku_id}-discord-watermark-container`;


                                if (apiCategory.sku_id === discord_categories.FANTASY) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.ANIME) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.BREAKFAST) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.DISXCORE) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.FALL) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.HALLOWEEN) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.WINTER) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.MONSTERS) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.CYBERPUNK) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.LUNAR_NEW_YEAR) {
                                    if (apiCategory.banner === "1202069953306689626") {
                                        category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                        category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                    }
                                }
                                if (apiCategory.sku_id === discord_categories.ELEMENTS) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.ANIME_V2) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                    category.querySelector("[data-shop-category-desc]").style.color = 'black';
                                }
                                if (apiCategory.sku_id === discord_categories.SPRINGTOONS) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                    category.querySelector("[data-shop-category-desc]").style.color = 'black';
                                }
                                if (apiCategory.sku_id === discord_categories.SHY) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.LOFI_VIBES) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.GALAXY) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.FEELIN_RETRO) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.PIRATES) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.ARCADE) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.TIDE) {
                                    category.querySelector("[data-shop-category-logo-holder]").style.display = 'unset';
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.DARK_FANTASY) {
                                    category.querySelector("[data-shop-discord-watermark-container]").style.display = 'unset';
                                }
                                if (apiCategory.sku_id === discord_categories.ROBERT) {
                                    category.querySelector("[data-shop-category-desc]").style.color = 'black';
                                }
                                if (apiCategory.sku_id === discord_categories.DOJO) {
                                    category.querySelector("[data-shop-category-desc]").style.color = 'black';
                                }
                                if (apiCategory.sku_id === discord_categories.KAWAII_MODE) {
                                    category.querySelector("[data-shop-category-desc]").style.color = 'black';
                                }

                                if (localStorage.experiment_2025_02_shop_category_modals === "Treatment 1: Enable category modals" || localStorage.experiment_2025_02_shop_category_modals === "Treatment 2: Enable category modals w/ data downloads") {
                                    category.querySelector("[data-shop-category-banner]").classList.add('clickable');

                                    category.querySelector("[data-shop-category-banner]").addEventListener("click", () => {
                                        openCategoryModal();
                                        addParams({itemSkuId: apiCategory.sku_id})
                                    });

                                    const itemSKUForScroll = params.get("itemSkuId");

                                    if (itemSKUForScroll === apiCategory.sku_id && modalIsAlreadyOpen != true) {
                                        modalIsAlreadyOpen = true;
                                        setTimeout(() => {
                                            openCategoryModal();
                                        }, 1000);
                                    }
                                    

                                    async function openCategoryModal() {
                                        let modal = document.createElement("div");

                                        modal.classList.add('modalv2');

                                        let categoryModalTabCache = null;

                                        modal.innerHTML = `
                                            <div class="category-modalv2-inner">
                                                <div class="category-modalv2-inner-left">
                                                    <p class="category-modal-text-sku-id" data-product-modal-sku-id></p>
                                                    <p class="category-modal-text-name" data-product-modal-name></p>
                                                    <p class="category-modal-text-summary" data-product-modal-summary></p>
                                                    <p class="category-modal-text-item-count">${getTextString("SHOP_CATEGORY_MODAL_ITEM_COUNT")}${apiCategory.products.length}</p>
                                                    <div class="category-modal-content-container" data-category-modal-content-container>
                                                        <div class="change-category-modal-content-button selected" data-shop-category-modal-tabs-tab-button-1>
                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_ASSETS_TAB")}</p>
                                                        </div>
                                                        <div class="change-category-modal-content-button" style="display: none;" data-shop-category-modal-tabs-tab-button-2>
                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_TAB")}</p>
                                                            <p class="category-reviews-beta-tag" data-review-beta-tag>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_BETA_TAB")}</p>
                                                        </div>
                                                        <div class="change-category-modal-content-button" style="display: none;" data-shop-category-modal-tabs-tab-button-3>
                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REWARDS_TAB")}</p>
                                                            <p class="category-rewards-new-tag" data-review-beta-tag>${getTextString("SHOP_CATEGORY_MODAL_REWARDS_NEW_TAB")}</p>
                                                        </div>
                                                        <div class="category-modal-inner-content-container" data-category-modal-inner-content-container>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="shop-modal-tag-container" data-shop-card-tag-container></div>
                                                <div data-modal-top-product-buttons>
                                                    <div title="Close" data-close-product-card-button>
                                                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                    </div>
                                                </div>
                                            </div>
                                        `;

                                        if (localStorage.ext_sty_category_tab === "2") {
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-1]").classList.remove("change-category-modal-content-button")
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]").classList.remove("change-category-modal-content-button")

                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-1]").classList.add("change-category-modal-content-button-transparent")
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]").classList.add("change-category-modal-content-button-transparent")
                                        } else if (localStorage.ext_sty_category_tab === "3") {
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-1]").classList.remove("change-category-modal-content-button")
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]").classList.remove("change-category-modal-content-button")

                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-1]").classList.add("change-category-modal-content-button-legacy")
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]").classList.add("change-category-modal-content-button-legacy")
                                        }

                                        if (shop_archives_token && localStorage.experiment_2025_05_xp_system === "Treatment 1: Enabled") {
                                            if (!claimablesPromotionsCache) {

                                                url = api + CLAIMABLES_PROMOTIONS;
                                                fetchUrl = new URL(url);
                                                if (localStorage.staff_unpublished_xp_events == "true") {
                                                    fetchUrl.searchParams.append("include-unpublished", "true");
                                                }

                                                fetch(fetchUrl, {
                                                    method: "GET",
                                                    headers: {
                                                        "Authorization": shop_archives_token
                                                    }
                                                }) // Replace with your API URL
                                                .then(response => response.json())
                                                .then(data => {
                                                    if (data.message) {
        
                                                    } else {
                                                        claimablesPromotionsCache = data;
                                                        if (Array.isArray(data) && modal.querySelector("[data-shop-category-modal-tabs-tab-button-3]")) {
                                                            data.forEach(promo => {
                                                                if (promo.category_data?.sku_id === apiCategory.sku_id) {
                                                                    modal.querySelector("[data-shop-category-modal-tabs-tab-button-3]").style.display = 'flex';
                                                                }
                                                            });
                                                        }
                                                    }
        
                                                })
                                                .catch(error => {
                                                    console.error(error);
                                                });
                                            } else {
                                                if (Array.isArray(claimablesPromotionsCache) && modal.querySelector("[data-shop-category-modal-tabs-tab-button-3]")) {
                                                    claimablesPromotionsCache.forEach(promo => {
                                                        if (promo.category_data?.sku_id === apiCategory.sku_id) {
                                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-3]").style.display = 'flex';
                                                        }
                                                    });
                                                }
                                            }
                                        }

                                        if (localStorage.experiment_2025_04_reviews_v2_hide_beta_tag === "Treatment 1: Enabled") {
                                            modal.querySelector("[data-review-beta-tag]").style.display = 'none';
                                        }

                                        if (localStorage.experiment_2025_04_reviews_v2 === "Treatment 1: Enabled" && localStorage.reviews_filter_type != "3") {
                                            modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]").style.display = 'flex';
                                        }

                                        fillCategoryModalContentContainer('assets');

                                        const tab_button_1 = modal.querySelector("[data-shop-category-modal-tabs-tab-button-1]");
                                        const tab_button_2 = modal.querySelector("[data-shop-category-modal-tabs-tab-button-2]");
                                        const tab_button_3 = modal.querySelector("[data-shop-category-modal-tabs-tab-button-3]");

                                        tab_button_1.addEventListener('click', () => {
                                            if (tab_button_2.classList.contains("selected")) {
                                                tab_button_2.classList.remove("selected");
                                            } else if (tab_button_3.classList.contains("selected")) {
                                                tab_button_3.classList.remove("selected");
                                            }
                                            tab_button_1.classList.add("selected");
                                            fillCategoryModalContentContainer('assets');
                                            categoryModalTabCache = "assets";
                                        });

                                        tab_button_2.addEventListener('click', () => {
                                            if (tab_button_1.classList.contains("selected")) {
                                                tab_button_1.classList.remove("selected");
                                            } else if (tab_button_3.classList.contains("selected")) {
                                                tab_button_3.classList.remove("selected");
                                            }
                                            tab_button_2.classList.add("selected");
                                            fillCategoryModalContentContainer('reviews');
                                            categoryModalTabCache = "reviews";
                                        });

                                        tab_button_3.addEventListener('click', () => {
                                            if (tab_button_1.classList.contains("selected")) {
                                                tab_button_1.classList.remove("selected");
                                            } else if (tab_button_2.classList.contains("selected")) {
                                                tab_button_2.classList.remove("selected");
                                            }
                                            tab_button_3.classList.add("selected");
                                            fillCategoryModalContentContainer('xp_rewards');
                                            categoryModalTabCache = "xp_rewards";
                                        });

                                        function fillCategoryModalContentContainer(tab, bypassCache, bypassCache2) {
                                            if (document.getElementById("shop-category-modal-write-review-container") && categoryModalTabCache != "reviews" || document.getElementById("shop-category-modal-write-review-container") && bypassCache === true) {
                                                document.getElementById("shop-category-modal-write-review-container").remove();
                                            }
                                            if (document.getElementById("shop-category-modal-write-review-container") && tab != "reviews") {
                                                document.getElementById("shop-category-modal-write-review-container").remove();
                                            }
                                            if (tab === "assets" && categoryModalTabCache != "assets") {

                                                modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                const asset_container = modal.querySelector("[data-category-modal-inner-content-container]");

                                                if (apiCategory.banner != null) {
                                                    let banner_asset = document.createElement("div");

                                                    banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.banner}</p>
                                                        <img class="category-modalv2-inner-img-banner" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.banner}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(banner_asset);
                                                }

                                                if (apiCategory.banner_asset && apiCategory.banner_asset.static != null) {
                                                    let banner_asset = document.createElement("div");

                                                    banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_BANNER_ASSET_1")}</p>
                                                        <img class="category-modalv2-inner-img-banner" src="${apiCategory.banner_asset.static}"></img> 
                                                    `;

                                                    asset_container.appendChild(banner_asset);
                                                }

                                                if (apiCategory.banner_asset && apiCategory.banner_asset.animated != null) {
                                                    let banner_asset = document.createElement("div");

                                                    banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_BANNER_ASSET_2")}</p>
                                                        <video disablepictureinpicture autoplay muted class="category-modalv2-inner-img-banner" src="${apiCategory.banner_asset.animated}" loop></video> 
                                                    `;

                                                    asset_container.appendChild(banner_asset);
                                                }

                                                if (apiCategory.logo != null) {
                                                    let logo_asset = document.createElement("div");

                                                    logo_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_LOGO")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.logo}</p>
                                                        <img class="category-modalv2-inner-img-logo" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.logo}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(logo_asset);
                                                }

                                                if (apiCategory.mobile_bg != null) {
                                                    let mobile_bg_asset = document.createElement("div");

                                                    mobile_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_MOBILE_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.mobile_bg}</p>
                                                        <img class="category-modalv2-inner-img-mobile_bg" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.mobile_bg}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(mobile_bg_asset);
                                                }

                                                if (apiCategory.pdp_bg != null) {
                                                    let pdp_bg_asset = document.createElement("div");

                                                    pdp_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_PDP_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.pdp_bg}</p>
                                                        <img class="category-modalv2-inner-img-pdp_bg" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.pdp_bg}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(pdp_bg_asset);
                                                }

                                                if (apiCategory.success_modal_bg != null) {
                                                    let success_modal_bg_asset = document.createElement("div");

                                                    success_modal_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_SUCCESS_MODAL_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.success_modal_bg}</p>
                                                        <img class="category-modalv2-inner-img-success_modal_bg" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.success_modal_bg}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(success_modal_bg_asset);
                                                }

                                                if (apiCategory.mobile_banner != null) {
                                                    let mobile_banner_asset = document.createElement("div");

                                                    mobile_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_MOBILE_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.mobile_banner}</p>
                                                        <img class="category-modalv2-inner-img-mobile_banner" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.mobile_banner}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(mobile_banner_asset);
                                                }

                                                if (apiCategory.featured_block != null) {
                                                    let featured_block_asset = document.createElement("div");

                                                    featured_block_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_FEATURED_BLOCK")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.featured_block}</p>
                                                        <img class="category-modalv2-inner-img-featured_block" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.featured_block}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(featured_block_asset);
                                                }

                                                if (apiCategory.hero_banner != null) {
                                                    let hero_banner_asset = document.createElement("div");

                                                    hero_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.hero_banner}</p>
                                                        <img class="category-modalv2-inner-img-hero_banner" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.hero_banner}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(hero_banner_asset);
                                                }

                                                if (apiCategory.hero_banner_asset && apiCategory.hero_banner_asset.static != null) {
                                                    let hero_banner_asset = document.createElement("div");

                                                    hero_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_BANNER_ASSET_1")}</p>
                                                        <img class="category-modalv2-inner-img-banner" src="${apiCategory.hero_banner_asset.static}"></img> 
                                                    `;

                                                    asset_container.appendChild(hero_banner_asset);
                                                }

                                                if (apiCategory.hero_banner_asset && apiCategory.hero_banner_asset.animated != null) {
                                                    let hero_banner_asset = document.createElement("div");

                                                    hero_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_BANNER_ASSET_2")}</p>
                                                        <video disablepictureinpicture autoplay muted class="category-modalv2-inner-img-banner" src="${apiCategory.hero_banner_asset.animated}" loop></video> 
                                                    `;

                                                    asset_container.appendChild(hero_banner_asset);
                                                }

                                                if (apiCategory.wide_banner != null) {
                                                    let wide_banner_asset = document.createElement("div");

                                                    wide_banner_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_WIDE_BANNER")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.wide_banner}</p>
                                                        <img class="category-modalv2-inner-img-wide_banner" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.wide_banner}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(wide_banner_asset);
                                                }

                                                if (apiCategory.hero_logo != null) {
                                                    let hero_logo_asset = document.createElement("div");

                                                    hero_logo_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_HERO_LOGO")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.hero_logo}</p>
                                                        <img class="category-modalv2-inner-img-hero_logo" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.hero_logo}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(hero_logo_asset);
                                                }

                                                if (apiCategory.category_bg != null) {
                                                    let category_bg_asset = document.createElement("div");

                                                    category_bg_asset.innerHTML = `
                                                        <p class="shop-category-modal-assets-title">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_CATEGORY_BG")}</p>
                                                        <p class="shop-category-modal-assets-summary">${getTextString("SHOP_CATEGORY_MODAL_ASSETS_ID")}${apiCategory.category_bg}</p>
                                                        <img class="category-modalv2-inner-img-category_bg" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.category_bg}.png?size=4096"></img> 
                                                    `;

                                                    asset_container.appendChild(category_bg_asset);
                                                }
                                            } else if (tab === "reviews" && categoryModalTabCache != "reviews" || bypassCache === true) {

                                                modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = `
                                                    <div class="review-element-notice" id="loading-category-reviews">
                                                        <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_LOADING")}</p>
                                                    </div>
                                                `;

                                                fetch(api + REVIEWSAPI + '/' + apiCategory.sku_id, {
                                                    method: "GET",
                                                    headers: {
                                                        "Password": api_password,
                                                        "Authorization": discord_token,
                                                        "Token": api_token
                                                    }
                                                }) // Replace with your API URL
                                                .then(response => response.json())
                                                .then(data => {
                                                    if (data.message && data.message === "Reviews disabled") {
                                                        modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                        let reviewNoneElement = document.createElement("div");

                                                        reviewNoneElement.classList.add("review-element-warning");
        
                                                        reviewNoneElement.innerHTML = `
                                                            <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_DISABLED")}</p>
                                                        `;

                                                        modal.querySelector("[data-category-modal-inner-content-container]").appendChild(reviewNoneElement);

                                                    } else if (data.message && data.message === "This service is temporarily unavailable, down for maintenance.") {
                                                        modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                        let reviewNoneElement = document.createElement("div");

                                                        reviewNoneElement.classList.add("review-element-warning");
        
                                                        reviewNoneElement.innerHTML = `
                                                            <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_UNAVAILABLE")}</p>
                                                        `;

                                                        modal.querySelector("[data-category-modal-inner-content-container]").appendChild(reviewNoneElement);

                                                    } else if (tab === "reviews" && categoryModalTabCache === "reviews") {
                                                        renderReviews(data);

                                                        let hasReviewAlready = false;

                                                        data.forEach(review => {
                                                            if (review.users.id === localStorage.discord_user_id) {
                                                                hasReviewAlready = true;
                                                            }
                                                        });

                                                        if (localStorage.experiment_2025_05_m === "Treatment 1: Enabled") {

                                                        } else if (shop_archives_token && hasReviewAlready === false) {
                                                            let writeReviewContainer = document.createElement("div");
        
                                                            writeReviewContainer.classList.add("shop-category-modal-write-review-container");
                                                            writeReviewContainer.id = 'shop-category-modal-write-review-container';
                                                            writeReviewContainer.innerHTML = `
                                                                <p class="shop-category-modal-write-review-disclaimer-error" id="shop-category-modal-write-review-error-output"></p>
                                                                <div class="shop-category-modal-write-review-input-container">
                                                                    <div id="star-rating" class="stars">
                                                                        <svg data-value="1" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="2" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="3" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="4" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="5" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                    </div>

                                                                    <input autocomplete="off" id="shop-category-modal-write-review-post-input" placeholder="${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_WRITE")}${apiCategory.name}...">
                                                                    <svg data-post-review-button class="review-send-icon" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M6.6 10.02 14 11.4a.6.6 0 0 1 0 1.18L6.6 14l-2.94 5.87a1.48 1.48 0 0 0 1.99 1.98l17.03-8.52a1.48 1.48 0 0 0 0-2.64L5.65 2.16a1.48 1.48 0 0 0-1.99 1.98l2.94 5.88Z" class=""></path></svg>
                                                                </div>
                                                            `;

                                                            writeReviewContainer.querySelector("[data-post-review-button]").onclick = function(){
                                                                postReview(`${apiCategory.sku_id}`, 0);
                                                            };


                                                            const stars = writeReviewContainer.querySelectorAll('#star-rating svg');
                                                            let selectedRating = 0;

                                                            stars.forEach(star => {
                                                                star.addEventListener('click', () => {
                                                                    selectedRating = parseInt(star.getAttribute('data-value'));
                                                                    updateStars(selectedRating);
                                                                });
                                                            });
                                                        
                                                            function updateStars(rating) {
                                                                stars.forEach(star => {
                                                                    const value = parseInt(star.getAttribute('data-value'));
                                                                    star.classList.toggle('filled', value <= rating);
                                                                });
                                                                writeReviewContainer.querySelector("[data-post-review-button]").onclick = function(){
                                                                    postReview(`${apiCategory.sku_id}`, selectedRating);
                                                                };
                                                            }
    
                                                            modal.querySelector(".category-modalv2-inner-left").appendChild(writeReviewContainer);
                                                        } else if (shop_archives_token) {
                                                            let writeReviewContainer = document.createElement("div");
        
                                                            writeReviewContainer.classList.add("shop-category-modal-write-review-container");
                                                            writeReviewContainer.id = 'shop-category-modal-write-review-container';
                                                            writeReviewContainer.innerHTML = `
                                                                <p class="shop-category-modal-write-review-disclaimer-error" id="shop-category-modal-write-review-error-output"></p>
                                                                <div class="shop-category-modal-write-review-input-container">
                                                                    <div id="star-rating" class="stars">
                                                                        <svg data-value="1" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="2" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="3" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="4" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                        <svg data-value="5" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_131_2)"><path d="M12 1L14.6942 9.2918H23.4127L16.3593 14.4164L19.0534 22.7082L12 17.5836L4.94658 22.7082L7.64074 14.4164L0.587322 9.2918H9.30583L12 1Z" fill="currentColor"/></g><defs><clipPath id="clip0_131_2"><rect width="24" height="24" fill="currentColor"/></clipPath></defs></svg>
                                                                    </div>

                                                                    <input autocomplete="off" id="shop-category-modal-write-review-post-input" placeholder="${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_EDIT")}${apiCategory.name}...">
                                                                    <svg data-post-review-button class="review-send-icon" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M6.6 10.02 14 11.4a.6.6 0 0 1 0 1.18L6.6 14l-2.94 5.87a1.48 1.48 0 0 0 1.99 1.98l17.03-8.52a1.48 1.48 0 0 0 0-2.64L5.65 2.16a1.48 1.48 0 0 0-1.99 1.98l2.94 5.88Z" class=""></path></svg>
                                                                </div>
                                                            `;

                                                            writeReviewContainer.querySelector("[data-post-review-button]").onclick = function(){
                                                                postReview(`${apiCategory.sku_id}`, 0);
                                                            };


                                                            const stars = writeReviewContainer.querySelectorAll('#star-rating svg');
                                                            let selectedRating = 0;

                                                            stars.forEach(star => {
                                                                star.addEventListener('click', () => {
                                                                    selectedRating = parseInt(star.getAttribute('data-value'));
                                                                    updateStars(selectedRating);
                                                                });
                                                            });
                                                        
                                                            function updateStars(rating) {
                                                                stars.forEach(star => {
                                                                    const value = parseInt(star.getAttribute('data-value'));
                                                                    star.classList.toggle('filled', value <= rating);
                                                                });
                                                                writeReviewContainer.querySelector("[data-post-review-button]").onclick = function(){
                                                                    postReview(`${apiCategory.sku_id}`, selectedRating);
                                                                };
                                                            }

    
                                                            modal.querySelector(".category-modalv2-inner-left").appendChild(writeReviewContainer);
                                                        } else {
                                                            let writeReviewContainer = document.createElement("div");
        
                                                            writeReviewContainer.classList.add("shop-category-modal-write-review-container");
                                                            writeReviewContainer.id = 'shop-category-modal-write-review-container';
                                                            writeReviewContainer.innerHTML = `
                                                                <div onclick="loginToDiscord();" class="shop-category-modal-write-review-input-container">
                                                                    <input autocomplete="off" id="shop-category-modal-write-review-post-input" placeholder="${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_LOGIN")}" disabled>
                                                                </div>
                                                            `;
    
                                                            modal.querySelector(".category-modalv2-inner-left").appendChild(writeReviewContainer);
                                                        }
                                                    }

                                                })
                                                .catch(error => {
                                                    modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = `
                                                        <div class="review-element-warning" id="loading-category-reviews">
                                                            <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_ERROR")}</p>
                                                            <p class="review-warning-notice-text" style="font-size: medium; font-weight: 200;">${error}</p>
                                                        </div>
                                                    `;
                                                    console.error(error);
                                                });
    
                                                function renderReviews(datareview) {
                                                    if (localStorage.experiment_2025_05_m === "Treatment 1: Enabled") {
                                                        modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                        let reviewNoneElement = document.createElement("div");

                                                        reviewNoneElement.classList.add("review-element-warning");
        
                                                        reviewNoneElement.innerHTML = `
                                                            <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_UNAVAILABLE")}</p>
                                                        `;

                                                        modal.querySelector("[data-category-modal-inner-content-container]").appendChild(reviewNoneElement);
                                                    } else if (Array.isArray(datareview) && datareview.length === 0) {
                                                        modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                        let reviewNoneElement = document.createElement("div");

                                                        reviewNoneElement.classList.add("review-element-notice");
        
                                                        reviewNoneElement.innerHTML = `
                                                            <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_NONE")}</p>
                                                        `;

                                                        modal.querySelector("[data-category-modal-inner-content-container]").appendChild(reviewNoneElement);
                                                    } else {
                                                        const reviewContainer = modal.querySelector("[data-category-modal-inner-content-container]");

                                                        if (localStorage.staff_enable_override_review_content === "true") {
                                                            let reviewOverrideWarningElement = document.createElement("div");

                                                            reviewOverrideWarningElement.classList.add("review-element-notice");
        
                                                            reviewOverrideWarningElement.innerHTML = `
                                                                <p class="review-warning-notice-text" style="font-size: large; font-weight: 900;">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_OVERRIDE_WARNING")}</p>
                                                            `;

                                                            modal.querySelector("[data-category-modal-inner-content-container]").appendChild(reviewOverrideWarningElement);
                                                        }

                                                        datareview.forEach(review => {
                                                            if (localStorage.reviews_filter_type === "1" || localStorage.discord_user_id === review.users.id || localStorage.reviews_filter_type === "2" && review.review_flag_type != 2) {
                                                                let reviewElement = document.createElement("div");
    
                                                                reviewElement.classList.add("review-element");

                                                                if (review.system_type === 1) {
                                                                    reviewElement.classList.add("review-element-warning");
                                                                    reviewElement.classList.add("review-element-system");
                                                                } else if (review.system_type === 2) {
                                                                    reviewElement.classList.add("review-element-notice");
                                                                    reviewElement.classList.add("review-element-system");
                                                                }

                                                                let reviewTextOutput = review.review_text;
        
                                                                reviewElement.innerHTML = `
                                                                    <div class="review-content-inner">
                                                                        <div class="shop-modal-review-name-container" data-shop-modal-review-name-container>
                                                                            <img class="shop-modal-review-avatar-deco-img" src="${review.users.avatar_decoration_data ? `https://cdn.discordapp.com/avatar-decoration-presets/${review.users.avatar_decoration_data.asset}.png?size=40&amp;passthrough=true` : "https://cdn.yapper.shop/assets/31.png"}">
                                                                            <img class="shop-modal-review-avatar-img" src="https://cdn.discordapp.com/avatars/${review.users.id}/${review.users.avatar}.webp?size=128"></img>
                                                                            <p class="shop-modal-review-name" data-shop-modal-review-name></p>
                                                                        </div>
                                                                        <p class="shop-modal-review-review-text" data-review-content-text-output></p>
                                                                    </div>
                                                                    <div class="shop-modal-review-moderation-buttons" data-shop-modal-review-moderation-buttons></div>
                                                                `;

                                                                if (localStorage.experiment_2025_05_reviews_v2_user_profile === "Treatment 1: Enabled") {
                                                                    reviewElement.querySelector("[data-shop-modal-review-name]").classList.add("clickable");

                                                                    reviewElement.querySelector("[data-shop-modal-review-name]").addEventListener("click", () => {
                                                                        fetchUserProfileInfo(review.users.id);
                                                                    });
                                                                }

                                                                if (review.users.global_name && review.users.global_name != null) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-name]").textContent = review.users.global_name;
                                                                } else {
                                                                    reviewElement.querySelector("[data-shop-modal-review-name]").textContent = review.users.username;
                                                                }

                                                                if (localStorage.experiment_2025_04_reviews_v2_custom_emojis_render === "Treatment 1: Enabled") {
                                                                    if (localStorage.staff_enable_override_review_content === "true") {
                                                                        reviewElement.querySelector("[data-review-content-text-output]").innerHTML = renderReviewTextWithEmojis(localStorage.staff_raw_review_override_content);
                                                                    } else {
                                                                        reviewElement.querySelector("[data-review-content-text-output]").innerHTML = renderReviewTextWithEmojis(review.review_text);
                                                                    }
                                                                } else {
                                                                    if (localStorage.staff_enable_override_review_content === "true") {
                                                                        reviewElement.querySelector("[data-review-content-text-output]").textContent = localStorage.staff_raw_review_override_content;
                                                                    } else {
                                                                        reviewElement.querySelector("[data-review-content-text-output]").textContent = reviewTextOutput;
                                                                    }
                                                                }

                                                                if (review.users.id === localStorage.discord_user_id || localStorage.admin_level && localStorage.admin_level != "0") {
                                                                    let deleteReviewIcon = document.createElement("div");

                                                                    deleteReviewIcon.title = getTextString("SHOP_CATEGORY_MODAL_REVIEWS_DELETE_HOVER");

                                                                    deleteReviewIcon.innerHTML = `
                                                                        <svg class="closeIcon_modal delete-review-icon" onclick="deleteReview('${review.id}');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M14.25 1c.41 0 .75.34.75.75V3h5.25c.41 0 .75.34.75.75v.5c0 .41-.34.75-.75.75H3.75A.75.75 0 0 1 3 4.25v-.5c0-.41.34-.75.75-.75H9V1.75c0-.41.34-.75.75-.75h4.5Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M5.06 7a1 1 0 0 0-1 1.06l.76 12.13a3 3 0 0 0 3 2.81h8.36a3 3 0 0 0 3-2.81l.75-12.13a1 1 0 0 0-1-1.06H5.07ZM11 12a1 1 0 1 0-2 0v6a1 1 0 1 0 2 0v-6Zm3-1a1 1 0 0 1 1 1v6a1 1 0 1 1-2 0v-6a1 1 0 0 1 1-1Z" clip-rule="evenodd" class=""></path></svg>
                                                                    `;

                                                                    reviewElement.querySelector("[data-shop-modal-review-moderation-buttons]").appendChild(deleteReviewIcon);
                                                                }

                                                                if (localStorage.experiment_2025_04_reviews_v2_report === "Treatment 1: Enabled" && review.report_type === 0 && review.users.id != localStorage.discord_user_id && localStorage.account_type === "2") {
                                                                    let reportReviewIcon = document.createElement("div");

                                                                    reportReviewIcon.title = getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_HOVER");

                                                                    reportReviewIcon.innerHTML = `
                                                                        <svg data-report-review-button class="closeIcon_modal delete-review-icon" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M3 1a1 1 0 0 1 1 1v.82l8.67-1.45A2 2 0 0 1 15 3.35v1.47l5.67-.95A2 2 0 0 1 23 5.85v7.3a2 2 0 0 1-1.67 1.98l-9 1.5a2 2 0 0 1-1.78-.6c-.2-.21-.08-.54.18-.68a5.01 5.01 0 0 0 1.94-1.94c.18-.32-.1-.66-.46-.6L4 14.18V21a1 1 0 1 1-2 0V2a1 1 0 0 1 1-1Z" class=""></path></svg>
                                                                    `;

                                                                    reportReviewIcon.querySelector("[data-report-review-button]").onclick = function(){
                                                                        openReviewReportModal(review.id, review.review_text, review.users.username);
                                                                    };

                                                                    reviewElement.querySelector("[data-shop-modal-review-moderation-buttons]").appendChild(reportReviewIcon);
                                                                } else if (localStorage.experiment_2025_04_reviews_v2_report === "Treatment 1: Enabled" && review.report_type != 0 && localStorage.admin_level != "0" && localStorage.account_type === "2") {
                                                                    let reportReviewIcon = document.createElement("div");

                                                                    reportReviewIcon.title = getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_HOVER");

                                                                    reportReviewIcon.innerHTML = `
                                                                        <svg data-report-review-button class="closeIcon_modal delete-review-icon-good" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M3 1a1 1 0 0 1 1 1v.82l8.67-1.45A2 2 0 0 1 15 3.35v1.47l5.67-.95A2 2 0 0 1 23 5.85v7.3a2 2 0 0 1-1.67 1.98l-9 1.5a2 2 0 0 1-1.78-.6c-.2-.21-.08-.54.18-.68a5.01 5.01 0 0 0 1.94-1.94c.18-.32-.1-.66-.46-.6L4 14.18V21a1 1 0 1 1-2 0V2a1 1 0 0 1 1-1Z" class=""></path></svg>
                                                                    `;

                                                                    reportReviewIcon.querySelector("[data-report-review-button]").onclick = function(){
                                                                        openReviewReportModal(review.id, review.review_text, review.users.username);
                                                                    };

                                                                    reviewElement.querySelector("[data-shop-modal-review-moderation-buttons]").appendChild(reportReviewIcon);
                                                                }

                                                                if (review.users.system === true) {
                                                                    let moderatorNametag = document.createElement("p");
    
                                                                    moderatorNametag.classList.add("shop-modal-review-nametag-moderator");
                                                                    moderatorNametag.textContent = `${getTextString("SHOP_CATEGORY_MODAL_NAMETAG_SYSTEM")}`;
                                                                    moderatorNametag.title = `${getTextString("SHOP_CATEGORY_MODAL_NAMETAG_SYSTEM_TITLE")}`;

                                                                    reviewElement.querySelector("[data-shop-modal-review-name-container]").appendChild(moderatorNametag);
                                                                }

                                                                if (review.users.primary_guild) {
                                                                    let reviewServerTagContainer = document.createElement("div");
    
                                                                    reviewServerTagContainer.classList.add("shop-modal-review-server-tag-container");
                                                                    reviewServerTagContainer.innerHTML = `
                                                                        <img src="https://cdn.discordapp.com/clan-badges/${review.users.primary_guild.identity_guild_id}/${review.users.primary_guild.badge}.png?size=24"></img>
                                                                        <p>${review.users.primary_guild.tag}</p>
                                                                    `;

                                                                    reviewElement.querySelector("[data-shop-modal-review-name-container]").appendChild(reviewServerTagContainer);
                                                                }

                                                                if (Array.isArray(review.users.badges)) {
                                                                    let reviewBadgesContainer = document.createElement("div");
                                                                    reviewBadgesContainer.classList.add("shop-modal-review-badges-container");
                                                                  
                                                                    review.users.badges.forEach(badge => {
                                                                        const badgeImg = document.createElement("img");
                                                                        badgeImg.src = badge.src;
                                                                        badgeImg.alt = badge.name;
                                                                        badgeImg.title = badge.name;
                                                                        badgeImg.classList.add("review-badge");
                                                                        
                                                                        if (badge.support) {
                                                                            const badgeLink = document.createElement("a");
                                                                            badgeLink.href = badge.support;
                                                                            badgeLink.target = "_blank";
                                                                            badgeLink.rel = "noopener noreferrer";
                                                                            badgeLink.appendChild(badgeImg);
                                                                            reviewBadgesContainer.appendChild(badgeLink);
                                                                        } else {
                                                                            reviewBadgesContainer.appendChild(badgeImg);
                                                                        }
                                                                    });
                                                                  
                                                                    reviewElement.querySelector("[data-shop-modal-review-name-container]").appendChild(reviewBadgesContainer);
                                                                }
                                                                  
                                                                

                                                                let starRating = document.createElement("div");
    
                                                                starRating.classList.add("shop-modal-review-star-container");
                                                                starRating.setAttribute('data-shop-modal-review-star-container', '');

                                                                reviewElement.querySelector("[data-shop-modal-review-name-container]").appendChild(starRating);


                                                                const date = new Date(review.created_at);

                                                                const day = String(date.getDate()).padStart(2, '0');
                                                                const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth is 0-indexed
                                                                const year = date.getFullYear();

                                                                if (localStorage.reviews_time_type === "uk") {
                                                                    const formatted = `${day}/${month}/${year}`;

                                                                    let createdAtTag = document.createElement("p");
                                                                    
                                                                    createdAtTag.classList.add("shop-modal-review-time-container");
                                                                    createdAtTag.textContent = `${formatted}`;

                                                                    reviewElement.querySelector("[data-shop-modal-review-name-container]").appendChild(createdAtTag);
                                                                } else {
                                                                    const formatted = `${month}/${day}/${year}`;

                                                                    let createdAtTag = document.createElement("p");
                                                                    
                                                                    createdAtTag.classList.add("shop-modal-review-time-container");
                                                                    createdAtTag.textContent = `${formatted}`;

                                                                    reviewElement.querySelector("[data-shop-modal-review-name-container]").appendChild(createdAtTag);
                                                                }

        
                                                                if (review.rating === 5) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-star-container]").innerHTML = `
                                                                        <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzIxKSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iI0ZGRUMzRSIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzIxIj4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"></img>
                                                                    `;
                                                                } else if (review.rating === 4) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-star-container]").innerHTML = `
                                                                        <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzMyKSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iI0ZGRUMzRSIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzMyIj4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"></img>
                                                                    `;
                                                                } else if (review.rating === 3) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-star-container]").innerHTML = `
                                                                        <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzM5KSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iI0ZGRUMzRSIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzM5Ij4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"></img>
                                                                    `;
                                                                } else if (review.rating === 2) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-star-container]").innerHTML = `
                                                                        <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzQ2KSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iIzU3NTc1NyIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzQ2Ij4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"></img>
                                                                    `;
                                                                } else if (review.rating === 1) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-star-container]").innerHTML = `
                                                                        <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzUzKSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iIzU3NTc1NyIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzUzIj4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"></img>
                                                                    `;
                                                                } else if (review.rating === 0) {
                                                                    reviewElement.querySelector("[data-shop-modal-review-star-container]").innerHTML = `
                                                                        <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMyXzYwKSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iIzU3NTc1NyIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMyXzYwIj4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K"></img>
                                                                    `;
                                                                }
                                                                if (document.getElementById("loading-category-reviews")) {
                                                                    document.getElementById("loading-category-reviews").remove();
                                                                }

                                                                reviewContainer.appendChild(reviewElement);
                                                            }
                                                        });

                                                        function openReviewReportModal(reviewID, reviewText, reviewUser) {
                                                            let modal = document.createElement("div");
                    
                                                            modal.classList.add('modalv2');
                                                            modal.id = 'modalv2-report-review';
                    
                                                            modal.innerHTML = `
                                                                <div class="report-review-modalv2-inner">
                                                                    <p class="report-review-modal-header">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_HEADER")}</p>
                                                                    <p class="report-review-modal-summary" style="color: var(--8);">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_PREVIEW")}</p>
                                                                    <div class="report-review-content-preview">
                                                                        <div class="review-content-inner">
                                                                            <div class="shop-modal-review-name-container" data-shop-modal-review-name-container>
                                                                                <p class="shop-modal-review-name">${reviewUser}</p>
                                                                            </div>
                                                                            <p class="shop-modal-review-review-text" data-review-report-text-output></p>
                                                                        </div>
                                                                    </div>
                                                                    <input class="hidden" id="report-review-report-card-inv-imput" value="5" disabled>
                                                                    <input class="hidden" id="report-review-report-card-inv-imput-review-id" value="${reviewID}" disabled>
                                                                    <p class="report-review-modal-summary">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_SUMMARY")}</p>
                                                                    <div>
                                                                        <div class="report-review-report-card-option" onclick="selectReviewReportType(1)" id="report-review-report-card-option-1">
                                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_1")}</p>
                                                                        </div>
                                                                        <div class="report-review-report-card-option" onclick="selectReviewReportType(2)" id="report-review-report-card-option-2">
                                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_2")}</p>
                                                                        </div>
                                                                        <div class="report-review-report-card-option" onclick="selectReviewReportType(3)" id="report-review-report-card-option-3">
                                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_3")}</p>
                                                                        </div>
                                                                        <div class="report-review-report-card-option other" onclick="selectReviewReportType(4)" id="report-review-report-card-option-4">
                                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_4")}</p>
                                                                            <p class="report-review-report-card-option-summary">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_4_SUMMARY")}</p>
                                                                        </div>
                                                                        <div class="report-review-report-card-option other report-card-option-selected" onclick="selectReviewReportType(5)" id="report-review-report-card-option-5">
                                                                            <p>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_5")}</p>
                                                                        </div>
                                                                    </div>
                                                                    <p class="report-review-report-disclaimer">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_DISCLAIMER")}</p>
                                                                    <p class="report-review-report-disclaimer">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_DISCLAIMER1")}</p>
                                                                    <div class="report-review-bottom">
                                                                        <p class="shop-category-modal-report-review-error-output" id="shop-category-modal-report-review-error-output"></p>
                                                                        <button class="modalv3-content-card-button cancel-button">${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_CANCEL")}</button>
                                                                        <div data-dev-only-remove-report-button-container></div>
                                                                        <button class="modalv3-content-card-button report-button" data-reviews-send-report-button>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_REPORT")}</button>
                                                                    </div>
                                                                </div>
                                                            `;

                                                            modal.querySelector("[data-review-report-text-output]").textContent = reviewText;

                                                            modal.querySelector("[data-reviews-send-report-button]").addEventListener('click', () => {
                                                                reportReview(document.getElementById("report-review-report-card-inv-imput-review-id").value, document.getElementById("report-review-report-card-inv-imput").value);
                                                            });

                                                            if (localStorage.dev === "true") {
                                                                modal.querySelector("[data-dev-only-remove-report-button-container]").innerHTML = `
                                                                    <button class="modalv3-content-card-button report-button" data-reviews-remove-report-button>${getTextString("SHOP_CATEGORY_MODAL_REVIEWS_REPORT_REMOVE_REPORT")}</button>
                                                                `;
                                                                modal.querySelector("[data-reviews-remove-report-button]").addEventListener('click', () => {
                                                                    reportReview(document.getElementById("report-review-report-card-inv-imput-review-id").value, 0);
                                                                });
                                                            }
                    
                                                            document.body.appendChild(modal);
                    
                                                            setTimeout(() => {
                                                                modal.classList.add('show');
                                                            }, 1);
                                                            
                    
                                                            let modal_back = document.createElement("div");
                    
                                                            modal_back.classList.add('modalv2-back');
                                                            modal_back.classList.add('modalv2-back-review-report');
                                                            modal_back.id = 'modalv2-report-review-back';
                    
                                                            document.body.appendChild(modal_back);
                    
                                                            setTimeout(() => {
                                                                modal_back.classList.add('show');
                                                            }, 1);
                    
                    
                                                            modal.addEventListener('click', (event) => {
                                                                if (event.target === modal) {
                                                                    modal.classList.remove('show');
                                                                    modal_back.classList.remove('show');
                                                                    setTimeout(() => {
                                                                        modal.remove();
                                                                        modal_back.remove();
                                                                    }, 300);
                                                                }
                                                            });

                                                            modal.querySelector(".cancel-button").addEventListener('click', () => {
                                                                modal.classList.remove('show');
                                                                modal_back.classList.remove('show');
                                                                setTimeout(() => {
                                                                    modal.remove();
                                                                    modal_back.remove();
                                                                }, 300);
                                                            });
                                                        }

                                                    }
                                                    
                                                }
                                            } else if (tab === "xp_rewards" && categoryModalTabCache != "xp_rewards" || bypassCache2 === true) {
                                                modal.querySelector("[data-category-modal-inner-content-container]").innerHTML = ``;

                                                if (Array.isArray(claimablesPromotionsCache)) {
                                                    claimablesPromotionsCache.forEach(promo => {
                                                        
                                                        if (promo.already_claimed === false && promo.category_data?.sku_id === apiCategory.sku_id) {

                                                            let promoBanner = document.createElement("div");

                                                            promoBanner.classList.add("xp-reward-promo-card");
        
                                                            promoBanner.innerHTML = `
                                                                <div class="inner">
                                                                    <p class="title">Claim your free ${promo.xp_reward} XP!</p>
                                                                    <p class="sub">You have ${promo.xp_reward} XP waiting for you!</p>
                                                                    <a class="link" href="https://support.yapper.shop/#page=3">Learn More about XP</a>
                                                                    <button class="button" onclick="openClaimablesRewardClaimModal('${promo.claimable_id}')">Claim ${promo.xp_reward} XP</button>
                                                                </div>
                                                            `;

                                                            modal.querySelector("[data-category-modal-inner-content-container]").appendChild(promoBanner);
                                                        } else if (promo.category_data?.sku_id === apiCategory.sku_id) {

                                                            let promoBanner = document.createElement("div");

                                                            promoBanner.classList.add("xp-reward-promo-card");
        
                                                            promoBanner.innerHTML = `
                                                                <div class="inner">
                                                                    <p class="title">You claimed ${promo.xp_reward} XP.</p>
                                                                    <p class="sub">You already claimed this reward.</p>
                                                                    <a class="link" href="https://support.yapper.shop/#page=3">Learn More about XP</a>
                                                                </div>
                                                            `;

                                                            modal.querySelector("[data-category-modal-inner-content-container]").appendChild(promoBanner);
                                                        }
                                                    });
                                                }

                                            } else {
                                                console.log("already on that tab")
                                            }
                                        }

                                        window.fillCategoryModalContentContainer = fillCategoryModalContentContainer;


                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `${getTextString("SHOP_CATEGORY_MODAL_SKU_ID")}${apiCategory.sku_id}`;
                                        modal.querySelector("[data-product-modal-name]").textContent = apiCategory.name;
                                        modal.querySelector("[data-product-modal-summary]").textContent = apiCategory.summary;

                                        document.body.appendChild(modal);

                                        setTimeout(() => {
                                            modal.classList.add('show');
                                        }, 1);

                                        
                                        const top_button_container = document.querySelector("[data-modal-top-product-buttons]");

                                        
                                        if (localStorage.experiment_2025_02_shop_category_modals === "Treatment 2: Enable category modals w/ data downloads") {
                                            let downloadItemData = document.createElement("div");

                                            downloadItemData.title = getTextString("SHOP_DOWNLOAD_DATA");
                                            downloadItemData.innerHTML = `
                                                <svg data-download-product-card-button class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${apiCategory.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                            `;

                                            top_button_container.appendChild(downloadItemData);
                                        }

                                        if (localStorage.experiment_2025_03_view_raw_modal === "Treatment 1: Enabled") {
                                            let rawItemData = document.createElement("div");

                                            rawItemData.title = getTextString("SHOP_VIEW_RAW_DATA");
                                            rawItemData.innerHTML = `
                                                <svg data-view-raw-product-card-button class="shareIcon_modal" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.7376 3.18925C15.4883 2.93731 15.0814 2.93686 14.8316 3.18824L14.0087 4.01625C13.7618 4.26471 13.7614 4.66581 14.0078 4.91476L20.3804 11.3527C20.6265 11.6013 20.6265 12.0017 20.3804 12.2503L14.0078 18.6882C13.7614 18.9373 13.7618 19.3383 14.0087 19.5867L14.8316 20.4148C15.0814 20.6662 15.4883 20.6658 15.7376 20.4138L23.815 12.2503C24.061 12.0016 24.061 11.6014 23.815 11.3528L15.7376 3.18925Z" fill="currentColor"/><path d="M9.99171 4.91476C10.2381 4.66581 10.2377 4.26471 9.99081 4.01625L9.16787 3.18824C8.91804 2.93686 8.51118 2.93731 8.2619 3.18925L0.184466 11.3528C-0.0614893 11.6014 -0.061488 12.0016 0.184466 12.2503L8.2619 20.4138C8.51118 20.6658 8.91803 20.6662 9.16787 20.4148L9.99081 19.5867C10.2377 19.3383 10.2381 18.9373 9.99171 18.6882L3.61906 12.2503C3.37298 12.0017 3.37298 11.6013 3.61906 11.3527L9.99171 4.91476Z" fill="currentColor"/></svg>
                                            `;

                                            top_button_container.appendChild(rawItemData);

                                            modal.querySelector("[data-view-raw-product-card-button]").onclick = function(){
                                                openRawModal();
                                            };

                                            async function openRawModal() {
                                                let modal = document.createElement("div");
                    
                                                modal.classList.add('modalv2');
                    
                                                modal.innerHTML = `
                                                    <div class="view-raw-modalv2-inner">
                                                        <textarea class="view-raw-modal-textbox" readonly>${JSON.stringify(apiCategory, undefined, 4)}</textarea>
                                                    </div>
                                                `;
                    
                                                document.body.appendChild(modal);
                    
                                                setTimeout(() => {
                                                    modal.classList.add('show');
                                                }, 1);
                                                
                    
                                                let modal_back = document.createElement("div");
                    
                                                modal_back.classList.add('modalv2-back');
                                                modal_back.id = 'modalv2-back';
                    
                                                document.body.appendChild(modal_back);
                    
                                                setTimeout(() => {
                                                    modal_back.classList.add('show');
                                                }, 1);
                    
                    
                                                modal.addEventListener('click', (event) => {
                                                    if (event.target === modal) {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    }
                                                });
                    
                                                document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                    modal.classList.remove('show');
                                                    modal_back.classList.remove('show');
                                                    setTimeout(() => {
                                                        modal.remove();
                                                        modal_back.remove();
                                                    }, 300);
                                                });
                                            }
                                        }


                                        const unpublishedAt = new Date(apiCategory.unpublished_at);
                    
                                        if (apiCategory.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                    
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = unpublishedAt - now;
                    
                                                if (timeDiff <= 0) {
                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("SHOP_CATEGORY_NOT_IN_STORE")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                    
                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("SHOP_CATEGORY_DAYS_LEFT_IN_STORE")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                    
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }
                                        


                                        let modal_back = document.createElement("div");

                                        modal_back.classList.add('modalv2-back');
                                        modal_back.id = 'modalv2-back';

                                        document.body.appendChild(modal_back);

                                        setTimeout(() => {
                                            modal_back.classList.add('show');
                                        }, 1);


                                        modal.addEventListener('click', (event) => {
                                            if (event.target === modal) {
                                                modal.classList.remove('show');
                                                modal_back.classList.remove('show');
                                                setTimeout(() => {
                                                    modal.remove();
                                                    modal_back.remove();
                                                }, 300);
                                                removeParams('itemSkuId');
                                                modalIsAlreadyOpen = false;
                                            }
                                        });

                                        document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                            modal.classList.remove('show');
                                            modal_back.classList.remove('show');
                                            setTimeout(() => {
                                                modal.remove();
                                                modal_back.remove();
                                            }, 300);
                                            removeParams('itemSkuId');
                                            modalIsAlreadyOpen = false;
                                        });
                                    }
                                }


                                const unpublishedAt = new Date(apiCategory.unpublished_at);
                            
                                if (apiCategory.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                    
                                    function updateTimer() {
                                        const now = new Date();
                                        const timeDiff = unpublishedAt - now;
                    
                                        if (timeDiff <= 0) {
                                            category.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="unplublished-tag">
                                                    <p class="unplublished-tag-text">${getTextString("SHOP_CATEGORY_NOT_IN_STORE")}</p>
                                                </div>
                                            `;
                                            clearInterval(timerInterval);
                                        } else {
                                            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                    
                                            category.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="unplublished-tag">
                                                    <p class="unplublished-tag-text">${days}${getTextString("SHOP_CATEGORY_DAYS_LEFT_IN_STORE")}</p>
                                                </div>
                                            `;
                                        }
                                    }
                    
                                    const timerInterval = setInterval(updateTimer, 1000);
                                    updateTimer();
                                }

            
                                const cardOutput = category.querySelector("[data-shop-category-card-holder]");

                                if (localStorage.ext_sty_shop_cards === "2") {
                                    cardOutput.classList.remove("shop-category-card-holder");
                                    cardOutput.classList.add("shop-category-card-holder-standard");
                                } else {
                                    cardOutput.classList.add("shop-category-card-holder");
                                }

                                if (cardOutput) {
                                    for (const product of apiCategory.products) {
                                        const cardTemplate = document.querySelector("[data-shop-item-card-template]");
                                        const card = cardTemplate.content.cloneNode(true).children[0];

                                        if (localStorage.ext_sty_shop_cards === "2") {
                                            card.classList.remove("shop-category-card");
                                            card.classList.add("shop-category-card-standard");

                                            if (product.styles && product.styles.background_colors != null) {
                                                function decodePrimaryCard(decimal) {
                                                    const r = (decimal >> 16) & 0xFF; // Extract Red (top 8 bits)
                                                    const g = (decimal >> 8) & 0xFF;  // Extract Green (middle 8 bits)
                                                    const b = decimal & 0xFF;         // Extract Blue (bottom 8 bits)
                                                    return { r, g, b };
                                                }
    
                                                function decodeSecondaryCard(decimal) {
                                                    const r1 = (decimal >> 16) & 0xFF; // Extract Red (top 8 bits)
                                                    const g1 = (decimal >> 8) & 0xFF;  // Extract Green (middle 8 bits)
                                                    const b1 = decimal & 0xFF;         // Extract Blue (bottom 8 bits)
                                                    return { r1, g1, b1 };
                                                }
                                                
                                                // Example usage:
                                                const cardPrimaryColorDecimal = product.styles.background_colors[0]; // example (like 0xFFA000)
                                                const { r, g, b } = decodePrimaryCard(cardPrimaryColorDecimal);
    
                                                const cardSecondaryColorDecimal = product.styles.background_colors[1]; // example (like 0xFFA000)
                                                const { r1, g1, b1 } = decodeSecondaryCard(cardSecondaryColorDecimal);
                                                card.style.backgroundImage = `linear-gradient(rgb(${r}, ${g}, ${b}),rgb(${r1}, ${g1}, ${b1}))`;
                                            }
                                              
                                        } else {
                                            card.classList.add("shop-category-card");
                                        }

                                        card.id = product.sku_id;

                                        if (product.type === item_types.NONE) {
                                            card.classList.add("type_100");
                                            card.classList.add('hidden')
                                        } else if (product.type === item_types.AVATAR_DECORATION) {
                                            product.items.forEach(item => {
                                                
                                                card.classList.add("type_0");
                                                // Set the innerHTML for the preview holder
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('avatar-decoration-image');
                                                
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                
                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                
                                                previewHolder.appendChild(bgimg);
                                        
                                                // Set the product details
                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                }
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                        if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                            bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                        bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                    });
                                                }
                                                
                                            });
                                        } else if (product.type === item_types.PROFILE_EFFECT) {
                                            card.classList.add("type_1");

                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                            // Ensure the item ID is accessible here
                                            let itemId = undefined;
                                            if (Array.isArray(product.items)) {
                                                // If items is an array, find the item with type 1 and get its id
                                                const item = product.items.find(item => item.type === 1);
                                                if (item) {
                                                    itemId = item.id;
                                                }
                                            } else if (product.items && product.items.type === 1) {
                                                // If items is an object and has type 1, get its id
                                                itemId = product.items.id;
                                            }
                                        
                                        
                                            if (!discordProfileEffectsCache) {
                                                await setDiscordProfileEffectCache();
                                            }
                                        
                                            // Find matching profile effect
                                            const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                        
                                            if (matchingEffect) {
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('profile-effect-image');
                                        
                                                previewHolder.innerHTML = `
                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                `;
                                        
                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                const imgElement = card.querySelector("img");
                                        
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                    });
                                                } else {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                    });
                                                }
                                            }
                                        } else if (product.type === item_types.NAMEPLATE) {
                                            card.classList.add("type_2");

                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                previewName = localStorage.discord_displayname;
                                            } else {
                                                previewName = 'Default User'
                                            }

                                            previewHolder.innerHTML = `
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _1"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _2"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-null-user" data-user-nameplate-preview>
                                                    <video disablepictureinpicture muted loop class="nameplate-null-user" style="position: absolute; height: 100%; width: auto; right: 0;" data-user-nameplate-preview-img></video>
                                                    <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                    <p class="nameplate-user-name">${previewName}</p>
                                                </div>
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _2"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-null-user">
                                                    <div class="nameplate-null-user-avatar"></div>
                                                    <div class="nameplate-null-user-name _1"></div>
                                                    <div class="nameplate-preview-status-bg"></div>
                                                    <div class="nameplate-preview-status-color"></div>
                                                </div>
                                                <div class="nameplate-fade-top"></div>
                                                <div class="nameplate-fade-bottom"></div>
                                            `;

                                            product.items.forEach(item => {
                                                const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                const paletteName = item.palette;
                                                const asset = `https://cdn.discordapp.com/assets/collectibles/${item.asset}asset.webm`;
                                                const bgcolor = nameplate_palettes[paletteName].darkBackground;

                                                const videoElement = previewHolder.querySelector("[data-user-nameplate-preview-img]");

                                                videoElement.src = asset;

                                                nameplatePreview.style.backgroundImage = `linear-gradient(90deg, #00000000 -30%, ${bgcolor} 200%)`;
                                                // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                
                                                const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                
                                                nullUserNameRandomWidth.forEach(UserName => {
                                                    const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                    UserName.style.width = randomWidth + `px`;
                                                });
                                            
                                                const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                            
                                                nullUserAvatar.forEach(UserAvatar => {
                                                    UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                });

                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        videoElement.play();
                                                    });
                                                    card.addEventListener("mouseleave", () => {
                                                        videoElement.pause();
                                                    });
                                                }
                                            });
                                            
                                        } else if (product.type === item_types.BUNDLE) {
                                            card.classList.add("type_1000");
                                            // Fetch the bundled products for the bundle summary
                                            const bundledProducts = product.bundled_products || [];
                                        
                                            // Generate the bundle summary from the names of the bundled products
                                            const type0Product = bundledProducts.find(item => item.type === 0);
                                            const type1Product = bundledProducts.find(item => item.type === 1);
                                        
                                            let bundleSummary = `${getTextString("CARD_TYPE_BUNDLE_TITLE")}`;
                                            if (type0Product) {
                                                bundleSummary += `${type0Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_DECO")}`;
                                            }
                                            if (type1Product) {
                                                bundleSummary += `${type1Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_EFFECT")}`;
                                            }
                                        
                                            // Set the summary text
                                            card.querySelector("[data-product-card-summary]").textContent = bundleSummary;
                                        
                                            // Set the basic card details
                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                        
                                            // Handle each item in the bundle
                                            product.items.forEach(item => {
                                                if (item.type === 0) {
                                                    // Avatar decoration
                                                    const decoImage = document.createElement("img");
                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                    decoImage.alt = "Avatar Decoration";
                                                    decoImage.classList.add("avatar-decoration-image");
                                                    card.querySelector("[data-shop-card-preview-holder]").appendChild(decoImage);

                                                    const bgimg = document.createElement("div");
                                                    bgimg.classList.add("avatar-decoration-bg-image");
                                                    
                                                    card.querySelector("[data-shop-card-preview-holder]").appendChild(bgimg);
                                        
                                                    // Hover effect for decoration image
                                                    if (localStorage.reduced_motion != "true") {
                                                        card.addEventListener("mouseenter", () => {
                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        });
                                                        card.addEventListener("mouseleave", () => {
                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                            bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                        });
                                                    }
                                                } else if (item.type === 1) {
                                                    // Profile effect
                                                    (async () => {
                                                        if (!discordProfileEffectsCache) {
                                                            await setDiscordProfileEffectCache();
                                                        }
                                        
                                                        // Find the matching effect
                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                        
                                                        if (matchingEffect) {
                                                            const effectImage = document.createElement("img");
                                                            effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                            effectImage.alt = "Profile Effect";
                                                            effectImage.classList.add("profile-effect-image");
                                                            card.querySelector("[data-shop-card-preview-holder]").appendChild(effectImage);
                                        
                                                            // Hover effect for profile effect
                                                            if (localStorage.reduced_motion != "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    if (matchingEffect.effects && matchingEffect.effects[0] && matchingEffect.effects[0].src) {
                                                                        effectImage.src = matchingEffect.effects[0].src;
                                                                    }
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            } else {
                                                                card.addEventListener("mouseenter", () => {
                                                                    effectImage.src = matchingEffect.reducedMotionSrc;
                                                                });
                                                                card.addEventListener("mouseleave", () => {
                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            }
                                                        }
                                                    })();
                                                }
                                            });
                                        } else if (product.type === item_types.VARIANTS_GROUP) {
                                            // Update SKU and summary
                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                            // Always display the base variant name
                                            card.querySelector("[data-product-card-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                        
                                            // Render variant color blocks as interactive divs
                                            const variantContainer = card.querySelector("[data-shop-card-var-container]");
                                            variantContainer.innerHTML = ""; // Clear existing variant blocks
                                            let currentSelectedVariant = null; // Track selected variant
                                        
                                            product.variants.forEach((variant, index) => {
                                                // Create variant color block
                                                const variantColorBlockTmp = document.querySelector("[data-shop-varcolorblock-template]");
                                                const variantColorBlock = variantColorBlockTmp.content.cloneNode(true).children[0];
                                                variantColorBlock.classList.add("shop-card-var");
                                                variantColorBlock.id = "shop-card-var";
                                                variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                        
                                                // Add click event listener to switch variants
                                                variantColorBlock.addEventListener("click", () => {
                                                    if (currentSelectedVariant) {
                                                        currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                    }
                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                    currentSelectedVariant = variantColorBlock;
                                                    applyVariant(variant);
                                                });
                                        
                                                // Append the color block to the container
                                                variantContainer.appendChild(variantColorBlock);
                                        
                                                // Set the first variant as the default selected
                                                if (index === 0) {
                                                    currentSelectedVariant = variantColorBlock;
                                                    variantColorBlock.classList.add("shop-card-var-selected");
                                                }
                                            });

                                            let isFirstTimeLoadingVariant = true;
                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                        
                                            // Function to apply the selected variant
                                            function applyVariant(selectedVariant) {
                                                card.querySelector("[data-shop-card-var-title]").textContent = `(${selectedVariant.variant_label})`;

                                                if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                } else {
                                                    card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                }

                                                if (localStorage.experiment_2025_02_shop_card_modals != "Treatment 1: Enable modals" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 2: Enable modals w/ data downloads" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 3: Enable modals w/ p+" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 4: Enable modals w/ p+ on p+ page" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 5: Enable modals w/ data downloads and p+" && localStorage.experiment_2025_02_shop_card_modals != "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                    card.querySelector("[data-share-product-card-button]").innerHTML = `
                                                        <svg class="shareIcon_f4a996" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${selectedVariant.sku_id}');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                    `;
                                                }

                                                if (selectedVariant.type === 0) {
                                                    card.classList.add("type_2000-0");
                                                    previewHolder.innerHTML = ""; // Clear previous decorations
                                                    previewHolder.classList.add('avatar-decoration-image');
                                                    
                                                    // Add the avatar decoration based on the selected variant
                                                    selectedVariant.items?.forEach(item => {
                                                        const decoImage = document.createElement("img");
                                                        const bgimg = document.createElement("div");
                                                        if (isFirstTimeLoadingVariant == true) {
                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                            isFirstTimeLoadingVariant = false;
                                                        } else {
                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                            if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                            }
                                                        }
                                                        decoImage.alt = "Avatar Decoration";
                                                        decoImage.id = "shop-card-deco-image";
                                                        previewHolder.appendChild(decoImage);

                                                        bgimg.id = "shop-card-deco-bg-image";

                                                        previewHolder.appendChild(bgimg);
                                                    
                                                        // Hover effect for decoration image
                                                        if (localStorage.reduced_motion !== "true") {
                                                            card.addEventListener("mouseenter", () => {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                                    bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                                }
                                                            });
                                                            card.addEventListener("mouseleave", () => {
                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                bgimg.style.backgroundImage = `url(data:image/png;base64,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)`;
                                                            });
                                                        }
                                                    });
                                                } else if (selectedVariant.type === 1) {
                                                    card.classList.add("type_2000-1");
                                                    (async () => {
                                                        // Ensure the item ID is accessible here
                                                        let itemId = undefined;
                                                        if (Array.isArray(selectedVariant.items)) {
                                                            // If items is an array, find the item with type 1 and get its id
                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                            if (item) {
                                                                itemId = item.id;
                                                            }
                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                            // If items is an object and has type 1, get its id
                                                            itemId = selectedVariant.items.id;
                                                        }
                                                    
                                                    
                                                        if (!discordProfileEffectsCache) {
                                                            await setDiscordProfileEffectCache();
                                                        }
                                                    
                                                        // Find matching profile effect
                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                    
                                                        if (matchingEffect) {
                                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                            previewHolder.classList.add('profile-effect-image');
                                                        
                                                            if (isFirstTimeLoadingVariant == true) {
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                `;
                                                                isFirstTimeLoadingVariant = false;
                                                            } else {
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.effects[0]?.src}">
                                                                `;
                                                            }
                                                        
                                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                            const imgElement = card.querySelector("img");
                                                        
                                                            if (localStorage.reduced_motion != "true") {
                                                                card.addEventListener("mouseenter", () => {
                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                    }
                                                                });
                                                            
                                                                card.addEventListener("mouseleave", () => {
                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            } else {
                                                                card.addEventListener("mouseenter", () => {
                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                });
                                                            
                                                                card.addEventListener("mouseleave", () => {
                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                });
                                                            }
                                                        }
                                                    })();
                                                }
                                            }
                                        
                                            // Apply the default variant (first one) initially
                                            if (product.variants.length > 0) {
                                                applyVariant(product.variants[0]);
                                            }
                                        } else if (product.type === item_types.EXTERNAL_SKU) {
                                            card.classList.add("type_3000");

                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            } else {
                                                card.querySelector("[data-product-card-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                            }
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;

                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");

                                            if (product.sku_id === ORB_PROFILE_BADGE) {
                                                previewHolder.classList.add('potion-card-preview-holder');
                                                    
                                                previewHolder.innerHTML = `
                                                    <video loop disablepictureinpicture class="potion-card-preview profile-badge-orb-preview" id="orb-profile-badge-card-video" src="https://cdn.discordapp.com/assets/content/ccaa60fae2114887bfa2e413be11d62c6d194139ee0f33671825ff06a1050692.webm"></video>
                                                `;

                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        card.querySelector("#orb-profile-badge-card-video").play();
                                                    });
                                                    card.addEventListener("mouseleave", () => {
                                                        card.querySelector("#orb-profile-badge-card-video").pause();
                                                        card.querySelector("#orb-profile-badge-card-video").currentTime = 0;
                                                    });
                                                }
                                            } else if (product.sku_id === NITRO_CREDITS_3_DAYS) {
                                                previewHolder.classList.add('potion-card-preview-holder');
                                                    
                                                previewHolder.innerHTML = `
                                                    <svg class="potion-card-preview nitro-3-days-orb-preview" width="187" height="187" viewBox="0 0 187 187" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="M161.164 3.17212H30.5663C16.8601 3.17212 5.74902 14.3031 5.74902 28.0339V158.866C5.74902 172.597 16.8601 183.728 30.5663 183.728H161.164C174.87 183.728 185.982 172.597 185.982 158.866V28.0339C185.982 14.3031 174.87 3.17212 161.164 3.17212Z" fill="url(#paint0_linear_170_2)"/>
                                                    <g filter="url(#filter0_d_170_2)">
                                                    <path d="M100.125 107.318C106.339 107.318 111.376 102.266 111.376 96.0332C111.376 89.8007 106.339 84.7483 100.125 84.7483C93.9113 84.7483 88.874 89.8007 88.874 96.0332C88.874 102.266 93.9113 107.318 100.125 107.318Z" fill="white"/>
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M55.1214 50.8938C52.0146 50.8938 49.496 53.42 49.496 56.5362C49.496 59.6525 52.0146 62.1787 55.1214 62.1787H71.9979C75.1048 62.1787 77.6235 64.7049 77.6235 67.8211C77.6235 70.9373 75.1048 73.4635 71.9979 73.4635H46.6832C43.5763 73.4635 41.0576 75.9897 41.0576 79.106C41.0576 82.2222 43.5763 84.7484 46.6832 84.7484H60.7469C63.8539 84.7484 66.3724 87.2746 66.3724 90.3908C66.3724 93.5071 63.8539 96.0333 60.7469 96.0333H49.496C46.389 96.0333 43.8704 98.5595 43.8704 101.676C43.8704 104.792 46.389 107.318 49.496 107.318H56.5393C61.5352 126.787 79.1553 141.173 100.125 141.173C124.981 141.173 145.13 120.963 145.13 96.0333C145.13 71.1035 124.981 50.8938 100.125 50.8938H55.1214ZM100.125 118.603C112.553 118.603 122.627 108.498 122.627 96.0333C122.627 83.5683 112.553 73.4635 100.125 73.4635C87.6979 73.4635 77.6235 83.5683 77.6235 96.0333C77.6235 108.498 87.6979 118.603 100.125 118.603Z" fill="white"/>
                                                    <path d="M29.8064 84.7485C32.9133 84.7485 35.4319 82.2223 35.4319 79.1061C35.4319 75.9898 32.9133 73.4636 29.8064 73.4636H26.9936C23.8868 73.4636 21.3682 75.9898 21.3682 79.1061C21.3682 82.2223 23.8868 84.7485 26.9936 84.7485H29.8064Z" fill="white"/>
                                                    </g>
                                                    <defs>
                                                    <filter id="filter0_d_170_2" x="7.48094" y="42.5615" width="151.536" height="118.053" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                                                    <feFlood flood-opacity="0" result="BackgroundImageFix"/>
                                                    <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/>
                                                    <feOffset dy="5.55489"/>
                                                    <feGaussianBlur stdDeviation="6.94361"/>
                                                    <feComposite in2="hardAlpha" operator="out"/>
                                                    <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"/>
                                                    <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_170_2"/>
                                                    <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_170_2" result="shape"/>
                                                    </filter>
                                                    <linearGradient id="paint0_linear_170_2" x1="160.748" y1="183.303" x2="46.3474" y2="36.4729" gradientUnits="userSpaceOnUse">
                                                    <stop stop-color="#E978E6"/>
                                                    <stop offset="1" stop-color="#2F3EBB"/>
                                                    </linearGradient>
                                                    </defs>
                                                    </svg>
                                                `;
                                            } else {
                                                previewHolder.innerHTML = `
                                                    <p>${getTextString("CARD_TYPE_EXTERNAL_SKU_ERROR")}</p>
                                                `;
                                            }
                                            
                                        } else if (product.type === 'plus_more') {
                                            card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            card.querySelector("[data-product-card-name]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_TITLE")}`;
                                            card.querySelector("[data-product-card-summary]").textContent = `${getTextString("CARD_TYPE_PLUS_MORE_DESC")}`;

                                            card.querySelector("[data-shop-price-container]").innerHTML = ``;
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                            card.querySelector("[data-share-product-card-button]").innerHTML = ``;

                                            const plusMoreQuestionMark = document.createElement("img");
                                            plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                            plusMoreQuestionMark.classList.add("plus-more-question-mark");
                                            card.querySelector("[data-shop-card-preview-holder]").appendChild(plusMoreQuestionMark);
                                
                                            // Hover effect for decoration image
                                            if (localStorage.reduced_motion != "true") {
                                                card.addEventListener("mouseenter", () => {
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.gif`;
                                                });
                                                card.addEventListener("mouseleave", () => {
                                                    plusMoreQuestionMark.src = `https://cdn.discordapp.com/assets/server_products/storefront/question-mark.png`;
                                                });
                                            }
                                        } else if (product.items[0].item_type === 'deco') {
                                            product.items.forEach(item => {
                                                
                                                card.classList.add("type_0");
                                                // Set the innerHTML for the preview holder
                                                const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                                previewHolder.classList.add('avatar-decoration-image');
                                                
                                                // Set the initial image for the deco card
                                                const imgElement = document.createElement("img");
                                                imgElement.id = "shop-card-deco-image";
                                                imgElement.src = imgElement.src = item.static;
                                                
                                                previewHolder.appendChild(imgElement);

                                                const bgimg = document.createElement("div");
                                                bgimg.id = "shop-card-deco-bg-image";
                                                
                                                previewHolder.appendChild(bgimg);
                                        
                                                // Set the product details
                                                card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                                card.querySelector("[data-product-card-name]").textContent = product.name;
                                                card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                        
                                                // Hover effect: Change the image src on mouse enter and leave
                                                if (localStorage.reduced_motion != "true") {
                                                    card.addEventListener("mouseenter", () => {
                                                        imgElement.src = item.animated;
                                                        if (localStorage.discord_avatar != defaultAvatar1 && localStorage.discord_avatar != defaultAvatar2 && localStorage.discord_avatar != defaultAvatar3 && localStorage.discord_avatar != defaultAvatar4 && localStorage.discord_avatar != defaultAvatar5 && localStorage.discord_avatar != defaultAvatar6) {
                                                            bgimg.style.backgroundImage = `url(${localStorage.discord_avatar})`
                                                        }
                                                    });
                                            
                                                    card.addEventListener("mouseleave", () => {
                                                        imgElement.src = item.static;
                                                        bgimg.style.backgroundImage = `url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAACECAYAAABRRIOnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAy4SURBVHgB7Z3bbxTJFYePCZfYAgMh4m7CJVwSELeIyy5ICFagICHgkQeeeeMf4oUHeAEJCRASQShcHqIlXA0RCgYcBN5wyeIAZmUDhmXn65nytsczPd3V1VXdM/VJzYzxeKan69enTp06p6pNmpuO0tFZeWyvPE6oPFe/r8Vg5XGodAxXfh4KPb6TJqVNmgcad3bpmFo6plQeswRRDJSO/spjU4ikyILgTkcAvy8dsyo/uwTrgTBeSlkkg1JAiiYIGr1LykKYIfkGUfRJwcRRFEFgBZZJ/kVQD6xGX+Ux1+RZEFiDxaVjkbjvDkyBpXgoObYaeRREMwqhGkYuWAvEkSth5EkQrSCEWtCV5EYYeRHEcmk9IYRBDD+Ujh5xjGtB4CyukfoBolZD+Rh94ghXgsASrJXy8NEzFmfdiAtBIALE0KrdQ1ycWIvfiD0QwJ9Lx0rLn1tUVCSWxzel42exgC0LgY/wjXhfQResxfdioQuxcacSat5QOn4rHl1UyP6jlOdLMiNrQRBuXiW+izAB15AuBKveLxmRZUPhOC4Wj2mYz8Fi/CgZkIUgONnN4oeUWTJdyvke/xPDzqZpQSAGnMfp4smayaVjZun4rxgUhUlBKDFknank+RUcdaOiMCUILwZ3GBWFKUH8RcrzEh43IIrfiYGopglBMKzsEo9rOipHqqystIIgzvBH8eQFuuxUcYo0gsAqrBJP3iBOQe2IVkRznOiBaVopnrxC22jNG+lYCEYUW8XPTeQZFebGyUw08tARBFPYM8WTd7hxad9EIe6kgsBv+JN4igIRY3yJn+L+QRIfgj5pmXiKBpOM4+O+OIkgEINPcCkedB3r4r44riC6xAefiowqim5IXEH4rqL4rInzojhOJWKYI56iQ9fRMIrZyELgM/iuonmgOi7SwWxkIYh4FW4Wc/r06TJnzhx5+/atZMGiRYukra1NPnz4IAWD9v4qEVYiSi2FsQ400KxZs2TBggXB80mTJgX/f+zYMXny5ImYZP369bJnz57g+cePH4P3f/bsmbx69cr4Z2UEVqK3dHyu9csoQeTWkaTBV65cGQhg+fLlIwKoZuvWrcYbacuWLaPOY8WKFcEBSiAPHjyQnp6e4Occgi+xROoUFtcThFrAKzdw8bn7N2/eHFiDeiIIw+s5TIkC60B3FHWOYYEgDI579+5JzqhrJepVbtFVrJUcMHfuXFm1apWsW7culgiqQQznzp0LRNTR0SFTpkwJ3ofnEydODB7DDA4OyqdPn4JH7vD379/Lmzdvgue7du0KrFJS+Pu+vj65evVq8DwnUDc6xkrUE8R34jgqiRB0GyDP4G+cOXMmD8JgFZu/Vf9nrVEGXcVCcQhm+cCBAzJ7dvOVdkydOlXWrl0rN2/elC9fvohDaPv/S1W9aK04hPORxbZt2yL76qJDl7Vv3z7JAWMGDtWCcO5M4ritXr1amh0cTxxex5BuN2pgMa7GC5wSHtY1O8QzdBxlw4xy0qoF4bS7aPauohq+K8Nox4zqEcKCoLtwZiG4OK3QVVSDIBxbiVHdxriqXzij1ayDAjHs2LFDHDMymx0WhDNnslWtg2LDhg2ub4aRCcywIDrFEViHVsfxNZilnihBUALmJDLZ6tZBwTVwaCWY8AraXwnCW4cc4PjGCFwGJQgnDiV3BNPXnjKORxzB2h7hLsM64WQWT3nE4TAuwT5lbruMVopKxsVhtzFiIZxZh1aMOzSCa+JwjqMDQbSLA9asiVUm0JIsXbpUHNGJIJwMN70zWR/d7DADdDgRBFO/3pmsD9eGjDEHtDvpMlQSqqc+jrrUwEJY38jEdxeNcXSNJjDtadVCZBF7IGH1xo0bQS2ESl7F5G7cuNHoMI7M62vXrgWJsiq1n88h95MhtMlRkyo7sFz8006iJSvWW7MSmMKFCxeKKah5OHHihDx9+nRUaR3p86omYtmyZdLenk73CO3o0aPBe4ZLBPmcFy9eyN27d2X8+PEyf/58MQWfw/eyyDCCsLq04Pbt24PMYxPQ2KdPn47MXkYkjx49SiUKxHD8+PHI1HnOobe3N7izTYni69evtot8JuguS6iNqToLGofCl7ivpVhHl4sXL8auozBZjONipGFVECYjcEkvPH2xTn+Mv0A3ERf8DPwZE7gYfloVBOV0pqA0Lin379+XpNy+fVuScufOHTGF7co1q4Lo7DQzh0bpvY5Z1rEQr1+/lqRgJUx1G6auWVysCsKU+dMts6eANynPnz8XHRh9mMCkVY0DgrC2nbDtL1eNjpBch9inTZsmFhm0ZiG4sKYuLiX9OugIkiUDdDD1XQl22RQlghgSC5hUuu5FmjdvniSFlWqSwvmZtIa6otRgCEEMiwWqF+ZIi06qmU4YWyc3wXSCi46QNRm2ZiFMZ0clTUhlhlVnCKeWJYoL52Q6NdCihRi05lSa/lJc+J07d8Z6LWKM+9paUKUdV9BZlCSatq4RDFkTRBaOEWtJ7N69O/K9aZyDBw+maqQ478E5sARSFlnTFp3KQSa32HEl8z26meE0OcupoH/F8WMSi8XC1IwnZp6ZVVZqmTx5sqSFibFNmzYFohgYGBiJM/AzSwTt3bs3s1xIZjwtzXr2kg9hxUJkmWHNe+/fv19sgGNqO1XeYnb6OxWH0NrBzdNUvOOfceEfPC1NYBS8hfAoggXRlSBSbQ8cB52JJU8ZS9dulIXgEzONWOZ0IfBCYOHa0f6jfAjI3Ep4csuIyxAWhPYG4nEwlR8Aebc2ps/PwrrYI8ZgfK3/zDNcnFOnTsnQ0FAQfDJdD5EGVbfBQbg5bYRUQcAtY0aMQVgQw5VfZLKaDPmMRBRNzAQiBoTBQc6jikpGbaaSFYiAAiHqMsIpemSHmWhItVtPhtDmI15r9fYIhLCTJwAkgMkfE+tKUa9QK/NaiYN8hKwytPhMREC9Byl24S6Cz+f7pU2O5T35flibjOmW8qbxAdWCoILrr5IxJiacFKTIk/ZeK4FWJapwcMeSsJpUJDQ+ibb9/f3BI59Tq083JQSwvKfG3yXCQsC3YmkRMmYrTfkANBSbrsWBz2OySnUv6vPVLjocqluKw+HDh418B4tWQYHfOKqIpJYgEMO3YgkuJHdW2gkjLmTcSi7TmOgGEQHnb3kEhRhGDSZq7ahDBtViibfrb2qYrlZFudy1Ov0+d/LJkyfFFS9fvgwcZp3aUbqHs2fPyq1bt2zvsEM38a/q/6zX6MQnrG7gqoTBBcJqJCkIvnDhQtaeeCQ05OfPn4OC4rgoIVy5ciWzDWcbQBnbmDmseoLghX8QS1YiDBenu7s7tsVQow3XsCQADmUjXwLRnz9/3qUQgBDDA6kxXdEW8UfI3flSL2qZvlrOJ/3tkSNHcrP1Ied36NChMbGQcMAqJ1FWhpndtX4RZQGcWYkwdCXcfdevXw/MLHtuk7CL9bh06ZI8fvxY8gLnSvexZMmSoOHZee/y5cvBUgSkwDnehS/MTakzmdnW4A9zYSVqQVxBt+4ya/J8bhJhHaCRIAhUfScOFibzZAIji+8lIo+2UW0nZuU/4mkWfpAGSdVxin0fiohPdyo+tGFPoxfFrf7uFk/ReRjnRXEFwRSpz6gqLn0SmtGMIsn6EFgJK5XiHqPQVcSyDpBEEIjBdx3FI5EPmDTo9JOUh6B+55NiwAgxUeROZ0khP+ooBom6CoVOWJpqcaYWu8RxWNtTF7r3f5SOxBMnug06XPkwZ9tDeyIhz0GrrCLNHa7m0q3mTXgaQjehHV1Oa/JRIevdONnZzzMGhPBvSYEJH4CAFVbCyWZunhFoh9RhAVNOISczs3T4ndXcQKEuOQ4/S0pMCYITIQHAi8I+iIEpbSNRZJPDRi8K+xgVA5iOIyhRTK4cnuzAof+nGJ5fyiKwpEThQ9zZwcwlRTapfYZqsow0/lh59HEKsxBnSL41UEyyDj1j1qgEmyE+zJ0WugYikJmmNDZKsjUFMYpvxMcqdGmYHGsKW3ct6ibBk9lV71ckA4vATnBWKnxsmnEcIPwKuhB2FvOp/dFwEyEEFr4w7jzWw0W/zqQY0+cIws+B1IbIL12E9QVlbfkQ9SCnguow71uUwUdgPiLTFQGjcC0IBaJAHK0qDFUQlTjDyTR5EQQgBiWMVkEJ4YnkJKM9T4JQKGGQjdWsjmfuhKDIoyAUCIOAVjP5GLkVgiLPggiDteiS4uZw4iT2iENnMS5FEYRCWY0usbR0YgpU+SMTUYWpeCuaIMIocWA1OsV9t0KjE195LWUhFLLssciCqIYgF8KYEXqeJQOVgyQVBNAUxUvNJIhaIAwWj+wIPU6oPBepb1VU4xJmH678PFR5HJAmrlz7BccI+z+sD4lzAAAAAElFTkSuQmCC)`;
                                                    });
                                                }
                                                
                                            });
                                        } else if (product.items[0].item_type === 'effect') {
                                            card.classList.add("type_1");

                                            card.querySelector("[data-product-card-sku-id]").textContent = ``;
                                            card.querySelector("[data-product-card-name]").textContent = product.name;
                                            card.querySelector("[data-product-card-summary]").textContent = product.summary;
                                            
                                            const previewHolder = card.querySelector("[data-shop-card-preview-holder]");
                                            previewHolder.classList.add('profile-effect-image');
                                        
                                            previewHolder.innerHTML = `
                                                <img class="thumbnail-preview" src="${product.items[0].static}">
                                            `;
                                        
                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                            const imgElement = card.querySelector("img");
                                        
                                            if (localStorage.reduced_motion != "true") {
                                                card.addEventListener("mouseenter", () => {
                                                    imgElement.src = product.items[0].animated;
                                                });
                                            
                                                card.addEventListener("mouseleave", () => {
                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                    imgElement.src = product.items[0].static;
                                                });
                                            }
                                        } else {
                                            card.classList.add('hidden')
                                        }
                                        
                                        
                                        const priceTextNitro = card.querySelector("[data-price-nitro]");
                                        const priceTextStandard = card.querySelector("[data-price-standard]");

                                        const priceContainerNitro = card.querySelector("[data-price-nitro-container]");
                                        const priceContainerStandard = card.querySelector("[data-price-standard-container]");

                                        const priceContainer = card.querySelector("[data-shop-price-container]");

                                        let priceStandard = "N/A";
                                        let priceNitro = "N/A";
                                        let priceOrb = "N/A";

                                        if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                            if (localStorage.discord_premium_type === "2") {
                                                if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                    product.prices["4"].country_prices.prices.forEach(price => {
                                                        if (price.currency === "usd") {
                                                            priceStandard = price.amount;
                                                        }
                                                        if (price.currency === "discord_orb") {
                                                            priceOrb = price.amount;
                                                        }
                                                    });
    
                                                    if (priceStandard != "N/A" && priceOrb != "N/A") {
                                                        let orb_price = document.createElement("div");
                                                
                                                        orb_price.innerHTML = `
                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                        `;
                                                        orb_price.style.position = `absolute`;
                                                        orb_price.style.right = `0px`;
                                                        
                                                        priceContainer.appendChild(orb_price);
    
                                                        standardPriceOutput = `US$${(priceStandard / 100).toFixed(2)}`;

                                                        priceContainerStandard.innerHTML = `
                                                            <a style="font-size: large; font-weight: 900; margin-left: 23px">${standardPriceOutput}</a>
                                                            <div class="nitro-icon" style="margin-left: -5px"></div>
                                                        `;
    
                                                    } else if (priceStandard != "N/A") {
    
                                                        standardPriceOutput = `US$${(priceStandard / 100).toFixed(2)}`;

                                                        priceContainerStandard.innerHTML = `
                                                            <a style="font-size: large; font-weight: 900; margin-left: 23px">${standardPriceOutput}</a>
                                                            <div class="nitro-icon" style="margin-left: -5px"></div>
                                                        `;
    
                                                    } else if (priceOrb != "N/A") {
    
                                                        let orb_price = document.createElement("div");
                                                
                                                        orb_price.innerHTML = `
                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                        `;
                                                        orb_price.style.position = `absolute`;
                                                        orb_price.style.left = `23px`;
                                                        orb_price.style.bottom = `0px`;
                                                        
                                                        priceContainer.appendChild(orb_price);
    
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                            </div>
                                                        `;
                                                        
                                                    }
                                                }
                                            } else {
                                                if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                    product.prices["0"].country_prices.prices.forEach(price => {
                                                        if (price.currency === "usd") {
                                                            priceStandard = price.amount;
                                                        }
                                                        if (price.currency === "discord_orb") {
                                                            priceOrb = price.amount;
                                                        }
                                                    });
    
                                                    if (priceStandard != "N/A" && priceOrb != "N/A") {
                                                        let orb_price = document.createElement("div");
                                                
                                                        orb_price.innerHTML = `
                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                        `;
                                                        orb_price.style.position = `absolute`;
                                                        orb_price.style.right = `0px`;
                                                        
                                                        priceContainer.appendChild(orb_price);
    
                                                        priceTextStandard.textContent = `US$${(priceStandard / 100).toFixed(2)}`;
    
                                                    } else if (priceStandard != "N/A") {
    
                                                        priceTextStandard.textContent = `US$${(priceStandard / 100).toFixed(2)}`;
    
                                                    } else if (priceOrb != "N/A") {
    
                                                        let orb_price = document.createElement("div");
                                                
                                                        orb_price.innerHTML = `
                                                            <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                            <div class="orb-icon" style="margin-left: -25px"></div>
                                                        `;
                                                        orb_price.style.position = `absolute`;
                                                        orb_price.style.left = `23px`;
                                                        orb_price.style.bottom = `0px`;
                                                        
                                                        priceContainer.appendChild(orb_price);
    
                                                        card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="unplublished-tag">
                                                                <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                            </div>
                                                        `;
                                                        
                                                    }
                                                }
                                            }

                                        } else {
                                            if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                product.prices["0"].country_prices.prices.forEach(price => {
                                                    if (price.currency === "usd") {
                                                        priceStandard = price.amount;
                                                    }
                                                });
                                            }
                                    
                                            if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                product.prices["4"].country_prices.prices.forEach(price => {
                                                    if (price.currency === "usd") {
                                                        priceNitro = price.amount;
                                                    }
                                                });
                                            }

                                            if (priceTextStandard) {
                                                priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                            }
    
                                            if (priceTextNitro) {
                                                priceTextNitro.textContent = priceNitro !== "N/A" ? `US$${(priceNitro / 100).toFixed(2)} with Nitro` : "null";
                                            }
                                        }

                                        if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 1: Enabled" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button") {
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                <div class="card-multi-button-container" card-multi-button-container>
                                                    <button class="card-button" onclick="openInDiscordShop('${product.sku_id}', null, 'card', '${product.unpublished_at}', '${product.category_sku_id}');" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP_V2")}</button>
                                                    <button class="card-button" onclick="copyEmoji('${product.sku_id}'); copyNotice('copysku');" title="${getTextString("CARD_COPU_SKU_ID_TITLE")}">${getTextString("CARD_COPU_SKU_ID")}</button>
                                                </div>
                                            `;
                                        } else {
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = `
                                                <button class="card-button" onclick="openInDiscordShop('${product.sku_id}', null, 'card', '${product.unpublished_at}', '${product.category_sku_id}');" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP")}</button>
                                            `;
                                        }

                                        if (product.items[0] && product.items[0].item_type && product.items[0].item_type === 'deco' || product.items[0] && product.items[0].item_type && product.items[0].item_type === 'effect' || product.sku_id === "0") {
                                            card.querySelector("[data-product-card-open-in-shop]").innerHTML = ``;
                                        }

                                        if (product.premium_type === 2) {
                                            card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                            `;
                                        }

                                        if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 1: Enable modals" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 3: Enable modals w/ p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 4: Enable modals w/ p+ on p+ page" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                            if (product.type === item_types.AVATAR_DECORATION || product.type === item_types.PROFILE_EFFECT || product.type === item_types.NAMEPLATE || product.type === item_types.BUNDLE || product.type === item_types.VARIANTS_GROUP || product.type === item_types.EXTERNAL_SKU) {
                                                card.classList.add('clickable');

                                                card.addEventListener("click", (event) => {
                                                    if (event.target.matches("[data-shop-card-var]") || event.target.matches(".card-button") || event.target.matches(".shareIcon_f4a996")) {
                                                    } else {
                                                        openItemModal();
                                                        addParams({itemSkuId: product.sku_id})
                                                    }
                                                });

                                                const itemSKUForScroll = params.get("itemSkuId");

                                                if (itemSKUForScroll === product.sku_id && modalIsAlreadyOpen != true) {
                                                    modalIsAlreadyOpen = true;
                                                    setTimeout(() => {
                                                        openItemModal();
                                                    }, 1000);
                                                }
                                                

                                                async function openItemModal() {
                                                    let modal = document.createElement("div");

                                                    modal.classList.add('modalv2');

                                                    if (apiCategory.pdp_bg != null) {
                                                        pdp = apiCategory.pdp_bg
                                                    } else {
                                                        pdp = apiCategory.banner
                                                    }

                                                    modal.innerHTML = `
                                                        <div class="modalv2-inner">
                                                            <div class="modalv2-inner-left">
                                                                <div data-modal-left-preview-holder></div>
                                                                <p class="shop-modal-product-sku-id" data-product-modal-sku-id></p>
                                                                <p class="shop-modal-product-name" style="font-size: large; font-weight: 900;" data-product-modal-name></p>
                                                                <p class="shop-modal-product-summary" style="color: var(--8)" data-product-modal-summary></p>
                                                                <div class="shop-modal-var-container-container" data-shop-modal-var-container-container>
                                                                    <div class="shop-modal-var-container" data-shop-modal-var-container></div>
                                                                    <a class="shop-modal-var-title" data-shop-modal-var-title></a>
                                                                </div>
                                                                <div class="modal-shop-price-container" data-shop-price-container></div>
                                                                <div class="modal-left-bottom">
                                                                    <div class="modal-buttons" data-modal-buttons></div>
                                                                </div>
                                                            </div>
                                                            <img class="modalv2-inner-logo" src="https://cdn.yapper.shop/assets/31.png" data-modalv2-inner-logo></img>
                                                            <div class="shop-modal-tag-container" data-shop-card-tag-container></div>

                                                            <div data-modal-top-product-buttons>
                                                                <div title="Close" data-close-product-card-button>
                                                                    <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                </div>
                                                            </div>

                                                            <div id="modalv2-inner-right" class="modalv2-inner-right">
                                                                <img class="modalv2-inner-img" src="https://cdn.discordapp.com/app-assets/1096190356233670716/${pdp}.png?size=4096"></img>
                                                                <div data-modal-preview-holder></div>
                                                            </div>
                                                        </div>
                                                    `;

                                                    document.body.appendChild(modal);

                                                    setTimeout(() => {
                                                        modal.classList.add('show');
                                                    }, 1);

                                                    if (apiCategory.logo != null) {
                                                        modal.querySelector("[data-modalv2-inner-logo]").src = `https://cdn.discordapp.com/app-assets/1096190356233670716/${apiCategory.logo}.png?size=4096`;
                                                    }

                                                    const button_container = document.querySelector("[data-modal-buttons]");
                                                    const top_button_container = document.querySelector("[data-modal-top-product-buttons]");
                                                    

                                                    let copyDiscordLink = document.createElement("div");

                                                    copyDiscordLink.title = getTextString("SHOP_SHARE_DISCORD_LINK");
                                                    copyDiscordLink.innerHTML = `
                                                        <svg data-share-product-card-button class="shareIcon_modal" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${product.sku_id}'); copyNotice('copylink');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                                    `;
                                                    
                                                    top_button_container.appendChild(copyDiscordLink);
                                                    
                                                    if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                        let downloadItemData = document.createElement("div");

                                                        downloadItemData.title = getTextString("SHOP_DOWNLOAD_DATA");
                                                        downloadItemData.innerHTML = `
                                                            <svg data-download-product-card-button class="downloadIcon_modal" onclick="window.open('https://item.yapper.shop/sku/${product.sku_id}/data.zip');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.0547 0.999993L11.0547 11.59L7.7547 8.28999C7.66429 8.186 7.55337 8.10181 7.4289 8.04271C7.30442 7.98361 7.16907 7.95088 7.03134 7.94656C6.89362 7.94224 6.75648 7.96643 6.62855 8.01761C6.50061 8.0688 6.38464 8.14587 6.28789 8.24399C6.19115 8.34212 6.11573 8.45917 6.06637 8.58782C6.01701 8.71647 5.99476 8.85393 6.00104 8.99159C6.00731 9.12924 6.04196 9.26411 6.10282 9.38773C6.16368 9.51136 6.24943 9.62107 6.3547 9.70999L11.3547 14.71C11.5416 14.8932 11.7929 14.9959 12.0547 14.9959C12.3164 14.9959 12.5678 14.8932 12.7547 14.71L17.7547 9.70999C17.92 9.51987 18.0074 9.27437 17.9995 9.02257C17.9916 8.77078 17.889 8.53124 17.7121 8.35185C17.5352 8.17245 17.2972 8.06642 17.0455 8.05496C16.7939 8.04349 16.5471 8.12743 16.3547 8.28999L13.0547 11.6L13.0547 0.999993C13.0547 0.734776 12.9493 0.480422 12.7618 0.292885C12.5743 0.105349 12.3199 -7.13283e-06 12.0547 -7.10964e-06C11.7895 -7.08645e-06 11.5351 0.105349 11.3476 0.292885C11.1601 0.480422 11.0547 0.734776 11.0547 0.999993Z" fill="currentColor"/><path d="M4 15C4 14.7348 4.10536 14.4804 4.29289 14.2929C4.48043 14.1054 4.73478 14 5 14H7C7.26522 14 7.51957 13.8946 7.70711 13.7071C7.89464 13.5196 8 13.2652 8 13C8 12.7348 7.89464 12.4804 7.70711 12.2929C7.51957 12.1054 7.26522 12 7 12H5C4.20435 12 3.44129 12.3161 2.87868 12.8787C2.31607 13.4413 2 14.2044 2 15V19C2 19.7956 2.31607 20.5587 2.87868 21.1213C3.44129 21.6839 4.20435 22 5 22H19C19.7956 22 20.5587 21.6839 21.1213 21.1213C21.6839 20.5587 22 19.7956 22 19V15C22 14.2044 21.6839 13.4413 21.1213 12.8787C20.5587 12.3161 19.7956 12 19 12H17C16.7348 12 16.4804 12.1054 16.2929 12.2929C16.1054 12.4804 16 12.7348 16 13C16 13.2652 16.1054 13.5196 16.2929 13.7071C16.4804 13.8946 16.7348 14 17 14H19C19.2652 14 19.5196 14.1054 19.7071 14.2929C19.8946 14.4804 20 14.7348 20 15V19C20 19.2652 19.8946 19.5196 19.7071 19.7071C19.5196 19.8946 19.2652 20 19 20H5C4.73478 20 4.48043 19.8946 4.29289 19.7071C4.10536 19.5196 4 19.2652 4 19V15Z" fill="currentColor"/></svg>
                                                        `;

                                                        top_button_container.appendChild(downloadItemData);
                                                    }

                                                    if (localStorage.experiment_2025_03_view_raw_modal === "Treatment 1: Enabled") {
                                                        let rawItemData = document.createElement("div");

                                                        rawItemData.title = getTextString("SHOP_VIEW_RAW_DATA");
                                                        rawItemData.innerHTML = `
                                                            <svg data-view-raw-product-card-button class="shareIcon_modal" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15.7376 3.18925C15.4883 2.93731 15.0814 2.93686 14.8316 3.18824L14.0087 4.01625C13.7618 4.26471 13.7614 4.66581 14.0078 4.91476L20.3804 11.3527C20.6265 11.6013 20.6265 12.0017 20.3804 12.2503L14.0078 18.6882C13.7614 18.9373 13.7618 19.3383 14.0087 19.5867L14.8316 20.4148C15.0814 20.6662 15.4883 20.6658 15.7376 20.4138L23.815 12.2503C24.061 12.0016 24.061 11.6014 23.815 11.3528L15.7376 3.18925Z" fill="currentColor"/><path d="M9.99171 4.91476C10.2381 4.66581 10.2377 4.26471 9.99081 4.01625L9.16787 3.18824C8.91804 2.93686 8.51118 2.93731 8.2619 3.18925L0.184466 11.3528C-0.0614893 11.6014 -0.061488 12.0016 0.184466 12.2503L8.2619 20.4138C8.51118 20.6658 8.91803 20.6662 9.16787 20.4148L9.99081 19.5867C10.2377 19.3383 10.2381 18.9373 9.99171 18.6882L3.61906 12.2503C3.37298 12.0017 3.37298 11.6013 3.61906 11.3527L9.99171 4.91476Z" fill="currentColor"/></svg>
                                                        `;

                                                        top_button_container.appendChild(rawItemData);

                                                        modal.querySelector("[data-view-raw-product-card-button]").onclick = function(){
                                                            openRawModal();
                                                        };

                                                        async function openRawModal() {
                                                            let modal = document.createElement("div");
                    
                                                            modal.classList.add('modalv2');
                    
                                                            modal.innerHTML = `
                                                                <div class="view-raw-modalv2-inner">
                                                                    <textarea class="view-raw-modal-textbox" readonly>${JSON.stringify(product, undefined, 4)}</textarea>
                                                                </div>
                                                            `;
                    
                                                            document.body.appendChild(modal);
                    
                                                            setTimeout(() => {
                                                                modal.classList.add('show');
                                                            }, 1);
                                                            
                    
                                                            let modal_back = document.createElement("div");
                    
                                                            modal_back.classList.add('modalv2-back');
                                                            modal_back.id = 'modalv2-back';
                    
                                                            document.body.appendChild(modal_back);
                    
                                                            setTimeout(() => {
                                                                modal_back.classList.add('show');
                                                            }, 1);
                    
                    
                                                            modal.addEventListener('click', (event) => {
                                                                if (event.target === modal) {
                                                                    modal.classList.remove('show');
                                                                    modal_back.classList.remove('show');
                                                                    setTimeout(() => {
                                                                        modal.remove();
                                                                        modal_back.remove();
                                                                    }, 300);
                                                                }
                                                            });
                    
                                                            document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                                modal.classList.remove('show');
                                                                modal_back.classList.remove('show');
                                                                setTimeout(() => {
                                                                    modal.remove();
                                                                    modal_back.remove();
                                                                }, 300);
                                                            });
                                                        }
                                                    }

                                                    button_container.innerHTML = `
                                                        <button class="card-button" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}" onclick="location.href='https://discord.com/shop#itemSkuId=${product.sku_id}';">${getTextString("CARD_OPEN_IN_SHOP")}</button>
                                                    `;

                                                    if (product.type === item_types.AVATAR_DECORATION) {

                                                        modal.classList.add('modal-0');

                                                        product.items.forEach(item => {

                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                            const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");

                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                            modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                            modal.querySelector("[data-product-modal-summary]").textContent = product.summary;

                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {

                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile1">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true">
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                    </div>
                                                                `;

                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                previewHolderLeft.classList.add('modal-left-avatar-decoration-img');

                                                                const imgElement = document.createElement("img");
                                                                imgElement.id = "shop-card-deco-image";
                                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;

                                                                previewHolderLeft.appendChild(imgElement);

                                                                if (localStorage.reduced_motion != "true") {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                    });
                                                                }

                                                            } else {
                                                                
                                                                previewHolder.classList.add('modal-avatar-decoration-img');

                                                                const imgElement = document.createElement("img");
                                                                imgElement.id = "shop-card-deco-image";
                                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;

                                                                previewHolder.appendChild(imgElement);

                                                                // Hover effect: Change the image src on mouse enter and leave
                                                                if (localStorage.reduced_motion != "true") {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                    });
                                                                }
                                                            }

                                                        });
                                                    } else if (product.type === item_types.PROFILE_EFFECT) {
                                                        modal.classList.add('modal-1');
        
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;

                                                        // Ensure the item ID is accessible here
                                                        let itemId = undefined;
                                                        if (Array.isArray(product.items)) {
                                                            // If items is an array, find the item with type 1 and get its id
                                                            const item = product.items.find(item => item.type === 1);
                                                            if (item) {
                                                                itemId = item.id;
                                                            }
                                                        } else if (product.items && product.items.type === 1) {
                                                            // If items is an object and has type 1, get its id
                                                            itemId = product.items.id;
                                                        }
                                                    
                                                    
                                                        if (!discordProfileEffectsCache) {
                                                            await setDiscordProfileEffectCache();
                                                        }
                                                    
                                                        // Find matching profile effect
                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);

                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                    
                                                        if (matchingEffect) {
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                previewHolder.innerHTML = `
                                                                    <div class="modal-preview-profile2">
                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                        <div class="options-preview-profile-status-color"></div>
                                                                        <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${matchingEffect.effects[0]?.src}">
                                                                    </div>
                                                                `;

                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                previewHolderLeft.classList.add('modal-left-profile-effect-img');
                                                            
                                                                const imgElement = document.createElement("img");
                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;

                                                                previewHolderLeft.appendChild(imgElement);
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    imgElement.addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    imgElement.addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            } else {
                                                                const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                previewHolder.classList.add('modal-profile-effect-img');
                                                            
                                                                previewHolder.innerHTML = `
                                                                    <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                `;
                                                            
                                                                // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                const imgElement = previewHolder.querySelector("img");
                                                            
                                                                if (localStorage.reduced_motion != "true") {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                            const effectUrl = matchingEffect.effects[0]?.src;
                                                                            imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                        }
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                } else {
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                        imgElement.src = matchingEffect.reducedMotionSrc;
                                                                    });
                                                                
                                                                    document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                        // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                        imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                    });
                                                                }
                                                            }
                                                        }
                                                    } else if (product.type === item_types.NAMEPLATE) {
                                                        card.classList.add("modal-2");
            
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
            
                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        previewHolder.classList.add('nameplate-modal-preview');

                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
            
                                                        if (localStorage.discord_displayname && localStorage.discord_displayname != '') {
                                                            previewName = localStorage.discord_displayname;
                                                        } else {
                                                            previewName = 'Default User'
                                                        }

                                                        if (localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 2: Nameplate & Nameplate Test Warning" && product.category_sku_id === discord_categories.NAMEPLATE) {
                                                            let nameplateWarning = document.createElement("div");

                                                            nameplateWarning.classList.add('nameplate-modal-early-warning-container');
                                                            nameplateWarning.innerHTML = `
                                                                <p>${getTextString("SHOP_NAMEPLATE_WARNING_NOTICE_1")}</p>
                                                            `;

                                                            modal.querySelector(".modalv2-inner-left").appendChild(nameplateWarning);
                                                        } else if (localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 1: Nameplate Test Warning" || localStorage.experiment_2025_03_early_nameplate_warning === "Treatment 2: Nameplate & Nameplate Test Warning") {
                                                            if (product.category_sku_id === discord_categories.NAMEPLATE_TEST) {
                                                                let nameplateWarning = document.createElement("div");

                                                                nameplateWarning.classList.add('nameplate-modal-early-warning-container');
                                                                nameplateWarning.innerHTML = `
                                                                    <p>${getTextString("SHOP_NAMEPLATE_WARNING_NOTICE_2")}</p>
                                                                `;

                                                                modal.querySelector(".modalv2-inner-left").appendChild(nameplateWarning);
                                                            }
                                                        }
            
                                                        previewHolder.innerHTML = `
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _1"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _2"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                            <div class="nameplate-null-user" data-user-nameplate-preview>
                                                                <video disablepictureinpicture muted loop class="nameplate-null-user" style="position: absolute; height: 100%; width: auto; right: 0;" data-user-nameplate-preview-img></video>
                                                                <div class="nameplate-user-avatar" data-nameplate-user-random-avatar></div>
                                                                <p class="nameplate-user-name">${previewName}</p>
                                                            </div>
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _2"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                            <div class="nameplate-null-user">
                                                                <div class="nameplate-null-user-avatar"></div>
                                                                <div class="nameplate-null-user-name _1"></div>
                                                                <div class="nameplate-preview-status-bg"></div>
                                                                <div class="nameplate-preview-status-color"></div>
                                                            </div>
                                                        `;

                                                        previewHolderLeft.innerHTML = `
                                                            <div class="nameplate-null-user" data-user-nameplate-preview-left>
                                                                <video disablepictureinpicture muted loop class="nameplate-null-user" style="position: absolute; height: 100%; width: auto; right: 0;" data-user-nameplate-preview-img-left></video>
                                                                <div class="nameplate-user-avatar" data-nameplate-user-random-avatar-left></div>
                                                                <p class="nameplate-user-name">${previewName}</p>
                                                            </div>
                                                        `;
            
                                                        product.items.forEach(item => {
                                                            const nameplatePreview = previewHolder.querySelector("[data-user-nameplate-preview]");
                                                            const paletteName = item.palette;
                                                            const asset = `https://cdn.discordapp.com/assets/collectibles/${item.asset}asset.webm`;
                                                            const bgcolor = nameplate_palettes[paletteName].darkBackground;
            
                                                            const videoElement = previewHolder.querySelector("[data-user-nameplate-preview-img]");

                                                            videoElement.src = asset;
            
                                                            nameplatePreview.style.backgroundImage = `linear-gradient(90deg, #00000000 -30%, ${bgcolor} 200%)`;
                                                            // nameplatePreview.style.boxShadow = `0 0 0 1px #a10606`;
                                                            
                                                            const nullUserNameRandomWidth = previewHolder.querySelectorAll("[data-null-user-random-name]");
                                                            
                                                            nullUserNameRandomWidth.forEach(UserName => {
                                                                const randomWidth = Math.floor(Math.random() * (180 - 80 + 1)) + 80;
                                                                UserName.style.width = randomWidth + `px`;
                                                            });
                                                        
                                                            const nullUserAvatar = previewHolder.querySelectorAll("[data-nameplate-user-random-avatar]");
                                                        
                                                            nullUserAvatar.forEach(UserAvatar => {
                                                                UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                            });

                                                            if (localStorage.reduced_motion != "true") {
                                                                videoElement.play();
                                                            }



                                                            const videoElementLeft = previewHolderLeft.querySelector("[data-user-nameplate-preview-img-left]");
                                                            const nameplatePreviewLeft = previewHolderLeft.querySelector("[data-user-nameplate-preview-left]");
                                                            previewHolderLeft.classList.add("modal-left-nameplate-preview");

                                                            videoElementLeft.src = asset;

                                                            nameplatePreviewLeft.style.backgroundImage = `linear-gradient(90deg, #00000000 -30%, ${bgcolor} 200%)`;

                                                            const nullUserAvatarLeft = previewHolderLeft.querySelectorAll("[data-nameplate-user-random-avatar-left]");
                                                        
                                                            nullUserAvatarLeft.forEach(UserAvatar => {
                                                                UserAvatar.style.backgroundImage = `url(${localStorage.discord_avatar})`;
                                                            });

                                                            if (localStorage.reduced_motion != "true") {
                                                                videoElementLeft.addEventListener("mouseenter", () => {
                                                                    videoElementLeft.play();
                                                                });
                                                            
                                                                videoElementLeft.addEventListener("mouseleave", () => {
                                                                    videoElementLeft.pause();
                                                                });
                                                            }
                                                        });
                                                        
                                                    } else if (product.type === item_types.BUNDLE) {
                                                        modal.classList.add('modal-1000');

                                                        const bundledProducts = product.bundled_products || [];

                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                    
                                                        // Generate the bundle summary from the names of the bundled products
                                                        const type0Product = bundledProducts.find(item => item.type === 0);
                                                        const type1Product = bundledProducts.find(item => item.type === 1);
                                                    
                                                        let bundleSummary = `${getTextString("CARD_TYPE_BUNDLE_TITLE")}`;
                                                        if (type0Product) {
                                                            bundleSummary += `${type0Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_DECO")}`;
                                                        }
                                                        if (type1Product) {
                                                            bundleSummary += `${type1Product.name}${getTextString("CARD_TYPE_BUNDLE_TITLE_EFFECT")}`;
                                                        }
                                                    
                                                        // Set the summary text
                                                        modal.querySelector("[data-product-modal-summary]").textContent = bundleSummary;
                                                    
                                                        // Set the basic card details
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                    
                                                        // Handle each item in the bundle
                                                        product.items.forEach(item => {
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                
                                                                if (item.type === 0) {
                                                                    decosrc = item.asset
                                                                } else if (item.type === 1) {
                                                                    // Profile effect
                                                                    (async () => {
                                                                        if (!discordProfileEffectsCache) {
                                                                            await setDiscordProfileEffectCache();
                                                                        }
                                                                        
                                                    
                                                                        // Find the matching effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                                    
                                                                        if (matchingEffect) {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                renderProfile(effectUrl)
                                                                            }
                                                                        }
                                                                    })();
                                                                }

                                                                function renderProfile(effectUrl) {
                                                                    previewHolder.classList.add('modal-preview-profile-container');
                                                                    previewHolder.innerHTML = `
                                                                        <div class="modal-preview-profile2">
                                                                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                            <div class="profile-avatar-preview-bg"></div>
                                                                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                            <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                            <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.discordapp.com/avatar-decoration-presets/${decosrc}.png?size=4096&passthrough=true">
                                                                            <div class="options-preview-profile-status-bg"></div>
                                                                            <div class="options-preview-profile-status-color"></div>
                                                                            <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                        </div>
                                                                    `;
                                                                    document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                }

                                                                
                                                            } else {
                                                                if (item.type === 0) {
                                                                    const decoImage = document.createElement("img");
                                                                    decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                    decoImage.alt = "Avatar Decoration";
                                                                    decoImage.classList.add("modal-avatar-decoration-img");
                                                                    modal.querySelector("[data-modal-preview-holder]").appendChild(decoImage);
                                                    
                                                                    // Hover effect for decoration image
                                                                    if (localStorage.reduced_motion != "true") {
                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                        });

                                                                        document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                            decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        });
                                                                    }
                                                                } else if (item.type === 1) {
                                                                    // Profile effect
                                                                    (async () => {
                                                                        // Fetch profile effects if not cached
                                                                        if (!discordProfileEffectsCache) {
                                                                            const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                method: "GET",
                                                                                headers: {
                                                                                    "Password": api_password,
                                                                                    "Authorization": discord_token,
                                                                                    "Token": api_token
                                                                                }
                                                                            });
                                                                            const effectsData = await response.json();
                                                                            discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                        }
                                                    
                                                                        // Find the matching effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === item.id);
                                                    
                                                                        if (matchingEffect) {
                                                                            const effectImage = document.createElement("img");
                                                                            effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                            effectImage.alt = "Profile Effect";
                                                                            effectImage.classList.add("modal-profile-effect-img");
                                                                            modal.querySelector("[data-modal-preview-holder]").appendChild(effectImage);
                                                    
                                                                            // Hover effect for profile effect
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        effectImage.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    effectImage.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    effectImage.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        }
                                                                    })();
                                                                }
                                                            }
                                                        });
                                                    } else if (product.type === item_types.VARIANTS_GROUP) {
                                                        modal.querySelector("[data-shop-modal-var-container-container]").classList.add('show');
                                                        // Update SKU and summary
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
                                                    
                                                        // Always display the base variant name
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.variants[0]?.base_variant_name || "Product";
                                                    
                                                        // Render variant color blocks as interactive divs
                                                        const variantContainer = modal.querySelector("[data-shop-modal-var-container]");
                                                        variantContainer.innerHTML = ""; // Clear existing variant blocks
                                                        let currentSelectedVariant = null; // Track selected variant
                                                    
                                                        product.variants.forEach((variant, index) => {
                                                            // Create variant color block
                                                            const variantColorBlock = document.createElement("div");
                                                            variantColorBlock.classList.add("shop-card-var");
                                                            variantColorBlock.style.backgroundColor = `${variant.variant_value}`;
                                                    
                                                            // Add click event listener to switch variants
                                                            variantColorBlock.addEventListener("click", () => {
                                                                if (currentSelectedVariant) {
                                                                    currentSelectedVariant.classList.remove("shop-card-var-selected");
                                                                }
                                                                variantColorBlock.classList.add("shop-card-var-selected");
                                                                currentSelectedVariant = variantColorBlock;
                                                                applyVariant(variant);
                                                            });
                                                    
                                                            // Append the color block to the container
                                                            variantContainer.appendChild(variantColorBlock);
                                                    
                                                            // Set the first variant as the default selected
                                                            if (index === 0) {
                                                                currentSelectedVariant = variantColorBlock;
                                                                variantColorBlock.classList.add("shop-card-var-selected");
                                                            }
                                                        });
            
                                                        let isFirstTimeLoadingVariant = true;
                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                        const previewHolderLeft = modal.querySelector("[data-modal-left-preview-holder]");
                                                    
                                                        // Function to apply the selected variant
                                                        function applyVariant(selectedVariant) {
                                                            modal.querySelector("[data-shop-modal-var-title]").textContent = `(${selectedVariant.variant_label})`;
                                                            modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${selectedVariant.sku_id}`;
                                                            modal.querySelector("[data-share-product-card-button]").onclick = function(){
                                                                copyEmoji(`https://canary.discord.com/shop#itemSkuId=${selectedVariant.sku_id}`);
                                                            };
                                                            if (localStorage.experiment_2025_02_shop_card_modals === "Treatment 2: Enable modals w/ data downloads" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 5: Enable modals w/ data downloads and p+" || localStorage.experiment_2025_02_shop_card_modals === "Treatment 6: Enable modals w/ data downloads and p+ on p+ page") {
                                                                modal.querySelector("[data-download-product-card-button]").onclick = function(){
                                                                    window.open(`https://item.yapper.shop/sku/${selectedVariant.sku_id}/data.zip`);
                                                                };
                                                            }
                                                            if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                                
                                                                if (selectedVariant.type === 0) {
                                                                    selectedVariant.items?.forEach(item => {
                                                                        previewHolder.classList.add('modal-preview-profile-container');
                                                                        previewHolder.innerHTML = `
                                                                            <div class="modal-preview-profile1">
                                                                                <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                <div class="profile-avatar-preview-bg"></div>
                                                                                <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                <img id="profileAvatarDecoPreview" class="profile-avatar-deco-preview" src="https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true">
                                                                                <div class="options-preview-profile-status-bg"></div>
                                                                                <div class="options-preview-profile-status-color"></div>
                                                                            </div>
                                                                        `;
                                                                        document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();

                                                                        previewHolderLeft.classList.add('modal-left-avatar-decoration-img');

                                                                        previewHolderLeft.innerHTML = `
                                                                            <img id="shop-card-deco-image" src="https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&amp;passthrough=false" data-left-preview-deco-var>
                                                                        `;

                                                                        const imgElement = previewHolderLeft.querySelector("[data-left-preview-deco-var]");
                                                                        
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                imgElement.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                            });
                                                                        }
                                                                    });
                                                                } else if (selectedVariant.type === 1) {

                                                                    modal.classList.add("modal-2000-1");
                                                                    (async () => {
                                                                        // Ensure the item ID is accessible here
                                                                        let itemId = undefined;
                                                                        if (Array.isArray(selectedVariant.items)) {
                                                                            // If items is an array, find the item with type 1 and get its id
                                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                                            if (item) {
                                                                                itemId = item.id;
                                                                            }
                                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                            // If items is an object and has type 1, get its id
                                                                            itemId = selectedVariant.items.id;
                                                                        }
                                                                    
                                                                    
                                                                        if (!discordProfileEffectsCache) {
                                                                            await setDiscordProfileEffectCache();
                                                                        }
                                                                    
                                                                        // Find matching profile effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                                    
                                                                        if (matchingEffect) {
                                                                            if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                const effectUrl = matchingEffect.effects[0]?.src;
                                                                                previewHolder.classList.add('modal-preview-profile-container');
                                                                                previewHolder.innerHTML = `
                                                                                    <div class="modal-preview-profile2">
                                                                                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                                        <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                                        <div class="profile-avatar-preview-bg"></div>
                                                                                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                                        <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                                        <div class="options-preview-profile-status-bg"></div>
                                                                                        <div class="options-preview-profile-status-color"></div>
                                                                                        <img id="profileProfileEffectPreview" class="profile-profile-effect-preview" src="${effectUrl}">
                                                                                    </div>
                                                                                `;
                                                                                document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                                            }
                                                                        }

                                                                        previewHolderLeft.classList.add('modal-left-profile-effect-img');

                                                                        previewHolderLeft.innerHTML = `
                                                                            <img src="${matchingEffect.thumbnailPreviewSrc}" data-left-preview-effect-var>
                                                                        `;

                                                                        const imgElement = previewHolderLeft.querySelector("[data-left-preview-effect-var]");
                                                                        
                                                                        if (localStorage.reduced_motion != "true") {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                    const effectUrl = matchingEffect.effects[0]?.src;
                                                                                    imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                }
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                            });
                                                                        } else {
                                                                            imgElement.addEventListener("mouseenter", () => {
                                                                                imgElement.src = matchingEffect.reducedMotionSrc;
                                                                            });
                                                                        
                                                                            imgElement.addEventListener("mouseleave", () => {
                                                                                // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                            });
                                                                        }
                                                                    })();
                                                                }

                                                                
                                                            } else {
                                                                if (selectedVariant.type === 0) {
                                                                    modal.classList.add("modal-2000-0");
                                                                    previewHolder.innerHTML = ""; // Clear previous decorations
                                                                    previewHolder.classList.add('modal-avatar-decoration-img');
                                                                    
                                                                    // Add the avatar decoration based on the selected variant
                                                                    selectedVariant.items?.forEach(item => {
                                                                        const decoImage = document.createElement("img");
                                                                        decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                        decoImage.alt = "Avatar Decoration";
                                                                        decoImage.id = "shop-card-deco-image";
                                                                        previewHolder.appendChild(decoImage);
                                                                    
                                                                        // Hover effect for decoration image
                                                                        if (localStorage.reduced_motion !== "true") {
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=true`;
                                                                            });
                                                                            document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                decoImage.src = `https://cdn.discordapp.com/avatar-decoration-presets/${item.asset}.png?size=4096&passthrough=false`;
                                                                            });
                                                                        }
                                                                    });
                                                                } else if (selectedVariant.type === 1) {
                                                                    modal.classList.add("modal-2000-1");
                                                                    (async () => {
                                                                        // Ensure the item ID is accessible here
                                                                        let itemId = undefined;
                                                                        if (Array.isArray(selectedVariant.items)) {
                                                                            // If items is an array, find the item with type 1 and get its id
                                                                            const item = selectedVariant.items.find(item => item.type === 1);
                                                                            if (item) {
                                                                                itemId = item.id;
                                                                            }
                                                                        } else if (selectedVariant.items && selectedVariant.items.type === 1) {
                                                                            // If items is an object and has type 1, get its id
                                                                            itemId = selectedVariant.items.id;
                                                                        }
                                                                    
                                                                    
                                                                        // Fetch profile effects API only if not already cached
                                                                        if (!discordProfileEffectsCache) {
                                                                            const response = await fetch(api + PROFILE_EFFECTS, {
                                                                                method: "GET",
                                                                                headers: {
                                                                                    "Password": api_password,
                                                                                    "Authorization": discord_token,
                                                                                    "Token": api_token
                                                                                }
                                                                            });
                                                                            const effectsData = await response.json();
                                                                            discordProfileEffectsCache = effectsData.profile_effect_configs;
                                                                        }
                                                                    
                                                                        // Find matching profile effect
                                                                        const matchingEffect = discordProfileEffectsCache.find(effect => effect.id === itemId);
                                                                    
                                                                        if (matchingEffect) {
                                                                            const previewHolder = modal.querySelector("[data-modal-preview-holder]");
                                                                            previewHolder.classList.add('modal-profile-effect-img');
                                                                        
                                                                            previewHolder.innerHTML = `
                                                                                <img class="thumbnail-preview" src="${matchingEffect.thumbnailPreviewSrc}">
                                                                            `;
                                                                        
                                                                            // Hover effect: change to the first effect URL (use 'src' from the 'effects' array)
                                                                            const imgElement = previewHolder.querySelector("img");
                                                                        
                                                                            if (localStorage.reduced_motion != "true") {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    if (matchingEffect.effects && matchingEffect.effects.length > 0) {
                                                                                        const effectUrl = matchingEffect.effects[0]?.src;
                                                                                        imgElement.src = effectUrl || matchingEffect.thumbnailPreviewSrc;
                                                                                    }
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            } else {
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseenter", () => {
                                                                                    imgElement.src = matchingEffect.reducedMotionSrc;
                                                                                });
                                                                            
                                                                                document.getElementById('modalv2-inner-right').addEventListener("mouseleave", () => {
                                                                                    // Revert back to the original thumbnailPreviewSrc when hover ends
                                                                                    imgElement.src = matchingEffect.thumbnailPreviewSrc;
                                                                                });
                                                                            }
                                                                        }
                                                                    })();
                                                                }
                                                            }
                                                        }
                                                    
                                                        // Apply the default variant (first one) initially
                                                        if (product.variants.length > 0) {
                                                            applyVariant(product.variants[0]);
                                                        }
                                                    } else if (product.type === item_types.EXTERNAL_SKU) {
                                                        modal.classList.add('modal-3000');
            
                                                        modal.querySelector("[data-product-modal-sku-id]").textContent = `SKU ID: ${product.sku_id}`;
                                                        modal.querySelector("[data-product-modal-name]").textContent = product.name;
                                                        modal.querySelector("[data-product-modal-summary]").textContent = product.summary;
            
                                                        const previewHolder = modal.querySelector("[data-modal-preview-holder]");
            
                                                        if (product.sku_id === ORB_PROFILE_BADGE) {
                                                            previewHolder.classList.add('modal-preview-profile-container');
                                                            previewHolder.innerHTML = `
                                                                <div class="modal-preview-profile3">
                                                                    <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                                                                    <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                                                                    <div class="profile-avatar-preview-bg"></div>
                                                                    <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                                                                    <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                                                                    <p class="options-preview-profile-username" id="modal-username-preview"></p>
                                                                    <div class="options-preview-profile-status-bg"></div>
                                                                    <div class="options-preview-profile-status-color"></div>
                                                                    <div class="options-preview-profile-badge-container">
                                                                        <img class="options-preview-profile-badge" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTg3IiBoZWlnaHQ9IjE4NyIgdmlld0JveD0iMCAwIDE4NyAxODciIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxnIGNsaXAtcGF0aD0idXJsKCNjbGlwMF8xNDBfMikiPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDFfMTQwXzIpIj4KPHBhdGggZD0iTTg5Ljg1MzUgMC43MTg3ODFDOTIuMTYxOCAtMC4yMzk1OTQgOTQuNzU2NCAtMC4yMzk1OTQgOTcuMDY0NyAwLjcxODc4MUwxNTYuNDg0IDI1LjMzMjdDMTU4Ljc5MiAyNi4yOTEgMTYwLjYyNyAyOC4xMjYgMTYxLjU4NiAzMC40MzQzTDE4Ni4xOTkgODkuODUzNUMxODcuMTU4IDkyLjE2MTggMTg3LjE1OCA5NC43NTY0IDE4Ni4xOTkgOTcuMDY0N0wxNjEuNTg2IDE1Ni40ODRDMTYwLjYyNyAxNTguNzkyIDE1OC43OTIgMTYwLjYyNyAxNTYuNDg0IDE2MS41ODZMOTcuMDY0NyAxODYuMTk5Qzk0Ljc1NjQgMTg3LjE1OCA5Mi4xNjE4IDE4Ny4xNTggODkuODUzNSAxODYuMTk5TDMwLjQzNDMgMTYxLjU4NkMyOC4xMjYgMTYwLjYyNyAyNi4yOTEgMTU4Ljc5MiAyNS4zMzI3IDE1Ni40ODRMMC43MTg3ODEgOTcuMDY0N0MtMC4yMzk1OTQgOTQuNzU2NCAtMC4yMzk1OTQgOTIuMTYxOCAwLjcxODc4MSA4OS44NTM1TDI1LjMzMjcgMzAuNDM0M0MyNi4yOTEgMjguMTI2IDI4LjEyNiAyNi4yOTEgMzAuNDM0MyAyNS4zMzI3TDg5Ljg1MzUgMC43MTg3ODFaIiBmaWxsPSJ3aGl0ZSIvPgo8bWFzayBpZD0ibWFzazBfMTQwXzIiIHN0eWxlPSJtYXNrLXR5cGU6bHVtaW5hbmNlIiBtYXNrVW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4PSIwIiB5PSIwIiB3aWR0aD0iMTg3IiBoZWlnaHQ9IjE4NyI+CjxwYXRoIGQ9Ik04OS44NTM1IDAuNzE4NzgxQzkyLjE2MTggLTAuMjM5NTk0IDk0Ljc1NjQgLTAuMjM5NTk0IDk3LjA2NDcgMC43MTg3ODFMMTU2LjQ4NCAyNS4zMzI3QzE1OC43OTIgMjYuMjkxIDE2MC42MjcgMjguMTI2IDE2MS41ODYgMzAuNDM0M0wxODYuMTk5IDg5Ljg1MzVDMTg3LjE1OCA5Mi4xNjE4IDE4Ny4xNTggOTQuNzU2NCAxODYuMTk5IDk3LjA2NDdMMTYxLjU4NiAxNTYuNDg0QzE2MC42MjcgMTU4Ljc5MiAxNTguNzkyIDE2MC42MjcgMTU2LjQ4NCAxNjEuNTg2TDk3LjA2NDcgMTg2LjE5OUM5NC43NTY0IDE4Ny4xNTggOTIuMTYxOCAxODcuMTU4IDg5Ljg1MzUgMTg2LjE5OUwzMC40MzQzIDE2MS41ODZDMjguMTI2IDE2MC42MjcgMjYuMjkxIDE1OC43OTIgMjUuMzMyNyAxNTYuNDg0TDAuNzE4NzgxIDk3LjA2NDdDLTAuMjM5NTk0IDk0Ljc1NjQgLTAuMjM5NTk0IDkyLjE2MTggMC43MTg3ODEgODkuODUzNUwyNS4zMzI3IDMwLjQzNDNDMjYuMjkxIDI4LjEyNiAyOC4xMjYgMjYuMjkxIDMwLjQzNDMgMjUuMzMyN0w4OS44NTM1IDAuNzE4NzgxWiIgZmlsbD0id2hpdGUiLz4KPC9tYXNrPgo8ZyBtYXNrPSJ1cmwoI21hc2swXzE0MF8yKSI+CjxwYXRoIGQ9Ik05My40NTkzIC0yNS45NDZILTI2LjU2NTRWMjEzLjI1Nkg5My40NTkzVi0yNS45NDZaIiBmaWxsPSIjRUY1MUU4Ii8+CjxwYXRoIGQ9Ik0yNC42NjcgMTYyLjI1MkwxNjIuMjUyIDI0LjY2NjVMMTk1Ljc1NCAzOC45ODM3TDIxMC44MiAxNTguNDUzTDEyMy41NTUgMjE2LjExNEwyNy4xOTczIDIwNS43MjNMMjQuNjY3IDE2Mi4yNTJaIiBmaWxsPSIjM0M0MEYzIi8+CjxwYXRoIGQ9Ik0yNC42NjcgMjQuNjY2NUwxNjIuMjUyIDE2Mi4yNTJMMjAzLjU1IDYyLjYxNTlMMTM5LjEzNCAtMjMuNjA4N0wzNi44MDQ1IC0zMS42NjE0TDI0LjY2NyAyNC42NjY1WiIgZmlsbD0iI0NGOTJGRiIvPgo8cGF0aCBkPSJNMjEzLjQ4NCAtMjUuOTQ2SDkzLjQ1OVYyMTMuMjU2SDIxMy40ODRWLTI1Ljk0NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik0xNjIuMjUyIDI0LjY2NjZMOTUuMzc2IDkxLjU0MjZMOTYuMDM2MyAxNzAuNDMzTDE3NS41OTMgMTc5LjU1NUwyMDYuNzY0IDExMC43MzNMMTc3LjE1MyAyMi42ODU1TDE2Mi4yNTIgMjQuNjY2NloiIGZpbGw9IiM3QUU5RDYiLz4KPHBhdGggZD0iTTkzLjQ1OSAxOTUuMDc2VjEyOS4yMjlMMTI1LjYyOSAxMjMuNjU0TDE2Mi4yNTIgMTYxLjU3NEwxNjQuNTg5IDE3My41MTlMOTMuNDU5IDE5NS4wNzZaIiBmaWxsPSIjN0I0OUZGIi8+CjwvZz4KPHBhdGggZD0iTTk2LjU3MzggMjUuOTU4Qzk0Ljg0OTkgMjQuMjM0MSA5Mi4wNTY2IDI0LjIzNDEgOTAuMzMyNyAyNS45NThMMjUuOTU4IDkwLjMzODZDMjQuMjM0MSA5Mi4wNjI1IDI0LjIzNDEgOTQuODU1OCAyNS45NTggOTYuNTc5N0w5MC4zMzI3IDE2MC45NkM5Mi4wNTY2IDE2Mi42ODQgOTQuODQ5OSAxNjIuNjg0IDk2LjU3MzggMTYwLjk2TDE2MC45NTQgOTYuNTc5N0MxNjIuNjc4IDk0Ljg1NTggMTYyLjY3OCA5Mi4wNjI1IDE2MC45NTQgOTAuMzM4Nkw5Ni41NzM4IDI1Ljk1OFoiIGZpbGw9IiMxNDE0MTQiLz4KPHBhdGggZD0iTTk2LjU3MzggMjUuOTU4Qzk0Ljg0OTkgMjQuMjM0MSA5Mi4wNTY2IDI0LjIzNDEgOTAuMzMyNyAyNS45NThMMjUuOTU4IDkwLjMzODZDMjQuMjM0MSA5Mi4wNjI1IDI0LjIzNDEgOTQuODU1OCAyNS45NTggOTYuNTc5N0w5MC4zMzI3IDE2MC45NkM5Mi4wNTY2IDE2Mi42ODQgOTQuODQ5OSAxNjIuNjg0IDk2LjU3MzggMTYwLjk2TDE2MC45NTQgOTYuNTc5N0MxNjIuNjc4IDk0Ljg1NTggMTYyLjY3OCA5Mi4wNjI1IDE2MC45NTQgOTAuMzM4Nkw5Ni41NzM4IDI1Ljk1OFoiIGZpbGw9IiMwMDA3NzciLz4KPG1hc2sgaWQ9Im1hc2sxXzE0MF8yIiBzdHlsZT0ibWFzay10eXBlOmx1bWluYW5jZSIgbWFza1VuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeD0iMjQiIHk9IjI0IiB3aWR0aD0iMTM5IiBoZWlnaHQ9IjEzOSI+CjxwYXRoIGQ9Ik05Ni41NzM4IDI1Ljk1OEM5NC44NDk5IDI0LjIzNDEgOTIuMDU2NiAyNC4yMzQxIDkwLjMzMjcgMjUuOTU4TDI1Ljk1OCA5MC4zMzg2QzI0LjIzNDEgOTIuMDYyNSAyNC4yMzQxIDk0Ljg1NTggMjUuOTU4IDk2LjU3OTdMOTAuMzMyNyAxNjAuOTZDOTIuMDU2NiAxNjIuNjg0IDk0Ljg0OTkgMTYyLjY4NCA5Ni41NzM4IDE2MC45NkwxNjAuOTU0IDk2LjU3OTdDMTYyLjY3OCA5NC44NTU4IDE2Mi42NzggOTIuMDYyNSAxNjAuOTU0IDkwLjMzODZMOTYuNTczOCAyNS45NThaIiBmaWxsPSJ3aGl0ZSIvPgo8L21hc2s+CjxnIG1hc2s9InVybCgjbWFzazFfMTQwXzIpIj4KPHBhdGggZD0iTTkzLjQ1OTEgOTMuNDU5SDE5LjQwMTRWMTg1Ljk4M0g5My40NTkxVjkzLjQ1OVoiIGZpbGw9IiMwMDA0M0IiLz4KPHBhdGggZD0iTTE2Ni45NjIgMC45MzUwNTlIOTIuOTA0M1Y5My40NTkxSDE2Ni45NjJWMC45MzUwNTlaIiBmaWxsPSIjMkYzNzlFIi8+CjwvZz4KPHBhdGggZD0iTTk2Ljc0MzQgNTkuNTAxQzk4LjQyMDYgNjYuOTk4NSAxMDIuMTg0IDczLjg3MDggMTA3LjYwMSA3OS4zMTcxQzExMy4wMTggODQuNzYzNSAxMTkuODY3IDg4LjU2NzggMTI3LjM1OSA5MC4yODU4QzEyOC4wODkgOTAuNDU1MyAxMjguNzQ0IDkwLjg3MDIgMTI5LjIxMSA5MS40NTQ2QzEyOS42NzkgOTIuMDQ0OCAxMjkuOTM2IDkyLjc3NTMgMTI5LjkzNiA5My41MjMzQzEyOS45MzYgOTQuMjcxMyAxMjkuNjc5IDk1LjAwNzYgMTI5LjIxMSA5NS41OTJDMTI4Ljc0NCA5Ni4xODIyIDEyOC4wODkgOTYuNTkxMyAxMjcuMzU5IDk2Ljc2MDdDMTE5Ljg3OSA5OC40Mzc5IDExMy4wMyAxMDIuMjAxIDEwNy42MDcgMTA3LjYyNEMxMDIuMTg0IDExMy4wNDcgOTguNDIwNiAxMTkuODk2IDk2Ljc0MzQgMTI3LjM3NkM5Ni41NzQgMTI4LjEwNyA5Ni4xNTkxIDEyOC43NjEgOTUuNTc0NyAxMjkuMjI5Qzk0Ljk4NDUgMTI5LjY5NiA5NC4yNTQgMTI5Ljk1MyA5My41MDYgMTI5Ljk1M0M5Mi43NTggMTI5Ljk1MyA5Mi4wMjE3IDEyOS42OTYgOTEuNDM3MyAxMjkuMjI5QzkwLjg0NzEgMTI4Ljc2MSA5MC40MzggMTI4LjEwNyA5MC4yNjg2IDEyNy4zNzZDODguNTU2NCAxMTkuODk2IDg0Ljc2OTYgMTEzLjA1MyA3OS4zNDA4IDEwNy42NDJDNzMuOTExOSAxMDIuMjI1IDY3LjA1NzIgOTguNDU1NCA1OS41NzE0IDk2Ljc2NjZDNTguODQwOSA5Ni41OTcxIDU4LjE4NjMgOTYuMTgyMiA1Ny43MTg4IDk1LjU5NzhDNTcuMjUxMyA5NS4wMDc2IDU2Ljk5NDEgOTQuMjc3MSA1Ni45OTQxIDkzLjUyOTFDNTYuOTk0MSA5Mi43ODExIDU3LjI1MTMgOTIuMDQ0OCA1Ny43MTg4IDkxLjQ2MDRDNTguMTg2MyA5MC44NzAyIDU4Ljg0MDkgOTAuNDYxMiA1OS41NzE0IDkwLjI5MTdDNjcuMDU3MiA4OC41Nzk1IDczLjkwNjEgODQuNzg2OSA3OS4zMzQ5IDc5LjM1OEM4NC43NjM4IDczLjkyOTIgODguNTU2NCA2Ny4wODAzIDkwLjI2ODYgNTkuNTk0NUM5MC40MjY0IDU4Ljg1ODIgOTAuODI5NiA1OC4xOTc4IDkxLjQxMzkgNTcuNzI0NEM5MS45OTgzIDU3LjI1MTEgOTIuNzIzIDU2Ljk4MjMgOTMuNDc2OCA1Ni45NzY1Qzk0LjIzMDYgNTYuOTY0OCA5NC45NjExIDU3LjIxMDIgOTUuNTU3MiA1Ny42NzE4Qzk2LjE1MzIgNTguMTMzNSA5Ni41NzQgNTguNzgyMiA5Ni43NDkzIDU5LjUxMjdMOTYuNzQzNCA1OS41MDFaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTQwXzIiPgo8cmVjdCB3aWR0aD0iMTg3IiBoZWlnaHQ9IjE4NyIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPGNsaXBQYXRoIGlkPSJjbGlwMV8xNDBfMiI+CjxyZWN0IHdpZHRoPSIxODciIGhlaWdodD0iMTg3IiBmaWxsPSJ3aGl0ZSIvPgo8L2NsaXBQYXRoPgo8L2RlZnM+Cjwvc3ZnPgo="></img>
                                                                    </div>
                                                                </div>
                                                            `;
    
                                                            document.getElementById("modal-username-preview").textContent = localStorage.discord_username.toLowerCase();
                                                        } else if (product.sku_id === NITRO_CREDITS_3_DAYS) {
                                                            previewHolder.classList.add('modal-preview-profile-container');
                                                                
                                                            previewHolder.innerHTML = `
                                                                <div class="nitro-3-days-modal-orb-preview">
                                                                    <img class="hero-img" src="https://cdn.discordapp.com/assets/content/81644099db353c3ea7cefa334f8d298d06b768a68a349de663d2151fd01eddc7.png"></img>
                                                                    <svg class="nitro-title" aria-hidden="true" role="img" width="106" height="26" viewBox="0 0 106 26"><title>Nitro</title><g fill="none" fill-rule="evenodd"><path fill="white" d="M98.8266537 8.64800265L97.5788372 17.0822416C97.2940433 19.0754982 95.0485266 20.0010292 92.981582 20.0010292 91.0571496 20.0010292 89.1680861 19.0754982 89.4175111 17.2605602L90.6652125 8.64800265C90.9501215 6.76162212 93.1956383 5.80077257 95.2624676 5.80077257 97.3294121 5.80077257 99.1115628 6.76162212 98.8266537 8.64800265M96.2496839.0038079646L96.2503751.0000115044248 82.8208233.0000115044248C82.4777342.0000115044248 82.1864887.251383186 82.1368341.59030354L81.4839511 5.04596726C81.4228909 5.46254248 81.7462794 5.83609115 82.167825 5.83609115L84.6202551 5.83609115C84.8670304 5.83609115 85.0355795 6.08734779 84.9386897 6.31398496 84.6326976 7.03036549 84.4097703 7.8080646 84.2859219 8.64800265L83.0381053 17.2605602C82.2182861 23.0258876 87.0301735 25.9085513 92.2687909 25.9085513 97.7574094 25.9085513 103.139115 23.0258876 103.958934 17.2605602L105.206059 8.64800265C106.009634 2.99656903 101.367679.115400885 96.2496839.0038079646M15.5778562 11.7941867L15.6467505 15.9747796C15.648133 16.0607177 15.5902986 16.1363018 15.5068881 16.1574699L15.5067729 16.1574699 14.0843013 11.1148504C14.0822275 11.1071425 14.0795777 11.0996646 14.0763519 11.0923018L9.66308376.775018584C9.55432753.520885841 9.30421123.355912389 9.0273667.355912389L4.02607753.355912389C3.68126035.355912389 3.38920838.6097 3.34151232.950576106L.00682030635 24.7668062C-.0513596718 25.1820009.271568009 25.5526735.691385514 25.5526735L5.67355018 25.5526735C6.01882818 25.5526735 6.31122578 25.2981956 6.3583458 24.9566292L7.6643423 15.4949301C7.66560958 15.4857265 7.66618562 15.4762929 7.66607042 15.4669743L7.59475674 10.6052044 7.73715368 10.5697708 9.23116943 15.6125053C9.23335838 15.6196381 9.23589295 15.6267708 9.23888836 15.6336735L13.3663258 25.1370186C13.4758885 25.3893106 13.7250831 25.5526735 14.0004299 25.5526735L19.39573 25.5526735C19.7405472 25.5526735 20.0325992 25.2988858 20.0802953 24.9580097L23.4156785 1.14177965C23.4738585.726584956 23.1509308.355912389 22.7311133.355912389L17.782935.355912389C17.438233.355912389 17.146181.609469912 17.0983698.950346018L15.5795843 11.7654257C15.578317 11.7749743 15.577741 11.784523 15.5778562 11.7941867M25.2200758 25.5526274L30.2035078 25.5526274C30.5483249 25.5526274 30.8403769 25.2989549 30.888073 24.9579637L34.222765 1.14184867C34.280945.726653982 33.9580173.355981416 33.5381998.355981416L28.5547678.355981416C28.2100659.355981416 27.9180139.609653982 27.8702026.950645133L24.5355106 24.7667602C24.4773306 25.1819549 24.8002583 25.5526274 25.2200758 25.5526274M37.588782.910862832L36.9357838 5.3664115C36.8748388 5.78298673 37.1982273 6.15665044 37.6197729 6.15665044L42.8344271 6.15665044C43.2536686 6.15665044 43.5763658 6.52628761 43.5192227 6.94102212L41.0626451 24.7682788C41.005502 25.1830133 41.3281993 25.5526504 41.7474408 25.5526504L46.8027624 25.5526504C47.1481556 25.5526504 47.4405532 25.2980575 47.4875581 24.9564912L49.9960944 6.75280973C50.0430992 6.41112832 50.3354968 6.15665044 50.68089 6.15665044L56.2874814 6.15665044C56.6305704 6.15665044 56.9217007 5.90539381 56.9714705 5.56635841L57.6249296 1.11080973C57.6859898.694234513 57.3626013.320570796 56.9409404.320570796L38.2727712.320570796C37.9296821.320570796 37.6384366.571827434 37.588782.910862832M72.9157339 9.14614425C72.7371616 10.6051354 71.5970645 12.0642416 69.6364568 12.0642416L66.6908218 12.0642416C66.2704283 12.0642416 65.9472702 11.6925336 66.0063718 11.2768788L66.6298768 6.8920823C66.6782642 6.55178142 66.9700857 6.29891416 67.3143268 6.29891416L70.4562761 6.29891416C72.3453396 6.29891416 73.0936148 7.61571062 72.9157339 9.14614425M71.1691824.355958407L61.6845787.355958407C61.3397615.355958407 61.0477096.609630973 60.9998983.950622124L57.6652063 24.7667372C57.6070263 25.1819319 57.929954 25.5526044 58.3497715 25.5526044L63.4034802 25.5526044C63.7487582 25.5526044 64.0411558 25.2981265 64.0882759 24.9565602L65.0696166 17.8430292C65.0932342 17.6723035 65.2393178 17.5450646 65.4120144 17.5450646L66.0616716 17.5450646C66.1795293 17.5450646 66.2893224 17.6050027 66.3528019 17.7041708L71.1792055 25.2345071C71.3062798 25.4327283 71.5256356 25.5526044 71.7613509 25.5526044L78.0034289 25.5526044C78.5625328 25.5526044 78.8902992 24.9242327 78.5697909 24.4667018L73.5050221 17.2370912C73.383593 17.0637195 73.4460357 16.8224717 73.6364743 16.729631 76.8698986 15.1516841 78.7475566 13.5351973 79.3665685 9.03926814 80.0787836 3.13174602 76.3728918.355958407 71.1691824.355958407"></path></g></svg>
                                                                    <div class="preview-perks">
                                                                        <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                        <p>Custom emojis anywhere</p>
                                                                    </div>
                                                                    <div class="preview-perks">
                                                                        <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                        <p>Custom profile</p>
                                                                    </div>
                                                                    <div class="preview-perks">
                                                                        <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                        <p>500 MB Uploads</p>
                                                                    </div>
                                                                    <div class="preview-perks">
                                                                        <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                        <p>HD video streaming</p>
                                                                    </div>
                                                                    <div class="preview-perks">
                                                                        <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                                                        <p>Colour app themes and more!</p>
                                                                    </div>
                                                                </div>
                                                            `;
                                                        } else {
                                                            previewHolder.innerHTML = `
                                                                <p>${getTextString("CARD_TYPE_EXTERNAL_SKU_ERROR")}</p>
                                                            `;
                                                        }
                                                        
                                                    }


                                                    const priceTextNitro = modal.querySelector("[data-price-nitro]");
                                                    const priceTextStandard = modal.querySelector("[data-price-standard]");

                                                    const priceContainerNitro = modal.querySelector("[data-price-nitro-container]");
                                                    const priceContainerStandard = modal.querySelector("[data-price-standard-container]");

                                                    const priceContainer = modal.querySelector("[data-shop-price-container]");

                                                    let priceStandard = "N/A";
                                                    let priceNitro = "N/A";
                                                    let priceOrb = "N/A";

                                                    if (localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
                                                        if (localStorage.discord_premium_type === "2") {
                                                            if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                                product.prices["4"].country_prices.prices.forEach(price => {
                                                                    if (price.currency === "usd") {
                                                                        priceStandard = price.amount;
                                                                    }
                                                                    if (price.currency === "discord_orb") {
                                                                        priceOrb = price.amount;
                                                                    }
                                                                });
                
                                                                if (priceStandard != "N/A" && priceOrb != "N/A") {

                                                                    let nitro_price = document.createElement("div");
                                                            
                                                                    nitro_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900; margin-left: 23px">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        <div class="nitro-icon" style="margin-left: -5px"></div>
                                                                    `;
                                                                    nitro_price.style.position = `absolute`;
                                                                    nitro_price.style.left = `0px`;
                                                                    
                                                                    priceContainer.appendChild(nitro_price);

                                                                    let orb_price = document.createElement("div");
                                                            
                                                                    orb_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                        <div class="orb-icon" style="margin-left: -25px"></div>
                                                                    `;
                                                                    orb_price.style.position = `absolute`;
                                                                    orb_price.style.right = `20px`;
                                                                    
                                                                    priceContainer.appendChild(orb_price);
                
                                                                } else if (priceStandard != "N/A") {
                
                                                                    let nitro_price = document.createElement("div");
                                                            
                                                                    nitro_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900; margin-left: 23px">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        <div class="nitro-icon" style="margin-left: -5px"></div>
                                                                    `;
                                                                    nitro_price.style.position = `absolute`;
                                                                    nitro_price.style.left = `0px`;
                                                                    
                                                                    priceContainer.appendChild(nitro_price);
                
                                                                } else if (priceOrb != "N/A") {
                
                                                                    let orb_price = document.createElement("div");
                                                            
                                                                    orb_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                        <div class="orb-icon" style="margin-left: -25px"></div>
                                                                    `;
                                                                    orb_price.style.position = `absolute`;
                                                                    orb_price.style.left = `23px`;
                                                                    
                                                                    priceContainer.appendChild(orb_price);
                
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                    
                                                                }
                                                            }
                                                            if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                                product.prices["0"].country_prices.prices.forEach(price => {
                                                                    if (price.currency === "usd") {
                                                                        priceStandard = price.amount;
                                                                    }
                                                                    if (price.currency === "discord_orb") {
                                                                        priceOrb = price.amount;
                                                                    }
                                                                });
                
                                                                if (priceStandard != "N/A" && priceOrb != "N/A") {

                                                                    let standard_price = document.createElement("div");
                                                            
                                                                    standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                    `;
                                                                    standard_price.style.position = `absolute`;
                                                                    standard_price.style.left = `0px`;
                                                                    standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(standard_price);

                                                                    let orb_standard_price = document.createElement("div");
                                                            
                                                                    orb_standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                        <div class="orb-icon-crossed" style="margin-left: -23px"></div>
                                                                    `;
                                                                    orb_standard_price.style.position = `absolute`;
                                                                    orb_standard_price.style.right = `20px`;
                                                                    orb_standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(orb_standard_price);
                
                                                                } else if (priceStandard != "N/A") {
                
                                                                    let standard_price = document.createElement("div");
                                                            
                                                                    standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                    `;
                                                                    standard_price.style.position = `absolute`;
                                                                    standard_price.style.left = `0px`;
                                                                    standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(standard_price);
                
                                                                } else if (priceOrb != "N/A") {
                
                                                                    let orb_standard_price = document.createElement("div");
                                                            
                                                                    orb_standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                        <div class="orb-icon-crossed" style="margin-left: -24px"></div>
                                                                    `;
                                                                    orb_standard_price.style.position = `absolute`;
                                                                    orb_standard_price.style.left = `23px`;
                                                                    orb_standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(orb_standard_price);
                
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                    
                                                                }
                                                            }
                                                        } else {
                                                            if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                                product.prices["0"].country_prices.prices.forEach(price => {
                                                                    if (price.currency === "usd") {
                                                                        priceStandard = price.amount;
                                                                    }
                                                                    if (price.currency === "discord_orb") {
                                                                        priceOrb = price.amount;
                                                                    }
                                                                });
                
                                                                if (priceStandard != "N/A" && priceOrb != "N/A") {

                                                                    let standard_price = document.createElement("div");
                                                            
                                                                    standard_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                    `;
                                                                    standard_price.style.position = `absolute`;
                                                                    standard_price.style.left = `0px`;
                                                                    
                                                                    priceContainer.appendChild(standard_price);

                                                                    let orb_price = document.createElement("div");
                                                            
                                                                    orb_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                        <div class="orb-icon" style="margin-left: -25px"></div>
                                                                    `;
                                                                    orb_price.style.position = `absolute`;
                                                                    orb_price.style.right = `20px`;
                                                                    
                                                                    priceContainer.appendChild(orb_price);
                
                                                                } else if (priceStandard != "N/A") {
                
                                                                    let nitro_price = document.createElement("div");
                                                            
                                                                    nitro_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                    `;
                                                                    nitro_price.style.position = `absolute`;
                                                                    nitro_price.style.left = `0px`;
                                                                    
                                                                    priceContainer.appendChild(nitro_price);
                
                                                                } else if (priceOrb != "N/A") {
                
                                                                    let orb_price = document.createElement("div");
                                                            
                                                                    orb_price.innerHTML = `
                                                                        <a style="font-size: large; font-weight: 900;">${priceOrb}</a>
                                                                        <div class="orb-icon" style="margin-left: -25px"></div>
                                                                    `;
                                                                    orb_price.style.position = `absolute`;
                                                                    orb_price.style.left = `23px`;
                                                                    
                                                                    priceContainer.appendChild(orb_price);
                
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                    
                                                                }
                                                            }
                                                            if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                                product.prices["4"].country_prices.prices.forEach(price => {
                                                                    if (price.currency === "usd") {
                                                                        priceStandard = price.amount;
                                                                    }
                                                                    if (price.currency === "discord_orb") {
                                                                        priceOrb = price.amount;
                                                                    }
                                                                });
                
                                                                if (priceStandard != "N/A" && priceOrb != "N/A") {

                                                                    let standard_price = document.createElement("div");
                                                            
                                                                    standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed" style="margin-left: 21px;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        <div class="nitro-icon-crossed" style="margin-left: -3px"></div>
                                                                    `;
                                                                    standard_price.style.position = `absolute`;
                                                                    standard_price.style.left = `0px`;
                                                                    standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(standard_price);

                                                                    let orb_standard_price = document.createElement("div");
                                                            
                                                                    orb_standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                        <div class="orb-icon-crossed" style="margin-left: -23px"></div>
                                                                    `;
                                                                    orb_standard_price.style.position = `absolute`;
                                                                    orb_standard_price.style.right = `20px`;
                                                                    orb_standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(orb_standard_price);
                
                                                                } else if (priceStandard != "N/A") {
                
                                                                    let standard_price = document.createElement("div");
                                                            
                                                                    standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed" style="margin-left: 21px;">US$${(priceStandard / 100).toFixed(2)}</a>
                                                                        <div class="nitro-icon-crossed" style="margin-left: -3px"></div>
                                                                    `;
                                                                    standard_price.style.position = `absolute`;
                                                                    standard_price.style.left = `0px`;
                                                                    standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(standard_price);
                
                                                                } else if (priceOrb != "N/A") {
                
                                                                    let orb_standard_price = document.createElement("div");
                                                            
                                                                    orb_standard_price.innerHTML = `
                                                                        <a class="modal-standard-price-crossed">${priceOrb}</a>
                                                                        <div class="orb-icon-crossed" style="margin-left: -24px"></div>
                                                                    `;
                                                                    orb_standard_price.style.position = `absolute`;
                                                                    orb_standard_price.style.left = `23px`;
                                                                    orb_standard_price.style.marginTop = `30px`;
                                                                    
                                                                    priceContainer.appendChild(orb_standard_price);
                
                                                                    modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                        <div class="unplublished-tag">
                                                                            <p class="unplublished-tag-text">${getTextString("CARD_ORB_EXCLUSIVE_TAG")}</p>
                                                                        </div>
                                                                    `;
                                                                    
                                                                }
                                                            }
                                                        }
            
                                                    } else {
                                                        if (product.prices && product.prices["0"] && product.prices["0"].country_prices && product.prices["0"].country_prices.prices) {
                                                            product.prices["0"].country_prices.prices.forEach(price => {
                                                                if (price.currency === "usd") {
                                                                    priceStandard = price.amount;
                                                                }
                                                            });
                                                        }
                                                
                                                        if (product.prices && product.prices["4"] && product.prices["4"].country_prices && product.prices["4"].country_prices.prices) {
                                                            product.prices["4"].country_prices.prices.forEach(price => {
                                                                if (price.currency === "usd") {
                                                                    priceNitro = price.amount;
                                                                }
                                                            });
                                                        }
            
                                                        if (priceTextStandard) {
                                                            priceTextStandard.textContent = priceStandard !== "N/A" ? `US$${(priceStandard / 100).toFixed(2)}` : "null";
                                                        }
                
                                                        if (priceTextNitro) {
                                                            priceTextNitro.textContent = priceNitro !== "N/A" ? `US$${(priceNitro / 100).toFixed(2)} with Nitro` : "null";
                                                        }
                                                    }


                                                    const unpublishedAt = new Date(product.unpublished_at);
                            
                                                    if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = unpublishedAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${days}${getTextString("CARD_UNPUBLISHED_COUNTDOWN_TAG")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    const ExpiredAt = new Date(product.expires_at);
                            
                                                    if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                            
                                                        function updateTimer() {
                                                            const now = new Date();
                                                            const timeDiff = ExpiredAt - now;
                            
                                                            if (timeDiff <= 0) {
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                                    </div>
                                                                `;
                                                                clearInterval(timerInterval);
                                                            } else {
                                                                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                                modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                                    <div class="unplublished-tag">
                                                                        <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                                    </div>
                                                                `;
                                                            }
                                                        }
                            
                                                        const timerInterval = setInterval(updateTimer, 1000);
                                                        updateTimer();
                                                    }

                                                    if (product.premium_type === 2) {
                                                        modal.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                            <div class="premiumWheelBadge_c23530 textBadge_df8943 base_df8943 eyebrow_df8943 baseShapeRound_df8943" aria-label="This bonus item is yours to keep and use anytime with an active Nitro subscription." style="background-color: var(--status-danger);"><svg class="premiumWheel_c23530" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M15 14a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" class=""></path><path fill="currentColor" fill-rule="evenodd" d="M7 4a1 1 0 0 0 0 2h3a1 1 0 1 1 0 2H5.5a1 1 0 0 0 0 2H8a1 1 0 1 1 0 2H6a1 1 0 1 0 0 2h1.25A8 8 0 1 0 15 4H7Zm8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" clip-rule="evenodd" class=""></path><path fill="currentColor" d="M2.5 10a1 1 0 0 0 0-2H2a1 1 0 0 0 0 2h.5Z" class=""></path></svg></div>
                                                        `;
                                                    }

                                                    if (localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1" && product.type != 3000) {

                                                        if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen") {
                                                            let newLogInWithDiscordDismissible = document.createElement("div");
                                                
                                                            newLogInWithDiscordDismissible.innerHTML = `
                                                                <div class="newLogInWithDiscordDismissible-inner">
                                                                    <svg class="closeIcon_modal_discord_login" onclick="closeLoginDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-medium-title" style="margin-top: 0px;">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_TITLE")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_1")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <p class="center-text options-summary-text">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_SUMMARY_2")}</p>
                                                                    <hr style="opacity: 0;">
                                                                    <img src="https://cdn.yapper.shop/assets/178.png">
                                                                    <hr style="opacity: 0;">
                                                                    <button class="card-button" onclick="loginToDiscord()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_LOG_IN")}</button>
                                                                    <button class="card-button" onclick="closeLoginDismissibleCoachtip()">${getTextString("DISMISSIBLE_CONTENT_NEW_DISCORD_SIGN_IN_MODAL_NO_THANKS")}</button>
                                                                </div>
                                                                <div class="newLogInWithDiscordDismissible-pointer"></div>
                                                            `;
                                                
                                                            newLogInWithDiscordDismissible.classList.add('newLogInWithDiscordDismissible');
                                                
                                                            newLogInWithDiscordDismissible.id = `newLogInWithDiscordDismissible`;
                                                
                                                            modal.appendChild(newLogInWithDiscordDismissible);
                                                        }
                                                    }
                                                    


                                                    let modal_back = document.createElement("div");

                                                    modal_back.classList.add('modalv2-back');
                                                    modal_back.id = 'modalv2-back';

                                                    document.body.appendChild(modal_back);

                                                    setTimeout(() => {
                                                        modal_back.classList.add('show');
                                                    }, 1);


                                                    modal.addEventListener('click', (event) => {
                                                        if (event.target === modal) {
                                                            modal.classList.remove('show');
                                                            modal_back.classList.remove('show');
                                                            setTimeout(() => {
                                                                modal.remove();
                                                                modal_back.remove();
                                                            }, 300);
                                                            removeParams('itemSkuId');
                                                            modalIsAlreadyOpen = false;
                                                        }
                                                    });

                                                    document.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                                                        modal.classList.remove('show');
                                                        modal_back.classList.remove('show');
                                                        setTimeout(() => {
                                                            modal.remove();
                                                            modal_back.remove();
                                                        }, 300);
                                                    });
                                                }
                                            }
                                        }

                                        if (localStorage.experiment_2025_03_copy_sku_card === "Treatment 2: w/ share button" || localStorage.experiment_2025_03_copy_sku_card === "Treatment 3: only share button") {
                                            card.querySelector("[data-share-product-card-button]").innerHTML = `
                                                <svg class="shareIcon_f4a996" onclick="copyEmoji('https://canary.discord.com/shop#itemSkuId=${product.sku_id}'); copyNotice('copylink');" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M16.32 14.72a1 1 0 0 1 0-1.41l2.51-2.51a3.98 3.98 0 0 0-5.62-5.63l-2.52 2.51a1 1 0 0 1-1.41-1.41l2.52-2.52a5.98 5.98 0 0 1 8.45 8.46l-2.52 2.51a1 1 0 0 1-1.41 0ZM7.68 9.29a1 1 0 0 1 0 1.41l-2.52 2.51a3.98 3.98 0 1 0 5.63 5.63l2.51-2.52a1 1 0 0 1 1.42 1.42l-2.52 2.51a5.98 5.98 0 0 1-8.45-8.45l2.51-2.51a1 1 0 0 1 1.42 0Z" class=""></path><path fill="currentColor" d="M14.7 10.7a1 1 0 0 0-1.4-1.4l-4 4a1 1 0 1 0 1.4 1.4l4-4Z" class=""></path></svg>
                                            `;
                                        }


                                        function newItemCheck() {

                                            if (N > g) {
                                            } else {
                                                card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="unplublished-tag">
                                                        <p class="unplublished-tag-text">${getTextString("CARD_NEW_TAG")}</p>
                                                    </div>
                                                `;
                                            }
                                        }
                                                                            
                                        if (m.includes(product.sku_id)) {
                                            newItemCheck();
                                        }

                                        function newColorItemCheck() {

                                            if (N > newColorsExpireDate) {
                                            } else {
                                                card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                    <div class="unplublished-tag">
                                                        <p class="unplublished-tag-text">${getTextString("CARD_NEW_COLORS_TAG")}</p>
                                                    </div>
                                                `;
                                            }
                                        }

                                        if (params.get("page") === "leaks") {
                                            card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                <div class="unplublished-tag">
                                                    <p class="unplublished-tag-text">${getTextString("CARD_LEAKED_TAG")}</p>
                                                </div>
                                            `;
                                        }
                                                                            
                                        if (newColorsSKUIDS.includes(product.sku_id) && discord_categories.ANIME_V3 === apiCategory.sku_id) {
                                            newColorItemCheck();
                                        }

                                        function popularItemCheck() {
                                            card.classList.add('popular-item');
                                        }
                                                                            
                                        if (I.includes(product.sku_id)) {
                                            popularItemCheck();
                                        }


                                        const unpublishedAt = new Date(product.unpublished_at);
                            
                                        if (product.unpublished_at && !isNaN(unpublishedAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = unpublishedAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_UNPUBLISHED_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${days}${getTextString("CARD_UNPUBLISHED_COUNTDOWN_TAG")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }

                                        const ExpiredAt = new Date(product.expires_at);
                            
                                        if (product.expires_at && !isNaN(ExpiredAt.getTime())) {
                            
                                            function updateTimer() {
                                                const now = new Date();
                                                const timeDiff = ExpiredAt - now;
                            
                                                if (timeDiff <= 0) {
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_TAG")}</p>
                                                        </div>
                                                    `;
                                                    clearInterval(timerInterval);
                                                } else {
                                                    const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                                    const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                                    const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / 1000);
                            
                                                    card.querySelector("[data-shop-card-tag-container]").innerHTML = `
                                                        <div class="unplublished-tag">
                                                            <p class="unplublished-tag-text">${getTextString("CARD_EXPIRED_COUNTDOWN_TAG")}${days}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_DAYS")}${hours}${getTextString("CARD_EXPIRED_COUNTDOWN_TAG_HOURS")}</p>
                                                        </div>
                                                    `;
                                                }
                                            }
                            
                                            const timerInterval = setInterval(updateTimer, 1000);
                                            updateTimer();
                                        }

                                        // Append card to output
                                        cardOutput.append(card);

                                        scrollToSKU(product.sku_id);
                                    }
                                }
            
                                categoryOutput.append(category);

                                scrollToSKU(apiCategory.sku_id);

                                const nameplates_banner = document.getElementById(discord_categories.NAMEPLATE);
                                const arcane_banner = document.getElementById(discord_categories.WARRIOR);
                                const dnd_banner = document.getElementById(discord_categories.CHANCE);
                                const street_fighter_banner = document.getElementById(discord_categories.BAND);
                                const fall_banner = document.getElementById(discord_categories.FALL);
                                const palworld_banner = document.getElementById(discord_categories.TIDE);
                                const valorant_banner = document.getElementById(discord_categories.SHY);

                                if (localStorage.disable_client_banner_overrides != "true") {
                                    if (nameplates_banner) {
                                        document.getElementById(`${discord_categories.NAMEPLATE}-discord-watermark-container`).innerHTML = ``;
                                        document.getElementById(`${discord_categories.NAMEPLATE}-banner-banner-container`).innerHTML = `
                                            <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.discordapp.com/assets/content/6e9143efc20856655971694a3fc651737a9768dcda06dd420f219ddd67b72798.png">
                                            <video disablepictureinpicture autoplay muted class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px; z-index: 1;" src="https://cdn.discordapp.com/assets/content/6f72be1e45f627e6b43894ca7dcda02c2851a3120a643a85c5132e87af6b50c4.webm" loop></video>
                                        `;
                                    }

                                    if (palworld_banner) {
                                        document.getElementById(`${discord_categories.TIDE}-discord-watermark-container`).innerHTML = ``;
                                        document.getElementById(`${discord_categories.TIDE}-banner-banner-container`).innerHTML = `
                                            <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/15.jpg">
                                            <img style="position: absolute; right: 0px; bottom: 0px; width: 400px;" src="https://cdn.yapper.shop/discord-assets/13.png">
                                            <img style="position: absolute; left: 0px; bottom: 0px; width: 400px;" src="https://cdn.yapper.shop/discord-assets/12.png">
                                        `;
                                        document.getElementById(`${discord_categories.TIDE}-logo-container`).innerHTML = `
                                            <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/discord-assets/9.png" id="shop-banner-logo">
                                        `;
                                    }
                                    
                                    if (valorant_banner) {
                                        document.getElementById(`${discord_categories.SHY}-discord-watermark-container`).innerHTML = ``;
                                        document.getElementById(`${discord_categories.SHY}-banner-banner-container`).innerHTML = `
                                            <div class="shop-category-banner-img" style="background: rgb(255, 70, 85); position: absolute; left: 0px; bottom: 0px; width: 1280px;"></div>
                                            <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/23.png">
                                            <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/20.png">
                                            <img style="position: absolute; right: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/22.png">
                                        `;
                                        document.getElementById(`${discord_categories.SHY}-logo-container`).innerHTML = `
                                            <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/discord-assets/21.png" id="shop-banner-logo">
                                        `;
                                    }

                                    if (localStorage.reduced_motion != "true") {
    
                                        if (arcane_banner) {
                                            document.getElementById(`${discord_categories.WARRIOR}-banner-banner-container`).innerHTML = `
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.discordapp.com/app-assets/1096190356233670716/1303490165297123358.png?size=4096">
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/35.png">
                                            `;
                                        }
                                        
                                        if (dnd_banner) {
                                            document.getElementById(`${discord_categories.CHANCE}-banner-banner-container`).innerHTML = `
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/32.png">
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/31.png">
                                            `;
                                        }
                                        
                                        if (street_fighter_banner) {
                                            document.getElementById(`${discord_categories.BAND}-banner-banner-container`).innerHTML = `
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.discordapp.com/app-assets/1096190356233670716/1285465421356732426.png?size=4096">
                                                <img class="shop-category-banner-img" style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/19.png">
                                            `;
                                        }
    
                                        if (palworld_banner) {
                                            document.getElementById(`${discord_categories.TIDE}-discord-watermark-container`).innerHTML = ``;
                                            document.getElementById(`${discord_categories.TIDE}-banner-banner-container`).innerHTML = `
                                                <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/15.jpg">
                                                <img style="position: absolute; right: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/14.png">
                                                <img style="position: absolute; right: 0px; bottom: 0px; width: 400px;" src="https://cdn.yapper.shop/discord-assets/13.png">
                                                <img style="position: absolute; left: 0px; bottom: 0px; width: 400px;" src="https://cdn.yapper.shop/discord-assets/12.png">
                                            `;
                                            document.getElementById(`${discord_categories.TIDE}-logo-container`).innerHTML = `
                                                <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/discord-assets/9.png" id="shop-banner-logo">
                                            `;
                                        }
    
                                        if (valorant_banner) {
                                            document.getElementById(`${discord_categories.SHY}-discord-watermark-container`).innerHTML = ``;
                                            document.getElementById(`${discord_categories.SHY}-banner-banner-container`).innerHTML = `
                                                <div class="shop-category-banner-img" style="background: rgb(255, 70, 85); position: absolute; left: 0px; bottom: 0px; width: 1280px;"></div>
                                                <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/24.png">
                                                <img style="position: absolute; right: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/22.png">
                                                <img style="position: absolute; left: 0px; bottom: 0px; width: 1280px;" src="https://cdn.yapper.shop/discord-assets/20.png">
                                            `;
                                            document.getElementById(`${discord_categories.SHY}-logo-container`).innerHTML = `
                                                <img class="shop-category-banner-logo" src="https://cdn.yapper.shop/discord-assets/21.png" id="shop-banner-logo">
                                            `;
                                        }
                                        
                                    }
                                }

                                if (fall_banner) {
                                    document.getElementById(`${discord_categories.FALL}-discord-watermark-container`).innerHTML = ``;
                                    document.getElementById(`${discord_categories.FALL}-logo-container`).innerHTML = ``;
                                }
                            }
                        }
            
                        // Remove loading container
                        document.getElementById("shop-category-loading-container").innerHTML = ``;
                    }
                })
                .catch(error => {
                    console.error('Error fetching the API:', error);
                    document.getElementById("everything-housing-container").innerHTML = `
                        <div style="text-align: center; margin-top: 10px;" id="failed-to-load-shop">
                            <img style="width: 200px;" src="https://raw.githubusercontent.com/DTACat/Collectibles/main/Images/shopuhoh.png">
                            <h2>${getTextString("SHOP_NOT_LOAD_ERROR_1")}</h2>
                            <p>${getTextString("SHOP_NOT_LOAD_ERROR_2")}</p>
                            <p>${error}</p>
                            <button class="refresh-button" onclick="location.reload();">${getTextString("SHOP_NOT_LOAD_ERROR_RELOAD")}</button>
                        </div>
                    `;
                });

        }
    }

    async function fetchUserProfileInfo(userID) {
        let modal = document.createElement("div");

        modal.classList.add('modal-profile');

        modal.innerHTML = `
            <div class="modal-profile-inner">Loading User Profile...</div>
        `;

        document.body.appendChild(modal);

        setTimeout(() => {
            modal.classList.add('show');
        }, 1);

        let modal_back = document.createElement("div");

        modal_back.classList.add('modalv2-back');
        modal_back.id = 'modalv2-back';

        document.body.appendChild(modal_back);

        modal_back.style.opacity = '0';

        setTimeout(() => {
            modal_back.classList.add('show');
        }, 1);


        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            }
        });

        fetch(api + `/users/${userID}/profile`, {
            method: "GET",
            headers: {
                "Authorization": localStorage.shop_archives_token
            }
        })
        .then(response => response.json())
        .then((data) => {
            if (data.message) {
                modal.innerHTML = `
                    <div class="modal-profile-inner">
                        <div class="modal-preview-profile2">
                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color"></div>
                            <div id="profileBannerPreview" class="options-preview-profile-banner"></div>
                            <div class="profile-avatar-preview-bg"></div>
                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="">
                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${data.message}</p>
                            <p class="options-preview-profile-username" id="options-username-preview">${data.error}</p>
                        </div>
                    </div>
                `;
            } else {
                modal.innerHTML = `
                    <div class="modal-profile-inner">
                        <div class="modal-preview-profile2">
                            <div popout-profile-banner-color class="options-preview-profile-banner-color" style="background-color: #859CF0;"></div>
                            <div class="options-preview-profile-banner" style="background-image: url(https://cdn.discordapp.com/banners/${data.id}/${data.banner}.png?size=480);"></div>
                            <div class="profile-avatar-preview-bg"></div>
                            <img class="profile-avatar-preview" src="https://cdn.discordapp.com/avatars/${data.id}/${data.avatar}.webp?size=128">
                            <p popout-profile-displayname class="options-preview-profile-displayname">${data.global_name}</p>
                            <p popout-profile-username class="options-preview-profile-username">${data.username}</p>
                        </div>
                    </div>
                `;

                if (data.banner_color) {
                    modal.querySelector("[popout-profile-banner-color]").style.backgroundColor = data.banner_color;
                }

                if (data.global_name === null) {
                    modal.querySelector("[popout-profile-displayname]").textContent = data.username;
                }

                modal.querySelector("[popout-profile-username]").textContent = data.username;
            }
        })
        .catch(error => {
            console.error(error);
            modal.innerHTML = `
                <div class="modal-profile-inner">
                    <div class="modal-preview-profile2">
                        <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color"></div>
                        <div id="profileBannerPreview" class="options-preview-profile-banner"></div>
                        <div class="profile-avatar-preview-bg"></div>
                        <img id="profileAvatarPreview" class="profile-avatar-preview" src="">
                        <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">Unknown User</p>
                        <p class="options-preview-profile-username" id="options-username-preview">unknownuser</p>
                    </div>
                </div>
            `;
        });
    }


    function renderReviewTextWithEmojis(reviewText) {
        // Escape HTML special characters
        const safeText = reviewText
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;");
      
        // Replace :emoji: with <img>
        const rendered = safeText.replace(/(:[a-zA-Z0-9_]+:)/g, (match) => {
            const emojiUrl = CUSTOM_EMOJIS[match];
            if (emojiUrl) {
                return `<img src="${emojiUrl}" alt="${match}"/>`;
            }
            return match; // Leave as-is if emoji not found
        });
      
        return rendered;
    }
      

    function selectReviewReportType(type) {
        if (document.querySelector(".report-card-option-selected")) {
            document.querySelectorAll('.report-card-option-selected').forEach((el) => {
                el.classList.remove("report-card-option-selected");
            });
        }

        if (type === 1 || type === 2 || type === 3 || type === 4 || type === 5) {
            document.getElementById("report-review-report-card-option-" + type).classList.add("report-card-option-selected");
            document.getElementById("report-review-report-card-inv-imput").value = type;
        } else {
            console.error(type + " is not a valid review report type")
        }
    }

    function reportReview(reviewId, reportType) {
      
        fetch(api + REVIEWSAPI + `/report/${reviewId}`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": shop_archives_token
            },
            body: JSON.stringify({
                reportType: Number(reportType)
            })
        })
        .then(response => response.json())
        .then((data) => {
            if (data.success && data.success === true) {
                const modal = document.getElementById("modalv2-report-review");
                const modal_back = document.getElementById("modalv2-report-review-back");

                if (modal && modal_back) {
                    modal.classList.remove('show');
                    modal_back.classList.remove('show');
                    setTimeout(() => {
                        modal.remove();
                        modal_back.remove();
                    }, 300);
                    fillCategoryModalContentContainer('reviews', true);
                }
                if (document.getElementById("review-panel-report-type-id-" + reviewId) && document.getElementById("review-panel-report-type-id-" + reviewId + "-text")) {
                    document.getElementById("review-panel-report-type-id-" + reviewId).classList.remove("review-flag-type-2");
                    document.getElementById("review-panel-report-type-id-" + reviewId).classList.add("review-flag-type-0");
                    document.getElementById("review-panel-report-type-id-" + reviewId + "-text").textContent = "0";
                }
            } else {
                if (document.getElementById("shop-category-modal-report-review-error-output")) {
                    document.getElementById("shop-category-modal-report-review-error-output").textContent = data.message;
                }
            }
        })
        .catch(error => {
            console.error(error);
            if (document.getElementById("shop-category-modal-report-review-error-output")) {
                document.getElementById("shop-category-modal-report-review-error-output").textContent = error;
            }
        });
    }


    const postReview = async (itemId, rating) => {

        if (document.getElementById("shop-category-modal-write-review-error-output")) {
            document.getElementById("shop-category-modal-write-review-error-output").textContent = ``;
        }

        const accessToken = localStorage.discord_token;

        const reviewText = document.getElementById("shop-category-modal-write-review-post-input").value;

        if (!accessToken) {
            console.error('Access token is missing!');
            return;
        }

        const response = await fetch(api + REVIEWSAPI, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                "Authorization": shop_archives_token
            },
            body: JSON.stringify({
                itemId,
                rating,
                reviewText
            })
        });

        const result = await response.json();
        if (response.ok) {
            fillCategoryModalContentContainer('reviews', true);
        } else {
            if (document.getElementById("shop-category-modal-write-review-error-output")) {
                document.getElementById("shop-category-modal-write-review-error-output").textContent = `${result.message}`;
            }
        }
    
    };

    // Example usage:
    // postReview('item123', 5, 'This is my review text.');

    window.postReview = postReview;

    function deleteReview(reviewId) {
      
        fetch(api + REVIEWSAPI + `/delete/${reviewId}`, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json",
                "Authorization": shop_archives_token
            }
        })
        .then(response => response.json())
        .then((data) => {
            fillCategoryModalContentContainer('reviews', true);
        })
        .catch(error => {
            console.error(error)
        });
    }


    function deleteAllStoredUserData() {
        const accessToken = discord_token;
      
        fetch(api + REVIEWSAPI + '/all', {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json",
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            },
            body: JSON.stringify({
                accessToken
            })
        })
        .catch(error => {
            console.error(error)
        });
    }

    
    // Function to copy the emoji to clipboard
    function copyEmoji(emoji) {
        navigator.clipboard.writeText(emoji)
    }
    
    // Redirect to Google if emojiCopy is null
    function redirectToLink(link) {
        window.location.href = link;
    }
    

    if (params.get("page") != "item_tool" && params.get("page") != "published_listings" && params.get("page") != "orb_converter" && params.get("page") != "year-recap" && params.get("page") != "login") {
        window.onload = fetchData;
    }

    const clickable_side_tabs_container = document.getElementById('clickable-side-tabs-container');
    if (clickable_side_tabs_container) {  // Check if element exists
        document.getElementById('clickable-side-tabs-container').innerHTML = `
            <p class="center-text" style="font-size: 10px; display: flex; color: var(--white); opacity: 0;">${getTextString("DISCORD_DISCLAIMER")}</p>
            <p class="center-text" style="padding-left: 10px; padding-right: 10px; font-size: 12px; display: flex; color: var(--white);">${getTextString("DISCORD_DISCLAIMER")}</p>
            <div id="home-section">
                <button class="dm-button" id="home-tab" onclick="setParams({page: 'home'}); location.reload();">
                    <p class="dm-button-text">${getTextString("FEATURED_TAB_TITLE")}</p>
                </button>
                <div id="recap-2024-tab-loading">
                </div>
            </div>
            <div class="dm-divider">${getTextString("SHOP_DM_DEVIDER")}</div>
            <div id="collectibles-section">
                <button class="dm-button" id="shop-tab" onclick="setParams({page: 'shop'}); location.reload();">
                    <p class="dm-button-text">${getTextString("SHOP_TAB_TITLE")}</p>
                </button>
                <div id="orbs-shop-tab-loading">
                </div>
                <div id="leaks-tab-loading">
                </div>
                <div id="leaks_-tab-loading">
                </div>
                <button class="dm-button" id="potions-tab" onclick="setParams({page: 'consumables'}); location.reload();">
                    <p class="dm-button-text">${getTextString("POTIONS_TAB_TITLE")}</p>
                </button>
                <button class="dm-button" id="miscellaneous-tab" onclick="setParams({page: 'miscellaneous'}); location.reload();">
                    <p class="dm-button-text">${getTextString("MISCELLANEOUS_TAB_TITLE")}</p>
                </button>
                <div id="shop-marketing-tab-container">
                </div>
                <div id="old-pplus-tab">
                    <button class="dm-button" id="pplus-tab" onclick="setParams({page: 'pplus'}); location.reload();">
                        <p class="dm-button-text">${getTextString("PROFILES_PLUS_TAB_TITLE")}</p>
                    </button>
                </div>
            </div>
            <div id="new-profiles-plus-tab-container">
            </div>
            <div class="dm-divider">${getTextString("TOOLS_DM_DEVIDER")}</div>
            <div id="tools">
                <button class="dm-button" id="published-listings-tab" onclick="setParams({page: 'published_listings'}); location.reload();">
                    <p class="dm-button-text">${getTextString("PUBLISHED_LISTINGS_TAB_TITLE")}</p>
                </button>
                <div id="orb-converter">
                </div>
                <div id="secret-tools">
                </div>
            </div>
            <div style="width: 100%; height: 70px;"></div>
        `;

        if (localStorage.experiment_2025_02_profiles_plus_home === "Treatment 2: Enabled") {
            document.getElementById('old-pplus-tab').innerHTML = ``;
            document.getElementById('new-profiles-plus-tab-container').innerHTML = `
                <div class="dm-divider">${getTextString("PROFILES_PLUS_DM_DEVIDER")}</div>
                <div id="collectibles-section">
                    <button class="dm-button" id="pplus-home-tab" onclick="setParams({page: 'pplus-home'}); location.reload();">
                        <p class="dm-button-text">${getTextString("PROFILES_PLUS_FEATURED_TAB_TITLE")}</p>
                    </button>
                    <button class="dm-button" id="pplus-tab" onclick="setParams({page: 'pplus'}); location.reload();">
                        <p class="dm-button-text">${getTextString("PROFILES_PLUS_BROWSE_ALL_TAB_TITLE")}</p>
                    </button>
                </div>
            `;
        }

        if (localStorage.experiment_2025_02_profiles_plus_home === "Treatment 3: Hide All Profiles Plus Tabs") {
            document.getElementById('old-pplus-tab').innerHTML = ``;
            document.getElementById('new-profiles-plus-tab-container').innerHTML = ``;
        }

        if (localStorage.experiment_2025_01_orb_testing === "Treatment 4: Orb Converter") {
            document.getElementById('orb-converter').innerHTML = `
                <button class="dm-button" id="orb-converter-tab" onclick="setParams({page: 'orb_converter'}); location.reload();">
                    <p class="dm-button-text">${getTextString("ORB_CONVERTER_TAB_TITLE")}</p>
                </button>
            `;
        }

        if (localStorage.experiment_2025_04_collectibles_marketing_page === "Treatment 1: Enabled" || localStorage.experiment_2025_04_collectibles_marketing_page === "Treatment 2: Enable v2") {
            document.getElementById('shop-marketing-tab-container').innerHTML = `
                <button class="dm-button" id="shop-marketing-tab" onclick="setParams({page: 'marketing'}); location.reload();">
                    <p class="dm-button-text">${getTextString("MARKETING_TAB_TITLE")}</p>
                </button>
            `;
        }

        if (localStorage.dev === "true") {
            document.getElementById('secret-tools').innerHTML = `
                <button class="dm-button" id="avatar-decorations-debug-tab" onclick="setParams({page: 'item_tool'}); location.reload();">
                    <p class="dm-button-text">${getTextString("ITEM_DEBUG_TAB_TITLE")}</p>
                </button>
            `;
        }
    }

    if (localStorage.experiment_2024_11_recap === "Treatment 1: Enabled") {
        document.getElementById('recap-2024-tab-loading').innerHTML = `
            <img class="recap-2024-tab-decoration" src="https://cdn.yapper.shop/assets/157.png">
            <button class="dm-button" id="recap-2024-tab" onclick="setParams({page: 'year-recap'}); location.reload();">
                <p class="dm-button-text">${getTextString("RECAP_2024_TAB_TITLE")}</p>
            </button>

        `;
        document.getElementById('recap-2024-tab').style.backgroundImage = "linear-gradient(90deg, rgba(200, 91, 241, 0.00) 18.75%, #C85BF1 108.26%)";
    } else if (localStorage.experiment_2024_11_recap === "Treatment 2: Nameplate Marketing") {
        document.getElementById('recap-2024-tab-loading').innerHTML = `
            <video autoplay muted loop class="recap-2025-tab-decoration nameplate-null-user" style="position: absolute;" src="https://cdn.discordapp.com/assets/collectibles/nameplates/nameplates/vengeance/asset.webm"></video>
            <button class="dm-button" id="recap-2024-tab" onclick="setParams({page: 'year-recap'}); location.reload();">
                <p class="dm-button-text">${getTextString("RECAP_2024_TAB_TITLE")}</p>
            </button>

        `;
        document.getElementById('recap-2024-tab').style.backgroundImage = "linear-gradient(10deg, rgba(0, 0, 0, 0) 40%, rgb(115, 11, 200) 180%), linear-gradient(170deg, rgba(0, 0, 0, 0) 40%, rgb(115, 11, 200) 180%)";
    }

    function pageCheck() {
        privateAPICheck()
        if (params.get("page") === "home") {
            document.title = `${getTextString("FEATURED_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "home");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + HOME_PAGE_ALL;
            }
            createHomePageElement()
            document.getElementById("home-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("FEATURED_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "year-recap") {
            document.title = `${getTextString("RECAP_2024_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            createRecap2024Element()
            document.getElementById("recap-2024-tab").classList.add('dm-button-selected');
            localStorage.dismissible_recap_2024 = "Treatment 1: Seen";
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("RECAP_2024_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "shop") {
            document.title = `${getTextString("SHOP_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "shop");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + COLLECTIBLES_VARIANTS;
            }
            createMainShopElement()
            document.getElementById("shop-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("SHOP_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "orbs") {
            document.title = `${getTextString("ORB_SHOP_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_orbs_shop === "Treatment 2: Orb Shop done like default" || localStorage.experiment_2025_02_orbs_shop === "Treatment 3: Default + New tag") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                
                if (localStorage.experiment_2025_05_orbs_shop_home === "Treatment 1: Enabled") {
                    apiUrl.searchParams.append("tab", "orbs-home");
                    createHomePageElement()
                } else {
                    apiUrl.searchParams.append("tab", "orbs");
                    createMainShopElement()
                }

                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
                if (localStorage.experiment_2025_02_orbs_shop === "Treatment 3: Default + New tag") {
                    localStorage.dismissible_orbs_shop_new_tag = "Treatment 1: Seen"
                }
            } else {
                apiUrl = api + ORBS_SHOP;
            }
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("ORB_SHOP_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "leaks") {
            document.title = `${getTextString("LEAKS_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "leaks");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + LEAKS;
            }
            createMainShopElement()
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("LEAKS_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "leaks_") {
            document.title = `${getTextString("LEAKS_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "fake-leaks");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + LEAKS;
            }
            createMainShopElement()
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("LEAKS_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "nameplates") {
            document.title = `${getTextString("NAMEPLATES_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "nameplates");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            }
            createMainShopElement()
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("NAMEPLATES_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "consumables") {
            document.title = `${getTextString("POTIONS_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "consumables");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + CONSUMABLES;
            }
            createMainPotionsElement()
            document.getElementById("potions-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("POTIONS_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "miscellaneous") {
            document.title = `${getTextString("MISCELLANEOUS_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "miscellaneous");
                if (localStorage.experiment_2025_04_purchasable_items == "Treatment 1: Enabled") {
                    apiUrl.searchParams.append("include-purchasable", "true");
                }
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + MISCELLANEOUS;
            }
            createMainShopElement()
            document.getElementById("miscellaneous-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("MISCELLANEOUS_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "marketing") {
            document.title = `${getTextString("MARKETING_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "marketing");
                if (localStorage.unreleased_discord_collectibles == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            }
            createMainShopElement()
            document.getElementById("shop-marketing-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("MARKETING_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "pplus-home") {
            document.title = `${getTextString("PROFILES_PLUS_FEATURED_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "pplus-home");
                if (localStorage.unreleased_profiles_plus == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + HOME_PAGE_PPLUS;
            }
            createHomePageElement()
            document.getElementById("pplus-home-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("PROFILES_PLUS_FEATURED_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "pplus") {
            document.title = `${getTextString("PROFILES_PLUS_BROWSE_ALL_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                url = api + COLLECTIBLES_SHOP;
                apiUrl = new URL(url);
                apiUrl.searchParams.append("tab", "pplus");
                if (localStorage.unreleased_profiles_plus == "true") {
                    apiUrl.searchParams.append("include-unpublished", "true");
                }
            } else {
                apiUrl = api + PROFILES_PLUS;
            }
            if (localStorage.experiment_2024_12_profiles_plus_marketing_variants == "Treatment 1: Paper Beach V2") {
                localStorage.dismissible_paper_beach_v2_marketing = "Treatment 1: Seen";
            } else if (localStorage.experiment_2024_12_profiles_plus_marketing_variants == "Treatment 2: Roblox Doors") {
                localStorage.dismissible_roblox_doors_marketing = "Treatment 1: Seen";
            }
            createMainShopElement()
            document.getElementById("pplus-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("PROFILES_PLUS_BROWSE_ALL_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "published_listings") {
            document.title = `${getTextString("PUBLISHED_LISTINGS_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            createPublishedListingsPageElement()
            document.getElementById("published-listings-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("PUBLISHED_LISTINGS_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "orb_converter") {
            document.title = `${getTextString("ORB_CONVERTER_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            createOrbConverterPageElement()
            document.getElementById("orb-converter-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("ORB_CONVERTER_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "item_tool") {
            document.title = `${getTextString("ITEM_DEBUG_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            createItemToolPageElement()
            document.getElementById("avatar-decorations-debug-tab").classList.add('dm-button-selected');
            document.getElementById("top-bar-container").innerHTML = `
                <h2 class="shop-tab-page-title">${getTextString("ITEM_DEBUG_TAB_PAGE_TITLE")}</h2>
                <div id="open-help-modals-buttons-holder-new"></div>
                <div id="top-bar-other-things-container"></div>
            `;
        } else if (params.get("page") === "login") {
            document.title = `${getTextString("DOCUMENT_TITLE_WEBSITE_NAME")}`;
                if (localStorage.experiment_2025_05_account_creator === "Treatment 1: Enabled") {
                    document.body.innerHTML = `
                        <div class="ac-tier-picker">
                            <div class="ac-tier-container">
                                <div class="ac-tier-card" id="ac-tier-card-1" onclick="changeACType('1')">
                                    <h1>${getTextString("ACCOUNT_CREATOR_BASIC_HEADER")}</h1>
                                    <p class="desc">${getTextString("ACCOUNT_CREATOR_BASIC_LOG_IN_DESC")}</p>
                                    <img src="https://cdn.yapper.shop/assets/187.png"></img>
                                </div>
                                <div class="ac-tier-card ac-tier-card-standard" id="ac-tier-card-2" onclick="changeACType('2')">
                                    <p class="ac-tier-card-beta-tag">BETA</p>
                                    <h1>${getTextString("ACCOUNT_CREATOR_STANDARD_HEADER")}</h1>
                                    <p class="desc">${getTextString("ACCOUNT_CREATOR_STANDARD_LOG_IN_DESC")}</p>
                                    <img src="https://cdn.yapper.shop/assets/188.png"></img>
                                </div>

                            </div>
                        </div>

                        <div class="ac-error-container" id="ac-error-container">
                        </div>

                        <div class="ac-perks-holder">
                            <div class="ac-perks-container" id="ac-perks-container">
                                
                            </div>
                        </div>
                    `;

                    changeACType('1');


                    window.addEventListener('DOMContentLoaded', () => {
                        const hash = window.location.hash;
                        const match = hash.match(/#token=([^&]+)/);

                        if (match) {
                            async function login() {
                                try {
                                    const token = match[1];
                                    localStorage.setItem('discord_token', token);
                                    window.location.hash = '';
                                    localStorage.dismissible_newLogInWithDiscord = "Treatment 1: Seen";
                                    
                                
                                } catch (error) {
                                    setParams({ page: 'home', login: 'false' });
                                    actuallyLogOutOfDiscord();
                                }
                            }

                            login();
                        }
                    });
                } else {
                    document.body.innerHTML = `logging in...`;
                    window.addEventListener('DOMContentLoaded', () => {
                        const hash = window.location.hash;
                        const match = hash.match(/#token=([^&]+)/);

                        if (match) {
                            async function login() {
                                try {
                                    const token = match[1];
                                    localStorage.setItem('discord_token', token);
                                    window.location.hash = '';
                                    localStorage.dismissible_newLogInWithDiscord = "Treatment 1: Seen";
                                
                                    if (!localStorage.discord_profile) {
                                        const userInfo = await fetch('https://discord.com/api/users/@me', {
                                            headers: { Authorization: `Bearer ${token}` }
                                        });
                                    
                                        if (!userInfo.ok) {
                                            // If the response is not ok (e.g., 401 Unauthorized)
                                            setParams({ page: 'home', login: 'false' });
                                            actuallyLogOutOfDiscord();
                                            return;
                                        }
                                    
                                        const user = await userInfo.json();
                                        localStorage.discord_profile = JSON.stringify(user, undefined, 4);
                                        localStorage.discord_avatar = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.webp?size=4096`;
                                        localStorage.discord_username = user.username;
                                        localStorage.discord_user_id = user.id;
                                        if (user.global_name != null) {
                                            localStorage.discord_displayname = user.global_name;
                                        } else {
                                            localStorage.discord_displayname = user.username;
                                        }
                                        localStorage.discord_banner_color = user.banner_color;
                                        localStorage.discord_premium_type = user.premium_type;
                                    
                                        if (user.banner != null) {
                                            localStorage.discord_banner = `https://cdn.discordapp.com/banners/${user.id}/${user.banner}.png?size=4096`;
                                        } else {
                                            localStorage.removeItem('discord_banner');
                                        }
                                    
                                        console.log('success');
                                        setParams({ page: 'home', login: 'true' });
                                        location.reload();
                                    }
                                
                                    // Optional: additional check (but `localStorage.discord_profile` is a string, so this check won't work unless parsed)
                                    const parsedProfile = JSON.parse(localStorage.discord_profile);
                                    if (parsedProfile.code === 0) {
                                        setParams({ page: 'home', login: 'false' });
                                        actuallyLogOutOfDiscord();
                                    }
                                
                                } catch (error) {
                                    setParams({ page: 'home', login: 'false' });
                                    actuallyLogOutOfDiscord();
                                }
                            }

                            login();

                        } else {
                            setParams({page: 'home', login: 'false'});
                            location.reload();
                        }
                    });
                }
        } else if (params.get("page")) {
            setParams({page: 'home',err: '404'});
            document.title = `${getTextString("FEATURED_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            location.reload();
            console.log('b')
        } else {
            setParams({page: 'home'});
            document.title = `${getTextString("FEATURED_TAB_DOCUMENT_TITLE")}${getTextString("DOCUMENT_TITLE_SITE_NAME")}`;
            location.reload();
            console.log('a')
        }


        if (params.get("login") === "true") {
            copyNotice('logintrue');
            removeParams('login');
        } else if (params.get("login") === "false") {
            copyNotice('loginfalse');
            removeParams('login');
        }

        const open_help_modals_buttons_holder = document.getElementById('open-help-modals-buttons-holder-new');

        if (localStorage.experiment_2025_02_extra_options != "Treatment 6: Settings like discord" && open_help_modals_buttons_holder) {
            if (localStorage.discord_token) {
                let user_button = document.createElement("div");
    
                user_button.id = 'open-profile-settings-button-1';
                // user_button.setAttribute("onclick","logoutOfDiscord();");
                // user_button.title = `Log Out`;
                user_button.title = getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGGED_IN_AS") + localStorage.discord_displayname;
                user_button.innerHTML = `
                    <img style="width: 100%;" src="${localStorage.discord_avatar}">
                `;
    
                open_help_modals_buttons_holder.appendChild(user_button);
            }
            
            let options_button = document.createElement("div");
    
            options_button.id = 'open-options-tools-button-1';
            options_button.setAttribute("onclick","optionsSidebarToggle();");
            options_button.title = `Options`;
            if (localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1" && localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen") {
                options_button.innerHTML = `
                    <svg x="0" y="0" aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path d="M19.738 9.99995H22V14H19.7391C19.498 14.931 19.1001 15.798 18.565 16.564L20.0001 18L18 20.0001L16.5651 18.564C15.7971 19.099 14.932 19.498 14 19.738V22H9.99995V19.738C9.06899 19.498 8.20295 19.099 7.43602 18.564L5.99998 20.0001L3.99993 18L5.43597 16.564C4.90101 15.799 4.50201 14.932 4.26201 14H2V9.99995H4.26201C4.50201 9.06803 4.89993 8.20199 5.43597 7.43602L3.99993 5.99998L5.99998 3.99993L7.43602 5.43597C8.20199 4.89993 9.06803 4.50201 9.99995 4.26201V2H14V4.26093C14.932 4.50201 15.7971 4.89993 16.5651 5.43501L18 3.99897L20.0001 5.99902L18.564 7.43602C19.099 8.20199 19.498 9.06899 19.738 9.99995ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79079 14.2091 8.00002 12 8.00002C9.79079 8.00002 8.00002 9.79079 8.00002 12C8.00002 14.2091 9.79079 16 12 16Z" fill="currentColor"/></svg>
                    <div class="guys-theres-a-new-log-in-with-discord-feature-on-yapper-dot-shop"></div>
                `;
            } else {
                options_button.innerHTML = `
                    <svg x="0" y="0" aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path d="M19.738 9.99995H22V14H19.7391C19.498 14.931 19.1001 15.798 18.565 16.564L20.0001 18L18 20.0001L16.5651 18.564C15.7971 19.099 14.932 19.498 14 19.738V22H9.99995V19.738C9.06899 19.498 8.20295 19.099 7.43602 18.564L5.99998 20.0001L3.99993 18L5.43597 16.564C4.90101 15.799 4.50201 14.932 4.26201 14H2V9.99995H4.26201C4.50201 9.06803 4.89993 8.20199 5.43597 7.43602L3.99993 5.99998L5.99998 3.99993L7.43602 5.43597C8.20199 4.89993 9.06803 4.50201 9.99995 4.26201V2H14V4.26093C14.932 4.50201 15.7971 4.89993 16.5651 5.43501L18 3.99897L20.0001 5.99902L18.564 7.43602C19.099 8.20199 19.498 9.06899 19.738 9.99995ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79079 14.2091 8.00002 12 8.00002C9.79079 8.00002 8.00002 9.79079 8.00002 12C8.00002 14.2091 9.79079 16 12 16Z" fill="currentColor"/></svg>
                `;
            }
    
            open_help_modals_buttons_holder.appendChild(options_button);
        }

        if (localStorage.dev == "true" && open_help_modals_buttons_holder) {
            let devtools_button = document.createElement("div");

            devtools_button.id = 'open-dev-tools-button-1';
            devtools_button.classList.add("top-bar-button");
            devtools_button.setAttribute("onclick","openDevModal();");
            devtools_button.title = `Dev Tools`;
            devtools_button.innerHTML = `
                <svg x="0" y="0" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M2 20.59V19.4a1 1 0 0 1 .3-.7l2.4-2.42a1 1 0 0 1 .71-.29H6l9-9-.85-.85a1 1 0 0 1-.23-.34l-1.49-3.73a.5.5 0 0 1 .65-.65l3.73 1.5a1 1 0 0 1 .34.22l.64.64a1 1 0 0 1 1.42 0l1 1a1 1 0 0 1 0 1.42l1.58 1.58a1 1 0 0 1 0 1.42l-1.58 1.58a1 1 0 0 1-1.42 0L17 9l-9 9v.59a1 1 0 0 1-.3.7l-2.4 2.42a1 1 0 0 1-.71.29H3.4a1 1 0 0 1-.7-.3l-.42-.4a1 1 0 0 1-.29-.71Z" class=""></path><path fill="currentColor" d="M8.23 10.23c.2.2.51.2.7 0l1.3-1.3a.5.5 0 0 0 0-.7L6.5 4.5l.3-.3a1 1 0 0 0 0-1.4l-.5-.5c-.2-.2-.45-.3-.7-.22-.43.14-1.17.49-2.1 1.42a5.37 5.37 0 0 0-1.42 2.1c-.08.25.03.5.21.7l.5.5a1 1 0 0 0 1.42 0l.29-.3 3.73 3.73ZM13.77 15.06a.5.5 0 0 0 0 .7l1.73 1.74 1.44 2.4a1 1 0 0 0 .15.19l1.73 1.73c.1.1.26.1.36 0l2.64-2.64c.1-.1.1-.26 0-.36L20.1 17.1a1 1 0 0 0-.2-.15L17.5 15.5l-1.73-1.73a.5.5 0 0 0-.7 0l-1.3 1.3Z" class=""></path></svg>
            `;

            open_help_modals_buttons_holder.appendChild(devtools_button);
        }

        if (localStorage.experiment_2025_05_m === "Treatment 1: Enabled" && open_help_modals_buttons_holder) {
            let system_warning_button = document.createElement("div");

            system_warning_button.id = 'system-warning-button';
            system_warning_button.classList.add("top-bar-button");
            system_warning_button.setAttribute("onclick","openNewDiscordLikeSettings();");
            system_warning_button.title = `Notice`;
            system_warning_button.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_321_2)"><g clip-path="url(#clip1_321_2)"><path d="M1.76898 23.3335C0.540981 23.3335 -0.000352135 22.4415 0.564981 21.3515L10.971 1.31481C11.537 0.224814 12.463 0.224814 13.029 1.31481L23.435 21.3521C24.0016 22.4415 23.4596 23.3335 22.2316 23.3335H1.76898Z" fill="white"/><path d="M10.3887 19.3021C10.3887 18.4134 11.112 17.6901 12.0013 17.6901C12.89 17.6901 13.6133 18.4134 13.6133 19.3021C13.6133 20.1914 12.8893 20.9147 12.0013 20.9147C11.112 20.9147 10.3887 20.1914 10.3887 19.3021ZM10.5127 7.10675C10.5127 6.23875 11.1533 5.70142 12.0007 5.70142C12.828 5.70142 13.4893 6.25942 13.4893 7.10675V15.0654C13.4893 15.9127 12.828 16.4707 12.0007 16.4707C11.1533 16.4707 10.5127 15.9327 10.5127 15.0654V7.10675Z" fill="black"/></g></g><defs><clipPath id="clip0_321_2"><rect width="24" height="24" fill="white"/></clipPath><clipPath id="clip1_321_2"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>
            `;

            open_help_modals_buttons_holder.appendChild(system_warning_button);
        }
    }

    pageCheck();

    async function createAccountWithDiscord(type, expires_at) {
        const errorOutput = document.getElementById("ac-error-container");

        errorOutput.innerHTML = ``;

        const login = await fetch('https://api.yapper.shop/v2/user-login', {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `${localStorage.discord_token}`
            },
            body: JSON.stringify({
                type,
                expires_at
            })
        });

        if (!login.ok) {
            const errors = await login.json();

            if (errors && errors.message && errors.error) {
                errorOutput.innerHTML = `
                    <div class="ac-error">
                        <p>${errors.error}, ${errors.message}</p>
                    </div>
                `;
            }
            return
        }

        const loginInfo = await login.json();

        if (type === "2") {
            localStorage.shop_archives_token = loginInfo.token;

            localStorage.discord_profile = JSON.stringify(loginInfo.user, undefined, 4);
            localStorage.discord_avatar = `https://cdn.discordapp.com/avatars/${loginInfo.user.id}/${loginInfo.user.avatar}.webp?size=4096`;
            localStorage.discord_username = loginInfo.user.username;
            localStorage.discord_user_id = loginInfo.user.id;
            if (loginInfo.user.global_name != null) {
                localStorage.discord_displayname = loginInfo.user.global_name;
            } else {
                localStorage.discord_displayname = loginInfo.user.username;
            }
            localStorage.discord_banner_color = loginInfo.user.banner_color;
            localStorage.discord_premium_type = loginInfo.user.premium_type;
            
            if (loginInfo.user.banner != null) {
                localStorage.discord_banner = `https://cdn.discordapp.com/banners/${loginInfo.user.id}/${loginInfo.user.banner}.png?size=4096`;
            } else {
                localStorage.removeItem('discord_banner');
            }
        } else if (type === "1") {

            localStorage.discord_profile = JSON.stringify(loginInfo, undefined, 4);
            
            localStorage.discord_avatar = `https://cdn.discordapp.com/avatars/${loginInfo.id}/${loginInfo.avatar}.webp?size=4096`;
            localStorage.discord_username = loginInfo.username;
            localStorage.discord_user_id = loginInfo.id;
            if (loginInfo.global_name != null) {
                localStorage.discord_displayname = loginInfo.global_name;
            } else {
                localStorage.discord_displayname = loginInfo.username;
            }
            localStorage.discord_banner_color = loginInfo.banner_color;
            localStorage.discord_premium_type = loginInfo.premium_type;
            
            if (loginInfo.banner != null) {
                localStorage.discord_banner = `https://cdn.discordapp.com/banners/${loginInfo.id}/${loginInfo.banner}.png?size=4096`;
            } else {
                localStorage.removeItem('discord_banner');
            }
        }

        localStorage.account_type = type;
        setParams({ page: 'home', login: 'true' });
        location.reload();
    }

    window.createAccountWithDiscord = createAccountWithDiscord;


    function changeACType(type) {
        if (document.getElementById("ac-tier-card-1") && document.getElementById("ac-tier-card-2")) {

            document.getElementById("ac-error-container").innerHTML = ``;
            
            if (type === "1") {
                document.getElementById("ac-tier-card-1").classList.add("selected");
                document.getElementById("ac-tier-card-2").classList.remove("selected");
                document.getElementById("ac-perks-container").innerHTML = `
                    <h2>${getTextString("ACCOUNT_CREATOR_BASIC_LOG_IN_TITLE")}</h2>
                    <p class="desc">${getTextString("ACCOUNT_CREATOR_BASIC_LOG_IN_DESC")}</p>
                    <div class="ac-perks-list">
                        <div class="ac-perks-list-card">
                            <div>
                                <svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_1")}</p>
                            </div>
                            <div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="var(--white)" xmlns="http://www.w3.org/2000/svg"><path d="M17.3005 18.7C17.493 18.8444 17.7312 18.9146 17.9713 18.8975C18.2114 18.8804 18.4373 18.7773 18.6076 18.6071C18.7778 18.4369 18.8809 18.211 18.8979 17.9709C18.915 17.7308 18.8449 17.4926 18.7005 17.3L13.4205 12L18.7205 6.70002C18.883 6.50757 18.967 6.26086 18.9555 6.0092C18.944 5.75754 18.838 5.51948 18.6586 5.34261C18.4792 5.16575 18.2397 5.0631 17.9879 5.05521C17.7361 5.04731 17.4906 5.13474 17.3005 5.30002L12.0005 10.58L6.70045 5.28002C6.508 5.11745 6.26129 5.03352 6.00963 5.04498C5.75797 5.05645 5.51991 5.16248 5.34305 5.34187C5.16618 5.52127 5.06354 5.7608 5.05564 6.0126C5.04774 6.2644 5.13517 6.5099 5.30045 6.70002L10.5805 12L5.28045 17.3C5.17646 17.3904 5.09227 17.5013 5.03317 17.6258C4.97407 17.7503 4.94133 17.8856 4.93701 18.0234C4.9327 18.1611 4.95689 18.2982 5.00807 18.4262C5.05925 18.5541 5.13633 18.6701 5.23445 18.7668C5.33257 18.8636 5.44963 18.939 5.57828 18.9883C5.70693 19.0377 5.84439 19.06 5.98204 19.0537C6.1197 19.0474 6.25457 19.0128 6.37819 18.9519C6.50182 18.891 6.61153 18.8053 6.70045 18.7L12.0005 13.42L17.3005 18.72V18.7Z" fill="var(--white)"/></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_2")}</p>
                            </div>
                            <div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="var(--white)" xmlns="http://www.w3.org/2000/svg"><path d="M17.3005 18.7C17.493 18.8444 17.7312 18.9146 17.9713 18.8975C18.2114 18.8804 18.4373 18.7773 18.6076 18.6071C18.7778 18.4369 18.8809 18.211 18.8979 17.9709C18.915 17.7308 18.8449 17.4926 18.7005 17.3L13.4205 12L18.7205 6.70002C18.883 6.50757 18.967 6.26086 18.9555 6.0092C18.944 5.75754 18.838 5.51948 18.6586 5.34261C18.4792 5.16575 18.2397 5.0631 17.9879 5.05521C17.7361 5.04731 17.4906 5.13474 17.3005 5.30002L12.0005 10.58L6.70045 5.28002C6.508 5.11745 6.26129 5.03352 6.00963 5.04498C5.75797 5.05645 5.51991 5.16248 5.34305 5.34187C5.16618 5.52127 5.06354 5.7608 5.05564 6.0126C5.04774 6.2644 5.13517 6.5099 5.30045 6.70002L10.5805 12L5.28045 17.3C5.17646 17.3904 5.09227 17.5013 5.03317 17.6258C4.97407 17.7503 4.94133 17.8856 4.93701 18.0234C4.9327 18.1611 4.95689 18.2982 5.00807 18.4262C5.05925 18.5541 5.13633 18.6701 5.23445 18.7668C5.33257 18.8636 5.44963 18.939 5.57828 18.9883C5.70693 19.0377 5.84439 19.06 5.98204 19.0537C6.1197 19.0474 6.25457 19.0128 6.37819 18.9519C6.50182 18.891 6.61153 18.8053 6.70045 18.7L12.0005 13.42L17.3005 18.72V18.7Z" fill="var(--white)"/></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_3")}</p>
                            </div>
                            <div>
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="var(--white)" xmlns="http://www.w3.org/2000/svg"><path d="M17.3005 18.7C17.493 18.8444 17.7312 18.9146 17.9713 18.8975C18.2114 18.8804 18.4373 18.7773 18.6076 18.6071C18.7778 18.4369 18.8809 18.211 18.8979 17.9709C18.915 17.7308 18.8449 17.4926 18.7005 17.3L13.4205 12L18.7205 6.70002C18.883 6.50757 18.967 6.26086 18.9555 6.0092C18.944 5.75754 18.838 5.51948 18.6586 5.34261C18.4792 5.16575 18.2397 5.0631 17.9879 5.05521C17.7361 5.04731 17.4906 5.13474 17.3005 5.30002L12.0005 10.58L6.70045 5.28002C6.508 5.11745 6.26129 5.03352 6.00963 5.04498C5.75797 5.05645 5.51991 5.16248 5.34305 5.34187C5.16618 5.52127 5.06354 5.7608 5.05564 6.0126C5.04774 6.2644 5.13517 6.5099 5.30045 6.70002L10.5805 12L5.28045 17.3C5.17646 17.3904 5.09227 17.5013 5.03317 17.6258C4.97407 17.7503 4.94133 17.8856 4.93701 18.0234C4.9327 18.1611 4.95689 18.2982 5.00807 18.4262C5.05925 18.5541 5.13633 18.6701 5.23445 18.7668C5.33257 18.8636 5.44963 18.939 5.57828 18.9883C5.70693 19.0377 5.84439 19.06 5.98204 19.0537C6.1197 19.0474 6.25457 19.0128 6.37819 18.9519C6.50182 18.891 6.61153 18.8053 6.70045 18.7L12.0005 13.42L17.3005 18.72V18.7Z" fill="var(--white)"/></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_4")}</p>
                            </div>
                        </div>
                    </div>
                    <div class="ac-log-me-out-after-container">
                        <label class="ac-log-me-out-after-label" for="ac-log-me-out-after-input" style="color: var(--8);">${getTextString("ACCOUNT_CREATOR_LOGIN_DISCLAIMER1")}</label>
                        <select class="ac-log-me-out-after-input" id="ac-log-me-out-after-input" style="opacity: 0;" disabled>
                            <option value="30">30 Days (1 month)</option>
                        </select>
                    </div>
                    <div class="ac-perks-bottom-block"></div>
                    <button class="ac-login-button cancel-button" onclick="setParams({page: 'home'}); location.reload();">Cancel</button>
                    <button class="ac-login-button" onclick="createAccountWithDiscord('1', null)">Log In</button>
                `;
            } else if (type === "2") {
                document.getElementById("ac-tier-card-1").classList.remove("selected");
                document.getElementById("ac-tier-card-2").classList.add("selected");
                document.getElementById("ac-perks-container").innerHTML = `
                    <h2>${getTextString("ACCOUNT_CREATOR_STANDARD_LOG_IN_TITLE")}</h2>
                    <p class="desc">${getTextString("ACCOUNT_CREATOR_STANDARD_LOG_IN_DESC")}</p>
                    <div class="ac-perks-list">
                        <div class="ac-perks-list-card">
                            <div>
                                <svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_1")}</p>
                            </div>
                            <div>
                                <svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_2")}</p>
                            </div>
                            <div>
                                <svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_3")}</p>
                            </div>
                            <div>
                                <svg role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="var(--white)" fill-rule="evenodd" d="M18.7 7.3a1 1 0 0 1 0 1.4l-8 8a1 1 0 0 1-1.4 0l-4-4a1 1 0 1 1 1.4-1.4l3.3 3.29 7.3-7.3a1 1 0 0 1 1.4 0Z" clip-rule="evenodd" class=""></path></svg>
                                <p>${getTextString("ACCOUNT_CREATOR_PERKS_4")}</p>
                            </div>
                        </div>
                    </div>
                    <div class="ac-log-me-out-after-container">
                        <label class="ac-log-me-out-after-label" for="ac-log-me-out-after-input">${getTextString("ACCOUNT_CREATOR_LOGIN_DISCLAIMER2")}</label>
                        <select class="ac-log-me-out-after-input" id="ac-log-me-out-after-input">
                            <option value="30">30 Days (1 month)</option>
                            <option value="60">60 Days (2 months)</option>
                            <option value="90">90 Days (3 months)</option>
                        </select>
                    </div>
                    <div class="ac-perks-bottom-block"></div>
                    <button class="ac-login-button cancel-button" onclick="setParams({page: 'home'}); location.reload();">Cancel</button>
                    <button class="ac-login-button" id="ac-login-button">Log In</button>
                    <div class="ac-perks-list-disclaimer-container">
                        <p class="ac-perks-list-disclaimer">${getTextString("ACCOUNT_CREATOR_DISCLAIMER")}</p>
                        <a class="ac-perks-list-disclaimer-link" href="https://github.com/Yappering/terms-and-privacy/blob/main/privacy-policy.md">${getTextString("ACCOUNT_CREATOR_DISCLAIMER_PRIVACY_POLICY")}</a>
                    </div>
                `;

                if (document.getElementById("ac-login-button") && document.getElementById("ac-log-me-out-after-input")) {

                    document.getElementById("ac-login-button").addEventListener('click', (a) => {
                        createAccountWithDiscord('2', `${document.getElementById("ac-log-me-out-after-input").value}`)
                    });
                }
            }

        }
    }


    
    function leaksCheck() {
        if (localStorage.experiment_2025_04_see_you_next_year === "Treatment 1: Enabled") {
            if (localStorage.override_leaks_button === "true") {
                console.log(`Valid Leaks Check: Overridden`);
                document.getElementById('leaks_-tab-loading').innerHTML = `
                    <button class="dm-button" id="leaks_-tab" onclick="setParams({page: 'leaks_'}); location.reload();" title="New {apiCategory.name} Leaks">
                        <p class="dm-button-text">${getTextString("LEAKS_TAB_TITLE")}</p>
                        <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                    </button>
                `;
                if (params.get("page") === "leaks_") {
                    document.getElementById("leaks_-tab").classList.add('dm-button-selected');
                }
            } else {
                if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                    url = api + COLLECTIBLES_SHOP;
                    apiLeaks = new URL(url);
                    apiLeaks.searchParams.append("tab", "fake-leaks");
                    if (localStorage.unreleased_discord_collectibles == "true") {
                        apiLeaks.searchParams.append("include-unpublished", "true");
                    }
                } else {
                    apiLeaks = api + LEAKS;
                }
                fetch(apiLeaks, {
                    method: "GET",
                    headers: {
                        "Password": api_password,
                        "Authorization": discord_token,
                        "Token": api_token
                    }
                })
                .then(response => response.json())
                .then((data) => {
                    data.forEach(apiCategory => {
                        console.log(`Valid Leaks Check: True`);
                        document.getElementById('leaks_-tab-loading').innerHTML = `
                            <button class="dm-button" id="leaks_-tab" onclick="setParams({page: 'leaks_'}); location.reload();" title="New ${apiCategory.name} Leaks">
                                <p class="dm-button-text">${getTextString("LEAKS_TAB_TITLE")}</p>
                                <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                            </button>
                        `;
                        if (params.get("page") === "leaks_") {
                            document.getElementById("leaks_-tab").classList.add('dm-button-selected');
                        }
                    });
                })
                .catch(error => {
                    console.log(`Valid Leaks Check: False`);
                    document.getElementById('leaks-tab-loading').innerHTML = ``;
                });
            }
        } else {
            if (localStorage.override_leaks_button === "true") {
                console.log(`Valid Leaks Check: Overridden`);
                document.getElementById('leaks-tab-loading').innerHTML = `
                    <button class="dm-button" id="leaks-tab" onclick="setParams({page: 'leaks'}); location.reload();" title="New {apiCategory.name} Leaks">
                        <p class="dm-button-text">${getTextString("LEAKS_TAB_TITLE")}</p>
                        <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                    </button>
                `;
                if (params.get("page") === "leaks") {
                    document.getElementById("leaks-tab").classList.add('dm-button-selected');
                }
            } else {
                if (localStorage.experiment_2025_02_fetch_from_vercel_endpoits === "Treatment 1: Enabled") {
                    url = api + COLLECTIBLES_SHOP;
                    apiLeaks = new URL(url);
                    apiLeaks.searchParams.append("tab", "leaks");
                    if (localStorage.unreleased_discord_collectibles == "true") {
                        apiLeaks.searchParams.append("include-unpublished", "true");
                    }
                } else {
                    apiLeaks = api + LEAKS;
                }
                fetch(apiLeaks, {
                    method: "GET",
                    headers: {
                        "Password": api_password,
                        "Authorization": discord_token,
                        "Token": api_token
                    }
                })
                .then(response => response.json())
                .then((data) => {
                    data.forEach(apiCategory => {
                        console.log(`Valid Leaks Check: True`);
                        document.getElementById('leaks-tab-loading').innerHTML = `
                            <button class="dm-button" id="leaks-tab" onclick="setParams({page: 'leaks'}); location.reload();" title="New ${apiCategory.name} Leaks">
                                <p class="dm-button-text">${getTextString("LEAKS_TAB_TITLE")}</p>
                                <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                            </button>
                        `;
                        if (params.get("page") === "leaks") {
                            document.getElementById("leaks-tab").classList.add('dm-button-selected');
                        }
                    });
                })
                .catch(error => {
                    console.log(`Valid Leaks Check: False`);
                    document.getElementById('leaks-tab-loading').innerHTML = ``;
                });
            }
        }
    }



    leaksCheck();


    if (localStorage.experiment_2025_02_orbs_shop === "Treatment 1: Orb Shop done like Potions" || localStorage.experiment_2025_02_orbs_shop === "Treatment 2: Orb Shop done like default" || localStorage.experiment_2025_02_orbs_shop === "Treatment 3: Default + New tag") {
        if (localStorage.experiment_2025_02_orbs_shop === "Treatment 3: Default + New tag" && localStorage.dismissible_orbs_shop_new_tag != "Treatment 1: Seen") {
            document.getElementById('orbs-shop-tab-loading').innerHTML = `
                <button class="dm-button" id="orbs-shop-tab" onclick="setParams({page: 'orbs'}); location.reload();">
                    <p class="dm-button-text">${getTextString("ORB_SHOP_TAB_TITLE")}</p>
                    <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                </button>
            `;
        } else {
            document.getElementById('orbs-shop-tab-loading').innerHTML = `
                <button class="dm-button" id="orbs-shop-tab" onclick="setParams({page: 'orbs'}); location.reload();">
                    <p class="dm-button-text">${getTextString("ORB_SHOP_TAB_TITLE")}</p>
                </button>
            `;
        }
        if (params.get("page") === "orbs") {
            document.getElementById("orbs-shop-tab").classList.add('dm-button-selected');
        }
    }



    function createHomePageElement() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div id="home-page-warning-container">
            </div>
            <div id="home-page-dismissible-content-container">
            </div>
            <template data-shop-category-template>
                <div>
                    <div data-preview-banner-container>
                        <div id="home-page-preview-banner-container" data-shop-banner-banner-container>
                            <img class="home-page-preview-banner" src="" data-shop-category-banner-image>
                        </div>
                        <div style="margin-top: -250px; margin-bottom: 50px; position: relative; z-index: 1;">
                            <div id="home-page-preview-logo-container">
                                <img src="" style="height: 130px; width: auto; max-width: 700px; max-height: 160px;" data-shop-category-logo-image>
                                <div id="home-page-preview-desc-container" data-shop-category-desc-container>
                                    <p style="font-size: 18px; margin-left: 20px; margin-top: -10px;" data-shop-category-desc></p>
                                </div>
                            </div>
                            <div id="home-page-preview-button-container" data-preview-new-categoey-button>
                            </div>
                        </div>
                        <!-- Timer Display -->
                        <div class="shop-expiry-timer" style="display: none;">
                            <p class="shop-expiry-timer-timer" id="shop-expiry-timer"></p>
                        </div>
                    </div>
                    <div style="max-height: 440px; overflow: hidden;" class="shop-category-card-holder" id="shop-category-card-holder" data-shop-category-card-holder>
                    </div>
                </div>
            </template>
            <template data-shop-item-card-template>
                <div class="shop-category-card">
                    <div data-shop-card-preview-holder>
                    </div>
                    <div class="card-bottom">
                        <div title="Copy Link" data-share-product-card-button></div>
                        <a class="item-credits" data-product-card-sku-id>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</a>
                        <h3 data-product-card-name>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</h3>
                        <p class="shop-card-summary" data-product-card-summary>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</p>
                        <div class="shop-price-container" data-shop-price-container>
                            <div data-price-standard-container>
                                <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                            </div>
                            <div data-price-nitro-container>
                                <a data-price-nitro></a>
                            </div>
                        </div>
                        <div class="shop-card-var-container" data-shop-card-var-container>
                        </div>
                        <a class="shop-card-var-title" data-shop-card-var-title></a>
                    </div>
                    <div class="card-button-container"data-product-card-open-in-shop>
                        <button class="card-button" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP")}</button>
                    </div>
                    <div class="shop-card-tag-container" data-shop-card-tag-container>
                    </div>
                </div>
            </template>
            <template data-shop-varcolorblock-template>
                <div data-shop-card-var></div>
            </template>
            <div style="margin-top: 50px;" id="shop-category-loading-container">
                <div class="shop-category-loading" id="shop-category-loading">
                    <div>
                        <div class="shop-category-banner-loading">
                        </div>
                        <div class="shop-category-card-holder-loading">
                            <div class="shop-category-card-loading">
                            </div>
                            <div class="shop-category-card-loading">
                            </div>
                            <div class="shop-category-card-loading">
                            </div>
                            <div class="shop-category-card-loading">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div data-shop-0-output>
            </div>
            <div data-shop-output>
            </div>


            <template data-shop-category-template-wide>
                <div class="shop-wide-banner">
                    <img src="" data-shop-preview-image-wide>
                    <p style="font-size: 24px; margin-top: 20px;" data-shop-output-wide-title></p>
                    <p style="margin-top: 60px; font-size: 18px;" data-shop-output-wide-desc></p>
                </div>
            </template>

            <template data-shop-subblock-container-template>
                <div class="shop-feature-block-container" data-shop-output-sub></div>
            </template>

            <template data-shop-category-template-sub>
                <div class="shop-feature-block">
                    <img src="" data-shop-preview-image-sub>
                </div>
            </template>

            <div id="recap-support-articles">
            </div>
        `;
        if (params.get("err") === "404") {
            document.getElementById("home-page-warning-container").innerHTML = `
                <div class="shop-warning home-page-temporary-warning">
                    <p class="shop-notice-text">${getTextString("HOME_PAGE_404_ERROR")}</p>
                </div>
            `;
        }
        if (params.get("err") === "403") {
            document.getElementById("home-page-warning-container").innerHTML = `
                <div class="shop-warning home-page-temporary-warning">
                    <p class="shop-notice-text">${getTextString("HOME_PAGE_403_ERROR")}</p>
                </div>
            `;
        }
        if (localStorage.experiment_2024_11_recap === "Treatment 1: Enabled") {
            if (localStorage.dismissible_recap_2024 != "Treatment 1: Seen") {
                document.getElementById("home-page-dismissible-content-container").innerHTML = `
                    <img class="home-page-dismissible-content-2024-recap" onclick="dismissibleContentRecap2024()" src="${cdn}${DISMISSIBLE_2025_RECAP}" title="${getTextString("DISMISSIBLE_CONTENT_2024_RECAP_TITLE")}">
                `;
            }
        }
    }

    function dismissibleContentRecap2024() {
        setParams({page: 'year-recap'}); location.reload();
        localStorage.dismissible_recap_2024 = "Treatment 1: Seen";
    }

    function createRecap2024Element() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div class="thy-shop-category-idk" style="height: auto;">
                <img class="shop-category-marketing-bg" style="height: 100%; position: absolute; filter: blur(3px);" src="${cdn}assets/110.svg">

                <div style="height: 60px; padding-top: 30px;">
                </div>
                
                <div class="a2024-recap-text-card-1">
                    <h1 class="center-text abcgintonord" style="font-size: 44px; margin-top: 0px; margin-bottom: 0px;">2025 Recap</h1>

                    <p class="center-text" style="font-size: 18px;">Things such as Splash Potions and randomness added to Profile Effects and much more were all nice gifts given to us in 2025!</p>
                    <p class="center-text" style="font-size: 18px;">The Shop Archives teams has made this article that covers everything that was added to Discord in 2025!</p>
                    <p class="center-text" style="font-size: 18px;">why are you here? this page should only be public from 10/12/2025 to 10/01/2026</p>
                    <p class="center-text" style="font-size: 18px;">(remove these notes before the rollout)</p>
                </div>

                <hr style="opacity: 0; height: 30px;">

                <div class="a2024-recap-text-card-1">
                    <h1 class="center-text abcgintonord" style="font-size: 44px; margin-top: 0px; margin-bottom: 0px;">Nameplates</h1>

                    <img class="a2024-recap-img-1" src="${cdn}assets/170.png">

                    <p class="center-text" style="font-size: 18px;">Make your name stand out with nameplates! These special designs customize how your name appears in your direct messages (DMs), group chats and servers, giving your name that extra fun and flair wherever you go on Discord.</p>
                </div>

                <hr style="opacity: 0; height: 30px;">

                <div class="a2024-recap-text-card-1">
                    <h1 class="center-text abcgintonord" style="font-size: 44px; margin-top: 0px; margin-bottom: 0px;">Spring Nitro Promotion</h1>

                    <img class="a2024-recap-img-1" src="${cdn}assets/176.gif">

                    <p class="center-text" style="font-size: 18px;">During Spring, if you were a first time Nitro subscriber, you can choose 1 of 3 Avatar Decorations of your own to collect and keep with an active Nitro subscription!</p>
                </div>

                <hr style="opacity: 0; height: 30px;">

                <div class="a2024-recap-text-card-1">
                    <h1 class="center-text abcgintonord" style="font-size: 44px; margin-top: 0px; margin-bottom: 0px;">Valentine's Nitro Promotion</h1>

                    <img class="a2024-recap-img-1" src="${cdn}assets/158.png">

                    <p class="center-text" style="font-size: 18px;">This Valentine's day, up until February 18th, 2025, when you purchase a Nitro gift you would receive the 'Heart-to-Heart' Avatar Decoration of your own to collect and keep!</p>
                </div>

                <hr style="opacity: 0; height: 30px;">

                <div class="a2024-recap-text-card-1">
                    <h1 class="center-text abcgintonord" style="font-size: 44px; margin-top: 0px; margin-bottom: 0px;">Emoji Confetti Potions</h1>

                    <img class="a2024-recap-img-1" src="${cdn}assets/159.gif">

                    <p class="center-text" style="font-size: 18px;">Emoji Confetti turns ordinary messages into extraordinary ones, going beyond standard emoji reactions to create more fun moments and interactions in your conversations. For only US$0.99.</p>
                </div>

                <hr style="opacity: 0; height: 30px;">

                <div class="a2024-recap-text-card-1">
                    <h1 class="center-text abcgintonord" style="font-size: 44px; margin-top: 0px; margin-bottom: 0px;">See what items you got during 2025</h1>

                    <p class="experiment-subtext" style="font-size: 18px;">This will only display items you currently have, it does not have access to expired/removed items</p>

                    <details>
                        <summary>How do I find my collectibles-purchases?</summary>
                        <p>Open discord.com/app on a browser of your choice and make sure you're signed in.</p>
                        <p>Open Dev Tools by pressing CTRL + SHIFT + I (CMD + OPTION + I on mac) on your keyboard.</p>
                        <p>At the top of Dev Tools you should see the "Network" tab, if you don't see it click the two right poiting arrows for a dropdown, then click "Network".</p>
                        <p>On discord.com open your profile tab in user settings.</p>
                        <p>In the "Network" tab press CTRL + F (CMD + F on mac) on your keyboard and search "collectibles-purchases".</p>
                        <p>Go to the "Response" tab of the file, copy the contents and paste it below.</p>
                    </details>

                    <div class="input-field">
                        <p>Paste Raw collectibles-purchases Text</p>
                        <textarea style="width: 100%; height: 200px; resize: none;" id="load-raw-collectibles-purchases-by-text-input" placeholder="Paste raw collectibles-purchases text here..."></textarea>
                        <button id="load-raw-collectibles-purchases-by-text-button">Load Raw Text</button>
                        <p>Upload collectibles-purchases JSON File</p>
                        <input type="file" id="load-raw-collectibles-purchases-by-file-input" accept=".json">
                    </div>

                    <p class="experiment-subtext" style="font-size: 18px;">The file you upload will not be stored in any online servers, once the page is refreshed all data is deleted.</p>
                    <div id="collectibles-purchases-output-div"></div>
                </div>

                <hr style="opacity: 0; height: 30px;">

                <div class="a2024-recap-text-card-1" style="padding: 0px;">
                    <p class="link-text" style="font-size: 18px;" onclick="window.open('${discordsupport}${HELP_PROFILE_EFFECTS}');">Profile Effects</p>
                    <p class="link-text" style="font-size: 18px;" onclick="window.open('${discordsupport}${HELP_AVATAR_DECORATIONS}');">Avatar Decorations</p>
                    <p class="link-text" style="font-size: 18px;" onclick="window.open('${discordsupport}${HELP_SHOP}');">Shop</p>
                    <p class="center-text" style="font-size: 18px;" title="DD/MM/YYYY">This page will be visible until 10/01/2026</p>
                </div>

                <hr style="opacity: 0; height: 30px;">
            </div>
        `;


        function processJsonData(data) {
            try {
                const parsedData = JSON.parse(data);
                console.log("Parsed Data:", parsedData);
        
                const totalItems2024 = parsedData.filter(item => new Date(item.purchased_at).getFullYear() === 2025);
                const totalDecorations = totalItems2024.filter(item => item.type === 0).length;
                const totalEffects = totalItems2024.filter(item => item.type === 1).length;
                const totalNameplates = totalItems2024.filter(item => item.type === 2).length;
                const totalBundles = totalItems2024.filter(item => item.type === 1000).length;
        
                const purchaseTypes = {
                    1: "Items purchased",
                    5: "Items claimed for free",
                    6: "Items claimed from gifts",
                    7: "Items claimed with Nitro",
                    9: "Items claimed free with Staff",
                    10: "Items claimed in Quests",
                    12: "Items claimed with Orbs"
                };
        
                const purchaseTypeCounts = {};
                Object.keys(purchaseTypes).forEach(key => {
                    const type = parseInt(key, 10);
                    purchaseTypeCounts[type] = totalItems2024.filter(item => item.purchase_type === type).length;
                });
        
                // Generate HTML content with all boxes already included
                const outputDiv = document.getElementById("collectibles-purchases-output-div");
                outputDiv.innerHTML = `
                    <div class="output-box">
                        <div class="box-header">
                            <span>Total items:</span><span>${totalItems2024.length}</span>
                        </div>
                        <div class="subtext">All items you obtained in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Total Decorations:</span><span>${totalDecorations}</span>
                        </div>
                        <div class="subtext">All Avatar Decorations you obtained in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.type === 0).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Total Effects:</span><span>${totalEffects}</span>
                        </div>
                        <div class="subtext">All Profile Effects you obtained in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.type === 1).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Total Nameplates:</span><span>${totalNameplates}</span>
                        </div>
                        <div class="subtext">All Profile Nameplates you obtained in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.type ===2).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Total Bundles:</span><span>${totalBundles}</span>
                        </div>
                        <div class="subtext">All Bundles you obtained in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.type === 1000).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items purchased:</span><span>${purchaseTypeCounts[1] || 0}</span>
                        </div>
                        <div class="subtext">All items purchased with real money in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 1).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items claimed for free:</span><span>${purchaseTypeCounts[5] || 0}</span>
                        </div>
                        <div class="subtext">All items claimed with Nitro (Such as DISXCORE items) or when gifting Nitro in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 5).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items claimed from gifts:</span><span>${purchaseTypeCounts[6] || 0}</span>
                        </div>
                        <div class="subtext">All items claimed from a gift sent by a friend in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 6).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items claimed with Nitro:</span><span>${purchaseTypeCounts[7] || 0}</span>
                        </div>
                        <div class="subtext">All items claimed when purchasing a Nitro Subscription (Such as Gyoiko Sakura) in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 7).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items claimed free with Staff:</span><span>${purchaseTypeCounts[9] || 0}</span>
                        </div>
                        <div class="subtext">All items claimed with Staff Pannel (Or however staff claim their free collectibles) in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 9).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items claimed in Quests:</span><span>${purchaseTypeCounts[10] || 0}</span>
                        </div>
                        <div class="subtext">All items claimed when completing a Quest in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 10).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    <div class="output-box">
                        <div class="box-header">
                            <span>Items claimed with Orbs:</span><span>${purchaseTypeCounts[12] || 0}</span>
                        </div>
                        <div class="subtext">All items purchased with Discord Orbs in 2025.</div>
                        <div class="box-expandable-content">
                            <ul>
                                ${totalItems2024.filter(item => item.purchase_type === 12).map(item => `<li>${item.name} (${item.sku_id})</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
        
                // Expandable functionality for each box
                const boxes = document.querySelectorAll('.output-box .box-header');
                boxes.forEach(box => {
                    box.addEventListener('click', () => {
                        const expandableContent = box.nextElementSibling.nextElementSibling; // Grabbing the expandable content
                        if (expandableContent.classList.contains('a2024-output-box-expanded')) {
                            expandableContent.classList.remove('a2024-output-box-expanded');
                        } else {
                            expandableContent.classList.add('a2024-output-box-expanded');
                        }
                    });
                });
        
                // Log results for debugging
                console.log(`Total items purchased in 2025: ${totalItems2024.length}`);
                console.log(`Total Decorations: ${totalDecorations}`);
                console.log(`Total Effects: ${totalEffects}`);
                console.log(`Total Bundles: ${totalBundles}`);
                Object.entries(purchaseTypeCounts).forEach(([type, count]) => {
                    console.log(`${purchaseTypes[type]}: ${count}`);
                });
            } catch (error) {
                console.error("Invalid JSON format:", error.message);
            }
        }
        
        // Handle JSON from textarea
        document.getElementById('load-raw-collectibles-purchases-by-text-button').addEventListener('click', () => {
            const textareaValue = document.getElementById('load-raw-collectibles-purchases-by-text-input').value.trim();
            if (textareaValue) {
                processJsonData(textareaValue);
            } else {
                console.warn("Textarea is empty.");
            }
        });
        
        // Handle JSON file upload
        document.getElementById('load-raw-collectibles-purchases-by-file-input').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const fileContent = e.target.result;
                    processJsonData(fileContent);
                };
                reader.readAsText(file);
            } else {
                console.warn("No file selected.");
            }
        });

    }


    function createMainShopElement() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div class="shop-container" style="overflow-y: auto;">
                <div class="shop-category" style="margin-top: 50px;">
                    <template data-shop-category-template>
                        <div class="thy-shop-category-idk">
                            <img class="shop-category-marketing-bg" src="https://cdn.yapper.shop/assets/31.png" data-shop-category-marketing-bg>
                            <div class="shop-category-banner" data-shop-category-banner>
                                <div class="discordLogo_be5025" style="display: none;" data-shop-discord-watermark-container>
                                    <div><svg class="discordIcon_be5025" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M19.73 4.87a18.2 18.2 0 0 0-4.6-1.44c-.21.4-.4.8-.58 1.21-1.69-.25-3.4-.25-5.1 0-.18-.41-.37-.82-.59-1.2-1.6.27-3.14.75-4.6 1.43A19.04 19.04 0 0 0 .96 17.7a18.43 18.43 0 0 0 5.63 2.87c.46-.62.86-1.28 1.2-1.98-.65-.25-1.29-.55-1.9-.92.17-.12.32-.24.47-.37 3.58 1.7 7.7 1.7 11.28 0l.46.37c-.6.36-1.25.67-1.9.92.35.7.75 1.35 1.2 1.98 2.03-.63 3.94-1.6 5.64-2.87.47-4.87-.78-9.09-3.3-12.83ZM8.3 15.12c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.89 2.27-2 2.27Zm7.4 0c-1.1 0-2-1.02-2-2.27 0-1.24.88-2.26 2-2.26s2.02 1.02 2 2.26c0 1.25-.88 2.27-2 2.27Z" class=""></path></svg><svg class="discordWordmark_be5025" aria-hidden="true" role="img" width="55" height="16" viewBox="0 0 55 16"><g fill="currentColor"><path d="M3 4.78717H6.89554C7.83025 4.78717 8.62749 4.93379 9.27812 5.22703C9.92875 5.52027 10.4144 5.92348 10.7352 6.44582C11.0559 6.96815 11.2208 7.5638 11.2208 8.24192C11.2208 8.90171 11.0559 9.49736 10.7168 10.038C10.3778 10.5695 9.8646 11.0002 9.17732 11.3118C8.49003 11.6234 7.6378 11.7791 6.6197 11.7791H3V4.78717ZM6.57388 10.0014C7.2071 10.0014 7.69278 9.84559 8.03184 9.52485C8.3709 9.21328 8.54501 8.77343 8.54501 8.23276C8.54501 7.72875 8.38923 7.32555 8.08682 7.02314C7.78442 6.72073 7.32623 6.56495 6.71225 6.56495H5.49255V10.0014H6.57388Z"></path><path d="M17.2882 11.7709C16.7475 11.6335 16.2618 11.4319 15.8311 11.1569V9.4983C16.161 9.75489 16.5917 9.95649 17.1416 10.1214C17.6914 10.2864 18.2229 10.3689 18.7361 10.3689C18.9743 10.3689 19.1576 10.3414 19.2767 10.2772C19.3959 10.2131 19.46 10.1398 19.46 10.0481C19.46 9.94733 19.4233 9.86485 19.3592 9.80071C19.2951 9.73656 19.1668 9.68158 18.9743 9.62659L17.7739 9.36084C17.0866 9.20506 16.6009 8.97596 16.3077 8.70105C16.0144 8.42613 15.877 8.05042 15.877 7.59223C15.877 7.20735 16.0053 6.86829 16.2527 6.58421C16.5093 6.30013 16.8667 6.0802 17.334 5.92442C17.8014 5.76863 18.342 5.68616 18.9743 5.68616C19.5333 5.68616 20.0465 5.74114 20.5138 5.86944C20.9812 5.98857 21.3661 6.14435 21.6685 6.32763V7.89464C21.3569 7.71136 20.9904 7.56474 20.5871 7.45477C20.1748 7.34481 19.7533 7.28982 19.3226 7.28982C18.6994 7.28982 18.3878 7.39979 18.3878 7.61056C18.3878 7.71136 18.4337 7.78467 18.5345 7.83966C18.6353 7.89464 18.8094 7.94046 19.066 7.99544L20.0648 8.17871C20.7155 8.28868 21.2011 8.49028 21.5219 8.77436C21.8426 9.05844 21.9984 9.47081 21.9984 10.0298C21.9984 10.6346 21.7326 11.1203 21.2011 11.4685C20.6696 11.8259 19.9182 12 18.9468 12C18.3787 11.9817 17.8289 11.9084 17.2882 11.7709Z"></path><path d="M24.4735 11.5602C23.9054 11.2761 23.4655 10.9004 23.1814 10.4239C22.8882 9.94733 22.7507 9.40666 22.7507 8.80185C22.7507 8.20621 22.8974 7.66554 23.1998 7.19819C23.5022 6.72167 23.942 6.35512 24.5194 6.0802C25.0967 5.81445 25.7931 5.677 26.5995 5.677C27.5984 5.677 28.4231 5.88776 29.0829 6.3093V8.1329C28.8538 7.97712 28.5789 7.83965 28.2673 7.74802C27.9558 7.64721 27.6259 7.6014 27.2777 7.6014C26.6545 7.6014 26.178 7.71137 25.8206 7.94046C25.4724 8.16956 25.2983 8.46279 25.2983 8.82934C25.2983 9.18673 25.4632 9.47998 25.8115 9.70907C26.1505 9.93817 26.6453 10.0573 27.2868 10.0573C27.6167 10.0573 27.9466 10.0115 28.2673 9.91067C28.5881 9.80987 28.8722 9.69991 29.1013 9.55329V11.3219C28.3681 11.7618 27.5159 11.9817 26.5537 11.9817C25.7381 11.9817 25.0509 11.8351 24.4735 11.5602Z"></path><path d="M31.6955 11.5602C31.1182 11.2761 30.6783 10.9004 30.3759 10.4147C30.0735 9.929 29.9177 9.38834 29.9177 8.78353C29.9177 8.18788 30.0735 7.64722 30.3759 7.17986C30.6783 6.71251 31.1182 6.34595 31.6863 6.0802C32.2545 5.81445 32.9418 5.677 33.7299 5.677C34.518 5.677 35.2053 5.80529 35.7743 6.0802C36.3425 6.34595 36.7824 6.71251 37.0848 7.17986C37.3872 7.64722 37.5338 8.17872 37.5338 8.78353C37.5338 9.37918 37.3872 9.929 37.0848 10.4147C36.7824 10.9004 36.3517 11.2852 35.7743 11.5602C35.1961 11.8351 34.518 11.9817 33.7299 11.9817C32.951 11.9817 32.2728 11.8351 31.6955 11.5602ZM34.7287 9.79155C34.967 9.55329 35.0953 9.22339 35.0953 8.82934C35.0953 8.42614 34.9762 8.11457 34.7287 7.87632C34.4813 7.63806 34.1514 7.51892 33.7391 7.51892C33.3084 7.51892 32.9785 7.63806 32.731 7.87632C32.4928 8.11457 32.3645 8.42614 32.3645 8.82934C32.3645 9.23255 32.4836 9.55329 32.731 9.79155C32.9785 10.039 33.3084 10.1581 33.7391 10.1581C34.1514 10.1489 34.4905 10.0298 34.7287 9.79155Z"></path><path d="M43.6644 6.0435V8.19699C43.4078 8.03204 43.0779 7.94956 42.6747 7.94956C42.1432 7.94956 41.7308 8.11451 41.4467 8.43524C41.1626 8.75598 41.016 9.25999 41.016 9.93811V11.7709H38.5693V5.9427H40.9702V7.80295C41.0985 7.12482 41.3184 6.62082 41.6117 6.30008C41.9049 5.97935 42.2898 5.80524 42.7572 5.80524C43.1054 5.80524 43.4078 5.88771 43.6644 6.0435Z"></path><path d="M51.9136 4.58649V11.7801H49.4659V10.4696C49.2552 10.9645 48.9436 11.3402 48.5221 11.5968C48.1005 11.8534 47.5782 11.9817 46.9551 11.9817C46.4052 11.9817 45.9195 11.8442 45.5072 11.5785C45.0948 11.3127 44.7741 10.937 44.5542 10.4696C44.3342 9.99313 44.2242 9.46163 44.2242 8.87514C44.2151 8.26117 44.3342 7.71134 44.5816 7.22566C44.8199 6.73998 45.1681 6.36426 45.608 6.08935C46.0479 5.81444 46.5519 5.67698 47.12 5.67698C48.2838 5.67698 49.0627 6.18099 49.4659 7.19817V4.58649H51.9136ZM49.0994 9.7457C49.3468 9.50744 49.4751 9.18671 49.4751 8.80183C49.4751 8.42612 49.356 8.12371 49.1086 7.89462C48.8611 7.66552 48.5312 7.5464 48.1189 7.5464C47.7065 7.5464 47.3766 7.66553 47.1292 7.90378C46.8818 8.14204 46.7626 8.44444 46.7626 8.82932C46.7626 9.2142 46.8818 9.51661 47.1292 9.75487C47.3766 9.99313 47.6973 10.1123 48.1097 10.1123C48.5221 10.1123 48.852 9.99313 49.0994 9.7457Z"></path><path d="M13.4751 6.29095C14.1789 6.29095 14.7489 5.77778 14.7489 5.14547C14.7489 4.51317 14.1789 4 13.4751 4C12.7723 4 12.2014 4.51317 12.2014 5.14547C12.2014 5.77778 12.7723 6.29095 13.4751 6.29095Z"></path><path d="M14.7489 7.07812C13.97 7.41719 12.9986 7.42635 12.2014 7.07812V11.7792H14.7489V7.07812Z"></path></g></svg></div>
                                </div>
                                <div id="home-page-preview-banner-container" data-shop-banner-banner-container>
                                    <img class="shop-category-banner-img" src="" data-shop-category-banner-image>
                                </div>
                                <div class="shop-category-logo-holder" style="display: none;" data-shop-category-logo-holder>
                                    <img class="shop-category-banner-logo" src="" id="shop-banner-logo" data-shop-category-logo-image>
                                </div>
                                <div class="shop-category-text-holder">
                                    <p style="font-size: 18px;" data-shop-category-desc></p>
                                </div>
                                <!-- Timer Display -->
                                <div class="shop-expiry-timer" style="display: none;">
                                    <p class="shop-expiry-timer-timer" id="shop-expiry-timer"></p>
                                </div>
                                <div class="shop-card-tag-container" data-shop-card-tag-container>
                                </div>
                            </div>
                            <div class="shop-category-card-holder" id="shop-category-card-holder" data-shop-category-card-holder>
                            </div>
                        </div>
                    </template>
                    <template data-shop-item-card-template>
                        <div class="shop-category-card">
                            <div data-shop-card-preview-holder>
                            </div>
                            <div class="card-bottom">
                                <div title="Copy Link" data-share-product-card-button></div>
                                <a class="item-credits" data-product-card-sku-id>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</a>
                                <h3 data-product-card-name>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</h3>
                                <p class="shop-card-summary" data-product-card-summary>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</p>
                                <div class="shop-price-container" data-shop-price-container>
                                    <div data-price-standard-container>
                                        <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                    </div>
                                    <div data-price-nitro-container>
                                        <a data-price-nitro></a>
                                    </div>
                                </div>
                                <div class="shop-card-var-container" data-shop-card-var-container>
                                </div>
                                <a class="shop-card-var-title" data-shop-card-var-title></a>
                            </div>
                            <div class="card-button-container"data-product-card-open-in-shop>
                                <button class="card-button" title="${getTextString("CARD_OPEN_IN_SHOP_TITLE")}">${getTextString("CARD_OPEN_IN_SHOP")}</button>
                            </div>
                            <div class="shop-card-tag-container" data-shop-card-tag-container>
                            </div>
                        </div>
                    </template>
                    <template data-shop-varcolorblock-template>
                        <div data-shop-card-var></div>
                    </template>
                    <div data-shop-output>
                    </div>
                    <div id="shop-category-loading-container">
                    </div>
                </div>
            </div>
        `;
    }

    function createShopCategoryLoadingElement() {
        document.getElementById("shop-category-loading-container").innerHTML = `
            <div class="shop-category-loading" id="shop-category-loading">
                <div>
                    <div class="shop-category-banner-loading">
                    </div>
                    <div class="shop-category-card-holder-loading">
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                    </div>
                </div>
                <div>
                    <div class="shop-category-banner-loading">
                    </div>
                    <div class="shop-category-card-holder-loading">
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                    </div>
                </div>
            </div>
        `;
    }


    function createMainPotionsElement() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div class="shop-container" style="overflow-y: auto;">
                <div class="shop-category" style="margin-top: 50px;">
                    <template data-potion-card-template>
                        <div>
                            <div class="shop-category-card" data-potion-card-holder>
                                <div class="potion-card-preview-holder">
                                    <img class="potion-card-preview" src="" id="potion-card-preview" data-potion-card-preview-image>
                                </div>
                                <div class="card-bottom">
                                    <div title="Copy Link" data-share-product-card-button></div>
                                    <a class="item-credits" data-product-card-sku-id>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</a>
                                    <h3 data-product-card-name>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</h3>
                                    <p class="shop-card-summary" data-product-card-summary>${getTextString("FAILED_TO_LOAD_ITEM_CARD_ERROR")}</p>
                                    <div class="shop-price-container" data-shop-price-container>
                                        <div data-price-standard-container>
                                            <a style="font-size: large; font-weight: 900;" data-price-standard></a>
                                        </div>
                                        <div data-price-nitro-container>
                                            <a data-price-nitro></a>
                                        </div>
                                    </div>
                                    <div class="shop-card-var-container" data-shop-card-var-container>
                                    </div>
                                    <a class="shop-card-var-title" data-shop-card-var-title></a>
                                </div>
                                <div class="card-button-container"data-product-card-open-in-shop>
                                    <button class="card-button" title="${getTextString("CARD_OPEN_SUPPORT_ARTICLE_TITLE")}">${getTextString("CARD_OPEN_SUPPORT_ARTICLE")}</button>
                                </div>
                                <div class="shop-card-tag-container" data-shop-card-tag-container>
                            </div>
                        </div>
                        </div>
                    </template>
                    <div data-shop-output class="shop-category-card-holder">
                    </div>
                    <div id="shop-category-loading-container">
                    </div>
                </div>
            </div>
        `;
    }

    function createPotionsCategoryLoadingElement() {
        document.getElementById("shop-category-loading-container").innerHTML = `
            <div class="shop-category-loading" id="shop-category-loading">
                <div>
                    <div class="shop-category-card-holder-loading">
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                        <div class="shop-category-card-loading">
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function createMarketingCategoryLoadingElement() {
        document.getElementById("shop-category-loading-container").innerHTML = `
            <div class="shop-category-loading" id="shop-category-loading">
                <div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                    <div class="potion-card-loading">
                    </div>
                </div>
            </div>
        `;
    }

    function createItemToolPageElement() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div style="display: flex; margin-top: 70px;">
                <div class="item-tool-card-big">
                    <h1>Avatar Decoration</h1>
        
                    <div class="shop-category-card deco-card" id="deco-preview-card" style="width: 280px;">
                        <img class="deco-preview-tool-deco" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC" id="customDecorationPreview" alt="Deco Preview" />
                        <div class="card-bottom">
                            <a class="item-credits" id="deco-skuid-output-text">SKU ID: SKU ID</a>
                            <h3 id="deco-name-output-text">Decoration Name</h3>
                            <p class="shop-card-summary" id="deco-desc-output-text">Decoration Description</p>
                            <div class="shop-price-container">
                                <a id="deco-price-output-text" style="font-size: large; font-weight: 900;">Price Standard</a>
                                <a id="deco-price2-output-text">Price Nitro</a>
                            </div>
                        </div>
                        <div class="card-button-container">
                            <button class="card-button" title="Open item in the Discord shop">Open In Shop</button>
                        </div>
                    </div>
                    <hr style="opacity: 0;">
        
                    <div class="input-field">
                        <input type="text" id="deco-name-intput-box" placeholder="Name">
                    </div>
                    
                    <div class="input-field">
                        <input type="text" id="deco-desc-intput-box" placeholder="Description">
                    </div>
                
                    <div class="input-field">
                        <input type="text" id="deco-skuid-input-box" placeholder="SKU ID">
                    </div>
                
                    <div class="input-field">
                        <input type="text" id="deco-animated-link-input-box" placeholder="Animated Link">
                    </div>
                    <p style="display: none;" id="deco-animated-link-output-text"></p>
                
                    <div class="input-field">
                        <input type="text" id="deco-static-link-input-box" placeholder="Static Link">
                    </div>
                    <p style="display: none;" id="deco-static-link-output-text"></p>
                
                    <div class="input-field">
                        <input type="text" id="deco-price-input-box" placeholder="Price">
                    </div>
                
                    <div class="input-field">
                        <input type="text" id="deco-price2-input-box" placeholder="Nitro Price">
                    </div>
                
                    <button id="custom-deco-copy-button">Copy for API</button>

                    <div class="customDecorationDataURLContainer">
                        <div class="input-field">
                            <p>Upload Item Asset</p>
                            <input type="file" id="customDecorationInput" accept="image/*">
                        </div>
                        <div class="input-field" style="display: none;">
                            <input type="text" id="customDecorationUrlInput" placeholder="Enter custom decoration URL">
                            <button id="loadCustomDecorationUrl">Load Decoration from URL</button>
                        </div>
                        <div class="input-field json-input-field" style="display: none;">
                            <div class="output-section">
                                <textarea style="width: 100%; height: 200px;" id="deco-dataUrlOutput" readonly placeholder="Data URL will appear here..."></textarea>
                            </div>
                        </div>
                    </div>
        
                    <div class="input-field json-input-field">
                        <p>Load item from JSON</p>
                        <textarea style="width: 100%; height: 200px;" id="deco-json-input" placeholder='Paste Shop Archives item API here'></textarea>
                        <button id="deco-load-json-button">Load JSON</button>
                    </div>
                </div>
    
                <div class="item-tool-card-big">
                    <h1>Profile Effect</h1>
    
                    <div class="shop-category-card effect-card" id="effect-preview-card" style="width: 280px;">
                        <img class="effect-preview-tool-effect" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC" id="customEffectPreview" alt="Effect Preview" />
                        <div class="card-bottom">
                            <a class="item-credits" id="effect-skuid-output-text">SKU ID: SKU ID</a>
                            <h3 id="effect-name-output-text">Effect Name</h3>
                            <p class="shop-card-summary" id="effect-desc-output-text">Effect Description</p>
                            <div class="shop-price-container">
                                <a id="effect-price-output-text" style="font-size: large; font-weight: 900;">Price Standard</a>
                                <a id="effect-price2-output-text">Price Nitro</a>
                            </div>
                        </div>
                        <div class="card-button-container">
                            <button class="card-button" title="Open item in the Discord shop">Open In Shop</button>
                        </div>
                    </div>
                    <hr style="opacity: 0;">
        
                    <div class="input-field">
                        <input type="text" id="effect-name-intput-box" placeholder="Name">
                    </div>
                    
                    <div class="input-field">
                        <input type="text" id="effect-desc-intput-box" placeholder="Description">
                    </div>
                
                    <div class="input-field">
                        <input type="text" id="effect-skuid-input-box" placeholder="SKU ID">
                    </div>
                
                    <div class="input-field">
                        <input type="text" id="effect-animated-link-input-box" placeholder="Animated Link">
                    </div>
                    <p style="display: none;" id="effect-animated-link-output-text"></p>
                
                    <div class="input-field">
                        <input type="text" id="effect-static-link-input-box" placeholder="Static Link">
                    </div>
                    <p style="display: none;" id="effect-static-link-output-text"></p>
                
                    <div class="input-field">
                        <input type="text" id="effect-price-input-box" placeholder="Price">
                    </div>
                
                    <div class="input-field">
                        <input type="text" id="effect-price2-input-box" placeholder="Nitro Price">
                    </div>
                
                    <button id="custom-effect-copy-button">Copy for API</button>

                    <div class="customEffectsDataURLContainer">
                        <div class="input-field">
                            <p>Upload Item Asset</p>
                            <input type="file" id="customEffectInput" accept="image/*">
                        </div>
                        <div class="input-field" style="display: none;">
                            <input type="text" id="customEffectUrlInput" placeholder="Enter custom effect URL">
                            <button id="loadCustomEffectUrl">Load Effect from URL</button>
                        </div>
                        <div class="input-field json-input-field" style="display: none;">
                            <div class="output-section">
                                <textarea style="width: 700px; height: 200px;" id="effect-dataUrlOutput" readonly placeholder="Data URL will appear here..."></textarea>
                            </div>
                        </div>
                    </div>
    
                    <div class="input-field json-input-field">
                        <p>Load item from JSON</p>
                        <textarea style="width: 100%; height: 200px;" id="effect-json-input" placeholder='Paste Shop Archives item API here'></textarea>
                        <button id="effect-load-json-button">Load JSON</button>
                    </div>
                </div>

            </div>
        `;

        
        const customDecorationInput = document.getElementById('customDecorationInput');
        const customDecorationUrlInput = document.getElementById('customDecorationUrlInput');
        const loadCustomDecorationUrlButton = document.getElementById('loadCustomDecorationUrl');
        const customDecorationPreview = document.getElementById('customDecorationPreview');
        const decoDataUrlOutput = document.getElementById('deco-dataUrlOutput');
        
        // Function to handle file upload
        customDecorationInput.addEventListener('change', function(event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
              const dataUrl = e.target.result;
              
              // Display custom decoration preview
              customDecorationPreview.src = dataUrl;
              customDecorationPreview.style.display = 'block';
        
              // Display Data URL
              decoDataUrlOutput.textContent = dataUrl;
            };
            
            reader.readAsDataURL(file);
          }
        });
        
        // Function to handle custom decoration URL input
        loadCustomDecorationUrlButton.addEventListener('click', function() {
          const customDecorationUrl = customDecorationUrlInput.value;
          
          if (customDecorationUrl) {
            const img = new Image();
            img.crossOrigin = 'Anonymous'; // This is needed to avoid CORS issues
        
            img.onload = function() {
              const canvas = document.createElement('canvas');
              canvas.width = img.width;
              canvas.height = img.height;
              const ctx = canvas.getContext('2d');
              
              ctx.drawImage(img, 0, 0);
        
              // Convert custom decoration to Data URL
              const dataUrl = canvas.toDataURL('image/png');
        
              // Display custom decoration preview
              customDecorationPreview.src = dataUrl;
              customDecorationPreview.style.display = 'block';
        
              // Display Data URL
              decoDataUrlOutput.textContent = dataUrl;
            };
        
            img.src = customDecorationUrl;
          }
        });
        
        
        
        
        
        
        const inputs = {
          name: document.getElementById('deco-name-intput-box'),
          description: document.getElementById('deco-desc-intput-box'),
          id: document.getElementById('deco-skuid-input-box'),
          animatedLink: document.getElementById('deco-animated-link-input-box'),
          staticLink: document.getElementById('deco-static-link-input-box'),
          price: document.getElementById('deco-price-input-box'),
          price2: document.getElementById('deco-price2-input-box')
        };
        
        // Define output elements
        const outputs = {
          name: document.getElementById('deco-name-output-text'),
          description: document.getElementById('deco-desc-output-text'),
          id: document.getElementById('deco-skuid-output-text'),
          animatedLink: document.getElementById('deco-animated-link-output-text'),
          staticLink: document.getElementById('deco-static-link-output-text'),
          price: document.getElementById('deco-price-output-text'),
          price2: document.getElementById('deco-price2-output-text')
        };
        
        const decoImagePreview = document.getElementById('customDecorationPreview');
        const decoPreviewCard = document.getElementById('deco-preview-card');
        let DecoStaticLink = '';
        let DecoAnimatedLink = '';
        
        // Add event listeners to update text live
        for (const key in inputs) {
          inputs[key].addEventListener('input', function() {
              outputs[key].textContent = `${inputs[key].value}`;
        
              if (key === 'staticLink') {
                DecoStaticLink = inputs.staticLink.value;
                decoImagePreview.src = DecoStaticLink;
            } else if (key === 'animatedLink') {
              DecoAnimatedLink = inputs.animatedLink.value;
            }
          });
        }
        
        decoPreviewCard.addEventListener('mouseenter', function() {
          if (DecoAnimatedLink) {
            decoImagePreview.src = DecoAnimatedLink;
          }
        });
        
        // Reset image source to static link on mouse leave
        decoPreviewCard.addEventListener('mouseleave', function() {
          if (DecoStaticLink) {
            decoImagePreview.src = DecoStaticLink;
          }
        });
        
        // Load JSON from textarea into inputs
        document.getElementById('deco-load-json-button').addEventListener('click', function() {
          try {
              const jsonData = JSON.parse(document.getElementById('deco-json-input').value);
              
              // Populate the input fields with the JSON data
              inputs.name.value = jsonData.name || "";
              inputs.description.value = jsonData.summary || "";
              inputs.id.value = jsonData.sku_id || "";
              inputs.price.value = jsonData.price || "";
              inputs.price2.value = jsonData.price_nitro || "";
              inputs.staticLink.value = jsonData.items[0].static || "";
              inputs.animatedLink.value = jsonData.items[0].animated || "";
        
              // Trigger input events to update the live preview
              for (const key in inputs) {
                  inputs[key].dispatchEvent(new Event('input'));
              }
          } catch (e) {
              alert("Invalid JSON! Please check the format.");
          }
        });
        
        // Copy button functionality
        document.getElementById('custom-deco-copy-button').addEventListener('click', function() {
          // Create JSON string for API use
          const jsonData = {
              name: inputs.name.value,
              summary: inputs.description.value,
              sku_id: inputs.id.value,
              price: inputs.price.value,
              price_nitro: inputs.price2.value,
              unpublished_at: null,
              isNew: "false",
              emojiCopy: null,
              items: [
                  {
                      item_type: "deco",
                      name: inputs.name.value,
                      static: inputs.staticLink.value,
                      animated: inputs.animatedLink.value,
                      summary: inputs.description.value
                  }
              ]
          };
        
          // Stringify JSON data with indentation for better formatting
          const jsonString = JSON.stringify(jsonData, null, 4);
        
          // Create a temporary textarea to hold the text
          const tempTextarea = document.createElement('textarea');
          tempTextarea.value = jsonString;
          document.body.appendChild(tempTextarea);
          tempTextarea.select();
          document.execCommand('copy');
          document.body.removeChild(tempTextarea);
        });
        
        
        
        
        
        const customEffectInput = document.getElementById('customEffectInput');
        const customEffectUrlInput = document.getElementById('customEffectUrlInput');
        const loadCustomEffectUrlButton = document.getElementById('loadCustomEffectUrl');
        const customEffectPreview = document.getElementById('customEffectPreview');
        const effectDataUrlOutput = document.getElementById('effect-dataUrlOutput');
        
        // Function to handle file upload
        customEffectInput.addEventListener('change', function(event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
              const dataUrl = e.target.result;
              
              // Display custom Effect preview
              customEffectPreview.src = dataUrl;
              customEffectPreview.style.display = 'block';
        
              // Display Data URL
              effectDataUrlOutput.textContent = dataUrl;
            };
            
            reader.readAsDataURL(file);
          }
        });
        
        // Function to handle custom Effect URL input
        loadCustomEffectUrlButton.addEventListener('click', function() {
          const customEffectUrl = customEffectUrlInput.value;
          
          if (customEffectUrl) {
            const img = new Image();
            img.crossOrigin = 'Anonymous'; // This is needed to avoid CORS issues
        
            img.onload = function() {
              const canvas = document.createElement('canvas');
              canvas.width = img.width;
              canvas.height = img.height;
              const ctx = canvas.getContext('2d');
              
              ctx.drawImage(img, 0, 0);
        
              // Convert custom Effect to Data URL
              const dataUrl = canvas.toDataURL('image/png');
        
              // Display custom Effect preview
              customEffectPreview.src = dataUrl;
              customEffectPreview.style.display = 'block';
        
              // Display Data URL
              effectDataUrlOutput.textContent = dataUrl;
            };
        
            img.src = customEffectUrl;
          }
        });
        
        
        
        
        
        
        const effectinputs = {
          name: document.getElementById('effect-name-intput-box'),
          description: document.getElementById('effect-desc-intput-box'),
          id: document.getElementById('effect-skuid-input-box'),
          animatedLink: document.getElementById('effect-animated-link-input-box'),
          staticLink: document.getElementById('effect-static-link-input-box'),
          price: document.getElementById('effect-price-input-box'),
          price2: document.getElementById('effect-price2-input-box')
        };
        
        // Define output elements
        const effectoutputs = {
          name: document.getElementById('effect-name-output-text'),
          description: document.getElementById('effect-desc-output-text'),
          id: document.getElementById('effect-skuid-output-text'),
          animatedLink: document.getElementById('effect-animated-link-output-text'),
          staticLink: document.getElementById('effect-static-link-output-text'),
          price: document.getElementById('effect-price-output-text'),
          price2: document.getElementById('effect-price2-output-text')
        };
        
        const effectImagePreview = document.getElementById('customEffectPreview');
        const effectPreviewCard = document.getElementById('effect-preview-card');
        let effectStaticLink = '';
        let effectAnimatedLink = '';
        
        // Add event listeners to update text live
        for (const key in effectinputs) {
          effectinputs[key].addEventListener('input', function() {
            effectoutputs[key].textContent = `${effectinputs[key].value}`;
        
              if (key === 'staticLink') {
                effectStaticLink = effectinputs.staticLink.value;
                effectImagePreview.src = effectStaticLink;
            } else if (key === 'animatedLink') {
              effectAnimatedLink = effectinputs.animatedLink.value;
            }
          });
        }
        
        effectPreviewCard.addEventListener('mouseenter', function() {
          if (effectAnimatedLink) {
            effectImagePreview.src = effectAnimatedLink;
          }
        });
        
        // Reset image source to static link on mouse leave
        effectPreviewCard.addEventListener('mouseleave', function() {
          if (effectStaticLink) {
            effectImagePreview.src = effectStaticLink;
          }
        });
        
        // Load JSON from textarea into inputs
        document.getElementById('effect-load-json-button').addEventListener('click', function() {
          try {
              const jsonData = JSON.parse(document.getElementById('effect-json-input').value);
              
              // Populate the input fields with the JSON data
              effectinputs.name.value = jsonData.name || "";
              effectinputs.description.value = jsonData.summary || "";
              effectinputs.id.value = jsonData.sku_id || "";
              effectinputs.price.value = jsonData.price || "";
              effectinputs.price2.value = jsonData.price_nitro || "";
              effectinputs.staticLink.value = jsonData.items[0].static || "";
              effectinputs.animatedLink.value = jsonData.items[0].animated || "";
        
              // Trigger input events to update the live preview
              for (const key in effectinputs) {
                effectinputs[key].dispatchEvent(new Event('input'));
              }
          } catch (e) {
              alert("Invalid JSON! Please check the format.");
          }
        });
        
        // Copy button functionality
        document.getElementById('custom-effect-copy-button').addEventListener('click', function() {
          // Create JSON string for API use
          const jsonData = {
              name: effectinputs.name.value,
              summary: effectinputs.description.value,
              sku_id: effectinputs.id.value,
              price: effectinputs.price.value,
              price_nitro: effectinputs.price2.value,
              unpublished_at: null,
              isNew: "false",
              emojiCopy: null,
              items: [
                  {
                      item_type: "effect",
                      name: effectinputs.name.value,
                      static: effectinputs.staticLink.value,
                      animated: effectinputs.animatedLink.value,
                      summary: effectinputs.description.value
                  }
              ]
          };
        
          // Stringify JSON data with indentation for better formatting
          const jsonString = JSON.stringify(jsonData, null, 4);
        
          // Create a temporary textarea to hold the text
          const tempTextarea = document.createElement('textarea');
          tempTextarea.value = jsonString;
          document.body.appendChild(tempTextarea);
          tempTextarea.select();
          document.execCommand('copy');
          document.body.removeChild(tempTextarea);
        });
    }



    function createOrbConverterPageElement() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div style="margin-top: 70px; text-align: center;">
                <div class="orb-converter-container">
                    <span>USD</span>
                    <input type="text" id="usdAmount" value="1" oninput="convertToOrbs()">
                    <input type="text" id="orbsAmount" value="0" oninput="convertToUSD()">
                    <span>Orbs</span>
                </div>
            </div>
        `;
    }



    function createPublishedListingsPageElement() {
        document.getElementById("everything-housing-container").innerHTML = `
            <div style="margin-top: 100px;">
                <div class="published-listings-tester-card">

                    <h1>Check Published Listing by SKU ID</h1>

                    <div class="sku-is-valid-or-not-container" id="sku-is-valid-or-not-container"></div>

                    <input type="text" id="sku-id-input" placeholder="Please Input SKU ID">

                    <button onclick="checkValidSKUID()">Check</button>

                    <div class="sku-check-info-container" id="sku-check-info-container">
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Type:</p>
                        <p class="shop-notice-text">Slug:</p>
                        <p class="shop-notice-text">Application ID:</p>
                        <p class="shop-notice-text">Application Name:</p>
                        <p class="shop-notice-text">Standard Price:</p>
                        <p class="shop-notice-text">Nitro Price:</p>
                    </div>

                </div>
                <div id="secret-published-listings-testers">
                </div>
            </div>
        `;
        if (localStorage.dev === "true") {
            document.getElementById("secret-published-listings-testers").innerHTML = `
                <div class="published-listings-tester-card">

                    <h1>Category Items List | Staff Only</h1>

                    <div class="sku-is-valid-or-not-container" id="category-sku-is-valid-or-not-container"></div>

                    <input type="text" id="category-sku-id-input" placeholder="Please Input SKU ID">

                    <button onclick="categoryCheckValidSKUID()">Check</button>

                    <div class="sku-check-info-container" id="category-sku-check-info-container">
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Slug:</p>
                        <p class="shop-notice-text">Application ID:</p>
                        <p class="shop-notice-text">Application Name:</p>
                    </div>

                </div>
            `;
        }
    }

    function checkValidSKUID() {
        const SKUinput = document.getElementById('sku-id-input').value;

        document.getElementById('sku-is-valid-or-not-container').innerHTML = ``;

        fetch(`https://canary.discord.com/api/v9/store/published-listings/skus/${SKUinput}`)
            .then(response => response.json())
            .then((data) => {

                itemType = data.sku.type;
        
                if (data.sku.price != null) {
                    priceStandard = data.sku.price.amount;
                    priceStandardOutput = `${data.sku.price.currency}$${(priceStandard / 100).toFixed(2)}`;
                } else {
                    priceStandard = 'N/A';
                    priceStandardOutput = 'N/A';
                }
        
                if (data.sku.price != null) {
                    if (data.sku.price.premium != null) {
                        priceNitro = data.sku.price.premium["2"].amount;
                        priceNitroOutput = `${data.sku.price.currency}$${(priceNitro / 100).toFixed(2)}`;
                    } else {
                        priceNitroOutput = 'N/A';
                        priceNitro = 'N/A';
                    }
                } else {
                    priceNitro = 'N/A';
                    priceNitroOutput = 'N/A';
                }

                if (itemType === 2) {
                    itemTypeOutput = `Collectible/Category`;
                } else if (itemType === 3) {
                    itemTypeOutput = `Consumable`;
                } else if (itemType === 4) {
                    itemTypeOutput = `Bundle of Collectibles`;
                }

                document.getElementById('sku-check-info-container').innerHTML = `
                    <p class="shop-notice-text">SKU ID: ${data.sku.id}</p>
                    <p class="shop-notice-text">Name: ${data.sku.name}</p>
                    <p class="shop-notice-text">Summary: ${data.summary}</p>
                    <p class="shop-notice-text">Type: ${itemTypeOutput} (${itemType})</p>
                    <p class="shop-notice-text">Slug: ${data.sku.slug}</p>
                    <p class="shop-notice-text">Application ID: ${data.sku.application.id}</p>
                    <p class="shop-notice-text">Application Name: ${data.sku.application.name}</p>
                    <p class="shop-notice-text">Standard Price: ${priceStandardOutput} (${priceStandard})</p>
                    <p class="shop-notice-text">Nitro Price: ${priceNitroOutput} (${priceNitro})</p>
                `;
            })
            .catch(error => {
                if (SKUinput != '') {
                    document.getElementById('sku-is-valid-or-not-container').innerHTML = `
                        <div class="shop-warning">
                            <p class="shop-notice-text">The SKU ID '${SKUinput}' is either invalid or unpublished!</p>
                        </div>
                    `;
                    document.getElementById('sku-check-info-container').innerHTML = `
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Type:</p>
                        <p class="shop-notice-text">Slug:</p>
                        <p class="shop-notice-text">Application ID:</p>
                        <p class="shop-notice-text">Application Name:</p>
                        <p class="shop-notice-text">Standard Price:</p>
                        <p class="shop-notice-text">Nitro Price:</p>
                    `;
                } else {
                    document.getElementById('sku-is-valid-or-not-container').innerHTML = `
                        <div class="shop-warning">
                            <p class="shop-notice-text">Please input an SKU ID below!</p>
                        </div>
                    `;
                    document.getElementById('sku-check-info-container').innerHTML = `
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Type:</p>
                        <p class="shop-notice-text">Slug:</p>
                        <p class="shop-notice-text">Application ID:</p>
                        <p class="shop-notice-text">Application Name:</p>
                        <p class="shop-notice-text">Standard Price:</p>
                        <p class="shop-notice-text">Nitro Price:</p>
                    `;
                }
                console.error(error);
            });
    }

    function categoryCheckValidSKUID() {
        const SKUinput = document.getElementById('category-sku-id-input').value;

        document.getElementById('category-sku-is-valid-or-not-container').innerHTML = ``;

        fetch(`https://canary.discord.com/api/v9/store/published-listings/skus/${SKUinput}`)
            .then(response => response.json())
            .then((data) => {
                
                if (data.child_skus == null) {
                    if (SKUinput != '') {
                        document.getElementById('category-sku-is-valid-or-not-container').innerHTML = `
                            <div class="shop-warning">
                                <p class="shop-notice-text">The SKU ID '${SKUinput}' has no child SKUs or is unpublished!</p>
                            </div>
                        `;
                        document.getElementById('category-sku-check-info-container').innerHTML = `
                            <p class="shop-notice-text">SKU ID:</p>
                            <p class="shop-notice-text">Name:</p>
                            <p class="shop-notice-text">Summary:</p>
                            <p class="shop-notice-text">Slug:</p>
                            <p class="shop-notice-text">Application ID:</p>
                            <p class="shop-notice-text">Application Name:</p>
                        `;
                    } else {
                        document.getElementById('category-sku-is-valid-or-not-container').innerHTML = `
                            <div class="shop-warning">
                                <p class="shop-notice-text">Please input an SKU ID below!</p>
                            </div>
                        `;
                        document.getElementById('category-sku-check-info-container').innerHTML = `
                            <p class="shop-notice-text">SKU ID:</p>
                            <p class="shop-notice-text">Name:</p>
                            <p class="shop-notice-text">Summary:</p>
                            <p class="shop-notice-text">Slug:</p>
                            <p class="shop-notice-text">Application ID:</p>
                            <p class="shop-notice-text">Application Name:</p>
                        `;
                    }
                    document.getElementById('category-sku-check-info-container').innerHTML = `
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Slug:</p>
                        <p class="shop-notice-text">Application ID:</p>
                        <p class="shop-notice-text">Application Name:</p>
                    `;
                } else {
                    document.getElementById('category-sku-check-info-container').innerHTML = `
                        <p class="shop-notice-text">SKU ID: ${data.sku.id}</p>
                        <p class="shop-notice-text">Name: ${data.sku.name}</p>
                        <p class="shop-notice-text">Summary: ${data.summary}</p>
                        <p class="shop-notice-text">Slug: ${data.sku.slug}</p>
                        <p class="shop-notice-text">Application ID: ${data.sku.application.id}</p>
                        <p class="shop-notice-text">Application Name: ${data.sku.application.name}</p>
                        <div data-category-child-sku-output-container></div>
                    `;

                    const childContainer = document.querySelector("[data-category-child-sku-output-container]");

                    data.child_skus.forEach(item => {
                        const childBlock = document.createElement("div");
                        childBlock.classList.add('category-child-sku-output')
                        itemType = item.type;

                        fetch(`https://canary.discord.com/api/v9/store/published-listings/skus/${item.id}`)
                        .then(response => response.json())
                        .then((itemItself) => {

                            itemType = itemItself.sku.type;
        
                            if (itemItself.sku.price != null) {
                                priceStandard = itemItself.sku.price.amount;
                                priceStandardOutput = `${itemItself.sku.price.currency}$${(priceStandard / 100).toFixed(2)}`;
                            } else {
                                priceStandard = 'N/A';
                                priceStandardOutput = 'N/A';
                            }
                        
                            if (itemItself.sku.price != null) {
                                if (itemItself.sku.price.premium != null) {
                                    priceNitro = itemItself.sku.price.premium["2"].amount;
                                    priceNitroOutput = `${itemItself.sku.price.currency}$${(priceNitro / 100).toFixed(2)}`;
                                } else {
                                    priceNitroOutput = 'N/A';
                                    priceNitro = 'N/A';
                                }
                            } else {
                                priceNitro = 'N/A';
                                priceNitroOutput = 'N/A';
                            }
                        
                            if (itemType === 2) {
                                itemTypeOutput = `Collectible/Category`;
                            } else if (itemType === 3) {
                                itemTypeOutput = `Consumable`;
                            } else if (itemType === 4) {
                                itemTypeOutput = `Bundle of Collectibles`;
                            }
                        
                            childBlock.innerHTML = `
                                <p class="shop-notice-text">SKU ID: ${itemItself.sku.id}</p>
                                <p class="shop-notice-text">Name: ${itemItself.sku.name}</p>
                                <p class="shop-notice-text">Summary: ${itemItself.summary}</p>
                                <p class="shop-notice-text">Type: ${itemTypeOutput} (${itemType})</p>
                                <p class="shop-notice-text">Slug: ${itemItself.sku.slug}</p>
                                <p class="shop-notice-text">Application ID: ${itemItself.sku.application.id}</p>
                                <p class="shop-notice-text">Application Name: ${itemItself.sku.application.name}</p>
                                <p class="shop-notice-text">Standard Price: ${priceStandardOutput} (${priceStandard})</p>
                                <p class="shop-notice-text">Nitro Price: ${priceNitroOutput} (${priceNitro})</p>
                            `;
                        })
                        .catch(error => {
                            if (item.price != null) {
                                priceStandard = item.price.amount;
                                priceStandardOutput = `${item.price.currency}$${(priceStandard / 100).toFixed(2)}`;
                            } else {
                                priceStandard = 'N/A';
                                priceStandardOutput = 'N/A';
                            }
                        
                            if (item.price != null) {
                                if (item.price.premium != null) {
                                    priceNitro = item.price.premium["2"].amount;
                                    priceNitroOutput = `${item.price.currency}$${(priceNitro / 100).toFixed(2)}`;
                                } else {
                                    priceNitroOutput = 'N/A';
                                    priceNitro = 'N/A';
                                }
                            } else {
                                priceNitro = 'N/A';
                                priceNitroOutput = 'N/A';
                            }
                        
                        
                            if (itemType === 2) {
                                itemTypeOutput = `Collectible/Category`;
                            } else if (itemType === 3) {
                                itemTypeOutput = `Consumable`;
                            } else if (itemType === 4) {
                                itemTypeOutput = `Bundle of Collectibles`;
                            }
                        
                            childBlock.innerHTML = `
                                <div>
                                    <div class="shop-warning">
                                        <p class="shop-notice-text">This item is not Published!</p>
                                    </div>
                                    <p class="shop-notice-text">SKU ID: ${item.id}</p>
                                    <p class="shop-notice-text">Name: ${item.name}</p>
                                    <p class="shop-notice-text">Summary: ${item.summary}</p>
                                    <p class="shop-notice-text">Type: ${itemTypeOutput} (${itemType})</p>
                                    <p class="shop-notice-text">Slug: ${item.slug}</p>
                                    <p class="shop-notice-text">Standard Price: ${priceStandardOutput} (${priceStandard})</p>
                                    <p class="shop-notice-text">Nitro Price: ${priceNitroOutput} (${priceNitro})</p>
                                </div>
                            `;
                            console.error(error);
                        });

                        childContainer.appendChild(childBlock); 
                    }); 
                }
            })
            .catch(error => {
                if (SKUinput != '') {
                    document.getElementById('category-sku-is-valid-or-not-container').innerHTML = `
                        <div class="shop-warning">
                            <p class="shop-notice-text">The SKU ID '${SKUinput}' is either invalid or unpublished!</p>
                        </div>
                    `;
                    document.getElementById('category-sku-check-info-container').innerHTML = `
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Slug:</p>
                    `;
                } else {
                    document.getElementById('category-sku-is-valid-or-not-container').innerHTML = `
                        <div class="shop-warning">
                            <p class="shop-notice-text">Please input an SKU ID below!</p>
                        </div>
                    `;
                    document.getElementById('category-sku-check-info-container').innerHTML = `
                        <p class="shop-notice-text">SKU ID:</p>
                        <p class="shop-notice-text">Name:</p>
                        <p class="shop-notice-text">Summary:</p>
                        <p class="shop-notice-text">Slug:</p>
                    `;
                }
                console.error(error);
            });
    }


    if (localStorage.experiment_2025_02_extra_options === "Treatment 6: Settings like discord") {
        const dm_container = document.querySelector(".dm-list");
        let u_bar = document.createElement("div");

        u_bar.classList.add("ubar-profile-and-settings")
        u_bar.innerHTML = `
            <img id="ubar-avatar" class="ubar-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
            <p class="ubar-displayname" id="ubar-displayname">${localStorage.discord_displayname ? localStorage.discord_displayname : "Default User"}</p>
            <p class="ubar-username" id="ubar-username">${localStorage.discord_username ? localStorage.discord_username : "default_user"}</p>
            <svg title="User Options" x="0" y="0" onclick="openNewDiscordLikeSettings()" id="ubar-options-cog" aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M16.4483 8.3333H18.3333V11.6667H16.4492C16.2483 12.4425 15.9167 13.165 15.4708 13.8033L16.6667 15 15 16.6667 13.8042 15.47C13.1642 15.9158 12.4433 16.2483 11.6667 16.4483V18.3333H8.3333V16.4483C7.5575 16.2483 6.8358 15.9158 6.1967 15.47L5 16.6667 3.3333 15 4.53 13.8033C4.0842 13.1658 3.7517 12.4433 3.5517 11.6667H1.6667V8.3333H3.5517C3.7517 7.5567 4.0833 6.835 4.53 6.1967L3.3333 5 5 3.3333 6.1967 4.53C6.835 4.0833 7.5567 3.7517 8.3333 3.5517V1.6667H11.6667V3.5508C12.4433 3.7517 13.1642 4.0833 13.8042 4.5292L15 3.3325 16.6667 4.9992 15.47 6.1967C15.9158 6.835 16.2483 7.5575 16.4483 8.3333ZM10 13.3333C11.8409 13.3333 13.3333 11.8409 13.3333 10 13.3333 8.159 11.8409 6.6667 10 6.6667 8.159 6.6667 6.6667 8.159 6.6667 10 6.6667 11.8409 8.159 13.3333 10 13.3333Z" )=""></path></svg>
        `;

        dm_container.appendChild(u_bar);
    }

    function openNewDiscordLikeSettings() {
        let modal = document.createElement("div");

        modal.classList.add('modalv3');

        modal.innerHTML = `
            <div class="modalv3-inner" style="color: var(--white);">
                <div class="modalv3-inner-left">
                    <div class="modalv3-side-tabs-container-backer">
                    
                    </div>
                    <div class="modalv3-side-tabs-container" id="modalv3-side-tabs-container">
                    
                    </div>
                </div>
                <div class="modalv3-inner-right" id="modalv3-inner-right">
                    <div class="modalv3-right-content-container" id="modalv3-right-content-container">
                        <div class="modalv3-right-content-container-inner" id="modalv3-right-content-container-inner">
                        
                        </div>
                        <div class="container_c2b141" data-discord-like-settings-close-button>
                            <div class="closeButton_c2b141" aria-label="Close" role="button" tabindex="0">
                                <svg aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path>
                                </svg>
                            </div>
                            <div class="keybind_c2b141" aria-hidden="true">ESC</div>
                        </div>
                    </div>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        document.getElementById("modalv3-side-tabs-container").innerHTML = `
            <div class="side-tabs-category-text-container">
                <p class="side-tabs-category-text">${getTextString("MODAL_V3_TAB_HEADER_USER_SETTINGS")}</p>
            </div>
            <button class="side-tabs-button" id="modal-v3-tab-account" onclick="setModalv3InnerContent('account')">
                <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_ACCOUNT")}</p>
            </button>

            <div id="modalv3-side-tabs-profile-container"></div>

            <div id="modalv3-side-tabs-reviews-container"></div>

            <div id="modalv3-side-tabs-warnings-container"></div>

            <hr>
            <div class="side-tabs-category-text-container">
                <p class="side-tabs-category-text">${getTextString("MODAL_V3_TAB_HEADER_SITE_SETTINGS")}</p>
            </div>
            <button class="side-tabs-button" id="modal-v3-tab-appearance" onclick="setModalv3InnerContent('appearance')">
                <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_APPEARANCE")}</p>
            </button>

            <div id="modalv3-side-tabs-accessibility-container"></div>

            <div id="xp-perks-options-modalv3-container"></div>

            <div id="staff-options-modalv3-container"></div>

            <div id="login-logout-options-modalv3-container"></div>
        
            <hr>
            
            <div class="modalv3-side-tabs-app-info-container">
                <p>Website made by: </p><a class="link" href="https://github.com/DTACat/">DTACat</a>
                <p>${app_version2} ${app_version1}</p>
            </div>
        `;

        if (localStorage.experiment_2025_04_profile_tab_v2 === "Treatment 1: Enabled") {
            document.getElementById("modalv3-side-tabs-profile-container").innerHTML = `
                <button class="side-tabs-button" id="modal-v3-tab-profile" onclick="setModalv3InnerContent('profile')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_PROFILE")}</p>
                </button>
            `;
        }

        if (localStorage.experiment_2025_04_reviews_v2 === "Treatment 1: Enabled") {
            document.getElementById("modalv3-side-tabs-reviews-container").innerHTML = `
                <button class="side-tabs-button" id="modal-v3-tab-reviews" onclick="setModalv3InnerContent('reviews')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_REVIEWS")}</p>
                </button>
            `;
        }

        if (localStorage.experiment_2025_04_reviews_v2_warning_system === "Treatment 1: Enabled" && discord_token) {
            document.getElementById("modalv3-side-tabs-warnings-container").innerHTML = `
                <button class="side-tabs-button" id="modal-v3-tab-warnings" onclick="setModalv3InnerContent('warnings')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_WARNINGS")}</p>
                </button>
            `;
        }

        if (localStorage.experiment_2025_04_accessibility_v2 === "Treatment 1: Enabled") {
            document.getElementById("modalv3-side-tabs-accessibility-container").innerHTML = `
                <button class="side-tabs-button" id="modal-v3-tab-accessibility" onclick="setModalv3InnerContent('accessibility')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_ACCESSIBILITY")}</p>
                </button>
            `;
        }

        if (localStorage.experiment_2025_05_xp_system === "Treatment 1: Enabled") {
            document.getElementById("xp-perks-options-modalv3-container").innerHTML = `
                <hr>
                <div class="side-tabs-category-text-container">
                    <p class="side-tabs-category-text">${getTextString("MODAL_V3_TAB_HEADER_XP_PERKS")}</p>
                    <p class="side-tabs-category-beta-text">BETA</p>
                </div>
                <button class="side-tabs-button" id="modal-v3-tab-xp_events" onclick="setModalv3InnerContent('xp_events')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_XP_EVENTS")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-xp_general" onclick="setModalv3InnerContent('xp_general')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_XP_GENERAL")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-xp_inventory" onclick="setModalv3InnerContent('xp_inventory')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_XP_INVENTORY")}</p>
                </button>
            `;
        }

        if (localStorage.dev === "true") {
            document.getElementById("staff-options-modalv3-container").innerHTML = `
                <hr>
                <div class="side-tabs-category-text-container">
                    <p class="side-tabs-category-text">${getTextString("MODAL_V3_TAB_HEADER_STAFF_ONLY")}</p>
                </div>
                <button class="side-tabs-button" id="modal-v3-tab-experiments" onclick="setModalv3InnerContent('experiments')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_EXPERIMENTS")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-dismissible_content" onclick="setModalv3InnerContent('dismissible_content')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_DISMISSIBLE_CONTENT")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-api_test_fetch" onclick="setModalv3InnerContent('api_test_fetch')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_API_TEST_FETCH")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-claimables_purchase" onclick="setModalv3InnerContent('claimables_purchase')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_CLAIMABLES_PURCHASE")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-local_storage" onclick="setModalv3InnerContent('local_storage')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_LOCAL_STORAGE")}</p>
                </button>
                <button class="side-tabs-button" id="modal-v3-tab-misc" onclick="setModalv3InnerContent('misc')">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_MISC")}</p>
                </button>
            `;
        }

        setTimeout(() => {
            modal.classList.add('show');
        }, 1);

        setModalv3InnerContent('account');


        document.addEventListener("keydown", function (event) {
            if (event.key === "Escape") {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                }, 300);
            }
        });

        document.querySelector("[data-discord-like-settings-close-button]").addEventListener('click', (event) => {
            modal.classList.remove('show');
            setTimeout(() => {
                modal.remove();
            }, 300);
        });
    }

    async function setModalv3InnerContent(tab) {
        if (!document.getElementById("modalv3-right-content-container-inner")) {
            openNewDiscordLikeSettings();
        }
        const tabPageOutput = document.getElementById("modalv3-right-content-container-inner");

        if (document.querySelector(".side-tabs-button-selected")) {
            document.querySelectorAll('.side-tabs-button-selected').forEach((el) => {
                el.classList.remove("side-tabs-button-selected");
            });
        }

        document.getElementById("modalv3-right-content-container").scrollTo(0,0);

        if (localStorage.discord_token) {
            document.getElementById("login-logout-options-modalv3-container").innerHTML = `
                <hr>
                <button class="side-tabs-button" id="modal-v3-tab-log_out" onclick="logoutOfDiscord()">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_LOG_OUT")}</p>
                </button>
            `;
        } else if (localStorage.experiment_2025_05_m != "Treatment 1: Enabled") {
            document.getElementById("login-logout-options-modalv3-container").innerHTML = `
                <hr>
                <button class="side-tabs-button" id="modal-v3-tab-log_in" onclick="loginToDiscord()">
                    <p class="side-tabs-button-text">${getTextString("MODAL_V3_TAB_TEXT_LOG_IN")}</p>
                </button>
            `;
        }

        if (tab === "account") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_ACCOUNT_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_SUMMARY")}</p>

                    <div id="modalv3-account-account-outdated-container">
                    </div>

                    <div id="modalv3-account-account-details-container">
                        <div class="modalv3-account-account-details">
                            <div class="modalv3-account-banner-color" style="background-color: var(--background-secondary);"></div>
                            <div class="modalv3-account-banner-image"></div>
                            <div class="modalv3-account-banner-filler"></div>

                            <div class="modalv3-account-avatar-preview-bg"></div>
                            <div class="modalv3-account-avatar-preview" style="background-color: var(--background-secondary);"></div>
                            <p class="modalv3-account-displayname">Loading...</p>

                            <div class="modalv3-account-account-details-inners-padding">
                                <div class="modalv3-account-account-details-inner">
                                    <div class="modalv3-account-account-details-card">
                                        <p class="modalv3-account-displayname-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_DISPLAY_NAME")}</p>
                                        <p class="modalv3-account-displayname-text">Loading...</p>
                                    </div>
                                    <div class="modalv3-account-account-details-card">
                                        <p class="modalv3-account-username-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_USERNAME")}</p>
                                        <p class="modalv3-account-username-text">Loading...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="modalv3-account-beta-program-card-container">

                </div>
            `;

            if (localStorage.experiment_2025_05_account_creator === "Treatment 1: Enabled" && localStorage.discord_token && !localStorage.account_type && document.getElementById("modalv3-account-account-outdated-container")) {
                document.getElementById("modalv3-account-account-outdated-container").innerHTML = `
                    <div class="modalv3-profile-tab-file-too-large-warning">
                        <p class="modalv3-profile-tab-sign-in-notice-title">Account outdated!</p>
                        <p class="modalv3-profile-tab-sign-in-notice-summary">You logged in to Shop Archives before the new account system, if you ignore this warning some things may break. Please log in again.</p>
                    </div>
                `;
            }

            const accountDetails = document.getElementById("modalv3-account-account-details-container");
            
            if (localStorage.experiment_2025_05_m === "Treatment 1: Enabled") {
                tabPageOutput.innerHTML = `
                    <h2>${getTextString("MODAL_V3_TAB_ACCOUNT_HEADER")}</h2>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_SUMMARY")}</p>

                        <div id="modalv3-account-account-details-container" style="margin-top: 20px; margin-bottom: 20px;">
                            <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_UNAVAILABLE_HEADER")}</h2>
                            <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_UNAVAILABLE_SUMMARY")}</p>
                        </div>
                    </div>
                `;
            } else if (localStorage.discord_token && localStorage.account_type != "2") {
                const discordProfile = JSON.parse(localStorage.discord_profile);
                accountDetails.innerHTML = `
                    <div class="modalv3-account-account-details">
                        <div class="modalv3-account-banner-color" style="background-color: ${discordProfile.banner_color};"></div>
                        <div class="modalv3-account-banner-image" style="background-image: url(https://cdn.discordapp.com/banners/${discordProfile.id}/${discordProfile.banner}.webp?size=480);"></div>
                        <div class="modalv3-account-banner-filler"></div>

                        <div class="modalv3-account-avatar-preview-bg"></div>
                        <img class="modalv3-account-avatar-preview" src="https://cdn.discordapp.com/avatars/${discordProfile.id}/${discordProfile.avatar}.webp?size=128">
                        <p class="modalv3-account-displayname">${discordProfile.global_name}</p>
                        <button class="modalv3-resync-profiles-button" onclick="updateDiscordProfileModalv3()">Resync Profile</button>

                        <div class="modalv3-account-account-details-inners-padding">
                            <div class="modalv3-account-account-details-inner">
                                <div class="modalv3-account-account-details-card">
                                    <p class="modalv3-account-displayname-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_DISPLAY_NAME")}</p>
                                    <p class="modalv3-account-displayname-text">${discordProfile.global_name}</p>
                                </div>
                                <div class="modalv3-account-account-details-card">
                                    <p class="modalv3-account-username-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_USERNAME")}</p>
                                    <p class="modalv3-account-username-text">${discordProfile.username}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (localStorage.discord_token && localStorage.account_type === "2") {

                if (!atMeUsercache) {
                    fetch(api + `/users/@me`, {
                        method: "GET",
                        headers: {
                            "Authorization": localStorage.shop_archives_token
                        }
                    })
                    .then(response => response.json())
                    .then((data) => {
                        renderAtMeAccountPage(data);
                        atMeUsercache = data;
                    })
                    .catch(error => {
                        console.error(error);
                        accountDetails.innerHTML = `
                            error
                        `;
                    });
                } else {
                    renderAtMeAccountPage(atMeUsercache)
                }

                function renderAtMeAccountPage(atMe) {
                    if (atMe.message) {
                        accountDetails.innerHTML = `
                            <div class="modalv3-account-account-details">
                                <div class="modalv3-account-banner-color" style="background-color: var(--background-secondary);"></div>
                                <div class="modalv3-account-banner-image"></div>
                                <div class="modalv3-account-banner-filler"></div>

                                <div class="modalv3-account-avatar-preview-bg"></div>
                                <div class="modalv3-account-avatar-preview" style="background-color: var(--background-secondary);"></div>
                                <p class="modalv3-account-displayname">Error</p>
                                <button class="modalv3-resync-profiles-button" onclick="loginToDiscord()">Log In with Discord</button>

                                <div class="modalv3-account-account-details-inners-padding">
                                    <div class="modalv3-account-account-details-inner">
                                        <div class="modalv3-account-account-details-card">
                                            <p class="modalv3-account-displayname-text">There was an error loading your account details.</p>
                                        </div>
                                        <div class="modalv3-account-account-details-card">
                                            <p class="modalv3-account-username-text">Your token may have expired, please log in again.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        accountDetails.innerHTML = `
                            <div class="modalv3-account-account-details">
                                <div class="modalv3-account-banner-color" data-modalv3-banner-color style="background-color: #859CF0;"></div>
                                <div class="modalv3-account-banner-image" style="background-image: url(https://cdn.discordapp.com/banners/${atMe.id}/${atMe.banner}.png?size=480);"></div>
                                <div class="modalv3-account-banner-filler"></div>

                                <div class="modalv3-account-avatar-preview-bg"></div>
                                <img class="modalv3-account-avatar-preview" src="https://cdn.discordapp.com/avatars/${atMe.id}/${atMe.avatar}.webp?size=128">
                                <p class="modalv3-account-displayname" data-modalv3-account-displayname></p>
                                <button class="modalv3-resync-profiles-button" onclick="updateDiscordProfileModalv3()">Resync Profile</button>

                                <div class="modalv3-account-account-details-inners-padding">
                                    <div class="modalv3-account-account-details-inner">
                                        <div class="modalv3-account-account-details-card">
                                            <p class="modalv3-account-displayname-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_DISPLAY_NAME")}</p>
                                            <p class="modalv3-account-displayname-text" data-modalv3-account-displayname2></p>
                                        </div>
                                        <div class="modalv3-account-account-details-card">
                                            <p class="modalv3-account-username-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_USERNAME")}</p>
                                            <p class="modalv3-account-username-text" data-modalv3-account-username2></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;

                        if (atMe.banner_color) {
                            accountDetails.querySelector("[data-modalv3-banner-color]").style.backgroundColor = atMe.banner_color;
                        }
        
                        if (atMe.global_name === null) {
                            accountDetails.querySelector("[data-modalv3-account-displayname]").textContent = atMe.username;
                        } else {
                            accountDetails.querySelector("[data-modalv3-account-displayname]").textContent = atMe.global_name;
                        }

                        if (atMe.global_name === null) {
                            accountDetails.querySelector("[data-modalv3-account-displayname2]").textContent = atMe.username;
                        } else {
                            accountDetails.querySelector("[data-modalv3-account-displayname2]").textContent = atMe.global_name;
                        }

                        accountDetails.querySelector("[data-modalv3-account-username2]").textContent = atMe.username;
                    }
                }
            } else {
                tabPageOutput.innerHTML = `
                    <h2>${getTextString("MODAL_V3_TAB_ACCOUNT_HEADER")}</h2>
                    <div class="modalv3-content-card-1">
                        <div id="modalv3-account-account-details-container" style="margin-top: 20px; margin-bottom: 20px;">
                            <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_NOT_LOGGED_IN_HEADER")}</h2>
                            <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_ACCOUNT_DISCORD_ACCOUNT_NOT_LOGGED_IN_SUMMARY")}</p>
                            <button class="modalv3-content-card-button" onclick="loginToDiscord()">${getTextString("MODAL_V3_TAB_ACCOUNT_LOGIN_WITH_DISCORD_BUTTON")}</button>
                        </div>
                    </div>
                `;
            }
        } else if (tab === "profile") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_PROFILE_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_SUMMARY")}</p>
                    <div class="modalv3-profile-editor-container">
                        <div class="modalv3-profile-editor-content-container" id="modalv3-profile-editor-content-container"></div>
                        <div class="modalv3-profile-editor-preview-container" id="modalv3-profile-editor-preview-container"></div>
                    </div>
                </div>
            `;

            document.getElementById("modalv3-profile-editor-preview-container").innerHTML = `
                <p>Preview:</p>
                <div class="modal-preview-profile2">
                    <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                    <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                    <div class="profile-avatar-preview-bg"></div>
                    <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                    <div class="options-preview-profile-status-bg"></div>
                    <div class="options-preview-profile-status-color"></div>
                    <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                    <p class="options-preview-profile-username" id="options-username-preview"></p>
                </div>
            `;

            document.getElementById("modalv3-profile-editor-content-container").innerHTML = `
                <div id="modalv3-profile-tab-sign-in-notice">
                    
                </div>
                <div class="modalv3-profile-editor-content-card">
                    <p class="modalv3-profile-editor-option-header">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_CHANGE_DISPLAY_NAME_HEADER")}</p>
                    <input type="text" class="modalv3-profile-editor-text-input" value="${localStorage.discord_displayname}" placeholder="${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_CHANGE_DISPLAY_NAME_PLACEHOLDER")}" autocomplete="off" oninput="changeUsernameFromInput();" id="profile-username-text-input">
                </div>
                <hr>
                <div class="modalv3-profile-editor-content-card">
                    <p class="modalv3-profile-editor-option-header-with-button">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_CHANGE_AVATAR_HEADER")}</p>
                    <label for="profileAvatarInput" class="modalv3-profile-editor-image-upload">${getTextString("OPTIONS_EXTRA_PROFILE_CHANGE_AVATAR")}</label>
                    <input type="file" id="profileAvatarInput" class="profile-avatar-file-input" accept="image/*">
                    <button id="removeProfileAvatarButton" class="modalv3-profile-editor-image-remove">${getTextString("OPTIONS_EXTRA_PROFILE_REMOVE_AVATAR")}</button>
                    <div id="options-avatar-img-input-option-error"></div>
                </div>
                <hr>
                <div class="modalv3-profile-editor-content-card">
                    <p class="modalv3-profile-editor-option-header-with-button">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_CHANGE_BANNER_HEADER")}</p>
                    <label for="profileBannerInput" class="modalv3-profile-editor-image-upload">${getTextString("OPTIONS_EXTRA_PROFILE_CHANGE_BANNER")}</label>
                    <input type="file" id="profileBannerInput" class="profile-avatar-file-input" accept="image/*">
                    <button id="removeProfileBannerButton" class="modalv3-profile-editor-image-remove">${getTextString("OPTIONS_EXTRA_PROFILE_REMOVE_BANNER")}</button>
                    <div id="options-banner-img-input-option-error"></div>
                </div>
                <hr>
                <div class="modalv3-profile-editor-content-card">
                    <p class="modalv3-profile-editor-option-header">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_CHANGE_BANNER_COLOR_HEADER")}</p>
                    <input type="color" autocomplete="off" class="modalv3-profile-editor-color-input" oninput="changeBannerColorFromInput();" id="profile-banner-color-input" value="${localStorage.discord_banner_color}">
                </div>
            `;

            if (discord_token) {
                document.getElementById("modalv3-profile-tab-sign-in-notice").innerHTML = `
                    <div class="modalv3-profile-tab-sign-in-notice">
                        <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_LOGGED_IN_TITLE")}</p>
                        <p class="modalv3-profile-tab-sign-in-notice-summary">${getTextString("MODAL_V3_TAB_PROFILE_DISCORD_PROFILE_LOGGED_IN_SUMMARY")}</p>
                    </div>
                `;
            }

            document.getElementById("options-username-preview").textContent = localStorage.discord_username.toLowerCase();

            const avatarImageInput = document.getElementById("profileAvatarInput");
            const avatarImagePreview = document.getElementById("profileAvatarPreview");
            const removeAvatarImageButton = document.getElementById("removeProfileAvatarButton");

            // Load saved image from localStorage on page load
            document.addEventListener("DOMContentLoaded", () => {
                const savedImage = localStorage.getItem("discord_avatar");
                if (savedImage) {
                    avatarImagePreview.src = savedImage;
                }
            });

            // Handle image upload
            avatarImageInput.addEventListener("change", function () {
                document.getElementById("options-avatar-img-input-option-error").innerHTML = ``;
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const dataUrl = event.target.result;
                        try {
                            localStorage.setItem("discord_avatar", dataUrl);
                            avatarImagePreview.src = dataUrl;
                        } catch(error) {
                            document.getElementById("options-avatar-img-input-option-error").innerHTML = `
                                <div class="modalv3-profile-tab-file-too-large-warning">
                                    <p class="modalv3-profile-tab-file-too-large-warning-title">${getTextString("OPTIONS_EXTRA_PROFILE_FILE_TOO_BIG")}</p>
                                    <p class="modalv3-profile-tab-file-too-large-warning-summary">${getTextString("OPTIONS_EXTRA_PROFILE_FILE_TOO_BIG_SUMMARY")}</p>
                                </div>
                            `;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Handle image removal
            removeAvatarImageButton.addEventListener("click", function () {
                setRandomDiscordAvatar()
                avatarImagePreview.src = localStorage.discord_avatar;
                document.getElementById("options-avatar-img-input-option-error").innerHTML = ``;
            });


            const bannerImageInput = document.getElementById("profileBannerInput");
            const bannerImagePreview = document.getElementById("profileBannerPreview");
            const removeBannerImageButton = document.getElementById("removeProfileBannerButton");


            if (localStorage.discord_banner === ``) {
                removeBannerImageButton.style.display = 'none';
            }

            // Load saved image from localStorage on page load
            document.addEventListener("DOMContentLoaded", () => {
                const savedImage = localStorage.getItem("discord_banner");
                if (savedImage) {
                    bannerImagePreview.style.backgroundImage = `url(${savedImage})`;
                }
            });

            // Handle image upload
            bannerImageInput.addEventListener("change", function () {
                document.getElementById("options-banner-img-input-option-error").innerHTML = ``;
                removeBannerImageButton.style.display = 'unset';
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function (event) {
                        const dataUrl = event.target.result;
                        try {
                            localStorage.setItem("discord_banner", dataUrl);
                            bannerImagePreview.style.backgroundImage = `url(${dataUrl})`;
                        } catch(error) {
                            document.getElementById("options-banner-img-input-option-error").innerHTML = `
                                <div class="modalv3-profile-tab-file-too-large-warning">
                                    <p class="modalv3-profile-tab-file-too-large-warning-title">${getTextString("OPTIONS_EXTRA_PROFILE_FILE_TOO_BIG")}</p>
                                    <p class="modalv3-profile-tab-file-too-large-warning-summary">${getTextString("OPTIONS_EXTRA_PROFILE_FILE_TOO_BIG_SUMMARY")}</p>
                                </div>
                            `;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Handle image removal
            removeBannerImageButton.addEventListener("click", function () {
                removeBannerImageButton.style.display = 'none';
                localStorage.discord_banner = ``
                bannerImagePreview.style.backgroundImage = '';
                document.getElementById("options-banner-img-input-option-error").innerHTML = ``;
            });

        } else if (tab === "warnings") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_WARNINGS_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_WARNINGS_ACCOUNT_WARNINGS_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_WARNINGS_ACCOUNT_WARNINGS_SUMMARY")}</p>

                    <div id="modalv3-warnings-warns-output-container">
                    </div>
                </div>
            `;

            updateAndCacheReviewsWarnings();
        } else if (tab === "reviews") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            if (localStorage.experiment_2025_05_m === "Treatment 1: Enabled") {
                tabPageOutput.innerHTML = `
                    <h2>${getTextString("MODAL_V3_TAB_REVIEWS_HEADER")}</h2>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_UNAVAILABLE_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_UNAVAILABLE_SUMMARY")}</p>
                    </div>
                `;
            } else if (localStorage.discord_token && shop_archives_token) {
                tabPageOutput.innerHTML = `
                    <h2>${getTextString("MODAL_V3_TAB_REVIEWS_HEADER")}</h2>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SUMMARY")}</p>

                        <div class="modalv3-content-ratio-card green" id="modalv3-ratio-card-reviews-filter-3" onclick="updateReviewsFilterStore('3');">
                            <div class="modalv3-content-ratio-card-inner">
                                <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_3")}</h2>
                                <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_3_SUMMARY")}</p>
                            </div>
                        </div>
                        <div class="modalv3-content-ratio-card orange" id="modalv3-ratio-card-reviews-filter-2" onclick="updateReviewsFilterStore('2');">
                            <div class="modalv3-content-ratio-card-inner">
                                <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_2")}</h2>
                                <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_2_SUMMARY")}</p>
                            </div>
                        </div>
                        <div class="modalv3-content-ratio-card red" id="modalv3-ratio-card-reviews-filter-1"  onclick="updateReviewsFilterStore('1');">
                            <div class="modalv3-content-ratio-card-inner">
                                <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_1")}</h2>
                                <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_1_SUMMARY")}</p>
                            </div>
                        </div>
                    </div>
                `;

                updateReviewsFilterStore();
            } else {
                tabPageOutput.innerHTML = `
                    <h2>${getTextString("MODAL_V3_TAB_REVIEWS_HEADER")}</h2>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_DISCORD_ACCOUNT_NOT_LOGGED_IN_SUMMARY")}</p>

                        <div class="modalv3-content-ratio-card green">
                            <div class="modalv3-content-ratio-card-inner">
                                <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_3")}</h2>
                                <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_3_SUMMARY")}</p>
                            </div>
                        </div>
                        <div class="modalv3-content-ratio-card orange modalv3-content-ratio-card-selected">
                            <svg class="lock-icon" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M6 9h1V6a5 5 0 0 1 10 0v3h1a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3v-8a3 3 0 0 1 3-3Zm9-3v3H9V6a3 3 0 1 1 6 0Zm-1 8a2 2 0 0 1-1 1.73V18a1 1 0 1 1-2 0v-2.27A2 2 0 1 1 14 14Z" clip-rule="evenodd" class=""></path></svg>
                            <div class="lock-icon-block"></div>
                            <div class="modalv3-content-ratio-card-inner">
                                <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_2")}</h2>
                                <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_2_SUMMARY")}</p>
                            </div>
                        </div>
                        <div class="modalv3-content-ratio-card red">
                            <div class="modalv3-content-ratio-card-inner">
                                <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_1")}</h2>
                                <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_REVIEWS_REVIEWS_FILTER_SETTINGS_1_SUMMARY")}</p>
                            </div>
                        </div>
                    </div>
                `;
            }

        } else if (tab === "appearance") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_APPEARANCE_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_SUMMARY")}</p>

                    <div class="modalv3-theme-selection-container" id="modalv3-theme-selection-container">
                    </div>
                </div>
                <div id="modal-v3-color-themes-experiment-output"></div>
                <div id="modal-v3-custom-themes-experiment-output"></div>
                <div id="modal-v3-community-themes-experiment-output"></div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_APPEARANCE_TIME_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_TIME_SUMMARY")}</p>
                    <div class="modalv3-content-ratio-card green" id="modalv3-ratio-card-reviews-time-us" onclick="updateReviewsTimeFormatStore('us');">
                        <div class="modalv3-content-ratio-card-inner">
                            <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_APPEARANCE_TIME_SETTINGS_2")}</h2>
                            <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_TIME_SETTINGS_2_SUMMARY")}</p>
                        </div>
                    </div>
                    <div class="modalv3-content-ratio-card green" id="modalv3-ratio-card-reviews-time-uk" onclick="updateReviewsTimeFormatStore('uk');">
                        <div class="modalv3-content-ratio-card-inner">
                            <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_APPEARANCE_TIME_SETTINGS_1")}</h2>
                            <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_TIME_SETTINGS_1_SUMMARY")}</p>
                        </div>
                    </div>
                </div>
                <div id="modal-v3-extended-styles-experiment-output"></div>
                <div id="modal-v3-extended-styles-cards-experiment-output"></div>
            `;

            updateReviewsTimeFormatStore();

            document.getElementById("modalv3-theme-selection-container").innerHTML = `
                <div class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_LIGHT")}" id="theme-light-button" onclick="updateThemeStore('light', 'true', null);"></div>
                <div class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_DARK")}" id="theme-dark-button" onclick="updateThemeStore('dark', 'true', null);"></div>
                <div class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_MIDNIGHT")}" id="theme-midnight-button" onclick="updateThemeStore('midnight', 'true', null);"></div>
            `;

            if (localStorage.experiment_2025_04_theme_picker_v2_color === "Treatment 1: Enabled") {
                document.getElementById("modal-v3-color-themes-experiment-output").innerHTML = `
                    <hr>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_COLOR_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_COLOR_SUMMARY")}</p>

                        <div class="modalv3-theme-selection-container" id="modalv3-color-theme-selection-container">
                        </div>
                    </div>
                `;

                document.getElementById("modalv3-color-theme-selection-container").innerHTML = `
                    <div class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_BLUE")}" id="theme-color_blue-button" onclick="updateThemeStore('color_blue', 'true', null);"></div>
                    <div class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_RED")}" id="theme-color_red-button" onclick="updateThemeStore('color_red', 'true', null);"></div>
                    <div class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_GREEN")}" id="theme-color_green-button" onclick="updateThemeStore('color_green', 'true', null);"></div>
                `;
            }

            if (localStorage.experiment_2025_04_theme_picker_v2_custom === "Treatment 1: Enabled") {
                document.getElementById("modal-v3-custom-themes-experiment-output").innerHTML = `
                    <hr>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_CUSTOM_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_CUSTOM_SUMMARY")}</p>

                        <div class="modalv3-theme-selection-container" id="modalv3-custom-theme-selection-container">
                        </div>
                    </div>
                `;

                document.getElementById("modalv3-custom-theme-selection-container").innerHTML = `
                    <div style="text-align: center;" class="theme-selection-box" title="${getTextString("THEME_PICKER_V2_CUSTOM")}" id="theme-custom_css-button" onclick="updateThemeStore('custom_css', 'true', null);" bis_skin_checked="1">
                        <svg class="circleIcon_db6521" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M13 5a1 1 0 1 0-2 0v6H5a1 1 0 1 0 0 2h6v6a1 1 0 1 0 2 0v-6h6a1 1 0 1 0 0-2h-6V5Z" class=""></path></svg>
                    </div>
                `;
            }

            if (localStorage.experiment_2025_04_theme_picker_v2_community === "Treatment 2: As banners") {
                document.getElementById("modal-v3-community-themes-experiment-output").innerHTML = `
                    <hr>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_COMMUNITY_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_THEME_COMMUNITY_SUMMARY")}</p>

                        <div id="modalv3-community-theme-selection-container">
                        </div>
                    </div>
                `;
                fetchAndRenderCommunityThemesAsBanners();
            }

            async function fetchAndRenderCommunityThemesAsBanners() {
                if (!communityThemesCache) {
                    await setCommunityThemesCache();
                }

                try {
                    communityThemesCache.forEach(theme => {
                        let themeIcon = document.createElement("div");

                        themeIcon.classList.add("modalv3-community-theme-banner");
                        themeIcon.id = 'theme-community-' + theme.id + '-button'
                        themeIcon.style.color = theme.text_color;
                        if (theme.banner.src != null) {
                            themeIcon.style.backgroundImage = `linear-gradient(-90deg,rgba(0, 0, 0, 0) 30%,${theme.banner.color_primary}), url('${theme.banner.src}')`;
                        } else if (theme.banner.color_secondary != null) {
                            themeIcon.style.backgroundImage = `linear-gradient(-90deg, ${theme.banner.color_secondary} 30%,${theme.banner.color_primary})`;
                        } else {
                            themeIcon.style.backgroundColor = theme.banner.color_primary;
                        }

                        themeIcon.innerHTML = `
                            <p class="modalv3-community-theme-banner-header">${theme.name}</p>
                            <button class="modalv3-apply-theme-button" onclick="updateThemeStore('community-${theme.id}', 'true', '${theme.github.raw}');">Apply</button>
                            <div class="modalv3-community-theme-banner-creddits-container">
                                <div title="Github">
                                    <svg class="shareIcon_modal" onclick="window.open('https://github.com/${theme.github.user}/${theme.github.repo}');" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.0001 2.4375C20.0001 1.725 19.9521 0.8505 19.6251 0C19.6251 0 17.4861 0.0149998 15.4686 1.926C14.5371 1.6545 13.5411 1.5 12.5001 1.5C11.4591 1.5 10.4631 1.6545 9.53157 1.926C7.51407 0.0149998 5.37507 0 5.37507 0C5.04957 0.8505 5.00007 1.725 5.00007 2.4375C5.00007 3.516 5.19207 4.1775 5.30757 4.5045C4.17807 5.7585 3.50007 7.311 3.50007 9C3.50007 12.279 5.98257 14.2965 9.50007 15C8.70957 15.6945 8.22507 16.665 8.07057 17.754C7.73607 17.916 7.25007 18 6.68757 18C6.23607 18 5.35857 17.787 4.54107 16.5135C4.21107 15.9975 3.50007 15 2.56257 15C2.37957 15 1.99407 14.988 2.00007 15.2715C2.00307 15.4065 2.21007 15.408 2.65257 15.8025C3.02307 16.134 3.36807 16.677 3.50007 17.25C3.71757 18.1905 4.58907 20.0625 6.68757 20.0625C7.43757 20.0625 8.00007 19.875 8.00007 19.875V23.3115C9.42057 23.757 10.9326 24 12.5001 24C14.0676 24 15.5796 23.757 17.0001 23.3115V18.375C17.0001 17.0265 16.4391 15.825 15.5001 15C19.0176 14.2965 21.5001 12.279 21.5001 9C21.5001 7.341 20.8461 5.8125 19.7511 4.5705C19.8456 4.278 20.0001 3.6 20.0001 2.4375Z" fill="currentColor"/></svg>
                                </div>
                            </div>
                        `;

                        document.getElementById("modalv3-community-theme-selection-container").appendChild(themeIcon);
                    });
                    if (document.getElementById("theme-" + localStorage.sa_theme + "-button")) {
                        document.getElementById("theme-" + localStorage.sa_theme + "-button").classList.add('theme-selection-box-selected');
                    }
                }
                catch(error) {
                    document.getElementById("modalv3-community-theme-selection-container").innerHTML = `There was an error loading community themes`;
                }
            }

            if (document.getElementById("theme-" + localStorage.sa_theme + "-button")) {
                document.getElementById("theme-" + localStorage.sa_theme + "-button").classList.add('theme-selection-box-selected');
            }

            if (localStorage.experiment_2025_04_extended_styles === "Treatment 1: Enabled" || localStorage.experiment_2025_04_extended_styles === "Treatment 2: Card Styles") {
                document.getElementById("modal-v3-extended-styles-experiment-output").innerHTML = `
                    <hr>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_SUMMARY")}</p>

                        <div class="modalv3-extended-styles-card-container" id="modalv3-extended-styles-card-container-category-tabs"></div>
                    </div>
                `;

                document.getElementById("modalv3-extended-styles-card-container-category-tabs").innerHTML = `
                    <div class="modalv3-extended-styles-card-1 selected" id="modalv3-extended-styles-category-tab-1" onclick="updateExtendedStylesCategoryTab('1');">
                        <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_DARK")}</p>
                        <div class="modalv3-extended-styles-card-1-preview">
                            <div class="category-modal-content-container">

                                <div class="change-category-modal-content-button selected">
                                    <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_SELECTED")}</p>
                                </div>

                                <div class="change-category-modal-content-button" style="display: flex;">
                                    <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_OTHER")}</p>
                                </div>

                                <div class="modalv3-extended-styles-card-1-preview-category-modal-inner-content-container">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modalv3-extended-styles-card-1" id="modalv3-extended-styles-category-tab-2" onclick="updateExtendedStylesCategoryTab('2');">
                        <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_TRANSPARENT")}</p>
                        <div class="modalv3-extended-styles-card-1-preview">
                            <div class="category-modal-content-container">

                                <div class="change-category-modal-content-button-transparent selected">
                                    <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_SELECTED")}</p>
                                </div>

                                <div class="change-category-modal-content-button-transparent" style="display: flex;">
                                    <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_OTHER")}</p>
                                </div>

                                <div class="modalv3-extended-styles-card-1-preview-category-modal-inner-content-container">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modalv3-extended-styles-card-1" id="modalv3-extended-styles-category-tab-3" onclick="updateExtendedStylesCategoryTab('3');">
                        <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_LEGACY")}</p>
                        <div class="modalv3-extended-styles-card-1-preview">
                            <div class="category-modal-content-container">

                                <div class="change-category-modal-content-button-legacy selected">
                                    <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_SELECTED")}</p>
                                </div>

                                <div class="change-category-modal-content-button-legacy" style="display: flex;">
                                    <p>${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_CATEGORY_TABS_OTHER")}</p>
                                </div>

                                <div class="modalv3-extended-styles-card-1-preview-category-modal-inner-content-container">
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                updateExtendedStylesCategoryTab();
            }

            if (localStorage.experiment_2025_04_extended_styles === "Treatment 2: Card Styles") {
                document.getElementById("modal-v3-extended-styles-cards-experiment-output").innerHTML = `
                    <hr>
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_SHOP_CARDS_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_APPEARANCE_EXTENDED_STYLES_SHOP_CARDS_SUMMARY")}</p>

                    </div>
                `;
            }

        } else if (tab === "accessibility") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_ACCESSIBILITY_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_ACCESSIBILITY_REDUCED_MOTION_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_ACCESSIBILITY_REDUCED_MOTION_SUMMARY")}</p>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_ACCESSIBILITY_REDUCED_MOTION_SUMMARY2")}</p>

                    <input class="modalv3-toggle" onclick="reducedMotionChecked();" id="reduced-motion-box" type="checkbox">
                </div>
            `;

        } else if (tab === "xp_events") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `

                <div id="modalv3-xp-notice-container">
                </div>
                
                <h2>${getTextString("MODAL_V3_TAB_XP_EVENTS_HEADER")}</h2>

                <div id="modalv3-failed-to-load-xp-events-balance">
                </div>

                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_EVENTS_EVENTS_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_XP_EVENTS_EVENTS_SUMMARY")}</p>
                    <a class="xp-reward-event-link" href="https://support.yapper.shop/#page=3">Learn More about XP</a>

                    <hr style="opacity: 0;">

                    <div class="xp-inventory-card" id="modalv3-xp-events-loading">
                        <div class="inner">
                            <p class="title">Loading Events...</p>
                            <p class="sub">Events are currently being loaded, please wait...</p>
                        </div>
                    </div>

                    <div style="display: none;" id="modalv3-xp-events-output">
                    </div>

                    <div style="display: none;" id="modalv3-xp-events-output2">
                    </div>
                </div>
            `;

            if (localStorage.dismissible_XPnotice != "Treatment 1: Seen") {
                document.getElementById("modalv3-xp-notice-container").innerHTML = `
                    <div class="modalv3-profile-tab-sign-in-notice" id="XPnotice">
                        <svg class="closeIcon_modal_discord_login" onclick="closeXPnoticeDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                        <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_XP_NOTICE_1")}</p>
                        <p class="modalv3-profile-tab-sign-in-notice-summary">${getTextString("MODAL_V3_XP_NOTICE_2")}</p>
                    </div>
                `;
            }

            if (!claimablesPromotionsCache) {
                try {

                    url = api + CLAIMABLES_PROMOTIONS;
                    fetchUrl = new URL(url);
                    if (localStorage.staff_unpublished_xp_events == "true") {
                        fetchUrl.searchParams.append("include-unpublished", "true");
                    }

                    const userInfo = await fetch(fetchUrl, {
                        headers: { Authorization: `${shop_archives_token}` }
                    });
          
                    if (!userInfo.ok) {
                        document.getElementById("modalv3-failed-to-load-xp-events-balance").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_EVENTS_ERROR_1")}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    }

                    const data = await userInfo.json();

                    if (data.message) {
                        document.getElementById("modalv3-failed-to-load-xp-events-balance").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_EVENTS_ERROR_1")}</p>
                                <p class="modalv3-profile-tab-sign-in-notice-summary">${data.error}, ${data.message}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    } else {
                        claimablesPromotionsCache = data;
                    }
              
                } catch (error) {
                    console.error(error)
                }
            }

            function fetchXpEvents() {
                document.getElementById("modalv3-xp-events-output").innerHTML = ``;
                document.getElementById("modalv3-xp-events-output2").innerHTML = ``;
                if (Array.isArray(claimablesPromotionsCache) && claimablesPromotionsCache.length != 0) {
                    claimablesPromotionsCache.forEach(promo => {

                        let promoBanner = document.createElement("div");
    
                        promoBanner.classList.add("xp-reward-event-card");
                        
                        if (promo.already_claimed === false) {

                            if (promo.category_data) {
                                promoBanner.innerHTML = `
                                    <div class="inner">
                                        <div data-xp-event-expires-at></div>
                                        <p class="title">${promo.name}</p>
                                        <p class="sub">You have ${promo.xp_reward.toLocaleString()} XP waiting for you!</p>
                                        <button class="button" onclick="setParams({page: '${promo.category_data.page}', scrollTo: '${promo.category_data.sku_id}'}); location.reload();">Take me there</button>
                                    </div>
                                `;
                            } else {
                                promoBanner.innerHTML = `
                                    <div class="inner">
                                        <div data-xp-event-expires-at></div>
                                        <p class="title">${promo.name}</p>
                                        <p class="sub">You have ${promo.xp_reward.toLocaleString()} XP waiting for you!</p>
                                        <button class="button" onclick="openClaimablesRewardClaimModal('${promo.claimable_id}')">Claim ${promo.xp_reward.toLocaleString()} XP</button>
                                    </div>
                                `;
                            }

                            const expiresAt = new Date(promo.expires_at);
                            
                            if (promo.expires_at && !isNaN(expiresAt.getTime())) {
                    
                                function updateTimer() {
                                    const now = new Date();
                                    const timeDiff = expiresAt - now;
                    
                                    if (timeDiff <= 0) {
                                        promoBanner.classList.add("hidden");
                                        clearInterval(timerInterval);
                                    } else {
                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                                        const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

                                        const date = `ENDS IN ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    
                                        promoBanner.querySelector("[data-xp-event-expires-at]").innerHTML = `
                                            <p class="xp-event-expires-at-text">${date.replace(" 0d 0h 0m", "").replace(" 0d 0h", "").replace(" 0d", "")}</p>
                                        `;
                                    }
                                }
                    
                                const timerInterval = setInterval(updateTimer, 1000);
                                updateTimer();
                            }
    
                            document.getElementById("modalv3-xp-events-output").appendChild(promoBanner);
                        } else {

                            promoBanner.classList.add("claimed");
    
                            promoBanner.innerHTML = `
                                <div class="inner">
                                    <div data-xp-event-expires-at></div>
                                    <p class="title">${promo.name}</p>
                                    <p class="sub">You already claimed this reward for ${promo.xp_reward.toLocaleString()} XP.</p>
                                    <button class="button" disabled>Claimed</button>
                                </div>
                            `;

                            const expiresAt = new Date(promo.expires_at);
                            
                            if (promo.expires_at && !isNaN(expiresAt.getTime())) {
                    
                                function updateTimer() {
                                    const now = new Date();
                                    const timeDiff = expiresAt - now;
                    
                                    if (timeDiff <= 0) {
                                        promoBanner.classList.add("hidden");
                                        clearInterval(timerInterval);
                                    } else {
                                        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                                        const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                                        const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                                        const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);

                                        const date = `ENDS IN ${days}d ${hours}h ${minutes}m ${seconds}s`;
                    
                                        promoBanner.querySelector("[data-xp-event-expires-at]").innerHTML = `
                                            <p class="xp-event-expires-at-text">${date.replace(" 0d 0h 0m", "").replace(" 0d 0h", "").replace(" 0d", "")}</p>
                                        `;
                                    }
                                }
                    
                                const timerInterval = setInterval(updateTimer, 1000);
                                updateTimer();
                            }
    
                            document.getElementById("modalv3-xp-events-output2").appendChild(promoBanner);
                        }
                    });
    
                    document.getElementById("modalv3-xp-events-output").style.display = 'unset';
                    document.getElementById("modalv3-xp-events-output2").style.display = 'unset';
                    document.getElementById("modalv3-xp-events-loading").style.display = 'none';
                } else {
                    document.getElementById("modalv3-xp-events-output").style.display = 'unset';
                    document.getElementById("modalv3-xp-events-loading").style.display = 'none';

                    document.getElementById("modalv3-xp-events-output").innerHTML = `
                        <div class="xp-inventory-card">
                            <div class="inner">
                                <p class="title">All is quiet...</p>
                                <p class="sub">There are currently no events happening right now, check back later.</p>
                            </div>
                        </div>
                    `;
                }
            }

            window.fetchXpEvents = fetchXpEvents;

            fetchXpEvents();
            
        } else if (tab === "xp_general") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `

                <div id="modalv3-xp-notice-container">
                </div>

                <h2>${getTextString("MODAL_V3_TAB_XP_SHOP_HEADER")}</h2>

                <div id="modalv3-failed-to-load-xp-shop">
                </div>

                <div id="modalv3-failed-to-load-xp-balance">
                </div>

                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_SHOP_XP_LEVEL_HEADER")}</h2>

                    <div class="my-xp-balance-container">
                        <div class="my-xp-balance-get-more" onclick="setModalv3InnerContent('xp_events')">
                            <svg class="circleIcon_my-xp-balance-get-more" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M13 5a1 1 0 1 0-2 0v6H5a1 1 0 1 0 0 2h6v6a1 1 0 1 0 2 0v-6h6a1 1 0 1 0 0-2h-6V5Z" class=""></path></svg>
                        </div>
                        <div class="my-xp-balance-container-inner">
                            <h2 class="my-xp-balance" id="modalv3-xp-balance-text"> ... </h2>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIMABLES_FEATURED")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIMABLES_FEATURED_SUMMARY")}</p>

                    <div style="display: grid;" id="modalv3-xp-perks-loading" class="xp-card-featured-container">
                        <div class="xp-card-featured">
                            <p class="modalv3-xp-card-featured-title">Loading Perks...</p>
                        </div>
                        <div class="xp-card-featured">
                            <p class="modalv3-xp-card-featured-title">Loading Perks...</p>
                        </div>
                    </div>

                    <div style="display: none;" id="modalv3-xp-perks-featured-output" class="xp-card-featured-container">
                    </div>
                </div>
                <hr style="opacity: 0;">
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIMABLES_ADDITIONAL")}</h2>

                    <div style="display: none;" id="modalv3-xp-perks-shop-output" class="xp-card-shop-container">
                    </div>
                </div>
            `;

            if (localStorage.dismissible_XPnotice != "Treatment 1: Seen") {
                document.getElementById("modalv3-xp-notice-container").innerHTML = `
                    <div class="modalv3-profile-tab-sign-in-notice" id="XPnotice">
                        <svg class="closeIcon_modal_discord_login" onclick="closeXPnoticeDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                        <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_XP_NOTICE_1")}</p>
                        <p class="modalv3-profile-tab-sign-in-notice-summary">${getTextString("MODAL_V3_XP_NOTICE_2")}</p>
                    </div>
                `;
            }

            if (!atMeUsercache) {
                try {

                    const userInfo = await fetch('https://api.yapper.shop/v2/users/@me', {
                        headers: { Authorization: `${shop_archives_token}` }
                    });
          
                    if (!userInfo.ok) {
                        document.getElementById("modalv3-failed-to-load-xp-shop").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_2")}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    }

                    const data = await userInfo.json();

                    if (data.message) {
                        document.getElementById("modalv3-failed-to-load-xp-shop").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_2")}</p>
                                <p class="modalv3-profile-tab-sign-in-notice-summary">${data.error}, ${data.message}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    } else {
                        atMeUsercache = data;
                    }
              
                } catch (error) {
                    console.error(error)
                }
            }

            if (!myClaimablesClaimedCache) {
                try {

                    const userInfo = await fetch(api + CLAIMABLES_CLAIMED, {
                        headers: { Authorization: `${shop_archives_token}` }
                    });
          
                    if (!userInfo.ok) {
                        document.getElementById("modalv3-failed-to-load-xp-shop").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_2")}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    }

                    const claimablesClaimed = await userInfo.json();

                    if (claimablesClaimed.message) {
                        document.getElementById("modalv3-failed-to-load-xp-shop").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_2")}</p>
                                <p class="modalv3-profile-tab-sign-in-notice-summary">${claimablesClaimed.error}, ${claimablesClaimed.message}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    } else {
                        myClaimablesClaimedCache = claimablesClaimed;
                    }
              
                } catch (error) {
                    console.error(error)
                }
            }

            if (!claimablesShopcache) {

                url = api + CLAIMABLES_SHOP;
                fetchUrl = new URL(url);
                if (localStorage.staff_unpublished_xp_shop == "true") {
                    fetchUrl.searchParams.append("include-unpublished", "true");
                }

                fetch(fetchUrl, {
                    method: "GET",
                    headers: {
                        "Authorization": shop_archives_token
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        document.getElementById("modalv3-failed-to-load-xp-shop").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_2")}</p>
                                <p class="modalv3-profile-tab-sign-in-notice-summary">${data.error}, ${data.message}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    } else {
                        claimablesShopcache = data;
                        renderXPShop(data);
                    }
                })
                .catch(error => {
                    console.error(error);
                    document.getElementById("modalv3-failed-to-load-xp-shop").innerHTML = `
                        <div class="modalv3-profile-tab-file-too-large-warning">
                            <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_2")}</p>
                            <p class="modalv3-profile-tab-sign-in-notice-summary">${error}</p>
                        </div>
                        <hr style="opacity: 0;">
                    `;
                });
            } else {
                renderXPShop(claimablesShopcache)
            }

            if (!myXPBalancecache) {
                fetch(api + XP_BALANCE, {
                    method: "GET",
                    headers: {
                        "Authorization": shop_archives_token
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        document.getElementById("modalv3-failed-to-load-xp-balance").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_3")}</p>
                                <p class="modalv3-profile-tab-sign-in-notice-summary">${data.error}, ${data.message}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    } else {
                        myXPBalancecache = data;
                        rendermyXPBalanceShop(data);
                    }
                })
                .catch(error => {
                    console.error(error);
                    document.getElementById("modalv3-failed-to-load-xp-balance").innerHTML = `
                        <div class="modalv3-profile-tab-file-too-large-warning">
                            <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_SHOP_ERROR_3")}</p>
                            <p class="modalv3-profile-tab-sign-in-notice-summary"${error}</p>
                        </div>
                        <hr style="opacity: 0;">
                    `;
                });
            } else {
                rendermyXPBalanceShop(myXPBalancecache)
            }

            function renderXPShop(data) {
                document.getElementById("modalv3-xp-perks-featured-output").innerHTML = ``;
                document.getElementById("modalv3-xp-perks-shop-output").innerHTML = ``;
    
                data.featured.forEach(featured => {
                    let featuredCard = document.createElement("div");
    
                    featuredCard.classList.add("xp-card-featured");

                    let itemPrice = `${featured.price.toLocaleString()} XP`;

                    let alreadyClaimed = false;

                    let nonoClaim = false;

                    if (myClaimablesClaimedCache != null) {
                        myClaimablesClaimedCache.forEach(claimed => {
                            if (claimed.id === featured.id) {
                                itemPrice = "Already Claimed"
                                alreadyClaimed = true;
                            }
                        });
                    }
    
                    featuredCard.innerHTML = `
                        <p class="modalv3-xp-card-featured-title">${featured.name}</p>
                        <p class="modalv3-xp-card-featured-summary">${featured.summary}</p>
                        <div data-possible-review-preview></div>
                        <div class="review-element-padding"></div>
                        <p class="modalv3-xp-card-featured-price">${itemPrice}</p>
                    `;

                    const today = new Date();
                    const year = today.getFullYear();
                    const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
                    const day = String(today.getDate()).padStart(2, '0');
                    let formattedDate = `${day}/${month}/${year}`

                    if (localStorage.reviews_time_type === "us") {
                        formattedDate = `${month}/${day}/${year}`
                    }
    
                    if (featured.id === "2" && atMeUsercache.primary_guild) {

                        featuredCard.querySelector("[data-possible-review-preview]").innerHTML = `
                            <div class="review-element">
                                <div class="review-content-inner">
                                    <div class="shop-modal-review-name-container" data-shop-modal-review-name-container>
                                        <img class="shop-modal-review-avatar-deco-img" src="https://cdn.yapper.shop/assets/31.png">
                                        <img class="shop-modal-review-avatar-img" src="https://cdn.discordapp.com/avatars/${atMeUsercache.id}/${atMeUsercache.avatar}.webp?size=128">
                                        <p class="shop-modal-review-name">${atMeUsercache.global_name ? atMeUsercache.global_name : atMeUsercache.username}</p>
                                        <div class="shop-modal-review-server-tag-container">
                                            <img src="https://cdn.discordapp.com/clan-badges/${atMeUsercache.primary_guild.identity_guild_id}/${atMeUsercache.primary_guild.badge}.png?size=24"></img>
                                            <p>${atMeUsercache.primary_guild.tag}</p>
                                        </div>
                                    <div class="shop-modal-review-star-container">
                                    <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzM5KSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iI0ZGRUMzRSIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzM5Ij4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K">
                                </div>
                                <p class="shop-modal-review-time-container">${formattedDate}</p>
                                </div>
                                <p class="shop-modal-review-review-text">${featured.preview_text}</p>
                                </div>
                            </div>
                        `;

                    } else if (featured.id === "2" && !atMeUsercache.primary_guild) {
    
                        let featuredCardBlock = document.createElement("div");
    
                        featuredCardBlock.classList.add("xp-card-featured-block");

                        featuredCardBlock.innerHTML = `
                            <div class="profile-no-text-container">
                                <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: white;">${getTextString("MODAL_V3_TAB_XP_SHOP_CANT_CLAIM_1")}</p>
                                <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: white;">${getTextString("MODAL_V3_TAB_XP_SHOP_CANT_CLAIM_2")}</p>
                                <a class="link" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: white;" href="https://support.yapper.shop/#page=3">Learn More</a>
                            </div>
                        `;

                        featuredCard.appendChild(featuredCardBlock);

                        nonoClaim = true;
    
                    } else if (featured.id === "3") {
    
                        featuredCard.querySelector("[data-possible-review-preview]").innerHTML = `
                            <div class="review-element review-color-preview">
                                <div class="review-content-inner">
                                    <div class="shop-modal-review-name-container">
                                        <img class="shop-modal-review-avatar-img" src="https://cdn.discordapp.com/avatars/${atMeUsercache.id}/${atMeUsercache.avatar}.webp?size=128">
                                        <p class="shop-modal-review-name">${atMeUsercache.global_name ? atMeUsercache.global_name : atMeUsercache.username}</p>
                                    <div class="shop-modal-review-star-container">
                                    <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzM5KSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iI0ZGRUMzRSIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzM5Ij4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K">
                                </div>
                                <p class="shop-modal-review-time-container">${formattedDate}</p>
                                </div>
                                <p class="shop-modal-review-review-text">${featured.preview_text}</p>
                                </div>
                            </div>
                        `;
    
                    } else if (featured.id === "5" && atMeUsercache.avatar_decoration_data) {

                        featuredCard.querySelector("[data-possible-review-preview]").innerHTML = `
                            <div class="review-element">
                                <div class="review-content-inner">
                                    <div class="shop-modal-review-name-container">
                                        <img class="shop-modal-review-avatar-deco-img" src="${atMeUsercache.avatar_decoration_data ? `https://cdn.discordapp.com/avatar-decoration-presets/${atMeUsercache.avatar_decoration_data.asset}.png?size=40&amp;passthrough=true` : "https://cdn.yapper.shop/assets/31.png"}">
                                        <img class="shop-modal-review-avatar-img" src="https://cdn.discordapp.com/avatars/${atMeUsercache.id}/${atMeUsercache.avatar}.webp?size=128">
                                        <p class="shop-modal-review-name">${atMeUsercache.global_name ? atMeUsercache.global_name : atMeUsercache.username}</p>
                                    <div class="shop-modal-review-star-container">
                                    <img class="shop-modal-review-stars-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMTIwIDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMTMxXzM5KSI+CjxwYXRoIGQ9Ik0xMiAwTDE0LjY5NDIgOC4yOTE4SDIzLjQxMjdMMTYuMzU5MyAxMy40MTY0TDE5LjA1MzQgMjEuNzA4MkwxMiAxNi41ODM2TDQuOTQ2NTggMjEuNzA4Mkw3LjY0MDc0IDEzLjQxNjRMMC41ODczMjIgOC4yOTE4SDkuMzA1ODNMMTIgMFoiIGZpbGw9IiNGRkVDM0UiLz4KPHBhdGggZD0iTTM2IDBMMzguNjk0MiA4LjI5MThINDcuNDEyN0w0MC4zNTkzIDEzLjQxNjRMNDMuMDUzNCAyMS43MDgyTDM2IDE2LjU4MzZMMjguOTQ2NiAyMS43MDgyTDMxLjY0MDcgMTMuNDE2NEwyNC41ODczIDguMjkxOEgzMy4zMDU4TDM2IDBaIiBmaWxsPSIjRkZFQzNFIi8+CjxwYXRoIGQ9Ik02MCAwTDYyLjY5NDIgOC4yOTE4SDcxLjQxMjdMNjQuMzU5MyAxMy40MTY0TDY3LjA1MzQgMjEuNzA4Mkw2MCAxNi41ODM2TDUyLjk0NjYgMjEuNzA4Mkw1NS42NDA3IDEzLjQxNjRMNDguNTg3MyA4LjI5MThINTcuMzA1OEw2MCAwWiIgZmlsbD0iI0ZGRUMzRSIvPgo8cGF0aCBkPSJNODQgMEw4Ni42OTQyIDguMjkxOEg5NS40MTI3TDg4LjM1OTMgMTMuNDE2NEw5MS4wNTM0IDIxLjcwODJMODQgMTYuNTgzNkw3Ni45NDY2IDIxLjcwODJMNzkuNjQwNyAxMy40MTY0TDcyLjU4NzMgOC4yOTE4SDgxLjMwNThMODQgMFoiIGZpbGw9IiM1NzU3NTciLz4KPHBhdGggZD0iTTEwOCAwTDExMC42OTQgOC4yOTE4SDExOS40MTNMMTEyLjM1OSAxMy40MTY0TDExNS4wNTMgMjEuNzA4MkwxMDggMTYuNTgzNkwxMDAuOTQ3IDIxLjcwODJMMTAzLjY0MSAxMy40MTY0TDk2LjU4NzMgOC4yOTE4SDEwNS4zMDZMMTA4IDBaIiBmaWxsPSIjNTc1NzU3Ii8+CjwvZz4KPGRlZnM+CjxjbGlwUGF0aCBpZD0iY2xpcDBfMTMxXzM5Ij4KPHJlY3Qgd2lkdGg9IjEyMCIgaGVpZ2h0PSIyNCIgZmlsbD0id2hpdGUiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K">
                                </div>
                                <p class="shop-modal-review-time-container">${formattedDate}</p>
                                </div>
                                <p class="shop-modal-review-review-text">${featured.preview_text}</p>
                                </div>
                            </div>
                        `;
                    } else if (featured.id === "5" && !atMeUsercache.avatar_decoration_data) {
    
                        let featuredCardBlock = document.createElement("div");
    
                        featuredCardBlock.classList.add("xp-card-featured-block");

                        featuredCardBlock.innerHTML = `
                            <div class="profile-no-text-container">
                                <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: white;">${getTextString("MODAL_V3_TAB_XP_SHOP_CANT_CLAIM_1")}</p>
                                <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: white;">${getTextString("MODAL_V3_TAB_XP_SHOP_CANT_CLAIM_2")}</p>
                                <a class="link" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: white;" href="https://support.yapper.shop/#page=3">Learn More</a>
                            </div>
                        `;

                        featuredCard.appendChild(featuredCardBlock);

                        nonoClaim = true;
    
                    }

                    if (alreadyClaimed === false && nonoClaim === false) {
                        featuredCard.addEventListener('click', () => {
                            openClaimablesPurchaseModal(featured.id)
                        });
                        featuredCard.classList.add("clickable");
                    }
    
                    document.getElementById("modalv3-xp-perks-featured-output").appendChild(featuredCard);
    
                });
                
                data.shop.forEach(claimable => {
                    let shopCard = document.createElement("div");

                    shopCard.classList.add("xp-card-shop");
    
                    let itemPrice = `${claimable.price.toLocaleString()} XP`;

                    let alreadyClaimed = false;

                    if (myClaimablesClaimedCache != null) {
                        myClaimablesClaimedCache.forEach(claimed => {
                            if (claimed.id === claimable.id) {
                                itemPrice = "Already Claimed"
                                alreadyClaimed = true;
                            }
                        });
                    }

                    if (itemPrice != "Already Claimed") {
                        shopCard.classList.add("clickable");
                    }

                    if (alreadyClaimed === false) {
                        shopCard.addEventListener('click', () => {
                            openClaimablesPurchaseModal(claimable.id)
                        });
                    }
    
                    shopCard.innerHTML = `
                        <p class="modalv3-xp-card-featured-title">${claimable.name}</p>
                        <p class="modalv3-xp-card-featured-summary">${claimable.summary}</p>
                        <p class="modalv3-xp-card-featured-price">${itemPrice}</p>
                    `;
    
                    document.getElementById("modalv3-xp-perks-shop-output").appendChild(shopCard);
    
                });

                document.getElementById("modalv3-xp-perks-featured-output").style.display = `grid`;
                document.getElementById("modalv3-xp-perks-shop-output").style.display = `grid`;
                document.getElementById("modalv3-xp-perks-loading").style.display = `none`;
            }

            window.renderXPShop = renderXPShop;

            function rendermyXPBalanceShop(data) {
                document.getElementById("modalv3-xp-balance-text").textContent = ` ${data.xp_balance.toLocaleString()} `;
            }

        } else if (tab === "xp_inventory") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `

                <div id="modalv3-xp-notice-container">
                </div>

                <h2>${getTextString("MODAL_V3_TAB_XP_INVENTORY_HEADER")}</h2>

                <div id="modalv3-failed-to-load-xp-inventory">
                </div>

                <div id="modalv3-xp-inventory-redeem-gift">
                </div>

                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_INVENTORY_CLAIMS_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_XP_INVENTORY_CLAIMS_SUMMARY")}</p>

                    <hr style="opacity: 0;">

                    <div class="xp-inventory-card" id="modalv3-xp-inventory-loading">
                        <div class="inner">
                            <p class="title">Loading Inventory...</p>
                            <p class="sub">Your inventory is currently being loaded, please wait...</p>
                        </div>
                    </div>

                    <div style="display: none;" id="modalv3-xp-inventory-output">
                    </div>
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_INVENTORY_REWARDS_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_XP_INVENTORY_REWARDS_SUMMARY")}</p>

                    <hr style="opacity: 0;">

                    <div style="display: none;" id="modalv3-xp-inventory-output2">
                    </div>
                </div>
            `;

            if (localStorage.experiment_2025_05_redeem_gift_codes === "Treatment 1: Enabled") {
                document.getElementById("modalv3-xp-inventory-redeem-gift").innerHTML = `
                    <div class="modalv3-content-card-1">
                        <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_XP_INVENTORY_REDEEM_HEADER")}</h2>
                        <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_XP_INVENTORY_REDEEM_SUMMARY")}</p>

                        <div class="modalv3-xp-inventory-claim-code-container">
                            <input type="text" id="xp-inventory-claim-code-input" placeholder="${getTextString("MODAL_V3_TAB_XP_INVENTORY_REDEEM_PLACEHOLDER")}" autocomplete="off">
                            <button id="xp-inventory-claim-code-button">Redeem</button>
                        </div>
                        <p class="modalv3-xp-inventory-claim-code" id="xp-inventory-claim-code-loading"></p>
                    </div>
                    <hr>
                `;

                document.getElementById("xp-inventory-claim-code-button").addEventListener("click", function () {
                    document.getElementById("xp-inventory-claim-code-loading").classList.remove("invalid");
                    document.getElementById("xp-inventory-claim-code-loading").textContent = '';
                    document.getElementById("xp-inventory-claim-code-button").disabled = true;
                    document.getElementById("xp-inventory-claim-code-button").textContent = '...';
                    redeemXPGiftCode(document.getElementById("xp-inventory-claim-code-input").value);
                });
            }

            if (localStorage.dismissible_XPnotice != "Treatment 1: Seen") {
                document.getElementById("modalv3-xp-notice-container").innerHTML = `
                    <div class="modalv3-profile-tab-sign-in-notice" id="XPnotice">
                        <svg class="closeIcon_modal_discord_login" onclick="closeXPnoticeDismissibleCoachtip()" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                        <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_XP_NOTICE_1")}</p>
                        <p class="modalv3-profile-tab-sign-in-notice-summary">${getTextString("MODAL_V3_XP_NOTICE_2")}</p>
                    </div>
                `;
            }

            if (!myClaimablesClaimedCache) {
                try {

                    const userInfo = await fetch(api + CLAIMABLES_CLAIMED, {
                        headers: { Authorization: `${shop_archives_token}` }
                    });
          
                    if (!userInfo.ok) {
                        document.getElementById("modalv3-failed-to-load-xp-inventory").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_INVENTORY_ERROR_1")}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    }

                    const data = await userInfo.json();

                    if (data.message) {
                        document.getElementById("modalv3-failed-to-load-xp-inventory").innerHTML = `
                            <div class="modalv3-profile-tab-file-too-large-warning">
                                <p class="modalv3-profile-tab-sign-in-notice-title">${getTextString("MODAL_V3_TAB_XP_INVENTORY_ERROR_1")}</p>
                                <p class="modalv3-profile-tab-sign-in-notice-summary">${data.error}, ${data.message}</p>
                            </div>
                            <hr style="opacity: 0;">
                        `;
                    } else {
                        myClaimablesClaimedCache = data;
                    }
              
                } catch (error) {
                    console.error(error)
                }
            }

            function fetchXpInventory() {
                document.getElementById("modalv3-xp-inventory-output").innerHTML = ``;
                if (Array.isArray(myClaimablesClaimedCache)) {

                    myClaimablesClaimedCache.sort((a, b) => new Date(b.claim_date) - new Date(a.claim_date));

                    myClaimablesClaimedCache.forEach(claimable => {

                        let formatted = null;

                        if (localStorage.reviews_time_type === "uk") {
                            const date = new Date(claimable.claim_date);

                            const day = String(date.getDate()).padStart(2, '0');
                            const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth is 0-indexed
                            const year = date.getFullYear();

                            formatted = `${day}/${month}/${year}`;
                        } else {
                            const date = new Date(claimable.claim_date);

                            const day = String(date.getDate()).padStart(2, '0');
                            const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth is 0-indexed
                            const year = date.getFullYear();

                            formatted = `${day}/${month}/${year}`;
                        }
                        
                        if (claimable.type === 1) {
    
                            let promoBanner = document.createElement("div");
    
                            promoBanner.classList.add("xp-inventory-card");
    
                            promoBanner.innerHTML = `
                                <div class="inner">
                                    <div data-xp-inventory-tag-refund-text></div>
                                    <p class="title">${claimable.name}</p>
                                    <p class="sub">You claimed this item on ${formatted}.</p>
                                    <p class="remove" data-xp-inventory-price>-${claimable.price.toLocaleString()} XP</p>
                                </div>
                            `;

                            if (claimable.refunded === true) {
                                promoBanner.querySelector("[data-xp-inventory-tag-refund-text]").innerHTML = `
                                    <p class="xp-inventory-tag-refund-text" title="${getTextString("MODAL_V3_TAB_XP_INVENTORY_TAG_REFUNDED_TITLE")}">${getTextString("MODAL_V3_TAB_XP_INVENTORY_TAG_REFUNDED")}</p>
                                `;
                                promoBanner.querySelector("[data-xp-inventory-price]").classList.remove("remove");
                                promoBanner.querySelector("[data-xp-inventory-price]").classList.add("normal");
                            }
    
                            document.getElementById("modalv3-xp-inventory-output").appendChild(promoBanner);
                        } else if (claimable.type === 0) {
    
                            let promoBanner = document.createElement("div");
    
                            promoBanner.classList.add("xp-inventory-card");
    
                            promoBanner.innerHTML = `
                                <div class="inner">
                                    <div data-xp-inventory-tag-revoke-text></div>
                                    <p class="title">${claimable.name}</p>
                                    <p class="sub">You claimed this reward on ${formatted}.</p>
                                    <p class="add" data-xp-inventory-price>+${claimable.price.toLocaleString()} XP</p>
                                </div>
                            `;

                            if (claimable.refunded === true) {
                                promoBanner.querySelector("[data-xp-inventory-tag-revoke-text]").innerHTML = `
                                    <p class="xp-inventory-tag-revoke-text" title="${getTextString("MODAL_V3_TAB_XP_INVENTORY_TAG_REVOKED_TITLE")}">${getTextString("MODAL_V3_TAB_XP_INVENTORY_TAG_REVOKED")}</p>
                                `;
                                promoBanner.querySelector("[data-xp-inventory-price]").classList.remove("add");
                                promoBanner.querySelector("[data-xp-inventory-price]").classList.add("normal");
                            }
    
                            document.getElementById("modalv3-xp-inventory-output2").appendChild(promoBanner);
                        }
                    });
    
                    document.getElementById("modalv3-xp-inventory-output").style.display = 'grid';
                    document.getElementById("modalv3-xp-inventory-output2").style.display = 'grid';
                    document.getElementById("modalv3-xp-inventory-loading").style.display = 'none';
                }
                if (!myClaimablesClaimedCache.find(item => item.type === 0)) {
                    document.getElementById("modalv3-xp-inventory-output2").innerHTML = `
                        <div class="xp-inventory-card">
                            <div class="inner">
                                <p class="title">No Claimed Rewards.</p>
                                <p class="sub">You don't have any claimed rewards.</p>
                            </div>
                        </div>
                    `;
                }
                if (!myClaimablesClaimedCache.find(item => item.type === 1)) {
                    document.getElementById("modalv3-xp-inventory-output").innerHTML = `
                        <div class="xp-inventory-card">
                            <div class="inner">
                                <p class="title">No Claimed Items.</p>
                                <p class="sub">You don't have any claimed items.</p>
                            </div>
                        </div>
                    `;
                }
            }

            window.fetchXpInventory = fetchXpInventory;

            fetchXpInventory();
        } else if (tab === "experiments") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_EXPERIMENTS_HEADER")}</h2>

                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_EXPERIMENTS_DISABLE_FORCE_ROLLOUT_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_EXPERIMENTS_DISABLE_FORCE_ROLLOUT_SUMMARY")}</p>

                    <input class="modalv3-toggle" onclick="disabledExperimentForceRolloutV2();" id="experiments-force-rollout-checkbox" type="checkbox">
                </div>

                <div class="modalv3-content-card-1" id="modalv3-experiment-output">
                </div>
            `;

            if (localStorage.experiment_force_rollout === "false") {
                document.getElementById("experiments-force-rollout-checkbox").checked = true;
            }

            experimentsList.forEach(({ title, id, name, treatments, rollout, needs_api_token, not_needed }) => {
                if (not_needed != "true") {
                    try {

                        let hrel = document.createElement("hr");
    
                        document.getElementById("modalv3-experiment-output").appendChild(hrel);

                        let experimentCard = document.createElement("div");
    
                        experimentCard.classList.add('modalv3-experiment-container');
                        experimentCard.innerHTML = `
                            <p class="modalv3-experiment-title">${title}</p>
                            <p class="modalv3-experiment-id">${id}</p>
                            <p class="modalv3-experiment-id">${getTextString("MODAL_V3_TAB_EXPERIMENTS_ROLLOUT")}${rollout}</p>
                            <div class="modalv3-experiment-treatment-info-container">
                                <select id="${name}_treatment_container" class="modalv3-experiment-treatment-container">
                                </select>
                                <button class="modalv3-experiment-treatment-clear-button" onclick="clearSetExperiment('${name}')">Clear</button>
                            </div>
                        `;
    
                        if (needs_api_token === "true") {
                            let apiNotice = document.createElement("p");
    
                            apiNotice.classList.add('modalv3-experiment-api-notice');
                            apiNotice.textContent = getTextString("MODAL_V3_TAB_EXPERIMENTS_API_WARNING");
    
                            experimentCard.appendChild(apiNotice);
                        }
    
    
                        document.getElementById("modalv3-experiment-output").appendChild(experimentCard);
    
                        const treatmentPicker = document.getElementById(`${name}_treatment_container`);
                
                        if (!treatmentPicker) return; // Skip if element doesn't exist
                
                        populateExperimentOptions(treatmentPicker, treatments);
                
                        const storedTreatment = localStorage.getItem(name);
                        if (storedTreatment) {
                            treatmentPicker.value = storedTreatment;
                        }
                
                        treatmentPicker.addEventListener("change", () => {
                            localStorage.setItem(name, treatmentPicker.value);
                        });
                
                    } catch (error) {
                        console.error(`Error setting up experiment: ${name}`, error);
                    }
                }
            });
            
            function populateExperimentOptions(selectElement, treatments) {
                treatments.forEach((treatment) => {
                    const optElement = document.createElement("option");
                    optElement.value = treatment;
                    optElement.textContent = treatment;
                    selectElement.appendChild(optElement);
                });
            }
        } else if (tab === "dismissible_content") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_DISMISSIBLE_CONTENT_HEADER")}</h2>

                <div class="modalv3-content-card-1" id="modalv3-dismissible-content-output">
                </div>
            `;

            dismissibleContentList.forEach(({ title, id, name, treatments, needs_api_token }) => {
                try {

                    let hrel = document.createElement("hr");
    
                    document.getElementById("modalv3-dismissible-content-output").appendChild(hrel);

                    let experimentCard = document.createElement("div");
    
                    experimentCard.classList.add('modalv3-experiment-container');
                    experimentCard.innerHTML = `
                        <p class="modalv3-experiment-title">${title}</p>
                        <p class="modalv3-experiment-id">${id}</p>
                        <div class="modalv3-experiment-treatment-info-container">
                            <select id="${name}_treatment_container" class="modalv3-experiment-treatment-container">
                            </select>
                        </div>
                    `;
    
    
                    document.getElementById("modalv3-dismissible-content-output").appendChild(experimentCard);

                    const treatmentPicker = document.getElementById(`${name}_treatment_container`);
            
                    if (!treatmentPicker) return; // Skip if element doesn't exist
            
                    populateDismissibleContentOptions(treatmentPicker, treatments);
            
                    const storedTreatment = localStorage.getItem(name);
                    if (storedTreatment) {
                        treatmentPicker.value = storedTreatment;
                    }
            
                    treatmentPicker.addEventListener("change", () => {
                        localStorage.setItem(name, treatmentPicker.value);
                    });
            
                } catch (error) {
                    console.error(`Error setting up experiment: ${name}`, error);
                }
            });
            
            function populateDismissibleContentOptions(selectElement, treatments) {
                treatments.forEach((treatment) => {
                    const optElement = document.createElement("option");
                    optElement.value = treatment;
                    optElement.textContent = treatment;
                    selectElement.appendChild(optElement);
                });
            }
        } else if (tab === "api_test_fetch") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_API_TEST_FETCH_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_API_TESTING_API_STATUS_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_API_TESTING_API_STATUS_SUMMARY")}</p>

                    <div class="modalv3-api-status-container" id="modalv3-api-status-container">
                    </div>
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_SUMMARY")}</p>

                    <div class="modalv3-content-card-2">
                        <p class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_BASE_URL")}</p>
                        <input type="text" readonly class="modalv3-api-testfetch-text-input" id="modalv3-test-fetch-base-url" value="https://api.yapper.shop">
                    </div>

                    <div class="modalv3-content-card-2">
                        <p class="modalv3-content-card-sub-header" >${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_API_VERSION")}</p>
                        <select class="modalv3-api-testfetch-select-input" id="modalv3-test-fetch-version">
                        <option value="v2">v2</option>
                        </select>
                    </div>

                    <div class="modalv3-content-card-2">
                        <p class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_ENDPOINT")}</p>
                        <select class="modalv3-api-testfetch-select-input" id="modalv3-test-fetch-endpoint">
                        <option value="/collectibles-shop">/collectibles-shop</option>
                        <option value="/profile-effects">/profile-effects</option>
                        <option value="/community">/community</option>
                        <option value="/status">/status</option>
                        </select>
                    </div>

                    <div class="modalv3-content-card-2">
                        <p class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_PARAMS")}</p>
                        <select class="modalv3-api-testfetch-select-input" id="modalv3-test-fetch-search-params-key">
                        <option value="tab">tab</option>
                        <option value="has-leaks">has-leaks</option>
                        <option value="include-no-sku-items">include-no-sku-items</option>
                        <option value="include-unpublished">include-unpublished</option>
                        </select>
                        <input type="text" class="modalv3-api-testfetch-text-input" id="modalv3-test-fetch-search-params-value" placeholder="Key">
                        <button class="modalv3-testfetch-button-1" onclick="modalv3AddTestFetchParam()">Add</button>
                    </div>

                    <div id="modalv3-test-fetch-params-output">
                        <div class="modalv3-api-testfetch-param-card">
                            <input type="text" class="modalv3-api-testfetch-text-input test-fetch-param-key hidden" value="is-test-fetch" disabled>
                            <input type="text" class="modalv3-api-testfetch-text-input test-fetch-param-value hidden" value="true" disabled>
                            <p>?is-test-fetch=true</p>
                        </div>
                    </div>

                    <button class="modalv3-content-card-button" onclick="fetchAPITestFetch()">${getTextString("MODAL_V3_TAB_API_TESTING_TEST_FETCH_FETCH")}</button>

                    <textarea readonly class="modalv3-api-testfetch-textarea-input" id="modalv3-test-fetch-output" placeholder="Output..."></textarea>

                </div>
            `;

            fetch(api + APISTATUS, {
                method: "GET",
                headers: {
                    "Password": api_password,
                    "Authorization": discord_token,
                    "Token": api_token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message && data.message === "Missing Access") {
                    document.getElementById("modalv3-api-status-container").innerHTML = `
                        <div class="modalv3-api-status-card">
                            <p class="modalv3-api-status-card-title">Shop</p>
                            <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                            <p class="modalv3-api-status-card-status">Missing Access</p>
                        </div>
                        <div class="modalv3-api-status-card">
                            <p class="modalv3-api-status-card-title">Discord Auth</p>
                            <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                            <p class="modalv3-api-status-card-status">Missing Access</p>
                        </div>
                        <div class="modalv3-api-status-card">
                            <p class="modalv3-api-status-card-title">Database</p>
                            <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                            <p class="modalv3-api-status-card-status">Missing Access</p>
                        </div>
                    `;
                } else {
                    data.forEach(apistatus => {
                        let statuscard = document.createElement("div");
    
                        statuscard.classList.add("modalv3-api-status-card");
    
                        if (apistatus.status === "Operational") {
                            statuscard.innerHTML = `
                                <p class="modalv3-api-status-card-title">${apistatus.name}</p>
                                <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#77B255" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M29.28 6.362c-1.156-.751-2.704-.422-3.458.736L14.936 23.877l-5.029-4.65c-1.014-.938-2.596-.875-3.533.138-.937 1.014-.875 2.596.139 3.533l7.209 6.666c.48.445 1.09.665 1.696.665.673 0 1.534-.282 2.099-1.139.332-.506 12.5-19.27 12.5-19.27.751-1.159.421-2.707-.737-3.458z"/><link xmlns=""/></svg>
                                <p class="modalv3-api-status-card-status">${apistatus.status}</p>
                            `;
                        } else if (apistatus.status === "Down") {
                            statuscard.innerHTML = `
                                <p class="modalv3-api-status-card-title">${apistatus.name}</p>
                                <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                                <p class="modalv3-api-status-card-status">${apistatus.status}</p>
                            `;
                        }
    
                        document.getElementById("modalv3-api-status-container").appendChild(statuscard);
    
                    });
                }
            })
            .catch(error => {
                document.getElementById("modalv3-api-status-container").innerHTML = `
                    <div class="modalv3-api-status-card">
                        <p class="modalv3-api-status-card-title">Shop</p>
                        <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                        <p class="modalv3-api-status-card-status">Down</p>
                    </div>
                    <div class="modalv3-api-status-card">
                        <p class="modalv3-api-status-card-title">Discord Auth</p>
                        <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                        <p class="modalv3-api-status-card-status">Down</p>
                    </div>
                    <div class="modalv3-api-status-card">
                        <p class="modalv3-api-status-card-title">Database</p>
                        <svg class="modalv3-status-card-img" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" width="36"  height="36" ><path fill="#b25555" d="M36 32c0 2.209-1.791 4-4 4H4c-2.209 0-4-1.791-4-4V4c0-2.209 1.791-4 4-4h28c2.209 0 4 1.791 4 4v28z"/><path fill="#FFF" d="M21.529 18.006l8.238-8.238c.977-.976.977-2.559 0-3.535-.977-.977-2.559-.977-3.535 0l-8.238 8.238-8.238-8.238c-.976-.977-2.56-.977-3.535 0-.977.976-.977 2.559 0 3.535l8.238 8.238-8.258 8.258c-.977.977-.977 2.559 0 3.535.488.488 1.128.732 1.768.732s1.28-.244 1.768-.732l8.258-8.259 8.238 8.238c.488.488 1.128.732 1.768.732s1.279-.244 1.768-.732c.977-.977.977-2.559 0-3.535l-8.24-8.237z"/><link xmlns=""/></svg>
                        <p class="modalv3-api-status-card-status">Down</p>
                    </div>
                `;
            });
        } else if (tab === "claimables_purchase") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_TITLE_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_TITLE_SUMMARY")}</p>

                    <div class="modalv3-content-card-2">
                        <p class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_OPEN_MODAL_TITLE")}</p>
                        <input autocomplete="off" type="text" class="modalv3-api-testfetch-text-input" id="modalv3-claimable-id-test" placeholder="${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_OPEN_MODAL_TITLE")}">
                    </div>

                    <button class="modalv3-content-card-button" id="modalv3-claimable-id-button">${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_OPEN_MODAL_OPEN")}</button>
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_CLAIMABLES_REWARD_CLAIM_TITLE_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_CLAIMABLES_REWARD_CLAIM_TITLE_SUMMARY")}</p>

                    <div class="modalv3-content-card-2">
                        <p class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_CLAIMABLES_REWARD_CLAIM_OPEN_MODAL_TITLE")}</p>
                        <input autocomplete="off" type="text" class="modalv3-api-testfetch-text-input" id="modalv3-claimable-reward-id-test" placeholder="${getTextString("MODAL_V3_TAB_CLAIMABLES_PURCHASE_OPEN_MODAL_TITLE")}">
                    </div>

                    <button class="modalv3-content-card-button" id="modalv3-claimable-reward-id-button">${getTextString("MODAL_V3_TAB_CLAIMABLES_REWARD_CLAIM_OPEN_MODAL_OPEN")}</button>
                </div>
            `;
            document.getElementById("modalv3-claimable-id-button").addEventListener("click", function () {
                openClaimablesPurchaseModal(document.getElementById("modalv3-claimable-id-test").value);
            });
            document.getElementById("modalv3-claimable-reward-id-button").addEventListener("click", function () {
                openClaimablesRewardClaimModal(document.getElementById("modalv3-claimable-reward-id-test").value);
            });
        } else if (tab === "local_storage") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_LOCAL_STORAGE_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_SUMMARY")}</p>

                    <div class="modalv3-localstorage-item-card">
                        <input type="text" class="modalv3-api-testfetch-text-input" id="modalv3-localstorage-add-input-key" placeholder="${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_KEY_PLACEHOLDER")}">
                        <input type="text" class="modalv3-api-testfetch-text-input" id="modalv3-localstorage-add-input-value" placeholder="${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_VALUE_PLACEHOLDER")}">
                        <button onclick="modalv3AddLocalStorage()">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_ADD")}</button>
                    </div>
                    <div id="modalv3-localstorage-output"></div>
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-header">${getTextString("MODAL_V3_TAB_STORAGE_SESSION_STORAGE_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_STORAGE_SESSION_STORAGE_SUMMARY")}</p>

                    <div class="modalv3-localstorage-item-card">
                        <input type="text" class="modalv3-api-testfetch-text-input" id="modalv3-sessionstorage-add-input-key" placeholder="${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_KEY_PLACEHOLDER")}">
                        <input type="text" class="modalv3-api-testfetch-text-input" id="modalv3-sessionstorage-add-input-value" placeholder="${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_VALUE_PLACEHOLDER")}">
                        <button onclick="modalv3AddSessionStorage()">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_ADD")}</button>
                    </div>
                    <div id="modalv3-sessionstorage-output"></div>
                </div>
            `;

            modalv3RefreshLocalStorageList()
            modalv3RefreshSessionStorageList()
        } else if (tab === "misc") {
            document.getElementById("modal-v3-tab-" + tab).classList.add("side-tabs-button-selected");
            tabPageOutput.innerHTML = `
                <h2>${getTextString("MODAL_V3_TAB_MISC_HEADER")}</h2>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_MISC_REVIEW_CONTENT_OVERRIDE_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_MISC_REVIEW_CONTENT_OVERRIDE_SUMMARY")}</p>

                    <input class="modalv3-toggle" onclick="overrideReviewTextContent();" id="override-review-text-content-checkbox" type="checkbox">
                </div>
                <div class="modalv3-content-card-2">
                    <input type="text" class="modalv3-api-testfetch-text-input" oninput="overrideRawReviewTextContent();" id="modalv3-update-review-content-override" value="${localStorage.staff_raw_review_override_content}">
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_MISC_UNPUBLISHED_XP_EVENTS_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_MISC_UNPUBLISHED_XP_EVENTS_SUMMARY")}</p>

                    <input class="modalv3-toggle" onclick="toggleStaffUnpublishedXPEvents();" id="unpublished-xp-events-checkbox" type="checkbox">
                </div>
                <hr>
                <div class="modalv3-content-card-1">
                    <h2 class="modalv3-content-card-sub-header">${getTextString("MODAL_V3_TAB_MISC_UNPUBLISHED_XP_SHOP_HEADER")}</h2>
                    <p class="modalv3-content-card-summary">${getTextString("MODAL_V3_TAB_MISC_UNPUBLISHED_XP_SHOP_SUMMARY")}</p>

                    <input class="modalv3-toggle" onclick="toggleStaffUnpublishedXPShop();" id="unpublished-xp-shop-checkbox" type="checkbox">
                </div>
            `;

            if (localStorage.staff_enable_override_review_content === "true") {
                document.getElementById("override-review-text-content-checkbox").checked = true;
            }
            if (localStorage.staff_unpublished_xp_events === "true") {
                document.getElementById("unpublished-xp-events-checkbox").checked = true;
            }
            if (localStorage.staff_unpublished_xp_shop === "true") {
                document.getElementById("unpublished-xp-shop-checkbox").checked = true;
            }
        } else {
            console.error(tab + ' is not a valid tab');
        }
    }

    window.setModalv3InnerContent = setModalv3InnerContent;


    // Misc Staff

    function toggleStaffUnpublishedXPEvents() {
        if (localStorage.staff_unpublished_xp_events === "true") {
            localStorage.staff_unpublished_xp_events = "false"
        } else {
            localStorage.staff_unpublished_xp_events = "true"
        }
    }

    function toggleStaffUnpublishedXPShop() {
        if (localStorage.staff_unpublished_xp_shop === "true") {
            localStorage.staff_unpublished_xp_shop = "false"
        } else {
            localStorage.staff_unpublished_xp_shop = "true"
        }
    }




    async function redeemXPGiftCode(giftCode) {
        if (giftCode.length != 0) {
            try {

                const userInfo = await fetch(api + REDEEM_GIFT_CODE + giftCode, {
                    headers: { Authorization: `${shop_archives_token}` }
                });
      
                if (!userInfo.ok) {
                    document.getElementById("xp-inventory-claim-code-loading").classList.add("invalid");
                    document.getElementById("xp-inventory-claim-code-loading").textContent = 'Invalid Code';
                    document.getElementById("xp-inventory-claim-code-button").disabled = false;
                    document.getElementById("xp-inventory-claim-code-button").textContent = 'Redeem';
                }
    
                const data = await userInfo.json();
    
                if (data.message === "Invalid Gift Code.") {
                    document.getElementById("xp-inventory-claim-code-loading").classList.add("invalid");
                    document.getElementById("xp-inventory-claim-code-loading").textContent = `Invalid Gift Code.`;
                    document.getElementById("xp-inventory-claim-code-button").disabled = false;
                    document.getElementById("xp-inventory-claim-code-button").textContent = 'Redeem';
                } else if (data.message) {
                    document.getElementById("xp-inventory-claim-code-loading").classList.add("invalid");
                    document.getElementById("xp-inventory-claim-code-loading").textContent = `${data.error}, ${data.message}`;
                    document.getElementById("xp-inventory-claim-code-button").disabled = false;
                    document.getElementById("xp-inventory-claim-code-button").textContent = 'Redeem';
                } else {
                    if (data.type === 0) {
                        openClaimablesRewardClaimModal(data.id, data, giftCode)
                    } else if (data.type === 1) {
                        openClaimablesPurchaseModal(data.id, data, giftCode)
                    }

                    document.getElementById("xp-inventory-claim-code-loading").textContent = ``;
                    document.getElementById("xp-inventory-claim-code-input").value = ``;
                    document.getElementById("xp-inventory-claim-code-button").disabled = false;
                    document.getElementById("xp-inventory-claim-code-button").textContent = 'Redeem';
                }
          
            } catch (error) {
                console.error(error)
            }
        } else {
            document.getElementById("xp-inventory-claim-code-loading").classList.add("invalid");
            document.getElementById("xp-inventory-claim-code-loading").textContent = `Invalid Gift Code.`;
            document.getElementById("xp-inventory-claim-code-button").disabled = false;
            document.getElementById("xp-inventory-claim-code-button").textContent = 'Redeem';
        }
    }



    async function openClaimablesPurchaseModal(claimableId, existingClaimableData, giftCode) {

        let disclaimerString = '';

        if (claimableId === "2" || claimableId === 2) {
            disclaimerString = getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_2");
        } else if (claimableId === "3" || claimableId === 3) {
            disclaimerString = getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_3");
        } else if (claimableId === "4" || claimableId === 4) {
            disclaimerString = getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_4");
        } else if (claimableId === "5" || claimableId === 5) {
            disclaimerString = getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_5");
        }

        if (!claimableId) {
            claimableId = null;
        }

        let modal = document.createElement("div");

        modal.classList.add('modalv2');

        modal.style.zIndex = '601';

        modal.innerHTML = `
            <div class="modalv2-inner claimables-purchase">
                <div data-modal-top-product-buttons>
                    <div title="Close" data-close-product-card-button>
                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                    </div>
                </div>
                <img src="https://cdn.discordapp.com/app-assets/1096190356233670716/1116154530145505300.png?size=4096"></img>
                <div class="claimable-modal-img-block">
                </div>
                <p class="title">${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_HEADER")}</p>
                <div class="claimable-modal-preview">
                    <p class="sub-header" style="opacity: 0; width: 1px;">Dummy_Text</p>
                    <p class="sub-header" style="left: 15px; top: 15px; position: absolute;" data-claimable-purchase-modal-name-preview>Loading...</p>
                    <p class="sub-header" style="right: 15px; top: 15px; position: absolute;" data-claimable-purchase-modal-price-preview></p>
                </div>
                <div class="claimable-modal-preview">
                    <p class="sub-header" data-claimable-purchase-your-xp>You have ... XP</p>
                </div>

                <p class="sub-text-bold">${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_1")}</p>
                <p class="sub-text">${disclaimerString}</p>

                <div class="report-review-bottom">
                    <p class="shop-category-modal-report-review-error-output" id="shop-claim-item-modal-error-output" data-shop-claim-item-modal-error-output></p>
                    <button class="modalv3-content-card-button purchase-button" style="display: nonel" data-claimable-purchase-button>Claim for ... XP</button>
                </div>
            </div>
        `;

        if (!myXPBalancecache) {
            try {

                const userInfo = await fetch(api + XP_BALANCE, {
                    headers: { Authorization: `${shop_archives_token}` }
                });
      
                if (!userInfo.ok) {
                    
                }

                const xpBalance = await userInfo.json();

                if (xpBalance.message) {
                    
                } else {
                    myXPBalancecache = xpBalance;
                    rendermyXPBalanceModal(xpBalance);
                }
          
            } catch (error) {
                console.error(error)
            }
        } else {
            rendermyXPBalanceModal(myXPBalancecache)
        }

        function rendermyXPBalanceModal(data) {
            modal.querySelector("[data-claimable-purchase-your-xp]").textContent = `You have ${data.xp_balance.toLocaleString()} XP`;
        }

        if (existingClaimableData) {
            renderModalContent(existingClaimableData);
        } else {
            fetch(api + '/claimables/published/' + claimableId, {
                method: "GET",
                headers: {
                    "Authorization": shop_archives_token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    modal.classList.remove('show');
                    modal_back.classList.remove('show');
                    setTimeout(() => {
                        modal.remove();
                        modal_back.remove();
                    }, 300);
                } else {
                    renderModalContent(data);
                }
            })
            .catch(error => {
                console.error(error);
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            });
        }

        function renderModalContent(data) {
            modal.querySelector("[data-claimable-purchase-modal-name-preview]").textContent = data.name;
            modal.querySelector("[data-claimable-purchase-modal-price-preview]").textContent = data.xp_price.toLocaleString() + ' XP';
            modal.querySelector("[data-claimable-purchase-button]").textContent = `Claim for ${data.xp_price.toLocaleString()} XP`;
            modal.querySelector("[data-claimable-purchase-button]").style.display = 'unset';

            if (myXPBalancecache.xp_balance < data.xp_price) {
                modal.querySelector("[data-claimable-purchase-button]").disabled = true;
                modal.querySelector("[data-shop-claim-item-modal-error-output]").textContent = getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_MODAL_NOT_ENOUGH_ERROR");
            }
            modal.querySelector("[data-claimable-purchase-button]").addEventListener('click', () => {
                modal.querySelector("[data-claimable-purchase-button]").disabled = true;
                modal.querySelector("[data-claimable-purchase-button]").textContent = `...`;
                claimPerkWithXP(data.id, modal, modal_back, giftCode)
            });
        }

        document.body.appendChild(modal);

        setTimeout(() => {
            modal.classList.add('show');
        }, 1);

        let modal_back = document.createElement("div");

        modal_back.classList.add('modalv2-back');
        modal_back.id = 'modalv2-back';

        modal_back.style.zIndex = '600';

        document.body.appendChild(modal_back);

        setTimeout(() => {
            modal_back.classList.add('show');
        }, 1);

        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            }
        });

        modal.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
            modal.classList.remove('show');
            modal_back.classList.remove('show');
            setTimeout(() => {
                modal.remove();
                modal_back.remove();
            }, 300);
        });
    }

    async function claimPerkWithXP(perkId, modal, modal_back, giftCode) {
        document.getElementById("shop-claim-item-modal-error-output").textContent = '';

        if (!giftCode) {
            giftCode = null;
        }

        try {

            const userInfo = await fetch(api + '/claimables/purchase/' + perkId, {
                method: "POST",
                headers: {
                    Authorization: `${shop_archives_token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    giftCode
                })
            });
  
            if (!userInfo.ok) {
                
            }

            const purchase = await userInfo.json();

            if (purchase.message) {
                document.getElementById("shop-claim-item-modal-error-output").textContent = purchase.message;
            } else {
                await updateXPBalance();
                await updateClaimablesClaimed();
                await updatePerksShop();

                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            }
      
        } catch (error) {
            console.error(error)
            document.getElementById("shop-claim-item-modal-error-output").textContent = error;
        }
    }


    async function openClaimablesRewardClaimModal(claimableId, existingClaimableData, giftCode) {

        if (!claimableId) {
            claimableId = null;
        }

        let modal = document.createElement("div");

        modal.classList.add('modalv2');

        modal.style.zIndex = '601';

        modal.innerHTML = `
            <div class="modalv2-inner claimables-reward">
                <div data-modal-top-product-buttons>
                    <div title="Close" data-close-product-card-button>
                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                    </div>
                </div>
                <img src="https://cdn.discordapp.com/app-assets/1096190356233670716/1116154530145505300.png?size=4096"></img>
                <div class="claimable-reward-modal-img-block">
                </div>
                <p class="big-text" data-claimable-purchase-modal-price-preview2>... XP</p>
                <p class="title">${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_REWARD_MODAL_HEADER")}</p>
                <p class="sub-header" data-claimable-purchase-modal-price-preview>${getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_REWARD_MODAL_SUMMARY")} ... XP</p>
                <a class="link" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: white;" href="https://support.yapper.shop/#page=3">Learn More about XP</a>

                <div class="report-review-bottom">
                    <p class="shop-category-modal-report-review-error-output" id="shop-claim-item-modal-error-output" data-shop-claim-item-modal-error-output></p>
                    <button class="modalv3-content-card-button select-button" style="display: nonel" data-claimable-purchase-button>Claim ... XP</button>
                </div>
            </div>
        `;

        if (existingClaimableData) {
            renderModalContent(existingClaimableData);
        } else {
            fetch(api + '/claimables/published/' + claimableId, {
                method: "GET",
                headers: {
                    "Authorization": shop_archives_token
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    modal.classList.remove('show');
                    modal_back.classList.remove('show');
                    setTimeout(() => {
                        modal.remove();
                        modal_back.remove();
                    }, 300);
                } else {
                    renderModalContent(data)
                }
            })
            .catch(error => {
                console.error(error);
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            });
        }

        function renderModalContent(data) {
            modal.querySelector("[data-claimable-purchase-modal-price-preview]").textContent = getTextString("MODAL_V3_TAB_XP_SHOP_CLAIM_REWARD_MODAL_SUMMARY") + data.xp_reward.toLocaleString() + ' XP';
            modal.querySelector("[data-claimable-purchase-modal-price-preview2]").textContent = data.xp_reward.toLocaleString() + ' XP';
            modal.querySelector("[data-claimable-purchase-button]").textContent = `Claim ${data.xp_reward.toLocaleString()} XP`;
            modal.querySelector("[data-claimable-purchase-button]").style.display = 'unset';

            modal.querySelector("[data-claimable-purchase-button]").addEventListener('click', () => {
                modal.querySelector("[data-claimable-purchase-button]").disabled = true;
                modal.querySelector("[data-claimable-purchase-button]").textContent = `...`;
                claimFreeXPReward(data.id, modal, modal_back, giftCode)
            });
        }

        document.body.appendChild(modal);

        setTimeout(() => {
            modal.classList.add('show');
        }, 1);

        let modal_back = document.createElement("div");

        modal_back.classList.add('modalv2-back');
        modal_back.id = 'modalv2-back';

        modal_back.style.zIndex = '600';

        document.body.appendChild(modal_back);

        setTimeout(() => {
            modal_back.classList.add('show');
        }, 1);

        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            }
        });

        modal.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
            modal.classList.remove('show');
            modal_back.classList.remove('show');
            setTimeout(() => {
                modal.remove();
                modal_back.remove();
            }, 300);
        });
    }

    window.openClaimablesRewardClaimModal = openClaimablesRewardClaimModal;

    async function claimFreeXPReward(perkId, modal, modal_back, giftCode) {
        document.getElementById("shop-claim-item-modal-error-output").textContent = '';

        if (!giftCode) {
            giftCode = null;
        }

        try {

            const userInfo = await fetch(api + '/claim-free-xp-reward/' + perkId, {
                method: "POST",
                headers: {
                    Authorization: `${shop_archives_token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    giftCode
                })
            });
  
            if (!userInfo.ok) {
                
            }

            const purchase = await userInfo.json();

            if (purchase.message) {
                document.getElementById("shop-claim-item-modal-error-output").textContent = purchase.message;
            } else {
                await updateXPBalance();
                await updateClaimablesClaimed();
                await updatePerksShop();
                await updateClaimablesPromotions();

                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            }
      
        } catch (error) {
            console.error(error)
            document.getElementById("shop-claim-item-modal-error-output").textContent = error;
        }
    }
    

    async function updateXPBalance() {
        try {

            const userInfo = await fetch(api + XP_BALANCE, {
                headers: { Authorization: `${shop_archives_token}` }
            });
  
            if (!userInfo.ok) {
            }

            const data = await userInfo.json();

            if (data.message) {
                
            } else {
                myXPBalancecache = data;
                if (document.getElementById("modalv3-xp-balance-text")) {
                    document.getElementById("modalv3-xp-balance-text").textContent = data.xp_balance.toLocaleString();
                }
            }
      
        } catch (error) {
            console.error(error)
        }
    }

    async function updatePerksShop() {
        try {

            url = api + CLAIMABLES_SHOP;
            fetchUrl = new URL(url);
            if (localStorage.staff_unpublished_xp_shop == "true") {
                fetchUrl.searchParams.append("include-unpublished", "true");
            }

            const userInfo = await fetch(fetchUrl, {
                headers: { Authorization: `${shop_archives_token}` }
            });
  
            if (!userInfo.ok) {
            }

            const data = await userInfo.json();

            if (data.message) {
                
            } else {
                claimablesShopcache = data;
                try {
                    renderXPShop(data);
                } catch (error) {
                }
            }
      
        } catch (error) {
            console.error(error)
        }
    }

    async function updateClaimablesClaimed() {
        try {

            const userInfo = await fetch(api + CLAIMABLES_CLAIMED, {
                headers: { Authorization: `${shop_archives_token}` }
            });
  
            if (!userInfo.ok) {
            }

            const data = await userInfo.json();

            if (data.message) {
                
            } else {
                myClaimablesClaimedCache = data;
                try {
                    fetchXpInventory();
                } catch (error) {
                }
            }
      
        } catch (error) {
            console.error(error)
        }
    }

    async function updateClaimablesPromotions() {
        try {

            url = api + CLAIMABLES_PROMOTIONS;
            fetchUrl = new URL(url);
            if (localStorage.staff_unpublished_xp_events == "true") {
                fetchUrl.searchParams.append("include-unpublished", "true");
            }

            const userInfo = await fetch(fetchUrl, {
                headers: { Authorization: `${shop_archives_token}` }
            });
  
            if (!userInfo.ok) {
            }

            const data = await userInfo.json();

            if (data.message) {
                
            } else {
                claimablesPromotionsCache = data;
                try {
                    fillCategoryModalContentContainer('xp_rewards', null, true);
                } catch (error) {
                }
                try {
                    fetchXpEvents();
                } catch (error) {
                }
            }
      
        } catch (error) {
            console.error(error)
        }
    }


    function updateExtendedStylesCategoryTab(setFilter) {
        const el1 = document.getElementById("modalv3-extended-styles-category-tab-1");
        const el2 = document.getElementById("modalv3-extended-styles-category-tab-2");
        const el3 = document.getElementById("modalv3-extended-styles-category-tab-3");

        if (el1 && el1.classList.contains('selected')) {
            el1.classList.remove('selected');
        } else if (el2 && el2.classList.contains('selected')) {
            el2.classList.remove('selected');
        } else if (el3 && el3.classList.contains('selected')) {
            el3.classList.remove('selected');
        }

        if (setFilter) {
            localStorage.ext_sty_category_tab = setFilter;
            document.getElementById("modalv3-extended-styles-category-tab-" + setFilter).classList.add('selected');
        } else {
            document.getElementById("modalv3-extended-styles-category-tab-" + localStorage.ext_sty_category_tab).classList.add('selected');
        }
    }

    function updateReviewsFilterStore(setFilter) {
        const el3 = document.getElementById("modalv3-ratio-card-reviews-filter-3");
        const el2 = document.getElementById("modalv3-ratio-card-reviews-filter-2");
        const el1 = document.getElementById("modalv3-ratio-card-reviews-filter-1");

        if (el3 && el3.classList.contains('modalv3-content-ratio-card-selected')) {
            el3.classList.remove('modalv3-content-ratio-card-selected');
        } else if (el2 && el2.classList.contains('modalv3-content-ratio-card-selected')) {
            el2.classList.remove('modalv3-content-ratio-card-selected');
        } else if (el1 && el1.classList.contains('modalv3-content-ratio-card-selected')) {
            el1.classList.remove('modalv3-content-ratio-card-selected');
        }

        if (setFilter) {
            localStorage.reviews_filter_type = setFilter;
            document.getElementById("modalv3-ratio-card-reviews-filter-" + setFilter).classList.add('modalv3-content-ratio-card-selected');
        } else {
            document.getElementById("modalv3-ratio-card-reviews-filter-" + localStorage.reviews_filter_type).classList.add('modalv3-content-ratio-card-selected');
        }
    }

    function updateReviewsTimeFormatStore(setTimeFormat) {
        const el2 = document.getElementById("modalv3-ratio-card-reviews-time-us");
        const el1 = document.getElementById("modalv3-ratio-card-reviews-time-uk");

        if (el2 && el2.classList.contains('modalv3-content-ratio-card-selected')) {
            el2.classList.remove('modalv3-content-ratio-card-selected');
        } else if (el1 && el1.classList.contains('modalv3-content-ratio-card-selected')) {
            el1.classList.remove('modalv3-content-ratio-card-selected');
        }

        if (setTimeFormat) {
            localStorage.reviews_time_type = setTimeFormat;
            document.getElementById("modalv3-ratio-card-reviews-time-" + setTimeFormat).classList.add('modalv3-content-ratio-card-selected');
        } else {
            document.getElementById("modalv3-ratio-card-reviews-time-" + localStorage.reviews_time_type).classList.add('modalv3-content-ratio-card-selected');
        }
    }

    let userReviewsWarnsCache = null;

    async function updateAndCacheReviewsWarnings() {
        let warningsRaw = null;
        if (userReviewsWarnsCache === null) {
            warningsRaw = await fetch(api + REVIEWSAPI + "/users/" + localStorage.discord_user_id + "/warns", {
                headers: { Authorization: `${localStorage.discord_token}`, Token: sessionStorage.getItem("api-token") }
            });

            const warnings = await warningsRaw.json();

            console.log(warnings)
            userReviewsWarnsCache = warnings;
        }

        if (document.getElementById("modalv3-warnings-warns-output-container")) {
            if (Array.isArray(userReviewsWarnsCache) && userReviewsWarnsCache.length === 0) {

            } else {
                userReviewsWarnsCache.forEach(warn => {
                    let warningCard = document.createElement("div");

                    let formatted = null;

                    if (localStorage.reviews_time_type === "uk") {
                        const date = new Date(warn.created_at);

                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth is 0-indexed
                        const year = date.getFullYear();

                        formatted = `${day}/${month}/${year}`;
                    } else {
                        const date = new Date(warn.created_at);

                        const day = String(date.getDate()).padStart(2, '0');
                        const month = String(date.getMonth() + 1).padStart(2, '0'); // getMonth is 0-indexed
                        const year = date.getFullYear();

                        formatted = `${day}/${month}/${year}`;
                    }

    
                    warningCard.classList.add('review-element-warning');
                    warningCard.style.paddingLeft = '10px';
                    warningCard.innerHTML = `
                        <h2 style="margin: 0;">Warning!</h2>
                        <p class="shop-modal-review-review-text">At: ${formatted}</p>
                        <p class="shop-modal-review-review-text">Reason: ${warn.message}</p>
                    `;
    
                    document.getElementById("modalv3-warnings-warns-output-container").appendChild(warningCard);
                })
            }
        }
    }


    function modalv3RefreshLocalStorageList() {
        const container = document.getElementById('modalv3-localstorage-output');
        container.innerHTML = '';
  
        const keys = Object.keys(localStorage).sort();
  
        if (keys.length === 0) {
            container.innerHTML = '<p>No items in localStorage.</p>';
            return;
        }
  
        keys.forEach(key => {
            const value = localStorage.getItem(key);
  
            const div = document.createElement('div');
            div.className = 'modalv3-localstorage-item-card';
  
            div.innerHTML = `
                <input type="text" class="modalv3-api-testfetch-text-input" value="${key}" disabled>
                <input type="text" class="modalv3-api-testfetch-text-input" id="value-local-${key}" value="${value}">
                <button onclick="modalv3UpdateLocalStorage('${key}')">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_UPDATE")}</button>
                <button onclick="modalv3DeleteLocalStorage('${key}')">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_DELETE")}</button>
            `;
  
            container.appendChild(div);
        });
    }

    function modalv3AddLocalStorage() {
        const key = document.getElementById('modalv3-localstorage-add-input-key').value.trim();
        const value = document.getElementById('modalv3-localstorage-add-input-value').value;
  
        if (!key) {
            alert("Key cannot be empty.");
            return;
        }
  
        localStorage.setItem(key, value);
        document.getElementById('modalv3-localstorage-add-input-key').value = '';
        document.getElementById('modalv3-localstorage-add-input-value').value = '';
        modalv3RefreshLocalStorageList();
    }

    function modalv3UpdateLocalStorage(key) {
        const newValue = document.getElementById(`value-local-${key}`).value;
        localStorage.setItem(key, newValue);
        modalv3RefreshLocalStorageList();
    }

    function modalv3DeleteLocalStorage(key) {
        if (confirm(`Delete key "${key}"?`)) {
            localStorage.removeItem(key);
            modalv3RefreshLocalStorageList();
        }
    }


    function modalv3RefreshSessionStorageList() {
        const container = document.getElementById('modalv3-sessionstorage-output');
        container.innerHTML = '';
  
        const keys = Object.keys(sessionStorage).sort();
  
        if (keys.length === 0) {
            container.innerHTML = '<p>No items in sessionStorage.</p>';
            return;
        }
  
        keys.forEach(key => {
            const value = sessionStorage.getItem(key);
  
            const div = document.createElement('div');
            div.className = 'modalv3-localstorage-item-card';
  
            div.innerHTML = `
                <input type="text" class="modalv3-api-testfetch-text-input" value="${key}" disabled>
                <input type="text" class="modalv3-api-testfetch-text-input" id="value-session-${key}" value="${value}">
                <button onclick="modalv3UpdateSessionStorage('${key}')">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_UPDATE")}</button>
                <button onclick="modalv3DeleteSessionStorage('${key}')">${getTextString("MODAL_V3_TAB_STORAGE_LOCAL_STORAGE_DELETE")}</button>
            `;
  
            container.appendChild(div);
        });
    }

    function modalv3AddSessionStorage() {
        const key = document.getElementById('modalv3-sessionstorage-add-input-key').value.trim();
        const value = document.getElementById('modalv3-sessionstorage-add-input-value').value;
  
        if (!key) {
            alert("Key cannot be empty.");
            return;
        }
  
        sessionStorage.setItem(key, value);
        document.getElementById('modalv3-sessionstorage-add-input-key').value = '';
        document.getElementById('modalv3-sessionstorage-add-input-value').value = '';
        modalv3RefreshSessionStorageList();
    }

    function modalv3UpdateSessionStorage(key) {
        const newValue = document.getElementById(`value-session-${key}`).value;
        sessionStorage.setItem(key, newValue);
        modalv3RefreshSessionStorageList();
    }

    function modalv3DeleteSessionStorage(key) {
        if (confirm(`Delete key "${key}"?`)) {
            sessionStorage.removeItem(key);
            modalv3RefreshSessionStorageList();
        }
    }



    function adminDeleteReview(reviewId) {

        const accessToken = discord_token;
      
        fetch(api + REVIEWSAPI, {
            method: "DELETE",
            headers: {
                "Content-Type": "application/json",
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            },
            body: JSON.stringify({
                accessToken,
                reviewId
            })
        })
        .catch(error => {
            console.error(error)
        });

        if (document.getElementById(reviewId + "-review-admin-card")) {
            document.getElementById(reviewId + "-review-admin-card").remove();
        }
    }

    function modalv3AddTestFetchParam() {
        const key = document.getElementById("modalv3-test-fetch-search-params-key").value;
        const value = document.getElementById('modalv3-test-fetch-search-params-value').value;
  
        const container = document.getElementById('modalv3-test-fetch-params-output');
        const div = document.createElement('div');
        div.className = 'modalv3-api-testfetch-param-card';
        div.innerHTML = `
            <input type="text" class="modalv3-api-testfetch-text-input test-fetch-param-key hidden" value="${key}" disabled>
            <input type="text" class="modalv3-api-testfetch-text-input test-fetch-param-value hidden" value="${value}" disabled>
            <p>&${key}=${value}</p>
            <button class="modalv3-testfetch-button-1" onclick="this.parentElement.remove()">Delete</button>
        `;
        container.appendChild(div);

        document.getElementById('modalv3-test-fetch-search-params-value').value = '';
    }

    function fetchAPITestFetch() {
        const baseurl = document.getElementById("modalv3-test-fetch-base-url").value;
        const versionid = document.getElementById("modalv3-test-fetch-version").value;
        const endpoint = document.getElementById("modalv3-test-fetch-endpoint").value;
        const output = document.getElementById("modalv3-test-fetch-output");

        url = baseurl + "/" + versionid + endpoint;
        testFetchURL = new URL(url);

        const keyInputs = document.querySelectorAll('.test-fetch-param-key');
        const valueInputs = document.querySelectorAll('.test-fetch-param-value');

        const params = new URLSearchParams();
        for (let i = 0; i < keyInputs.length; i++) {
            const key = keyInputs[i].value.trim();
            const value = valueInputs[i].value.trim();
            if (key) params.append(key, value);
        }

        const finalUrl = `${testFetchURL}?${params.toString()}`;

        fetch(finalUrl, {
            method: "GET",
            headers: {
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            }
        })
        .then(response => response.json())
        .then((data) => {
            console.log(data);
            output.textContent = JSON.stringify(data, undefined, 4);
        })
        .catch(error => {
            console.log(`Failed to test fetch: `, error);
        });
    }

    function disabledExperimentForceRolloutV2() {
        if (localStorage.experiment_force_rollout === "false") {
            localStorage.experiment_force_rollout = "true"
        } else {
            localStorage.experiment_force_rollout = "false"
        }
    }

    function overrideReviewTextContent() {
        if (localStorage.staff_enable_override_review_content === "true") {
            localStorage.staff_enable_override_review_content = "false"
        } else {
            localStorage.staff_enable_override_review_content = "true"
        }
    }

    function overrideRawReviewTextContent() {
        localStorage.staff_raw_review_override_content = document.getElementById("modalv3-update-review-content-override").value;
    }

    function updateThemeStore(theme, hasButtons, raw) {
        localStorage.sa_theme = theme;
        localStorage.removeItem('community_theme_raw');
        if (hasButtons === "true") {
            try {
                if (document.querySelector(".theme-selection-box-selected")) {
                    document.querySelectorAll('.theme-selection-box-selected').forEach((el) => {
                        el.classList.remove("theme-selection-box-selected");
                    });
                }
                document.body.removeAttribute("class");
            } catch (error) {
            }
            if (document.getElementById("theme-" + theme + "-button")) {
                document.getElementById("theme-" + theme + "-button").classList.add('theme-selection-box-selected');
            }
        }
        document.body.classList.add('theme-' + theme);
        if (raw != null) {
            localStorage.community_theme_raw = raw;
            fetch(raw, {
                method: "GET"
            })
            .then(response => response.text())
            .then((data) => {

                document.getElementById("community-theme-import").innerHTML = `${data}`;

            })
            .catch(error => {
                console.error(error)
            });

            if (document.getElementById("theme-" + theme + "-button")) {
                document.getElementById("theme-" + theme + "-button").classList.add('theme-selection-box-selected');
            }
        } else {
            document.getElementById("community-theme-import").innerHTML = ``;
        }
    }

    function updateThemeToCommunity() {
        if (localStorage.community_theme_raw) {
            fetch(localStorage.community_theme_raw, {
                method: "GET"
            })
            .then(response => response.text())
            .then((data) => {
                document.getElementById("community-theme-import").innerHTML = `${data}`;
            })
            .catch(error => {
                console.error(error)
            });
        }
    }

    updateThemeToCommunity();

    function optionsSidebarToggle() {
        if (document.getElementById('options-sidebar-container').classList.contains('options-sidebar-container-expanded')) {
            document.getElementById('options-sidebar-container').classList.remove("options-sidebar-container-expanded");
        } else {
            document.getElementById('options-sidebar-container').classList.add("options-sidebar-container-expanded");
            document.getElementById('options-sidebar-container').innerHTML = `
                <h1 class="center-text" style="font-size: 30px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_TITLE")}</h1>
                <div class="options-option-card-holder">

                    <div id="old-options-container-dev">
                        <div id="currency-picker-container-dev">
                            <div class="options-option-card">
                                <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_SIDEBAR_CURRENCY_PICKER")}</p>
                                <select id="currency_picker_container" class="options-dropdown" title="${getTextString("OPTIONS_SIDEBAR_CURRENCY_PICKER_MORE")}" disabled>
                                </select>
                            </div>
                        </div>

                        <div class="options-option-card" id="reduced-motion-box-option">
                            <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_SIDEBAR_REDUCED_MOTION")}</p>
                            <input class="options-toggle-box" onclick="reducedMotionChecked();" style="cursor: pointer; scale: 2; posision: center;" id="reduced-motion-box" type="checkbox">
                        </div>

                        <div class="options-option-card" id="disable-banner-overrides-box-option">
                            <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_SIDEBAR_REDUCED_MOTION_BANNERS")}</p>
                            <input class="options-toggle-box" onclick="disableBannerOverridesChecked();" style="cursor: pointer; scale: 2; posision: center;" id="disable-banner-overrides-box" type="checkbox">
                        </div>
                    </div>

                    <div class="username-picker-container" id="username-picker-container-dev"></div>

                </div>
                <div id="theme-picker-container"></div>
                <div id="accessibility-options-container"></div>
                <h1 class="center-text" style="font-size: 30px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_DOWNLOADS")}</h1>
                <div>
                    <div class="experiment-card-holder" style="width: 300px; margin-left: auto; margin-right: auto;">
                    <template id="downloadables-api-template">
                        <div class="item experiment-card">
                            <p class="name"></p>
                            <p class="summary experiment-subtext"></p>
                            <div class="downloadables"></div>
                        </div>
                    </template>
                    <div class="experiment-card-holder" id="downloadables-output"></div>
                </div>
                <p class="center-text" style="font-size: 30px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_YAPPER_HELP")}</p>
                <div class="experiment-card-holder" id="yapper-article-container" style="width: 300px; margin-left: auto; margin-right: auto;">
                    <button class="card-button" onclick="window.open('https://discord.gg/SVKQEYeTsN');">${getTextString("OPTIONS_SIDEBAR_YAPPER_DISCORD_SERVER")}</button>
                    <button class="card-button" onclick="window.open('https://github.com/Yappering/');">${getTextString("OPTIONS_SIDEBAR_YAPPER_GITHUB")}</button>
                </div>
                ${getTextString("APP_VERSION")}${tcbx926n29}
            `;

            if (app_version2 === "Stable") {
                let betatester = document.createElement("div");

                betatester.innerHTML = `
                    <button class="card-button" onclick="window.open('https://dev.yapper.shop?page=home');">${getTextString("OPTIONS_SIDEBAR_YAPPER_BETA_TESTING")}</button>
                `;
                                    
                document.getElementById("yapper-article-container").appendChild(betatester);
            }

            if (localStorage.experiment_2025_02_extra_options === "Treatment 4: Enabled" || localStorage.experiment_2025_02_extra_options === "Treatment 5: Enabled w/o currency picker" || localStorage.experiment_2025_02_extra_options === "Treatment 6: Settings like discord") {
                document.getElementById("username-picker-container-dev").innerHTML = `
                    <p class="center-text" style="font-size: 20px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE")}</p>
                    <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DESC")}</p>
                    <div class="experiment-card-holder" id="discord-integration-options-container" style="width: 300px; margin-left: auto; margin-right: auto;"></div>
                    <div id="profile-change-settings">
                        <div id="options-profile-nono-change-container"></div>
                        <div id="profile-settings-edit">
                            <div class="options-option-card" id="options-text-input-option">
                                <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_CHANGE_USERNAME")}</p>
                                <input class="options-text-input" autocomplete="off" oninput="changeUsernameFromInput();" style="posision: center;" id="profile-username-text-input" value="${localStorage.discord_displayname}" type="text">
                            </div>
                            <div class="options-option-card" id="options-text-input-option">
                                <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_CHANGE_BANNER_COLOR")}</p>
                                <input class="options-color-input" autocomplete="off" oninput="changeBannerColorFromInput();" style="posision: center;" id="profile-banner-color-input" value="${localStorage.discord_banner_color}" type="color">
                            </div>
                            <div class="options-option-card" id="options-img-input-option">
                                <label for="profileAvatarInput" class="profile-avatar-upload-label">${getTextString("OPTIONS_EXTRA_PROFILE_CHANGE_AVATAR")}</label>
                                <input type="file" id="profileAvatarInput" class="profile-avatar-file-input" accept="image/*">
                                <button id="removeProfileAvatarButton" class="profile-avatar-remove-button">${getTextString("OPTIONS_EXTRA_PROFILE_REMOVE_AVATAR")}</button>
                            </div>
                            <div id="options-avatar-img-input-option-error"></div>
                            <div class="options-option-card" id="options-img-input-option">
                                <label for="profileBannerInput" class="profile-avatar-upload-label">${getTextString("OPTIONS_EXTRA_PROFILE_CHANGE_BANNER")}</label>
                                <input type="file" id="profileBannerInput" class="profile-avatar-file-input" accept="image/*">
                                <button id="removeProfileBannerButton" class="profile-avatar-remove-button">${getTextString("OPTIONS_EXTRA_PROFILE_REMOVE_BANNER")}</button>
                            </div>
                            <div id="options-banner-img-input-option-error"></div>
                        </div>
                        <div class="options-preview-profile">
                            <div class="options-preview-profile-banner-color" id="options-preview-profile-banner-color" style="background-color: ${localStorage.discord_banner_color};"></div>
                            <div id="profileBannerPreview" class="options-preview-profile-banner" style="background-image: url(${localStorage.discord_banner});"></div>
                            <div class="profile-avatar-preview-bg"></div>
                            <img id="profileAvatarPreview" class="profile-avatar-preview" src="${localStorage.discord_avatar}" alt="No image uploaded">
                            <div class="options-preview-profile-status-bg"></div>
                            <div class="options-preview-profile-status-color"></div>
                            <p class="options-preview-profile-displayname" id="options-preview-profile-displayname">${localStorage.discord_displayname}</p>
                            <p class="options-preview-profile-username" id="options-username-preview"></p>
                        </div>
                        <div id="options-profile-nameplate-preview-container"></div>
                    </div>
                `;

                if (localStorage.experiment_2025_04_discord_sign_in === "Treatment 3: Force Logged In" || localStorage.experiment_2025_04_discord_sign_in === "Treatment 1: Dynamic" && localStorage.getItem('discord_token')) {
                    let cantChangeProfileWhenLoggedIn = document.createElement("div");

                    cantChangeProfileWhenLoggedIn.classList.add('cant-change-profile-when-logged-in-container');
                    cantChangeProfileWhenLoggedIn.innerHTML = `
                        <div class="profile-no-text-container">
                            <img style="width: 150px;" src="https://cdn.yapper.shop/assets/177.png">
                            <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: white;">${getTextString("OPTIONS_EXTRA_PROFILE_ERROR_1")}</p>
                            <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: white;">${getTextString("OPTIONS_EXTRA_PROFILE_ERROR_2")}</p>
                            <button class="discord-profile-logout-button" onclick="logoutOfDiscord()">${getTextString("OPTIONS_EXTRA_PROFILE_ERROR_BUTTON")}</button>
                            <button class="discord-profile-logout-button" onclick="updateDiscordProfilePlaceholder()">${getTextString("OPTIONS_EXTRA_PROFILE_RESYNC")}</button>
                        </div>
                    `;


                    document.getElementById("profile-change-settings").appendChild(cantChangeProfileWhenLoggedIn);

                    document.getElementById("discord-integration-options-container").innerHTML = `
                        <div id="discord-sign-in-title-container"></div>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGGED_IN_AS")}${localStorage.discord_displayname} (${localStorage.discord_username})</p>
                        <button class="card-button" onclick="logoutOfDiscord()">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGOUT")}</button>
                    `;
                    if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen" && localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1") {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                            <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                        `;
                    } else {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                        `;
                    }
                } else if (localStorage.experiment_2025_04_discord_sign_in === "Treatment 1: Dynamic" || localStorage.experiment_2025_04_discord_sign_in === "Treatment 2: Force Logged Out") {
                    document.getElementById("discord-integration-options-container").innerHTML = `
                        <div id="discord-sign-in-title-container"></div>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_SUMMARY")}</p>
                        <button class="card-button" onclick="loginToDiscord()">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGIN")}</button>
                    `;
                    if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen" && localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1") {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                            <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                        `;
                    } else {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                        `;
                    }
                }

                if (localStorage.experiment_2025_04_discord_sign_in === "Treatment 6: Force Logged In v2" || localStorage.experiment_2025_04_discord_sign_in === "Treatment 4: Dynamic v2" && localStorage.getItem('discord_token')) {

                    document.getElementById("options-profile-nono-change-container").innerHTML = `
                        <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_ERROR_1")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_ERROR_2")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_ERROR_3")}</p>
                    `;

                    document.getElementById("profile-settings-edit").style.display = 'none';

                    document.getElementById("discord-integration-options-container").innerHTML = `
                        <div id="discord-sign-in-title-container"></div>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGGED_IN_AS")}${localStorage.discord_displayname} (${localStorage.discord_username})</p>
                        <div class="card-multi-button-container">
                            <button class="card-button" onclick="updateDiscordProfilePlaceholder()">${getTextString("OPTIONS_EXTRA_PROFILE_RESYNC")}</button>
                            <button class="card-button" onclick="logoutOfDiscord()">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGOUT")}</button>
                        </div>
                    `;
                    if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen" && localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1") {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                            <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                        `;
                    } else {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                        `;
                    }
                } else if (localStorage.experiment_2025_04_discord_sign_in === "Treatment 4: Dynamic v2") {
                    document.getElementById("discord-integration-options-container").innerHTML = `
                        <div id="discord-sign-in-title-container"></div>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_SUMMARY")}</p>
                        <button class="card-button" onclick="loginToDiscord()">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGIN")}</button>
                    `;
                    if (localStorage.dismissible_newLogInWithDiscord != "Treatment 1: Seen" && localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1") {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                            <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                        `;
                    } else {
                        document.getElementById('discord-sign-in-title-container').innerHTML = `
                            <p class="center-text" style="font-size: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD")}</p>
                        `;
                    }
                }

                
                
                document.getElementById("accessibility-options-container").innerHTML = `
                    <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_ACCESSIBILITY")}</p>
                    <div id="currency-picker-experiment-container"></div>
                    <div class="options-option-card" id="reduced-motion-box-option">
                        <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_SIDEBAR_REDUCED_MOTION")}</p>
                        <input class="options-toggle-box" onclick="reducedMotionChecked();" style="cursor: pointer; scale: 2; posision: center;" id="reduced-motion-box" type="checkbox">
                    </div>
                `; 
                document.getElementById("old-options-container-dev").innerHTML = ``;

                document.getElementById("options-username-preview").textContent = localStorage.discord_username.toLowerCase();

                // if (localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker") {
                //     document.getElementById("currency-picker-experiment-container").innerHTML = `
                //         <div class="options-option-card" id="has-nitro-box-option">
                //             <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_SIDEBAR_NITRO_DISCOUNT")}</p>
                //             <input class="options-toggle-box" onclick="optionsHasNitroChecked();" style="cursor: pointer; scale: 2; posision: center;" id="options-has-nitro-box" type="checkbox">
                //         </div>
                //     `;
                //     <div class="options-option-card">
                //         <p class="option-card-title" style="color: var(--white);">Currency</p>
                //         <select id="currency_picker_container" class="options-dropdown">
                //         </select>
                //     </div>
                // }


                const avatarImageInput = document.getElementById("profileAvatarInput");
                const avatarImagePreview = document.getElementById("profileAvatarPreview");
                const removeAvatarImageButton = document.getElementById("removeProfileAvatarButton");

                // Load saved image from localStorage on page load
                document.addEventListener("DOMContentLoaded", () => {
                    const savedImage = localStorage.getItem("discord_avatar");
                    if (savedImage) {
                        avatarImagePreview.src = savedImage;
                    }
                });

                // Handle image upload
                avatarImageInput.addEventListener("change", function () {
                    document.getElementById("options-avatar-img-input-option-error").classList.remove('options-img-input-option-error')
                    document.getElementById("options-avatar-img-input-option-error").innerHTML = ``;
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (event) {
                            const dataUrl = event.target.result;
                            try {
                                localStorage.setItem("discord_avatar", dataUrl);
                                avatarImagePreview.src = dataUrl;
                            } catch(error) {
                                document.getElementById("options-avatar-img-input-option-error").classList.add('options-img-input-option-error')
                                document.getElementById("options-avatar-img-input-option-error").innerHTML = `
                                    <p>${getTextString("OPTIONS_EXTRA_PROFILE_FILE_TOO_BIG")}</p>
                                `;
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Handle image removal
                removeAvatarImageButton.addEventListener("click", function () {
                    setRandomDiscordAvatar()
                    avatarImagePreview.src = localStorage.discord_avatar;
                });


                const bannerImageInput = document.getElementById("profileBannerInput");
                const bannerImagePreview = document.getElementById("profileBannerPreview");
                const removeBannerImageButton = document.getElementById("removeProfileBannerButton");


                if (localStorage.discord_banner === ``) {
                    removeBannerImageButton.style.display = 'none';
                }

                // Load saved image from localStorage on page load
                document.addEventListener("DOMContentLoaded", () => {
                    const savedImage = localStorage.getItem("discord_banner");
                    if (savedImage) {
                        bannerImagePreview.style.backgroundImage = `url(${savedImage})`;
                    }
                });

                // Handle image upload
                bannerImageInput.addEventListener("change", function () {
                    document.getElementById("options-banner-img-input-option-error").classList.remove('options-img-input-option-error')
                    document.getElementById("options-banner-img-input-option-error").innerHTML = ``;
                    removeBannerImageButton.style.display = 'block';
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (event) {
                            const dataUrl = event.target.result;
                            try {
                                localStorage.setItem("discord_banner", dataUrl);
                                bannerImagePreview.style.backgroundImage = `url(${dataUrl})`;
                            } catch(error) {
                                document.getElementById("options-banner-img-input-option-error").classList.add('options-img-input-option-error')
                                document.getElementById("options-banner-img-input-option-error").innerHTML = `
                                    <p>${getTextString("OPTIONS_EXTRA_PROFILE_FILE_TOO_BIG")}</p>
                                `;
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Handle image removal
                removeBannerImageButton.addEventListener("click", function () {
                    removeBannerImageButton.style.display = 'none';
                    localStorage.discord_banner = ``
                    bannerImagePreview.style.backgroundImage = '';
                });
            }

            try {
                const currency_picker_currencies = ["USD", "Discord Orb"];

                const currency_picker_currencies_picker = document.getElementById("currency_picker_container");
                

                populate_currency_picker();
                
                const storedTreatment = localStorage.getItem("currency");
                if (storedTreatment) {
                    currency_picker_currencies_picker.value = storedTreatment;
                }

                function populate_currency_picker() {
                    currency_picker_currencies.forEach((treatments) => {
                        const optElement = document.createElement("option");
                        optElement.value = treatments;
                        optElement.textContent = treatments;
                        currency_picker_currencies_picker.appendChild(optElement);
                    });
                }

                currency_picker_currencies_picker.addEventListener("change", () => {
                    const selectedTreatment = currency_picker_currencies_picker.value;
                
                    // Store the selection
                    localStorage.setItem("currency", selectedTreatment);
                });
            } catch(error) {
            }

            if (localStorage.experiment_2024_12_theme_picker == "Treatment 1: Enabled" || localStorage.experiment_2024_12_theme_picker == "Treatment 2: Enabled with custom css") {
                document.getElementById("theme-picker-container").innerHTML = `
                    <p class="center-text" style="font-size: 20px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_APPEARANCE")}</p>
                    <p class="center-text" id="default-theme-title" style="display: none; font-size: 15px; margin-top: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_APPEARANCE_1")}</p>
                    <div id="theme-selection-box-container">
                        <div class="theme-selection-box" title="${getTextString("OPTIONS_SIDEBAR_APPEARANCE_THEME_1")}" id="theme-dark-button" onclick="themeDarkChecked();"></div>
                        <div class="theme-selection-box" title="${getTextString("OPTIONS_SIDEBAR_APPEARANCE_THEME_2")}" id="theme-midnight-button" onclick="themeMidnightChecked();"></div>
                        <div class="theme-selection-box" title="${getTextString("OPTIONS_SIDEBAR_APPEARANCE_THEME_3")}" id="theme-light-button" onclick="themeLightChecked();"></div>
                    </div>
                    <p class="center-text" id="custom-theme-title" style="display: none; font-size: 15px; margin-top: 0px; color: var(--white);">${getTextString("OPTIONS_SIDEBAR_APPEARANCE_2")}</p>
                `;
                if (localStorage.experiment_2024_12_theme_picker == "Treatment 2: Enabled with custom css") {
                    const themes_container = document.getElementById("theme-picker-container");

                    document.getElementById("default-theme-title").style.display = 'unset';
                    document.getElementById("custom-theme-title").style.display = 'unset';

                    let custom_themes = document.createElement("div");
                    custom_themes.id = 'theme-selection-box-container';

                    custom_themes.innerHTML = `
                        <div class="theme-selection-box" title="Neon Green" id="theme-neongreen-button" onclick="themeNeonGreenChecked();">
                            <div class="edit-custom-theme-box"></div>
                            <div class="delete-custom-theme-box"></div>
                        </div>
                        <div class="theme-selection-box" title="Neon Purple" id="theme-neonpurple-button" onclick="themeNeonPurpleChecked();">
                            <div class="edit-custom-theme-box"></div>
                            <div class="delete-custom-theme-box"></div>
                        </div>
                        <div id="add-custom-theme-box-container">
                            <div class="theme-selection-box" title="Add Custon Theme" id="theme-custom-button" onclick="themeAddCustom();">
                                <svg class="circleIcon_db6521" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M13 5a1 1 0 1 0-2 0v6H5a1 1 0 1 0 0 2h6v6a1 1 0 1 0 2 0v-6h6a1 1 0 1 0 0-2h-6V5Z" class=""></path></svg>
                            </div>
                        </div>
                    `;

                    themes_container.appendChild(custom_themes);
                }
            }

            if (localStorage.sa_theme == "dark") {
                try {
                    document.getElementById("theme-dark-button").classList.add('theme-selection-box-selected');
                    document.body.classList.add('theme-dark');
                } catch (error) {
                }
            } else
            if (localStorage.sa_theme == "midnight") {
                try {
                    document.getElementById("theme-midnight-button").classList.add('theme-selection-box-selected');
                    document.body.classList.add('theme-midnight');
                } catch (error) {
                }
            } else
            if (localStorage.sa_theme == "light") {
                try {
                    document.getElementById("theme-light-button").classList.add('theme-selection-box-selected');
                    document.body.classList.add('theme-light');
                } catch (error) {
                }
            } else
            if (localStorage.sa_theme == "neongreen") {
                try {
                    document.getElementById("theme-neongreen-button").classList.add('theme-selection-box-selected');
                    document.body.classList.add('theme-neongreen');
                } catch (error) {
                }
            } else
            if (localStorage.sa_theme == "neonpurple") {
                try {
                    document.getElementById("theme-neonpurple-button").classList.add('theme-selection-box-selected');
                    document.body.classList.add('theme-neonpurple');
                } catch (error) {
                }
            }
            

            if (localStorage.fetch_collectibles_variants == "true") {
                document.getElementById("is-in-shop-box").checked = true;
            }
        
            if (localStorage.fetch_collectibles_variants == "none") {
                document.getElementById("is-in-shop-box").checked = true;
            }
    
            if (localStorage.reduced_motion == "true") {
                document.getElementById("reduced-motion-box").checked = true;
            }

            // if (localStorage.is_nitro_user == "true" && localStorage.experiment_2025_02_extra_options && localStorage.experiment_2025_02_extra_options != "Treatment 5: Enabled w/o currency picker" && localStorage.experiment_2025_02_extra_options != "Treatment -1: Disabled") {
            //     document.getElementById("options-has-nitro-box").checked = true;
            // }

            if (localStorage.disable_client_banner_overrides == "true") {
                document.getElementById("disable-banner-overrides-box").checked = true;
            }

            if (localStorage.experiment_2025_04_collectibles_marketing_page === "Treatment 1: Enabled" || localStorage.experiment_2025_04_collectibles_marketing_page === "Treatment 2: Enable v2") {
                const content = document.getElementById('downloadables-output');
                content.innerHTML = `
                    <p class="name">${getTextString("OPTIONS_SIDEBAR_MARKETING_DOWNLOADS_HAVE_MOVED")}</p>
                    <div class="experiment-card-holder" style="width: 300px; margin-left: auto; margin-right: auto;">
                        <button class="card-button" onclick="setParams({page: 'marketing'}); location.reload();">${getTextString("OPTIONS_SIDEBAR_MARKETING_DOWNLOADS_HAVE_MOVED_BUTTON")}</button>
                    </div>
                `;
            } else {

                fetch(api + DOWNLOADABLE_DATA, {
                    method: "GET",
                    headers: {
                        "Password": api_password,
                        "Authorization": discord_token,
                        "Token": api_token
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        // Call the function to display the data
                        displayData(data);
                    })
                    .catch(error => {
                        console.error('Error fetching the API:', error);
                    });

                    // Function to display the data in the HTML
                    function displayData(data) {
                    const content = document.getElementById('downloadables-output');
                    const template = document.getElementById('downloadables-api-template');
                    
                    data.forEach(item => {
                        // Clone the template
                        const clone = template.content.cloneNode(true);
                    
                        // Fill in the name and summary
                        clone.querySelector('.name').textContent = item.name;
                        clone.querySelector('.summary').textContent = item.summary;
                    
                        if (item.id === "discord_marketing") {
                            // Add buttons for downloadables
                            const downloadablesDiv = clone.querySelector('.downloadables');
                            item.downloadables.forEach(downloadable => {
                                const button = document.createElement('button');
                                button.textContent = `${downloadable.id}: ` + downloadable.name;
                                button.classList.add('card-button');
                                button.addEventListener('click', () => {
                                    window.open('https://item.yapper.shop/marketing/' + downloadable.id + '/data.zip', '_blank');
                                });
                                downloadablesDiv.appendChild(button);
                            });
                        }

                        if (item.id === "profiles_plus_marketing") {
                            // Add buttons for downloadables
                            const downloadablesDiv = clone.querySelector('.downloadables');
                            item.downloadables.forEach(downloadable => {
                                const button = document.createElement('button');
                                button.textContent = `${downloadable.id}: ` + downloadable.name;
                                button.classList.add('card-button');
                                button.addEventListener('click', () => {
                                    window.open('https://item.yapper.shop/profiles-plus-marketing/' + downloadable.id + '/data.zip', '_blank');
                                });
                                downloadablesDiv.appendChild(button);
                            });
                        }
                    
                        // Append the cloned template to the content
                        content.appendChild(clone);
                    });
                }

            }
            if (localStorage.experiment_2025_03_extra_options_dismissible_content === "Treatment 1: V1") {
                localStorage.dismissible_newProfileSettings = "Treatment 1: Seen"
                if (document.getElementById("newProfileSettingsDismissible")) {
                    document.getElementById("newProfileSettingsDismissible").remove();
                }
            }
            if (localStorage.experiment_2025_04_discord_sign_in_dismissible === "Treatment 1: V1" && localStorage.staff_dont_dismiss_discord_login != "true") {
                localStorage.dismissible_newLogInWithDiscord = "Treatment 1: Seen"
                if (document.getElementById("open-options-tools-button-1")) {
                    document.getElementById("open-options-tools-button-1").innerHTML = `
                        <svg x="0" y="0" aria-hidden="true" role="img" width="24" height="24" viewBox="0 0 24 24"><path d="M19.738 9.99995H22V14H19.7391C19.498 14.931 19.1001 15.798 18.565 16.564L20.0001 18L18 20.0001L16.5651 18.564C15.7971 19.099 14.932 19.498 14 19.738V22H9.99995V19.738C9.06899 19.498 8.20295 19.099 7.43602 18.564L5.99998 20.0001L3.99993 18L5.43597 16.564C4.90101 15.799 4.50201 14.932 4.26201 14H2V9.99995H4.26201C4.50201 9.06803 4.89993 8.20199 5.43597 7.43602L3.99993 5.99998L5.99998 3.99993L7.43602 5.43597C8.20199 4.89993 9.06803 4.50201 9.99995 4.26201V2H14V4.26093C14.932 4.50201 15.7971 4.89993 16.5651 5.43501L18 3.99897L20.0001 5.99902L18.564 7.43602C19.099 8.20199 19.498 9.06899 19.738 9.99995ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79079 14.2091 8.00002 12 8.00002C9.79079 8.00002 8.00002 9.79079 8.00002 12C8.00002 14.2091 9.79079 16 12 16Z" fill="currentColor"/></svg>
                    `;
                }
                if (document.getElementById("newLogInWithDiscordDismissible")) {
                    document.getElementById("newLogInWithDiscordDismissible").remove();
                }
            }
        }
    }


    function loginToDiscord() {
        const discordUrl = `https://discord.com/api/oauth2/authorize?client_id=${discord_app_ids.SHOP_ARCHIVES}&redirect_uri=${encodeURIComponent(api + LOGIN_CALLBACK)}&response_type=code&scope=identify`;
        window.location.href = discordUrl;
    }

    function logoutOfDiscord() {
        let modal = document.createElement("div");

        modal.classList.add('modalv2');

        modal.innerHTML = `
            <div class="modalv2-inner open-in-shop" style="display: unset; height: 500px; width: 700px;">
                <div data-modal-top-product-buttons>
                    <div title="Close" data-close-product-card-button>
                        <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                    </div>
                </div>
                <p class="center-text" style="font-size: 30px; margin-top: 20px; margin-bottom: 0px; color: var(--white); min-width: 500px;">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGOUT_1")}</p>
                <img style="display: block; width: 700px; margin-left: auto; margin-right: auto;" src="https://cdn.yapper.shop/assets/179.png">
                <p class="center-text options-medium-title" style="margin-top: 0px; min-width: 500px;">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGOUT_2")}</p>
                <div class="card-button-container open-in-shop">
                    <button class="card-button" onclick="actuallyLogOutOfDiscord();">${getTextString("OPTIONS_EXTRA_PROFILE_DISCORD_LOGOUT_3")}</button>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        setTimeout(() => {
            modal.classList.add('show');
        }, 1);

        let modal_back = document.createElement("div");

        modal_back.classList.add('modalv2-back');
        modal_back.id = 'modalv2-back';

        document.body.appendChild(modal_back);

        setTimeout(() => {
            modal_back.classList.add('show');
        }, 1);


        modal.addEventListener('click', (event) => {
            if (event.target === modal) {
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            }
        });

        modal.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
            modal.classList.remove('show');
            modal_back.classList.remove('show');
            setTimeout(() => {
                modal.remove();
                modal_back.remove();
            }, 300);
        });
    }

    function actuallyLogOutOfDiscord() {
        localStorage.removeItem('discord_token');
        localStorage.removeItem('discord_profile');
        sessionStorage.removeItem('discord_profile');
        localStorage.removeItem('discord_avatar');
        localStorage.removeItem('discord_username');
        localStorage.removeItem('discord_user_id');
        localStorage.removeItem('discord_displayname');
        localStorage.removeItem('discord_banner_color');
        localStorage.removeItem('discord_banner');
        localStorage.removeItem('discord_premium_type');
        localStorage.removeItem('admin_level');
        localStorage.removeItem('account_type');
        localStorage.removeItem('shop_archives_token');
        localStorage.dev = "false";
        localStorage.reviews_filter_type = "2";
        location.reload();
    }

    function closeLoginDismissibleCoachtip() {
        if (document.getElementById('newLogInWithDiscordDismissible')) {
            localStorage.dismissible_newLogInWithDiscord = "Treatment 1: Seen";
            document.getElementById('newLogInWithDiscordDismissible').remove();
        }
    }

    function closenew100FreeXPDismissibleCoachtip() {
        if (document.getElementById('new100FreeXPDismissible')) {
            localStorage.dismissible_new100FreeXP = "Treatment 1: Seen";
            document.getElementById('new100FreeXPDismissible').remove();
        }
    }

    function closeXPnoticeDismissibleCoachtip() {
        if (document.getElementById('XPnotice')) {
            localStorage.dismissible_XPnotice = "Treatment 1: Seen";
            document.getElementById('XPnotice').remove();
        }
    }

    async function updateDiscordProfilePlaceholder() {
        await updateDiscordProfile(localStorage.discord_token);
        optionsSidebarToggle();
        optionsSidebarToggle();
        if (apiUrl) {
            fetchData(pageCheck());
        }
    }

    window.updateDiscordProfilePlaceholder = updateDiscordProfilePlaceholder;

    async function updateDiscordProfileModalv3() {
        await updateDiscordProfile(localStorage.discord_token);
        setModalv3InnerContent('account');
        if (apiUrl) {
            fetchData(pageCheck());
        }
    }

    window.updateDiscordProfileModalv3 = updateDiscordProfileModalv3;

    async function updateDiscordProfile(token) {
        if (localStorage.account_type === "2") {
            try {
                const userInfo = await fetch('https://api.yapper.shop/v2/users/@me', {
                    method: "POST",
                    headers: { Authorization: `${localStorage.shop_archives_token}` }
                });
      
                if (!userInfo.ok) {
                    // If the response is not ok (e.g., 401 Unauthorized)
                    setParams({ page: 'home', login: 'false' });
                    actuallyLogOutOfDiscord();
                    return;
                }
      
                const user = await userInfo.json();
                localStorage.discord_profile = JSON.stringify(user, undefined, 4);
                localStorage.discord_avatar = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.webp?size=4096`;
                localStorage.discord_username = user.username;
                if (user.global_name != null) {
                    localStorage.discord_displayname = user.global_name;
                } else {
                    localStorage.discord_displayname = user.username;
                }
                localStorage.discord_banner_color = user.banner_color;
                localStorage.discord_premium_type = user.premium_type;
      
                if (user.banner != null) {
                    localStorage.discord_banner = `https://cdn.discordapp.com/banners/${user.id}/${user.banner}.png?size=4096`;
                } else {
                    localStorage.removeItem('discord_banner');
                }

                const atMe = await fetch('https://api.yapper.shop/v2/users/@me', {
                    headers: { Authorization: `${localStorage.shop_archives_token}` }
                });

                const atMe2 = await atMe.json();

                atMeUsercache = atMe2;
      
                console.log('success');
          
                // Optional: additional check (but `localStorage.discord_profile` is a string, so this check won't work unless parsed)
                const parsedProfile = JSON.parse(localStorage.discord_profile);
                if (parsedProfile.code === 0) {
                    setParams({ page: 'home', login: 'false' });
                    actuallyLogOutOfDiscord();
                }
          
            } catch (error) {
                setParams({ page: 'home', login: 'false' });
                actuallyLogOutOfDiscord();
            }
        } else {
            try {
                const userInfo = await fetch('https://discord.com/api/users/@me', {
                    headers: { Authorization: `Bearer ${token}` }
                });
      
                if (!userInfo.ok) {
                    // If the response is not ok (e.g., 401 Unauthorized)
                    setParams({ page: 'home', login: 'false' });
                    actuallyLogOutOfDiscord();
                    return;
                }
      
                const user = await userInfo.json();
                localStorage.discord_profile = JSON.stringify(user, undefined, 4);
                localStorage.discord_avatar = `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.webp?size=4096`;
                localStorage.discord_username = user.username;
                if (user.global_name != null) {
                    localStorage.discord_displayname = user.global_name;
                } else {
                    localStorage.discord_displayname = user.username;
                }
                localStorage.discord_banner_color = user.banner_color;
                localStorage.discord_premium_type = user.premium_type;
      
                if (user.banner != null) {
                    localStorage.discord_banner = `https://cdn.discordapp.com/banners/${user.id}/${user.banner}.png?size=4096`;
                } else {
                    localStorage.removeItem('discord_banner');
                }
      
                console.log('success');
          
                // Optional: additional check (but `localStorage.discord_profile` is a string, so this check won't work unless parsed)
                const parsedProfile = JSON.parse(localStorage.discord_profile);
                if (parsedProfile.code === 0) {
                    setParams({ page: 'home', login: 'false' });
                    actuallyLogOutOfDiscord();
                }
          
            } catch (error) {
                setParams({ page: 'home', login: 'false' });
                actuallyLogOutOfDiscord();
            }
        }
    }

    function changeUsernameFromInput() {
        const input = document.getElementById('profile-username-text-input')

        localStorage.discord_username = input.value;
        localStorage.discord_displayname = input.value;

        const displayname = document.getElementById('options-preview-profile-displayname')

        displayname.textContent = input.value;


        const usernamename = document.getElementById('options-username-preview')

        usernamename.textContent = input.value.toLowerCase();
    }

    function changeBannerColorFromInput() {
        const input = document.getElementById('profile-banner-color-input')

        localStorage.discord_banner_color = input.value;

        const banner = document.getElementById('options-preview-profile-banner-color')

        banner.style.backgroundColor = input.value;
    }

    function changeAvatarFromInput() {
        const input = document.getElementById('profile-avatar-text-input')

        localStorage.discord_avatar = input.value;
    }


    if (localStorage.experiment_2025_03_extra_options_dismissible_content === "Treatment 1: V1") {

        if (localStorage.dismissible_newProfileSettings != "Treatment 1: Seen") {
            let newProfileSettingsDismissible = document.createElement("div");

            newProfileSettingsDismissible.onclick = function() {
                optionsSidebarToggle();
                localStorage.dismissible_newProfileSettings = "Treatment 1: Seen"
                newProfileSettingsDismissible.remove();
            };

            newProfileSettingsDismissible.classList.add('newProfileSettingsDismissible');

            newProfileSettingsDismissible.id = `newProfileSettingsDismissible`;

            document.body.appendChild(newProfileSettingsDismissible);
        }
    }

    if (localStorage.experiment_2024_12_profiles_plus_marketing_variants === "Treatment 1: Paper Beach V2") {

        if (localStorage.dismissible_paper_beach_v2_marketing != "Treatment 1: Seen") {
            const profiles_plus_tab = document.getElementById("pplus-tab");
            if (profiles_plus_tab) {
                profiles_plus_tab.innerHTML = `
                    <img class="paper-beach-v2-greeting-catgirl-1" src="https://cdn.yapper.shop/assets/null.png">
                    <p class="dm-button-text">${getTextString("PROFILES_PLUS_BROWSE_ALL_TAB_TITLE")}</p>
                    <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                    <div class="dm-tab-preview-avatar-decoration-rotate">
                        <div class="dm-tab-preview-avatar-decoration-container" id="dm-tab-preview-avatar-decoration-container">
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/2.png">
                        </div>
                        <div class="dm-tab-preview-avatar-decoration-back"></div>
                    </div>
                    <p class="dm-button-text dm-button-text-marketing-1">${getTextString("DISMISSIBLE_CONTENT_PAPER_BEACH_V2_TITLE")}</p>
                `;
                profiles_plus_tab.classList.add('paper_beach_v2_marketing_tab');
    
                profiles_plus_tab.addEventListener("mouseenter", () => {
                    if (document.getElementById("dm-tab-preview-avatar-decoration").src == "https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/12.png") {
                        document.getElementById("dm-tab-preview-avatar-decoration-container").innerHTML = `
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/8.png">
                        `;
                    } else if (document.getElementById("dm-tab-preview-avatar-decoration").src == "https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/8.png") {
                        document.getElementById("dm-tab-preview-avatar-decoration-container").innerHTML = `
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/2.png">
                        `;
                    } else if (document.getElementById("dm-tab-preview-avatar-decoration").src == "https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/2.png") {
                        document.getElementById("dm-tab-preview-avatar-decoration-container").innerHTML = `
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/12.png">
                        `;
                    }
                });
            }
        }
    }


    if (localStorage.experiment_2024_12_profiles_plus_marketing_variants === "Treatment 2: Roblox Doors") {

        if (localStorage.dismissible_roblox_doors_marketing != "Treatment 1: Seen") {
            const profiles_plus_tab = document.getElementById("pplus-tab");
            if (profiles_plus_tab) {
                profiles_plus_tab.innerHTML = `
                    <img class="paper-beach-v2-greeting-catgirl-1" src="https://cdn.yapper.shop/assets/null.png">
                    <p class="dm-button-text">${getTextString("PROFILES_PLUS_BROWSE_ALL_TAB_TITLE")}</p>
                    <div class="dm-new-icon">${getTextString("DM_NEW")}</div>
                    <div class="dm-tab-preview-avatar-decoration-rotate">
                        <div class="dm-tab-preview-avatar-decoration-container" id="dm-tab-preview-avatar-decoration-container">
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/2.png">
                        </div>
                        <div class="dm-tab-preview-avatar-decoration-back"></div>
                    </div>
                    <p class="dm-button-text dm-button-text-marketing-1">${getTextString("DISMISSIBLE_CONTENT_ROBLOX_DOORS_TITLE")}</p>
                `;
                profiles_plus_tab.classList.add('roblox_doors_marketing_tab');
    
                profiles_plus_tab.addEventListener("mouseenter", () => {
                    if (document.getElementById("dm-tab-preview-avatar-decoration").src == "https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/12.png") {
                        document.getElementById("dm-tab-preview-avatar-decoration-container").innerHTML = `
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/8.png">
                        `;
                    } else if (document.getElementById("dm-tab-preview-avatar-decoration").src == "https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/8.png") {
                        document.getElementById("dm-tab-preview-avatar-decoration-container").innerHTML = `
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/2.png">
                        `;
                    } else if (document.getElementById("dm-tab-preview-avatar-decoration").src == "https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/2.png") {
                        document.getElementById("dm-tab-preview-avatar-decoration-container").innerHTML = `
                            <img class="dm-tab-preview-avatar-decoration-3" id="dm-tab-preview-avatar-decoration" src="https://cdn.yapper.shop/custom-collectibles/paper-beach/avatar-decorations/12.png">
                        `;
                    }
                });
            }
        }
    }





    function themeDarkChecked() {
        clearCurrentTheme()
        localStorage.sa_theme = "dark"
        document.body.classList.add('theme-dark');
        document.getElementById("theme-dark-button").classList.add('theme-selection-box-selected');
    }

    function themeMidnightChecked() {
        clearCurrentTheme()
        localStorage.sa_theme = "midnight"
        document.body.classList.add('theme-midnight');
        document.getElementById("theme-midnight-button").classList.add('theme-selection-box-selected');
    }

    function themeLightChecked() {
        clearCurrentTheme()
        localStorage.sa_theme = "light"
        document.body.classList.add('theme-light');
        document.getElementById("theme-light-button").classList.add('theme-selection-box-selected');
    }

    function themeNeonGreenChecked() {
        clearCurrentTheme()
        localStorage.sa_theme = "neongreen"
        document.body.classList.add('theme-neongreen');
        document.getElementById("theme-neongreen-button").classList.add('theme-selection-box-selected');
    }

    function themeNeonPurpleChecked() {
        clearCurrentTheme()
        localStorage.sa_theme = "neonpurple"
        document.body.classList.add('theme-neonpurple');
        document.getElementById("theme-neonpurple-button").classList.add('theme-selection-box-selected');
    }

    function clearCurrentTheme() {
        try {
            document.getElementById("theme-dark-button").classList.remove('theme-selection-box-selected');
            document.body.classList.remove('theme-dark');
            document.getElementById("theme-midnight-button").classList.remove('theme-selection-box-selected');
            document.body.classList.remove('theme-midnight');
            document.getElementById("theme-light-button").classList.remove('theme-selection-box-selected');
            document.body.classList.remove('theme-light');
            document.getElementById("theme-neongreen-button").classList.remove('theme-selection-box-selected');
            document.body.classList.remove('theme-neongreen');
            document.getElementById("theme-neonpurple-button").classList.remove('theme-selection-box-selected');
            document.body.classList.remove('theme-neonpurple');
        } catch (error) {
        }
    }

    function disabledExperimentForceRollout() {
        if (!localStorage.experiment_force_rollout) {
            localStorage.experiment_force_rollout = "true"
        } else if (localStorage.experiment_force_rollout != "true") {
            localStorage.experiment_force_rollout = "true"
        } else {
            localStorage.experiment_force_rollout = "false"
        }
    }

    function inShopIsChecked() {
        if (localStorage.fetch_collectibles_variants != "true") {
            localStorage.fetch_collectibles_variants = "true"
        }
        else {
            localStorage.fetch_collectibles_variants = "false"
        }
        if (typeof fetchData === 'function') {
            fetchData(pageCheck());
        }
    }

    function reducedMotionChecked() {
        if (!localStorage.reduced_motion) {
            localStorage.reduced_motion = "true"
        } else if (localStorage.reduced_motion != "true") {
            localStorage.reduced_motion = "true"
        } else {
            localStorage.reduced_motion = "false"
        }
        if (typeof fetchData === 'function') {
            fetchData(pageCheck());
        }
    }

    function optionsHasNitroChecked() {
        if (localStorage.is_nitro_user != "true") {
            localStorage.is_nitro_user = "true"
        } else {
            localStorage.is_nitro_user = "false"
        }
        if (typeof fetchData === 'function') {
            fetchData(pageCheck());
        }
    }

    function disableBannerOverridesChecked() {
        if (localStorage.disable_client_banner_overrides != "true") {
            localStorage.disable_client_banner_overrides = "true"
        }
        else {
            localStorage.disable_client_banner_overrides = "false"
        }
        if (typeof fetchData === 'function') {
            fetchData(pageCheck());
        }
    }
    
    function noBundlesInShopIsChecked() {
        if (localStorage.shop_have_no_bundles != "true") {
            localStorage.shop_have_no_bundles = "true"
        }
        else {
            localStorage.shop_have_no_bundles = "false"
        }
        if (typeof fetchData === 'function') {
            pageCheck();
        }
    }
    
    function openMobileModal() {
        const lost_modal = document.getElementById('modal-housing');
        lost_modal.innerHTML = `
            <div class="modal-housing-1" id="modal-housing-1">
                <div class="lost-modal">
                    <div class="lost-modal-inner">
                        <h1 class="center-text" style="font-size: 54px; margin-top: 40px;">Looks like you're on mobile</h1>
                        <p>Would you like to use the mobile client?</p>
                        <button class="refresh-button" onclick="location.href='https://m.yapper.shop/';">Yes</button>
                        <button class="refresh-button" onclick="closeMobileModal()">No</button>
                    </div>
                </div>
            </div>
        `;
    }
    
    function openOptionsModal() {
        const options_modal = document.getElementById('modal-housing');
        options_modal.innerHTML = `
        <div class="modal-housing-1" id="modal-housing-1">
            <div class="lost-modal">
                <div class="lost-modal-inner">
                    <h1 class="center-text" style="font-size: 54px; margin-top: 40px;">Options</h1>
                    <div>
                        <div class="experiment-card-holder">
                            <div class="experiment-card" id="is-in-shop-box-option">
                                <p>Shop: Hide removed items</p>
                                <p class="experiment-subtext">This will hide all categories that are not currently in the shop</p>
                                <input class="options-toggle-box" onclick="inShopIsChecked();" style="cursor: pointer; scale: 2; posision: center;" id="is-in-shop-box" type="checkbox">
                            </div>
                            <div class="experiment-card">
                                <p>Shop: Hide bundles</p>
                                <p class="experiment-subtext">This will hide all bundles in the shop page</p>
                                <input class="options-toggle-box" onclick="noBundlesInShopIsChecked();" style="cursor: pointer; scale: 2; posision: center;" id="no-bundles-in-shop-box" type="checkbox">
                            </div>
                        </div>
                    </div>
                    <button class="refresh-button" onclick="closeLostModal()">Close</button>
                </div>
            </div>
        </div>
        `;
    
        if (localStorage.fetch_collectibles_variants == "true") {
            document.getElementById("is-in-shop-box").checked = true;
        }
    
        if (localStorage.fetch_collectibles_variants == "none") {
            document.getElementById("is-in-shop-box").checked = true;
        }
    
        if (localStorage.items_in_shop != "true") {
            if (localStorage.items_in_shop != "none") {
                document.getElementById("is-in-shop-box-option").style.display = 'none';
            }
        }
    
    
        if (localStorage.shop_have_no_bundles == "true") {
            document.getElementById("no-bundles-in-shop-box").checked = true;
        }
    }
    
    function openDownloadsModal() {
        const downloads_modal = document.getElementById('modal-housing');
        downloads_modal.innerHTML = `
        <div class="modal-housing-1" id="modal-housing-1">
            <div class="dev-modal">
                <div class="dev-modal-inner">
                    <h1 class="center-text" style="font-size: 54px; margin-top: 40px;">Manual Downloads</h1>
                    <p style="margin-top: -50px;">Experimental</p>
                    <div>
                        <div class="experiment-card-holder">
                        <template id="downloadables-api-template">
                            <div class="item experiment-card">
                                <p class="name"></p>
                                <p class="summary experiment-subtext"></p>
                                <div class="downloadables"></div>
                            </div>
                        </template>
                        <div class="experiment-card-holder" id="downloadables-output"></div>
                    </div>
                    <button class="refresh-button" onclick="closeLostModal()">Close</button>
                </div>
            </div>
        </div>
        `;
        
        // Fetch the data from the API
        fetch(DOWNLOADABLE_DATA, {
            method: "GET",
            headers: {
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            }
        })
            .then(response => response.json())
            .then(data => {
                // Call the function to display the data
                displayData(data);
            })
            .catch(error => {
                console.error('Error fetching the API:', error);
            });
            
            // Function to display the data in the HTML
            function displayData(data) {
            const content = document.getElementById('downloadables-output');
            const template = document.getElementById('downloadables-api-template');
            
            data.forEach(item => {
                // Clone the template
                const clone = template.content.cloneNode(true);
            
                // Fill in the name and summary
                clone.querySelector('.name').textContent = item.name;
                clone.querySelector('.summary').textContent = item.summary;
            
                // Add buttons for downloadables
                const downloadablesDiv = clone.querySelector('.downloadables');
                item.downloadables.forEach(downloadable => {
                    const button = document.createElement('button');
                    button.textContent = downloadable.name;
                    button.classList.add('card-button');
                    button.addEventListener('click', () => {
                        window.open(downloadable.url, '_blank');
                    });
                    downloadablesDiv.appendChild(button);
                });
            
                // Append the cloned template to the content
                content.appendChild(clone);
            });
        }
    
    }

    function scrollToSKUOverrride(type) {
        if (type === "card") {
            const sku_id = document.getElementById("scroll-to-sku-id-override-input").value;
            document.getElementById("scroll-to-sku-id-override-button").disabled = true;
            document.getElementById("scroll-to-sku-id-override-button").style.backgroundColor = 'var(--button-danger-background)';
            setTimeout(() => {
                try {
                    document.getElementById(sku_id).scrollIntoView({ behavior: "smooth" });
                }
                catch(error) {
                    scrollToSKU(sku_id)
                }
            }, 10);
            document.getElementById(sku_id).classList.add("highlighted")

            let highlightedGlint = document.createElement("div");

            highlightedGlint.classList.add('shop-category-card-highlighted-glint');

            document.getElementById(sku_id).appendChild(highlightedGlint);
            setTimeout(() => {
                highlightedGlint.remove();
                document.getElementById(sku_id).classList.remove("highlighted");
                document.getElementById("scroll-to-sku-id-override-button").disabled = false;
                document.getElementById("scroll-to-sku-id-override-button").style.backgroundColor = '';
            }, 3000);
        } else if (type === "category") {
            const sku_id = document.getElementById("scroll-to-category-sku-id-override-input").value;
            document.getElementById("scroll-to-category-sku-id-override-button").disabled = true;
            document.getElementById("scroll-to-category-sku-id-override-button").style.backgroundColor = 'var(--button-danger-background)';
            setTimeout(() => {
                try {
                    document.getElementById(sku_id).scrollIntoView({ behavior: "smooth" });
                }
                catch(error) {
                    scrollToSKU(sku_id)
                }
            }, 10);
            document.getElementById(sku_id).classList.add("highlighted")

            let highlightedGlint = document.createElement("div");

            highlightedGlint.classList.add('shop-category-highlighted-glint');

            document.getElementById(sku_id).appendChild(highlightedGlint);
            setTimeout(() => {
                highlightedGlint.remove();
                document.getElementById(sku_id).classList.remove("highlighted");
                document.getElementById("scroll-to-category-sku-id-override-button").disabled = false;
                document.getElementById("scroll-to-category-sku-id-override-button").style.backgroundColor = '';
            }, 3000);
        }
    }
    
    
    let dev_topbar_container = document.createElement("div");

    dev_topbar_container.classList.add('dev-topbar-container');
    dev_topbar_container.id = 'dev-topbar-container';

    document.body.appendChild(dev_topbar_container);
    
    function openDevModal() {
        if (localStorage.dev == "true") {


            if (document.getElementById('dev-topbar-container').classList.contains('dev-topbar-container-expanded')) {
                document.getElementById('dev-topbar-container').classList.remove("dev-topbar-container-expanded");
            } else {
                document.getElementById('dev-topbar-container').classList.add("dev-topbar-container-expanded");
                document.getElementById('dev-topbar-container').innerHTML = `
                    <h1 class="center-text" style="font-size: 30px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_DEV_TITLE")}</h1>

                    <div id="staff-notes">
                        <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_NOTES")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_NOTES_2")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_NOTES_1")}</p>
                    </div>

                    <div class="experiment-card-holder" style="width: 300px; margin-left: auto; margin-right: auto;">
                        <button class="card-button" onclick="redirectToLink('https://discord.gg/88Kkv6xmck');">${getTextString("OPTIONS_DEV_OPEN_STAFF_DISCORD_SERVER")}</button>
                    </div>

                    <div id="staff-todo-list">
                        <p class="center-text" style="font-size: 20px; margin-top: 20px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_TODO_LIST")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_TODO_LIST_1")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_TODO_LIST_2")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_TODO_LIST_3")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_TODO_LIST_4")}</p>
                        <p class="center-text" style="font-size: 15px; margin-top: 0px; margin-bottom: 0px; color: var(--white);">${getTextString("OPTIONS_EXTRA_STAFF_TODO_LIST_5")}</p>
                    </div>

                    <div class="options-option-card-holder">
                        <div class="options-option-card" id="unpublished-collectibles-box-option">
                            <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_DEV_UNPUBLISHED_COLLECTIBLES")}</p>
                            <input class="options-toggle-box" onclick="unreleasedDiscordCollectiblesToggle();" style="cursor: pointer; scale: 2; posision: center;" id="unpublished-collectibles-box" type="checkbox">
                        </div>
                        <div class="options-option-card" id="unpublished-pplus-items-box-option">
                            <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_DEV_UNPUBLISHED_PPLUS_ITEMS")}</p>
                            <input class="options-toggle-box" onclick="unreleasedPPlusItemsToggle();" style="cursor: pointer; scale: 2; posision: center;" id="unpublished-pplus-items-box" type="checkbox">
                        </div>
                        <div class="options-option-card" id="dont-dismiss-discord-login-box-option">
                            <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_DEV_NO_SEEN_DISCORD_LOG_IN_OPTIONS_OPEN")}</p>
                            <input class="options-toggle-box" onclick="dontSetDiscordLoginDismissibleToSeenToggle();" style="cursor: pointer; scale: 2; posision: center;" id="dont-dismiss-discord-login-box" type="checkbox">
                        </div>
                    </div>

                    <div class="experiment-card-holder" style="width: 300px; margin-left: auto; margin-right: auto;">
                        <button class="card-button" onclick="disableClientRework();">${getTextString("OPTIONS_DEV_DISABLE_CLIENT_REWORK")}</button>
                        <button class="card-button" onclick="setPageToNameplatePage();">${getTextString("OPTIONS_DEV_OPEN_NAMEPLATES_PAGE")}</button>
                    </div>

                    <div class="options-option-card" id="options-text-input-option">
                        <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_DEV_HIGHLIGHT_SKU_ID")}</p>
                        <input class="options-text-input" autocomplete="off" style="posision: center;" id="scroll-to-sku-id-override-input" value="1349486948942745695" type="text">
                    </div>
                    <div class="experiment-card-holder" style="width: 300px; margin-left: auto; margin-right: auto;">
                        <button class="card-button" id="scroll-to-sku-id-override-button" onclick="scrollToSKUOverrride('card');">${getTextString("OPTIONS_DEV_HIGHLIGHT_SKU_CARD")}</button>
                    </div>

                    <div class="options-option-card" id="options-text-input-option">
                        <p class="option-card-title" style="color: var(--white);">${getTextString("OPTIONS_DEV_HIGHLIGHT_CAT_SKU_ID")}</p>
                        <input class="options-text-input" autocomplete="off" style="posision: center;" id="scroll-to-category-sku-id-override-input" value="1349486948942745691" type="text">
                    </div>
                    <div class="experiment-card-holder" style="width: 300px; margin-left: auto; margin-right: auto;">
                        <button class="card-button" id="scroll-to-category-sku-id-override-button" onclick="scrollToSKUOverrride('category');">${getTextString("OPTIONS_DEV_HIGHLIGHT_SKU_CAT")}</button>
                    </div>
                    ${getTextString("APP_VERSION")}${tcbx926n29}
                `;
    
                if (localStorage.unreleased_discord_collectibles == "true") {
                    document.getElementById("unpublished-collectibles-box").checked = true;
                }

                if (localStorage.unreleased_profiles_plus == "true") {
                    document.getElementById("unpublished-pplus-items-box").checked = true;
                }

                if (localStorage.staff_dont_dismiss_discord_login == "true") {
                    document.getElementById("dont-dismiss-discord-login-box").checked = true;
                }
            }
        } else {
            console.error('403 (Forbidden)')
        }
    }

    function disableClientRework() {
        localStorage.full_client_rework = "false"
        location.reload();
    }

    function setPageToNameplatePage() {
        setParams({page: 'nameplates'});
        location.reload();
    }

    function unreleasedDiscordCollectiblesToggle() {
        if (!localStorage.unreleased_discord_collectibles) {
            localStorage.unreleased_discord_collectibles = "true"
        } else if (localStorage.unreleased_discord_collectibles === "none") {
            localStorage.unreleased_discord_collectibles = "true"
        } else {
            localStorage.unreleased_discord_collectibles = "none"
        }
        fetchData(pageCheck());
    }

    function unreleasedPPlusItemsToggle() {
        if (!localStorage.staff_dont_dismiss_discord_login) {
            localStorage.staff_dont_dismiss_discord_login = "true"
        } else if (localStorage.unreleased_profiles_plus === "none") {
            localStorage.unreleased_profiles_plus = "true"
        } else {
            localStorage.unreleased_profiles_plus = "none"
        }
        fetchData(pageCheck());
    }

    function dontSetDiscordLoginDismissibleToSeenToggle() {
        if (!localStorage.staff_dont_dismiss_discord_login) {
            localStorage.staff_dont_dismiss_discord_login = "true"
        } else if (localStorage.staff_dont_dismiss_discord_login === "none") {
            localStorage.staff_dont_dismiss_discord_login = "true"
        } else {
            localStorage.staff_dont_dismiss_discord_login = "none"
        }
    }

    function testFetchAPI(fetcherName) {
        const endpoint = testFetchAPIList.find(api => api.name === fetcherName);

        const { rollout } = endpoint;
        const treatmentPicker = document.getElementById(`${fetcherName}_treatment_container`);

        if (fetcherName === "testfetch_testfetchnew") {
            url = api + "/" + "collectibles-shop";
            testFetchURL = new URL(url);
            testFetchURL.searchParams.append("tab", treatmentPicker.value);
        } else if (fetcherName === "testfetch_testfetcheffects") {
            url = api + "/" + "profile-effects";
            testFetchURL = new URL(url);
            testFetchURL.searchParams.append("tab", treatmentPicker.value);
        } else {
            url = api + "/" + treatmentPicker.value;
            testFetchURL = new URL(url);
        }
        testFetchURL.searchParams.append("is-test-fetch", "true");
        if (document.getElementById("test-fetch-include-no-sku-items-box").checked === true) {
            testFetchURL.searchParams.append("include-no-sku-items", "true");
        }
        if (document.getElementById("test-fetch-unpublished-collectibles-box").checked === true) {
            testFetchURL.searchParams.append("include-unpublished", "true");
        }
        
        fetch(testFetchURL, {
            method: "GET",
            headers: {
                "Password": api_password,
                "Authorization": discord_token,
                "Token": api_token
            }
        })
        .then(response => response.json())
        .then((data) => {
            console.log(data);
        })
        .catch(error => {
            console.log(`Failed to test fetch: `, error);
        });
    }

    function openOldDevModal() {
        if (localStorage.dev == "true") {
            document.getElementById('modal-housing').innerHTML = `
                <div class="modal-housing-1" id="modal-housing-1">
                    <div class="dev-modal">
                        <div class="dev-modal-inner">
                            <h1 class="center-text" style="font-size: 54px; margin-top: -10px; margin-bottom: -5px;">${getTextString("OPTIONS_DEV_TITLE")}</h1>
                            <p>${getTextString("OPTIONS_DEV_DESC")}</p>
                            <button class="staff-close-button" onclick="closeDevModal()">${getTextString("OPTIONS_DEV_CLOSE")}</button>
                            <button class="staff-safe-mode-button" onclick="turnOffDevMode()">${getTextString("OPTIONS_DEV_SAFE_MODE")}</button>
                            <hr>
                            <div>
                                <h2>Modals</h2>
                                <div class="experiment-card-holder">
                                    <div class="experiment-card">
                                        <p>Lost</p>
                                        <p class="experiment-subtext">modal no longer supported on client</p>
                                        <button class="refresh-button" onclick="openLostModal()">Open</button>
                                    </div>
                                    <div class="experiment-card">
                                        <p>Dev</p>
                                        <button class="refresh-button" onclick="openDevModal()">Open</button>
                                    </div>
                                    <div class="experiment-card">
                                        <p>Options</p>
                                        <button class="refresh-button" onclick="openOptionsModal()">Open</button>
                                    </div>
                                    <div class="experiment-card">
                                        <p>Downloads</p>
                                        <button class="refresh-button" onclick="openDownloadsModal()">Open</button>
                                    </div>
                                </div>
                            </div>
                            <hr>
                            <div>
                                <h2>Local Storage Overrides</h2>
                                <p class="experiment-subtext">Refresh the page for changes to take effect</p>
                                <button class="refresh-button" onclick="localStorage.clear()">Delete All</button>
                                <input type="text" class="dev-local-storage-input-1" id="keyInput" placeholder="Enter key">
                                <input type="text" class="dev-local-storage-input-1" id="valueInput" placeholder="Enter value">
                                <button class="refresh-button" onclick="saveToLocalStorage()">Save</button>
                                <div id="storageItems"></div>
                            </div>
                            <hr>
                            <div>

                                <p>${getTextString("APP_VERSION")}${tcbx926n29}</p>
                            </div>
                            <hr>
                            <button class="staff-close-button" onclick="closeDevModal()">${getTextString("OPTIONS_DEV_CLOSE")}</button>
                            <button class="staff-safe-mode-button" onclick="turnOffDevMode()">${getTextString("OPTIONS_DEV_SAFE_MODE")}</button>
                        </div>
                    </div>
                </div>
            `;
    
            displayLocalStorage();
        } else {
            console.error('403 (Forbidden)')
        }
    }

    function colorButtonsPerRollout() {

        if (localStorage.experiment_theme_picker == "two" || localStorage.experiment_theme_picker == "two_autorollout") {
            document.getElementById("2024-12_theme_picker-2").classList.add('newish-experiment-button-selected');
        }

        if (localStorage.experiment_theme_picker == "true" || localStorage.experiment_theme_picker == "true_autorollout") {
            document.getElementById("2024-12_theme_picker-1").classList.add('newish-experiment-button-selected');
        }
    
        if (localStorage.experiment_theme_picker == "false" || localStorage.experiment_theme_picker == "false_autorollout") {
            document.getElementById("2024-12_theme_picker-00").classList.add('newish-experiment-button-selected');
        }


        if (localStorage.profiles_plus_marketing_variants == "variant_1" || localStorage.profiles_plus_marketing_variants == "variant_1_autorollout") {
            document.getElementById("2024-12_profiles_plus_marketing_variants-1").classList.add('newish-experiment-button-selected');
        }
    
        if (localStorage.profiles_plus_marketing_variants == "false" || localStorage.profiles_plus_marketing_variants == "false_autorollout") {
            document.getElementById("2024-12_profiles_plus_marketing_variants-00").classList.add('newish-experiment-button-selected');
        }



        if (localStorage.collectibles_variants == "true" || localStorage.collectibles_variants == "true_autorollout") {
            document.getElementById("2024-11_collectibles_variants-1").classList.add('newish-experiment-button-selected');
        }
    
        if (localStorage.collectibles_variants == "false" || localStorage.collectibles_variants == "false_autorollout") {
            document.getElementById("2024-11_collectibles_variants-00").classList.add('newish-experiment-button-selected');
        }




        if (localStorage.recap_items_2024 == "true" || localStorage.recap_items_2024 == "true_autorollout") {
            document.getElementById("2024-11_recap-1").classList.add('newish-experiment-button-selected');
        }
    
        if (localStorage.recap_items_2024 == "false" || localStorage.recap_items_2024 == "false_autorollout") {
            document.getElementById("2024-11_recap-00").classList.add('newish-experiment-button-selected');
        }
    }


    
    
    function closeDevModal() {
        const dev_modal = document.getElementById('modal-housing');
        dev_modal.innerHTML = ``;
    }
    
    function closeMobileModal() {
        const mobile_modal = document.getElementById('modal-housing');
        mobile_modal.innerHTML = ``;
    }
    
    function closeLostModal() {
        const lost_modal = document.getElementById('modal-housing');
        lost_modal.innerHTML = ``;
    }
    
    
    
    
    const fourohfour = document.getElementById("404-mains-button");
    if (fourohfour) {  // Check if element exists
        if (localStorage.not_found_found == "true") {
            document.getElementById("404-mains-button").classList.remove('hidden');
        }
    }
    
    
    function turnOffDevMode() {
        localStorage.dev = "false"
        location.reload();
    }
    
    function dev() {
        localStorage.dev = "true"
        location.reload();
    }




    function themePicker2() {
        localStorage.experiment_theme_picker = "two"
        document.getElementById("2024-12_theme_picker-2").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-00").classList.remove('newish-experiment-button-selected');
    }

    function themePicker1() {
        localStorage.experiment_theme_picker = "true"
        document.getElementById("2024-12_theme_picker-2").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-00").classList.remove('newish-experiment-button-selected');
    }

    function themePicker00() {
        localStorage.experiment_theme_picker = "false"
        document.getElementById("2024-12_theme_picker-2").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-00").classList.add('newish-experiment-button-selected');
    }

    function themePicker0() {
        localStorage.experiment_theme_picker = "pleasesetautorollout"
        document.getElementById("2024-12_theme_picker-2").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_theme_picker-00").classList.remove('newish-experiment-button-selected');
        fetchExperimentRolloutData();
    }


    function profilesPlusMarketingVariants1() {
        localStorage.profiles_plus_marketing_variants = "variant_1"
        document.getElementById("2024-12_profiles_plus_marketing_variants-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-12_profiles_plus_marketing_variants-00").classList.remove('newish-experiment-button-selected');
    }

    function profilesPlusMarketingVariants00() {
        localStorage.profiles_plus_marketing_variants = "false"
        document.getElementById("2024-12_profiles_plus_marketing_variants-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_profiles_plus_marketing_variants-00").classList.add('newish-experiment-button-selected');
    }

    function profilesPlusMarketingVariants0() {
        localStorage.profiles_plus_marketing_variants = "pleasesetautorollout"
        document.getElementById("2024-12_profiles_plus_marketing_variants-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_profiles_plus_marketing_variants-00").classList.remove('newish-experiment-button-selected');
        fetchExperimentRolloutData();
    }


    function collectiblesVariants1() {
        localStorage.collectibles_variants = "true"
        document.getElementById("2024-11_collectibles_variants-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-11_collectibles_variants-00").classList.remove('newish-experiment-button-selected');
    }

    function collectiblesVariants00() {
        localStorage.collectibles_variants = "false"
        document.getElementById("2024-11_collectibles_variants-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-11_collectibles_variants-00").classList.add('newish-experiment-button-selected');
    }

    function collectiblesVariants0() {
        localStorage.collectibles_variants = "pleasesetautorollout"
        document.getElementById("2024-11_collectibles_variants-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-11_collectibles_variants-00").classList.remove('newish-experiment-button-selected');
        fetchExperimentRolloutData();
    }



    function recap2024Items1() {
        localStorage.recap_items_2024 = "true"
        document.getElementById("2024-11_recap-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-11_recap-00").classList.remove('newish-experiment-button-selected');
    }

    function recap2024Items00() {
        localStorage.recap_items_2024 = "false"
        document.getElementById("2024-11_recap-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-11_recap-00").classList.add('newish-experiment-button-selected');
    }

    function recap2024Items0() {
        localStorage.recap_items_2024 = "pleasesetautorollout"
        document.getElementById("2024-11_recap-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-11_recap-00").classList.remove('newish-experiment-button-selected');
        fetchExperimentRolloutData();
    }




    function disableClientReworkTrue() {
        localStorage.full_client_rework = "false"
        document.getElementById("2024-12_disable_client_rework-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_disable_client_rework-00").classList.add('newish-experiment-button-selected');
        location.reload();
    }
    
    function disableClientReworkFalse() {
        localStorage.full_client_rework = "true"
        document.getElementById("2024-12_disable_client_rework-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-12_disable_client_rework-00").classList.remove('newish-experiment-button-selected');
        location.reload();
    }




    function forceAllApiToFectchPrivateApiFalse() {
        localStorage.force_all_api_to_fectch_private_api = "none"
        document.getElementById("2024-12_force_all_api_to_fectch_private_api-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-12_force_all_api_to_fectch_private_api-2").classList.add('newish-experiment-button-selected');
        fetchData(pageCheck());
    }
    
    function forceAllApiToFectchPrivateApiTrue() {
        localStorage.force_all_api_to_fectch_private_api = "true"
        document.getElementById("2024-12_force_all_api_to_fectch_private_api-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-12_force_all_api_to_fectch_private_api-2").classList.remove('newish-experiment-button-selected');
        fetchData(pageCheck());
    }


    

    function overrideLeaksButtonHide() {
        localStorage.override_leaks_button = "none"
        document.getElementById("2024-11_override_leaks_button-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-11_override_leaks_button-2").classList.add('newish-experiment-button-selected');
        leaksCheck();
    }
    
    function overrideLeaksButtonShow() {
        localStorage.override_leaks_button = "true"
        document.getElementById("2024-11_override_leaks_button-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-11_override_leaks_button-2").classList.remove('newish-experiment-button-selected');
        leaksCheck();
    }

    

    function unreleasedDiscordCollectiblesFalse() {
        localStorage.unreleased_discord_collectibles = "none"
        document.getElementById("2024-11_unreleased_discord_collectibles-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-11_unreleased_discord_collectibles-2").classList.add('newish-experiment-button-selected');
        fetchData(pageCheck());
    }
    
    function unreleasedDiscordCollectiblesTrue() {
        localStorage.unreleased_discord_collectibles = "true"
        document.getElementById("2024-11_unreleased_discord_collectibles-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-11_unreleased_discord_collectibles-2").classList.remove('newish-experiment-button-selected');
        fetchData(pageCheck());
    }

    
    
    
    function unreleasedProfilesPlusItemsFalse() {
        localStorage.unreleased_profiles_plus = "none"
        document.getElementById("2024-09_profiles_plus-1").classList.remove('newish-experiment-button-selected');
        document.getElementById("2024-09_profiles_plus-2").classList.add('newish-experiment-button-selected');
        fetchData(pageCheck());
    }
    
    function unreleasedProfilesPlusItemsTrue() {
        localStorage.unreleased_profiles_plus = "true"
        document.getElementById("2024-09_profiles_plus-1").classList.add('newish-experiment-button-selected');
        document.getElementById("2024-09_profiles_plus-2").classList.remove('newish-experiment-button-selected');
        fetchData(pageCheck());
    }
    
    
    
    
    function saveToLocalStorage() {
        // Get the values from the inputs
        const key = document.getElementById('keyInput').value;
        const value = document.getElementById('valueInput').value;
        
        // Save to local storage
        localStorage.setItem(key, value);
        
        // Refresh the display
        displayLocalStorage();
    }
        
    function displayLocalStorage() {
        // Get the container element
        const storageItems = document.getElementById('storageItems');
        
        // Clear the container
        storageItems.innerHTML = '';
        
        // Iterate over all items in local storage
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            const value = localStorage.getItem(key);
            
            // Create a container for each item
            const itemDiv = document.createElement('div');
            
            // Create editable input fields for key and value
            const keyInput = document.createElement('input');
            keyInput.type = 'text';
            keyInput.value = key;
            keyInput.disabled = true; // Disable key editing
            keyInput.className = 'dev-local-storage-input-2';
            
            const valueInput = document.createElement('input');
            valueInput.type = 'text';
            valueInput.value = value;
            valueInput.className = 'dev-local-storage-input-3';
            
            // Save button for each item
            const saveButton = document.createElement('button');
            saveButton.textContent = 'Update';
            saveButton.className = 'refresh-button';
            saveButton.onclick = function() {
                localStorage.setItem(key, valueInput.value);
            };
            
            // Delete button for each item
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.className = 'refresh-button';
            deleteButton.onclick = function() {
                localStorage.removeItem(key);
                displayLocalStorage(); // Refresh the display
            };
            
            // Append elements to the item div
            itemDiv.appendChild(deleteButton);
            itemDiv.appendChild(keyInput);
            itemDiv.appendChild(valueInput);
            itemDiv.appendChild(saveButton);
            
            // Append the item div to the container
            storageItems.appendChild(itemDiv);
        }
    }


    function triggerCrash() {
        if (localStorage.crash_count == null) {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "1") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_1")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "2") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_2")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "3") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_3")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "4") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_4")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "5") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_5")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "6") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_6")}</p>
                </div>
            `;
            crashCountIncrease()
        } else if (localStorage.crash_count == "7") {
            if (localStorage.dev == "true") {
                document.body.innerHTML = `
                    <div class="crash-info-container">
                        <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                        <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                        <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_DEV")}</p>
                    </div>
                `;
            } else {
                document.body.innerHTML = `
                    <div class="crash-info-container">
                        <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                        <p style="font-size: 20px;">${getTextString("CRASH_EASTER_EGG_7")}</p>
                    </div>
                `;
            }
            crashCountIncrease()
        } else if (localStorage.crash_count == "8") {
            document.body.innerHTML = `
                <div class="crash-info-container">
                    <p style="font-size: 34px;">${getTextString("CRASH_UH_OH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_REFRESH")}</p>
                    <p style="font-size: 20px;">${getTextString("CRASH_SUPPORT")}</p>
                </div>
            `;
        }
    }

    window.addEventListener('error', (event) => {
        if (event.message.includes("is not defined")) {
            triggerCrash();
        }
    });

    function crashCountIncrease() {
        // Retrieve the counter from localStorage or initialize it to 0
        let crashCount = parseInt(localStorage.getItem('crash_count')) || 0;
    
        // Increment the counter
        crashCount++;
    
        // Store the updated counter back to localStorage
        localStorage.setItem('crash_count', crashCount);
    }

    function heartBeat() {
        fetch(api + HEARTBEAT_DATA, {
            method: "GET",
            headers: {
                "Token": api_token
            }
        })
            .then(response => response.json())
            .then(data => {
                console.log('sending heartbeat');

                if (isFirstHeartbeat === true && localStorage.ongoing_discord_event_version != data.ongoing_discord_events[0].version) {

                }

                if (app_version2 === "Dev") {
                    if (app_version1 != data.latest_version_dev) {
                        console.log(`${getTextString("HEARTBEAT_UPDATE_READY")}`)

                        let update_button = document.createElement("div");

                        update_button.style.position = 'absolute';
                        update_button.style.marginLeft = '70px';
                        update_button.style.marginTop = '-5px';
                        update_button.innerHTML = `
                            <button type="button" class="card-button" onClick="location.reload();">
                                <div class="contents_dd4f85">${getTextString("HEARTBEAT_UPDATE_READY")}</div>
                            </button>
                        `;


                        document.body.appendChild(update_button);
                    }
                } else if (app_version2 === "Stable") {
                    if (app_version1 != data.latest_version_stable) {
                        console.log(`${getTextString("HEARTBEAT_UPDATE_READY")}`)

                        let update_button = document.createElement("div");

                        update_button.style.position = 'absolute';
                        update_button.style.marginLeft = '70px';
                        update_button.style.marginTop = '-5px';
                        update_button.innerHTML = `
                            <button type="button" class="card-button" onClick="location.reload();">
                                <div class="contents_dd4f85">${getTextString("HEARTBEAT_UPDATE_READY")}</div>
                            </button>
                        `;


                        document.body.appendChild(update_button);
                    }
                }
                isFirstHeartbeat = false;
            })
            .catch(error => console.error('Error fetching data:', error));
    }

    let isFirstHeartbeat = true;
    
    if (localStorage.experiment_2025_03_heartbeat === "Treatment 1: Fetch once on startup") {
        heartBeat();
    } else if (localStorage.experiment_2025_03_heartbeat === "Treatment 2: Fetch every 60 seconds") {
        heartBeat();
        setInterval(heartBeat, 60000);
    }

    function copyNotice(type) {
        if (type === "copylink") {
            string = getTextString("SHOP_LINK_COPY_SUCCESS");
        } else if (type === "copysku") {
            string = getTextString("SHOP_SKU_ID_COPY_SUCCESS");
        } else if (type === "copyemoji") {
            string = getTextString("SHOP_EMOJI_COPY_SUCCESS");
        } else if (type === "logintrue") {
            string = getTextString("SHOP_DISCORD_LOGIN_SUCCESS");
        } else if (type === "loginfalse") {
            string = getTextString("SHOP_DISCORD_LOGIN_FAIL");
        } else {
            string = getTextString("SHOP_LINK_COPY_FAIL");
            console.warn('Invalid copyNotice')
        }

        let copyNotice = document.createElement("div");

        copyNotice.classList.add('copy-notice-container');
        copyNotice.innerHTML = `
            <p>${string}</p>
        `;
                     
        document.body.appendChild(copyNotice);
        setTimeout(() => {
            copyNotice.remove();
        }, 5000);
    }

    function scrollToSKU(sku_id, noscroll) {
        const itemSKUForScroll = params.get("itemSkuId");
        const justScrollSKU = params.get("scrollTo");

        if (itemSKUForScroll === sku_id) {
            setTimeout(() => {
                try {
                    if (noscroll != "true") {
                        document.getElementById(itemSKUForScroll).scrollIntoView({ behavior: "smooth" });
                    }
                    document.getElementById(sku_id).classList.add("highlighted")

                    let highlightedGlint = document.createElement("div");

                    highlightedGlint.classList.add('shop-category-highlighted-glint');

                    document.getElementById(sku_id).appendChild(highlightedGlint);
                    setTimeout(() => {
                        highlightedGlint.remove();
                    }, 3000);
                }
                catch(error) {
                    scrollToSKU(sku_id)
                }
            }, 10);
        } else if (justScrollSKU === sku_id) {
            setTimeout(() => {
                try {
                    if (noscroll != "true") {
                        document.getElementById(justScrollSKU).scrollIntoView({ behavior: "smooth" });
                    }
                    document.getElementById(sku_id).classList.add("highlighted")

                    let highlightedGlint = document.createElement("div");

                    highlightedGlint.classList.add('shop-category-highlighted-glint');

                    document.getElementById(sku_id).appendChild(highlightedGlint);
                    setTimeout(() => {
                        highlightedGlint.remove();
                        removeParams('scrollTo');
                    }, 3000);
                }
                catch(error) {
                    scrollToSKU(sku_id)
                }
            }, 10);
        }
    }

    function openInDiscordShop(sku_id, type, from, unpublished_data, category_sku_id) {
        if (params.get("page") === "shop" && from === "card" && unpublished_data != "null" && localStorage.dismissible_open_in_shop_notice != "Treatment 1: Seen") {
            createModal(getTextString("SHOP_UNPUBLISHED_WARNING"));
        } else if (params.get("page") === "orbs" && from === "card" && localStorage.dismissible_open_in_shop_notice != "Treatment 1: Seen") {
            createModal(getTextString("SHOP_MISCELLANEOUS_WARNING"));
        } else if (params.get("page") === "leaks" && from === "card" && localStorage.dismissible_open_in_shop_notice != "Treatment 1: Seen") {
            createModal(getTextString("SHOP_UNRELEASED_WARNING"));
        } else if (params.get("page") === "miscellaneous" && from === "card" && localStorage.dismissible_open_in_shop_notice != "Treatment 1: Seen") {
            createModal(getTextString("SHOP_MISCELLANEOUS_WARNING"));
        } else if (category_sku_id === discord_categories.NAMEPLATE && from === "card" && localStorage.dismissible_open_in_shop_notice != "Treatment 1: Seen") {
            createModal(getTextString("SHOP_ROLLING_OUT_WARNING"));
        } else if (params.get("page") === "nameplates" && category_sku_id === discord_categories.NAMEPLATE_TEST && from === "card" && localStorage.dismissible_open_in_shop_notice != "Treatment 1: Seen") {
            createModal(getTextString("SHOP_MISCELLANEOUS_WARNING"));
        } else {
            location.href='https://discord.com/shop#itemSkuId=' + sku_id;
        }

        function createModal(string) {
            let modal = document.createElement("div");

            modal.classList.add('modalv2');

            modal.innerHTML = `
                <div class="modalv2-inner open-in-shop">
                    <p style="text-align: center; min-width: 800px;">${string}</p>
                    <div data-modal-top-product-buttons>
                        <div title="Close" data-close-product-card-button>
                            <svg class="closeIcon_modal" aria-hidden="true" role="img" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" d="M17.3 18.7a1 1 0 0 0 1.4-1.4L13.42 12l5.3-5.3a1 1 0 0 0-1.42-1.4L12 10.58l-5.3-5.3a1 1 0 0 0-1.4 1.42L10.58 12l-5.3 5.3a1 1 0 1 0 1.42 1.4L12 13.42l5.3 5.3Z" class=""></path></svg>
                        </div>
                    </div>
                    <div class="card-button-container open-in-shop">
                        <div class="card-multi-button-container open-in-shop">
                            <button class="card-button" onclick="location.href='https://discord.com/shop#itemSkuId=${sku_id}';">${getTextString("SHOP_MODAL_UNPUBLISHED_WARNING_CONTINUE")}</button>
                            <button class="card-button" onclick="openAndDismiss('${sku_id}')">${getTextString("SHOP_MODAL_UNPUBLISHED_WARNING_CONTINUE2")}</button>
                            <button class="card-button" data-go-back-button>${getTextString("SHOP_MODAL_UNPUBLISHED_WARNING_GO_BACK")}</button>
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            setTimeout(() => {
                modal.classList.add('show');
            }, 1);

            let modal_back = document.createElement("div");

            modal_back.classList.add('modalv2-back');
            modal_back.id = 'modalv2-back';

            document.body.appendChild(modal_back);

            setTimeout(() => {
                modal_back.classList.add('show');
            }, 1);


            modal.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.classList.remove('show');
                    modal_back.classList.remove('show');
                    setTimeout(() => {
                        modal.remove();
                        modal_back.remove();
                    }, 300);
                }
            });

            modal.querySelector("[data-close-product-card-button]").addEventListener('click', () => {
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            });

            modal.querySelector("[data-go-back-button]").addEventListener('click', () => {
                modal.classList.remove('show');
                modal_back.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                    modal_back.remove();
                }, 300);
            });
        }
    }

    function openAndDismiss(sku_id) {
        localStorage.dismissible_open_in_shop_notice = "Treatment 1: Seen";
        location.href='https://discord.com/shop#itemSkuId=' + sku_id;
    }
    
    


    function getTextString(variableName) {
        return window[variableName] || variableName; // Uses the variable if it exists, otherwise keeps ${TEXT}
    }
    // getTextString("")
    // ${getTextString("")}
}
